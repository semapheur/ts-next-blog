---
title: 'Smooth Manifolds'
subject: 'mathematics/differential_geometry'
showToc: true
references:
  - book_lee_2012
  - book_majumdar_bhattacharyya_2023
  - book_sinha_2014
---

# Topological manifolds

<MathBox title='Topological manifold' boxType='definition'>
A topological space $M$ is a topological manifold of dimension $n\in\N_+$ if it has the following properties:
1. $M$ is a *Hausdorff space*: for every pair of distinct points $p,q\in M$ there are disjoint subsets $U, V\subseteq M$ such that $p\in U$ and $q \in V$.
2. $M$ is *second-countable*: there exists a countable basis for the topology of $M$.
3. $M$ is *locally Euclidean of dimension* $n$: each point of $M$ has a neighbourhood that is homemorphic to an open subset of $\R^n$.

<details>
<summary>Details</summary>

More specifically, the third property means that for each $\mathbf{p}\in M$ we can find
- an open subset $U\subseteq M$ containing $p$
- an open subset $\U' \subseteq\R^n$
- a homeomorphism $\varphi: U'\to\U'$
</details>
</MathBox>

An $n$-dimensional topological manifold is a Hausdorff topological space $(M, \mathcal{T})$ with a second-countable basis for the topology which is locally homeomorphic to $\R^n$ (Euclidean space).

## Coordinate charts

<MathBox title='Coordinate chart' boxType='definition'>
A (coordinate) chart on a topological $n$-manifold $M$ is a pair $(U, \varphi)$ where $U$ is an open subset of $M$, called a coordinate domain/neighbourhood, and $\varphi:U\to \tilde{U}$, called a (local) coordinate map/system, is a homemorphism to an open subset $\tilde{U} = \varphi(U)\subseteq\R^n$. A chart is *centered* on $\mathbf{p}\in U$ if $\varphi(\mathbf{p}) = 0$.

The collection of charts $\mathcal{A} := \Set{ \left( U_\alpha, \varphi_\alpha \right) }$ covering $M$, i.e. $M = \bigcup_\alpha U_\alpha$, is called an atlas. 
</MathBox>

Given a chart $(U, \varphi)$, the coordinate domain $U$ get some special names depending on the shape of the image $\varphi(U)$:
- if $\varphi(U)$ is an open ball, $U$ is called a *coordinate ball*
- if $\varphi(U)$ is an open cube, $U$ is called a *coordinate cube*

Because a topological $n$-manifold $M$ is locally homeomorphic to $\R^n$, each point $p \in M$ is contained in the domain of some chart $(U,\varphi)$.

If $(r^i)_{i=1}^n$ are the standard coordinates on $\R^n$, the $i$th component of $\varphi = (x^i)_{i=1}^n$ is given by $x^i = r^i \circ\varphi$. The functions $x^i : U\to\R$ are called the *(local) coordinates* on  $U$.

## Submanifolds

If $M$ is an $n$-manifold, then $M_0 \subseteq M$ is called a $k$-dimensional submanifold of $M$ if for all $\mathbf{p}\in M_0$ there is a chart $(U, h)$ of $M$ with

$$
  h\left[M_0 \cap U \right] = \left(\R^k \times \mathbf{0}_{n-k} \right) \cup U'
$$

where $(U, h)$ is called a submanifold chart for $M_0$.

## $n$-sphere

For $n\in\N_+$, a unit $n$-sphere is defined as (in terms of the Euclidean norm) the set

$$
  \mathbb{S}^n := \Set{\mathbf{x} \in\R^{n+1} | \norm{ \mathbf{x}} = 1}
$$

An $n$-sphere is a topological subspace of $\R^{n+1}$ and is thus Hausdorff and second-countable. To show that an $n$-sphere is locally homeomorphic to $\R^n$, note that it it can be covered by open sets given by 

$$
  U_i^\pm := \Set{(x^i)_{i=1}^{n+1} \in\R^{n+1} | \pm x^i > 0}
$$

where $U_i^+$ and $U_i^-$ denote the subsets of $\R^{n+1}$ where the $i$th coordinate is positive and negative, respectively. 

Let $f:B^n \to\R$ be the continuous function $f(\mathbf{u}) = \sqrt{1 - \|\mathbf{u}\|^2}$, where $B^n$ is the unit $n$-ball. For each $i=1,\dots,n+1$, it is easily seen that $U_i^+ \cap \mathbb{S}^n$ is the grap of the function

$$
  x^i = f(x^1,\dots, x^{i-1},x^{i+1},\dots,x^{n+1})
$$

Similarly, $U_i^- \cap \mathbb{S}^n$ is the graph of the function

$$
  x^i = -f(x^1,\dots, x^{i-1},x^{i+1},\dots,x^{n+1})
$$

Thus, each subset $U_i^\pm \cap \mathbb{S}^n$ is locally homeomorphic to $\R^n$ and the maps $\varphi_i^\pm (x^1,\dots,x^{n+1}) = (x^1,\dots,x^{i-1},x^{i+1},\dots,x^n)$, removing the $i$th coordinate, are graph coordinates for $\mathbb{S}^n$. Since each point of $\mathbb{S}^n$ is in the domain of least one of these $2n + 2$ charts, $\mathbb{S}^n$ is a topological $n$-manifold.

<LatexFigure width={50} src='/fig/n_sphere_chart.svg' alt=''
  caption='Charts for n-sphere'
>
```latex
\documentclass[tikz]{standalone}
\usepackage{amssymb}
\usepackage{tikz}

\begin{document}

\def\r{1}

\begin{tikzpicture}[every node/.style={font=\small}]

  % n-sphere
  \begin{scope}
    % Hemispheres
    \fill[red!30] (\r, 0) arc (0:-180:\r{} and \r/3) arc (180:0:\r);
    \fill[blue!30] (\r, 0) arc (0:-180:\r{} and \r/3) arc (-180:0:\r);

    \draw[gray, dashed] (\r, 0) arc(0:180:\r{} and \r/3);
    \draw[gray] (\r, 0) arc(0:-180:\r{} and \r/3);

    % Axes
    \draw[->] (-1.25*\r, 0) -- (1.5*\r, 0);
    \draw[->] (0,-1.25*\r) -- (0,1.5*\r) node[above] {$x^i$};
    \draw[->] (1.5*\r/5, 1.5*\r/3) -- (-1.5*\r/5, -1.5*\r/3);

    % Labels
    \node at (60:\r) [above right, red] {$U_i^+ \cap \mathbb{S}^n \subseteq\mathbb{R}^{n+1}$};
    \node at (-60:\r{}) [below right, blue] {$U_i^- \cap \mathbb{S}^n \subseteq\mathbb{R}^{n+1}$};
  \end{scope}

  % R^n
  \begin{scope}[shift={(0,-\r*3)}]
    % Elipse
    \filldraw[fill=gray!20, dashed] (0,0) ellipse (\r{} and \r/3);

    % Axes
    \draw[->] (-1.25*\r, 0) -- (1.5*\r, 0);
    \draw[->] (1.5*\r/5, 1.5*\r/3) -- (-1.5*\r/5, -1.5*\r/3);

    % Labels
    \node at (45:\r/2) [above right] {$B^n \subseteq\mathbb{R}^n$};

    % Map
    \path[->] (-0.5*\r, 2*\r) edge[bend right] node[left] {$\varphi_i$} (-0.5*\r, 0.5\r);
  \end{scope}

\end{tikzpicture}

\end{document}
```
</LatexFigure>

## Projective space

Recall that the projective space is defined as $P_n (\R) := \mathbb{S}^n / \sim$ with the equivalence relation $\mathbf{x}\sim \mathbf{y} :\iff \mathbf{x}=\pm \mathbf{y}$. The canonical projection $\pi: \mathbb{S}^n \rightarrow \mathbb{S}^n / \sim$ is given by $\mathbf{x} \mapsto [\mathbf{x}]_\sim$. The projective space can be covered by open sets

$$
  V_i := \Set{ [\mathbf{x}]_\sim \in P_n (\R) | x^i \neq 0 }
$$

The pre-image of $V_i$ under $\pi$ is given by 

$$
  \pi^{-1}\left[ V_i \right] = U_i^+ \cup U_i^-
$$

where $U_i^\pm := \Set{\mathbf{x} \in \R^{n+1} | \pm x^i > 0}$ are open hemispheres. 

Define charts $\varphi_i : V_i \rightarrow \tilde{V}_i \subseteq \R^n$ can be formed by taking the slopes with respect to the $i$th component

$$
  \varphi_i\left( [\mathbf{x}]_\sim \right) = \left( \frac{x^1}{x^i}, \dots, \frac{x_{i-1}}{x^i},\frac{x^{i+1}}{x^i},\dots,\frac{x^{n+1}}{x^i} \right)
$$

This map is well-defined because its value is unchanged by multiplying $x$ by a nonzero constant. Because $\varphi_i \circ \pi$ is continuous, $\varphi_i$ is continuous by the characteristic property of quotient maps. It is in fact a hemomorphism with a continuous inverse

$$
  \varphi^{-1}\left(\tilde{x}^i \right) = \frac{1}{\sqrt{1 + \left(\tilde{x}^i \right)^2}}\left( \tilde{x}^1,\dots, \tilde{x}^{i-1}, 1, \tilde{x}^{i+1}, \dots, \tilde{x}^{n} \right)
$$

## Topological properties of manifolds

<MathBox title='' boxType='lemma'>
Every topological manifold has a countable basis of precompact coordinate balls.

<details>
<summary>Proof</summary>

Let $M$ be a topological $n$-manifold. First, we consider the special case in which $M$ can be covered by a single chart. Support $\varphi: M\to \tilde{U} \subseteq\R^n$ is a global coordinate map, and let $\mathcal{B}$ be the collection of all open balls $B_r (\mathbf{x})\subseteq\R^n$ such that $r$ is rational, $x$ has rational coordinates, and $B_{r'}(\mathbf{x}) \subseteq \tilde{U}$ for some $r' > r$. Each such ball is precompact in $\tilde{U}$, and it is easy to check that $\mathcal{B}$ is a countable basis for the topology of $\tilde{U}$. Because $\varphi$ is homeomorphism, it follows that the collection of sets of the form $\varphi^{-1}(B)$ for $B\in\mathcal{B}$ is a countable basis for the topology of $M$, consisting of precompact balls, with the restrictions of $\varphi$ as coordinate maps.

Next, let $M$ be an arbitrary $n$-manifold. By definition, each point $M$ is in the domain of a chart. Because every open cover of a second-countable space has a countable subcover, $M$ is covered by countably many charts $\Set{(U_i, \varphi_i)}_{i\in I \subseteq\N}$. By the preceding argument, each coordinate domain $U_i$ has a countable basis of coordinate balls that are precompact in $U_i$, and the union of all these countable basis is a countable basis for the topology of $M$. If $V\subseteq U_i$ is one of these balls, then the closure of $V$ in $U_i$ is compact, and because $M$ is Hausdorff, it is closed in $M$. It follows that the closure of $V$ in $M$ is the same as its closure in $U_i$, so $V$ is precompact in $M$ as well.
</details>
</MathBox>

<MathBox title='Connectivity properties of manifolds' boxType='proposition'>
If $M$ is a topological manifold, then
1. $M$ is locally path-connected
2. $M$ is connected if and only if it is path-connected
3. the components of $M$ are the same as its path components
4. $M$ has countably many components, each of which is an open subset of $M$ and a connected topological manifold

<details>
<summary>Proof</summary>

Since each coordinate ball is path-connected, **(1)** follows from the fact that $M$ has a basis of coordinate balls. Parts **(2)** and **(3)** follow directly from **(1)**. To prove **(4)**, note the each component is open in $M$ by proposition *X*, so the collection of components is an open cover of $M$. Because $M$ is second-countable, this cover must have a countable subcover. Since the components are all disjoint, the cover must have been countable to begin with, which is to say that $M$ has only countably many components. Because the components are open, they are connected topological manifolds in the subspace topology.
</details>
</MathBox>

<MathBox title='Manifolds are locally compact' boxType='proposition'>
Every topological manifold is locally compact.

<details>
<summary>Proof</summary>

This follows directly from the fact that every manifold has a basis of precompact open subsets.
</details>
</MathBox>

<MathBox title='Paracompactness' boxType='definition'>
Let $M$ be a topological space. A collection $\mathcal{X}$ of subsets of $M$ is *locally finite* if each point of $M$ has a neighbourhood that intersects at most finitely many of the sets in $\mathcal{X}$. Given a cover $\mathcal{U}$ of $M$, another cover $\mathcal{V}$ is a called a refinement of $U$ if for each $V\in\mathcal{V}$ there exists some $U\in\mathcal{U}$ such that $V\subseteq U$. We say that $M$ is paracompact if every open cover of $M$ admits an open, locally finite refinement.
</MathBox>

<MathBox title='Manifolds are paracompact' boxType='theorem'>
Every topological manifold is paracompact. In fact, given a topological manifold $M$, an open cover $\mathcal{X}$ of $M$, and any basis $\mathcal{B}$ for the topology of $M$, there exists a countable, locally finite open refinement of $\mathcal{X}$, consisting of elements of $\mathcal{B}$.

<details>
<summary>Proof</summary>

Let $(K_j)_{j=1}^\infty$ be an exhaustion of $M$ by compact sets. For each $j$, let $V_j = K_{j+1}/\mathrm{int}(K_j)$ and $W_j = \mathrm{int}(K_{j+1})/K_{j-1}$, where $K_j = \emptyset$ for $j < 1$. Then $V_j$ is a compact set contained in the open subset $W_j$. For each $x\in V_j$ there is some $X_x \in \mathcal{X}$ containing $x$, and because $\mathcal{B}$ is a basis, there exists $B_x \in \mathcal{B}$ such that $x\in B_x \subseteq X_x \cap W_j$. The collection of all such sets $B_x$ as $x$ ranges over $V_j$ is an open cover of $V_j$, and thus has a finite subcover. The union of all such finite subcovers as $j$ ranges over the positive integers is a countable open cover of $M$ that refines $\mathcal{X}$. Because the finite subcover of $V_j$ consists of sets contained in $W_j$, and $W_j \cap W_{j'} = \emptyset$ except when $j-2 \leq j' \leq j+2$, the resulting cover is locally finite.
</details>
</MathBox>

## Manifolds with boundary

<MathBox title='Upper half space' boxType='definition'>
The upper half space $\mathbb{H}^n \subseteq\R^n$ is defined as

$$
  \mathbb{H}^n := \Set{(x^i)_{i=1}^n \in\R^n | x^n \geq 0}
$$

with interior $\mathrm{int}(\mathbb{H}^n)$ and boundary $\partial \mathbb{H}^n$ given by

$$
\begin{align*}
  \mathrm{int}(\mathbb{H}^n) =& \Set{(x^i)_{i=1}^n \in\R^n | x^n > 0} \\
  \partial \mathbb{H}^n =& \Set{(x^i)_{i=1}^n \in\R^n | x^n = 0}
\end{align*}
$$

If $n=0$, then $H^0 = \R^0 = \Set{0}$ with $\mathrm{int}(\mathbb{H}^n) = \R^0$ and $\partial H^0 = \emptyset$.
</MathBox>

A topological $n$-manifold with boundary is a second-countable Hausdorff space $M$ in which every point has a neighbourhood homoemorphic either to an open subset of $\R^n$ or to a (relatively) open subset of $\mathbb{H}^n$.

An open subset $U\subseteq M$ together with a map $\varphi: U\to\R^n$ that is homeomorphic with an open subset of $\R^n$ or $\mathbb{H}^n$ is called a chart for $M$. If $\varphi(U)$ is a open subset of $\R^n$, including an open subset of $\mathbb{H}^n$ that does not intersect $\partial \mathbb{H}^n$, then $(U,\varphi)$ is an interior chart. If $\varphi(U)$ is an open subset of $\mathbb{H}^n$ such that $\varphi(U)\cap\partial \mathbb{H}^n \neq\emptyset$, then $(U,\varphi)$ is called a *boundary chart*. A boundary chart whose image is a set of the form $B_r(\mathbf{x}) \cap \mathbb{H}^n$ for some $\mathbf{x}\in\partial \mathbb{H}^n$ and $r > 0$ is called a *coordinate half-ball*.

A point $\mathbf{p}\in M$ is called an *interior point* of $M$, i.e. $p\in\mathrm{int}(M)$ if it is in the domain of some interior chart. It is a *boundary point* of $M$, i.e. $p\in\partial M$, if it is in the domain of a boundary chart that sends $p$ to $\partial \mathbb{H}^n$.

<MathBox title='Topological invariance of the boundary' boxType='theorem'>
If $M$ is a topological manifold with boundary, then each point of $M$ is either a boundary point or an interior point, but not both. Thus, $\partial M$ and $\mathrm{int}(M)$ are disjoint sets whose union is $M$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a topological $n$-manifold with boundary.
1. $\mathrm{int}(M)$ is an open subset of $M$ and a topological $n$-manifold without boundary
2. $\partial M$ is a closed subset of $M$ and a topological $(n-1)$-manifold without boundary
3. $M$ is a topological manifold if and only if $\partial M = \emptyset$
4. if $n=0$, then $\partial M = \emptyset$ and $M$ is a $0$-manifold
</MathBox>

# Smooth manifolds

## Smooth structure

<MathBox title='Diffeomorphism' boxType='definition'>
Let $U \subseteq \R^n$ and $U \subseteq \R^m$ be open subsets of Euclidean space. A function $f: U \rightarrow V$ is $k$-times continuously differentiable, i.e. $f \in C^k$, if all partial derivatives of $f$ up to the $k$-th order exist and are continuous. For $k=\infty$, then $f\in C^\infty$ is called *smooth* or *infinitely differentiable*. If $f$ is bijective with a differentiable inverse map, it is called a *diffeomorphism*, which by definition is a homeomorphism.
</MathBox>

<MathBox title='' boxType='proposition' tag='proposition-4'>
If $(U,\varphi)$ is a chart on a manifold $M$ of dimension $n$, then the coordinate map $\varphi:U\to\varphi(U)\subseteq\R^n$ is a diffeomorphism.

<details>
<summary>Proof</summary>

By definition, $\varphi$ is a homemorphism, so it suffices to check that both $\varphi$ and $\varphi^{-1}$ are smooth. To test the smoothness of $\varphi:U\to\varphi(U)$, we use the atlas $\Set{(U,\varphi)}$ with a single chart on $U$ and the atlas $\Set{(\varphi(U), \operatorname{id}_{\varphi(U)})}$ with a single chart on $\varphi(U)$. Since $\operatorname{id}_{\varphi(U)} \circ \varphi\circ\varphi^{-1}: \varphi(U)\to\varphi(U)$ is the identity map, it is smooth. By proposition $\ref{proposition-11}$**(2)**$\implies$**(1)**, $\varphi$ is smooth. To test the smoothness of $\varphi^{-1}:\varphi(U)\to U$, we use the same atlas as above. Since $\varphi\circ\varphi^{-1}\circ\operatorname{id}_{\varphi(U)} = \operatorname{id}_{\varphi(U)}$, the inverse $\varphi^{-1}$ is also smooth.
</details>
</MathBox>

<MathBox title='Smoothly compatible charts' boxType='definition'>
Let $(U, \varphi:U\to\R^n)$ and $(V,\psi:V\to\R^n)$ be two charts of a topological $n$-manifold $M$. The compositions

$$
  \varphi\circ\psi^{-1} : \psi(U\cap V)\to\varphi(U\cap V) \\
  \psi\circ\varphi^{-1} : \varphi(U\cap V)\to\psi(U\cap V)
$$

are called the *transition functions* between the the charts. As compositions of homeomorphism, they are themselves homeormorphic. The two charts are *smoothly compatible* or $C^\infty$-compatible if either $U\cap V = \emptyset$ of the transition functions are diffeomorphic.
</MathBox>

<MathBox title='Smooth atlas' boxType='definition'>
An atlas $\mathcal{A}$ on a topological manifold $M$ is *smooth* $(C^\infty)$ if any two charts in $\mathcal{A}$ are smoothly compatible with each other. A smooth atlas $\mathcal{A}$ is *maximal* (complete) if it is not properly contained in any larger smooth atlas. 
</MathBox>

<MathBox title='A smooth atlas on a circle' boxType='example'>
The unit circle in the complex plane $\mathbb{C}$ is the set

$$
  \mathbb{S}^1 = \Set{e^{it}\in\mathbb{C} | 0 \leq t \leq 2\pi}
$$

Let $U_1$ and $U_2$ be the two open subsets of $\mathbb{S}^1$.

$$
\begin{align*}
  U_1 =& \Set{e^{it}\in\mathbb{C} |  -\pi < t < \pi}
  U_2 =& \Set{e^{it}\in\mathbb{C} | 0 < t < 2\pi}
\end{align*}
$$

and define $\varphi_\alpha : U_\alpha \to\R$ for $\alpha = 1,2$ by

$$
\begin{align*}
  \varphi_1 (e^{it}) =& t,\; -\pi < t < \pi\\
  \varphi_2 (e^{it}) =& t,\; 0 < t < 2\pi
\end{align*}
$$

Both $\varphi_1$ and $\varphi_2$ are branches of the complex log function $\frac{1}{i}\ln(z)$ for $z\in\mathbb{C}$ and are homeomorphisms onto their respective images. Thus, $(U_1,\varphi_1)$ and $(U_2,\varphi_2)$ are charts on $\mathbb{S}^1$. The intersection $U_1 \cap U_2$ consists of two connected components

$$
\begin{align*}
  A =& \Set{e^{it} | -\pi < t < 0} \\
  B =& \Set{e^{it} | 0 < t < \pi}
\end{align*}
$$

with

$$
\begin{align*}
  \phi_1 (U_1 \cap U_2) =& \varphi_1 (A \sqcup B) = \varphi_1 (A) \sqcup \varphi_2 (B) = (-\pi,0) \sqcup (0,\pi) \\
  \phi_1 (U_1 \cap U_2) =& \varphi_1 (A \sqcup B) = \varphi_1 (A) \sqcup \varphi_2 (B) = (\pi,2\pi) \sqcup (0,\pi)
\end{align*}
$$

The transition function $\varphi_2 \circ \varphi_1^{-1} : \varphi(A \sqcup B) \to \varphi_2 (A \sqcup B)$ is given by

$$
  (\varphi_2 \circ \varphi_1^{-1})(t) = \begin{cases} 
    t + 2\pi\, \quad& t\in(-\pi,0) \\ 
    t, \quad& t\in (0,\pi)  
  \end{cases}
$$

Similarly,

$$
  (\varphi_1 \circ \varphi_2^{-1})(t) = \begin{cases} 
    t - 2\pi\, \quad& t\in(\pi,2\pi) \\ 
    t, \quad& t\in (0,\pi)
  \end{cases}
$$

Thus, $(U_1,\varphi_1)$ and $(U_2,\varphi_2)$ are smoothly compatible charts and form a smooth atlas on $\mathbb{S}^1$.
</MathBox>

<MathBox title='' boxType='lemma'>
Let $\mathcal{A} = \Set{(U_\alpha, \varphi_\alpha)}$ be an atlas on a locally Euclidean space. If two charts $(V,\psi)$ and $(W,\sigma)$ are both compatible with the atlas $\mathcal{A}$, then they are compatible with each other.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in V\cap W$. We need to show that $\sigma\circ\psi^{-1}$ is smooth at $\psi(\mathbf{p})$. Since $\mathcal{A}$ is an atlas for $M$, then $\mathbf{p}\in U_\alpha$ for some $\alpha$. Thus, $\mathbf{p}\in V\cap W \cap U_\alpha$.

Furthermore, $\sigma\circ\psi^{-1} = (\sigma\circ\varphi_\alpha^{-1})\circ(\varphi_\alpha\circ\psi^{-1})$ (with equality in the common domain) is smooth on $\psi(V\cap W\cap U_\alpha)$, hence at $\psi(\mathbf{p})$. Since $\mathbf{p}$ is an arbitrary point $V\cap W$, this proves that $\sigma\circ\psi^{-1}$ is smooth on $\psi(V\cap W)$. Similarly, $\psi\circ\sigma^{-1}$ is smooth on $\sigma(V\cap W)$.
</details>
</MathBox>

<MathBox title='Smooth manifold' boxType='definition'>
A smooth or $C^\infty$ manifold is a pair $(M,\mathcal{A})$ of topological manifold $M$ equipped with a maximal smooth atlas $\mathcal{A}$, called a smooth (differentiable) structure. A smooth manifold has dimension $n$ if all its connected components have dimension $n$. A $1$-dimensional manifold is also called a *curve*, a $2$-dimensional manifold a *surface*, and an *n*-dimensional manifold an *n-manifold*. 
</MathBox>

The notion of smooth structure can be specified in different ways by changing the compatibility requirements for charts:
- A $C^k$ structure requires each transition map to be $C^k$ diffeomorphic. A manifold endowed with such a structure is called a $C^k$ manifold.
- A *real-analytic structure* requires that each transition map is expressible as a convergent power series in a neighbourhood of each point. A manifold endowed with such a structure is called a *real-analytic manifold*.
- If $M$ has even dimension $n = 2m$, we can identify $\R^{2m}$ with $\mathrm{C}^m$ and require that the transition maps be complex-analytic, yielding a *complex-analytic manifold*.

<MathBox title='' boxType='proposition'>
Let $M$ be a topological $n$-manifold.
1. Every smooth atlas $\mathcal{A}$ for $M$ is contained in a unique maximal smooth atlas, called the smooth structure determined by $\mathcal{A}$.
2. Two smooth atlases for $M$ determine the same smooth structure if and only if their union is a smooth atlas.

<details>
<summary>Proof</summary>

**(1):** Let $\mathcal{A}$ be a smooth atlas for $M$ and let $\overline{\mathcal{A}}$ denote the set of all charts that are smoothly compatible with every chart in $\mathcal{A}$. To show that $\overline{\mathcal{A}}$ is a smooth atlas, we need to show that any two charts of $\overline{\mathcal{A}}$ are smoothly compatible with each other, that is for ny $(U,\varphi), (V,\psi)\in\overline{\mathcal{A}}$, the transition map $\psi\circ\varphi^{-1}: \varphi(U\cap V)\to \psi(U\cap V)$ is smooth.

Let $\mathbf{x} = \varphi(p) \in \varphi(U \cap V)$ be arbitrary. Because that domains of the charts in $\mathcal{A}$ cover $M$, there is some chart $(W,\theta)\in\mathcal{A}$ such that $p\in W$. Since every chart in $\overline{\mathcal{A}}$ is smoothly compatible with $(W,\theta)$, both of the maps $\theta\circ\varphi^{-1}$ and $\psi\circ\theta^{-1}$ are smooth where they are defined. Since $p\in U\cap V\cap W$, it follows that $\psi\circ\varphi^{-1} = (\psi\circ\theta^{-1})\circ(\theta\circ\varphi^{-1})$ is smooth on a neighbourhood of $\mathbf{x}$. Thus, $\psi\circ\varphi^{-1}$ is smooth in a neighbourhood of each point in $\varphi(U\cap V)$. Therefore, $\mathcal{A}$ is a smooth atlas. To that it is maximal, note that any chart that is smoothly compatible with every chart in $\overline{\mathcal{A}}$ must in particular be smoothly compatible with every chart in $\mathcal{A}$, so it is already on $\overline{\mathcal{A}}$. This proves the existence of a maximal smooth atlas containing $\mathcal{A}$. If $\mathcal{B}$ is any other maximal smooth atals containin $\mathcal{A}$, each of its charts is smoothly compatible with each chart in $\mathcal{A}$, so $\mathcal{B}\subseteq\overline{\mathcal{A}}$. By maximality of $\mathcal{B}$, it follows that $\mathcal{B} = \overline{\mathcal{A}}$.
</details>
</MathBox>

<MathBox title='Atlas for product manifolds' boxType='proposition'>
If $\Set{(U_\alpha, \varphi_\alpha)}$ and $\Set{(V_\beta, \psi_\beta)}$ are smooth atlases for the manifolds $M$ and $N$ of dimensions $m$ and $n$, respectively, then the collection

$$
  \Set{(U_\alpha \times V_\beta, \varphi_\alpha \times \psi_\beta : U_\alpha \times V_\beta \to \R^m \times\R^n)}
$$

of charts is a smooth atlas $M\times N$. Thus, $M\times N$ is a smooth manifold of dimension $m + n$.
</MathBox>

<MathBox title='Regular coordinate ball' boxType='definition'>
If $M$ is a smooth manifold, any set $B\subseteq M$ is a *regular coordinate ball* if there is a smooth coordinate ball $B' \supseteq \overline{B}$ and a smooth coordinate map $\varphi: B' \to\R^n$ such that for some positive real numbers $r < r'$

$$
\begin{align*}
  \varphi(B) =& B_r (0) \\
  \varphi(\overline{B}) =& \overline{B}_r (0) \\
  \varphi(B') = B_{r'}(0)
\end{align*}
$$

Because $\overline{B}$ is homeomorphic to $\overline{B}_r (0)$ it is compact, and thus every regular coordinate ball is precompact in $M$.
</MathBox>

<MathBox title='' boxType='lemma'>
Every smooth manifold has a countable basis of regular coordinate balls.
</MathBox>

## Smooth structures on manifolds with boundary

Recall that a map from an arbitrary subset $A\subseteq\R^n \to\R^n$ is smooth if, in a neighbourhood of each point of $A$, it admits an extension to a smooth map defined on an open subset of $\R^n$. Thus, if $U$ is an open subset of $\mathbb{H}^n$, a map $F:U\to\R^n$ is smooth if for each $\mathbf{x}\in U$, there exists an open subset $\tilde{U}\subseteq\R^n$ containing $\mathbf{x}$ and a smooth map $\tilde{F}:\tilde{U}\to\R^k$ that agrees with $F$ on $\tilde{U}\cap \mathbb{H}^n$.

If $F$ is such a map, the restriction of $F$ to $U\cap\mathrm{int}(\mathbb{H}^n)$ is smooth in the usual sense. By continuity, all partial derivatives of $F$ at points of $U\cap\partial \mathbb{H}^n$ are determined by their values in $\mathrm{int}(\mathbb{H}^n)$, and there in particular are independent of the choice of extension. It is a fact that $F:U\to\R^k$ is smooth in this sense if and only if $F$ is continuous, $F|_{U\cap\mathrm{int}(\mathbb{H}^n)}$ is smooth, and the partial derivatives of $F|_{U\cap\mathrm{int}(\mathbb{H}^n)}$ of all orders have continuous extensions to all of $U$.

Let $M$ be a topological manifold with boundary. A smooth structure for $M$ is defined to be a maximal smooth atlas, a collection of charts whose domains cover $M$ and whose transition maps (and their inverses) are smooth in the sense just described. With such a structure, $M$ is called a smooth manifold with boundary.

A subset $B\subseteq M$ is a *regular coordinate half-ball* if there is a smooth coordinate half-ball $B' \supseteq \overline{B}$ and a smooth coordinate map $\varphi: B'\to \mathbb{H}^n$ such that for some $r' > r > 0$ we have

$$
\begin{align*}
  \varphi(B) =& B_r (\mathbf{0}) \cap \mathbb{H}^n \\
  \varphi(\overline{B}) =& \overline{B}_r(\mathbf{0}) \cap \mathbb{H}^n \\
  \varphi(B') = B_{r'} =& B_{r'} (\mathbf{0}) \cap \mathbb{H}^n
\end{align*}
$$

<MathBox title='' boxType='proposition'>
Suppose $M_1,\dots,M_k$ are smooth manifolds and $N$ is a smooth manifold with boundary. Then $M_1 \times\cdots\times M_k \times N$ is a smooth manifold with boundary, and $\partial(M_1 \times\cdots\times M_k \times N) = M_1 \times\cdots\times M_k \times \partial N$.
</MathBox>

<MathBox title='Smooth invariance of the boundary' boxType='theorem'>
Suppose $M$ is a smooth manifold with boundary and $\mathbf{p}\in M$. If there is some smooth chart $(U,\varphi)$ for $M$ such that $\varphi(U)\subseteq \mathbb{H}^n$ and $\varphi(p)\in \partial \mathbb{H}^n$, the same is true for every smooth chart whose domain contains $p$.

<details>
<summary>Proof</summary>

Suppose on the contrary that $p$ is in the domain of a smooth interior chart $(U,\psi)$ and also in the domain of a smooth boundary chart $(V,\varphi)$ such that $\varphi(p)\in\partial \mathbb{H}^n$. Let $\tau = \varphi\circ\psi^{-1}$ denote the transition map, which is a homeomorphism from $\psi(U\cap V)$ to $\varphi(U \cap V)$. The smooth compatibility of the charts ensures that both $\tau$ and $\tau^{-1}$ are smooth, in the sense that locally they can be extended, if necessary, to smooth maps defined on open subsets of $\R^n$.

Write $\mathbf{x}_0 = \psi(p)$ and $\mathbf{y}_0 = \varphi(p) = \tau(\mathbf{x}_0)$. There is some neighbourhood $W$ of $\mathbf{y}_0$ in $\R^n$ and a smooth function $\eta: W\to\R^n$ that agrees with $\tau^{-1}$ on $W\cap\varphi(U\cap V)$. On the other hand, because we are assuming that $\psi$ is an interior chart, there is an open Euclidean ball $B$ that is centered at $x_0$ and contained in $\varphi(U\cap V)$, so $\tau$ itself is smooth on $B$ in the ordinary sense. After shrinking $B$ if necessary, we may assume $B\subseteq \tau^{-1}(W)$. Then $\eta\circ\tau|_B = \tau^{-1} \circ\tau|_B = \operatorname{id}_B$, so it follows from the chain rule that $\D\eta(\tau(\mathbf{x}))\circ\D\tau(\mathbf{x})$ is the identity map for each $x\in B$. Since $\D\tau(\mathbf{x})$ is a square matrix, this implies that it is non-singular. It follows that $\tau$ as a map from $B\to\R^n$ is an open map, so $\tau(B)$ is an open subset of $\R^n$ that contains $\mathbf{y}_0 = \varphi(p)$ and is contained in $\varphi(V)$. This contradicts the assumption that $\varphi(V)\subseteq \mathbb{H}^n$ and $\varphi(p)\in\partial \mathbb{H}^n$.
</details>
</MathBox>

## Open submanifolds

Let $M$ be an $n$-dimensional manifold, and let $S\subseteq M$ be any open subset. Define an atlas on $S$ as a collection $\mathcal{A}_S$ of smooth charts $(U,\varphi)$ for $M$ such that $U\subseteq S$. Every point $\mathbf{p}\in S$ is contained in the domain of some chart $(V,\varphi)$ for $M$. Setting $W = V\cap U$, then $(W, \varphi|_W)$ is a chart in $\mathcal{A}_S$ whose domain contains $\mathbf{p}$. Thus, $S$ is covered by the domains of charts in $\mathcal{A}_S$, and it is easy to verify that this is a smooth atlas for $S$. Hence, any open subset of $M$ is itself a smooth $n$-manifold in a natural way. Endowed with this smooth structure, any open subset is an *open submanifold* of $M$.

## Smooth maps

Generally, the terms *function* and *map* are synonymous. However, it is convenient to make a distinction between them in studying smooth manifolds. In the following discussion the term *function* is reserved for a map whose codomain is a vector space of fields, usually $\R^n$ and $\mathbb{C}^n$ for $n\in\N_+$. Either of the words *map* or *mapping* can mean any type of relation, such as a map between arbitrary manifolds.

### Smooth functions on manifolds

<MathBox title='Smooth functions on a manifold' boxType='definition'>
Suppose $M$ is a smooth $n$-manifold. A function $f:M\to\R^k$ for $k\in\N_+$ is smooth at a point $\mathbf{p}\in M$, denoted $f\in C_\mathbf{p}^\infty (M)$, if there exists a smooth chart $(U,\varphi)$ containing $\mathbf{p}$ and such that the composite function $f\circ\varphi^{-1}$ defined on the open subset $\tilde{U} = \varphi(U)\subseteq\R^n$, is smooth at $\varphi(\mathbf{p})$. The function $f$ is *smooth* on $M$ if it is smooth at every point of $M$

If $M$ is a smooth manifold with boundary, $\varphi(U)$ is an open subset of either $\R^n$ or $\mathbb{H}^n$, and in the latter case we interpret smoothness of $f\circ\varphi^{-1}$ to mean that each point of $\varphi(U)$ has a neighbourhood on which $f\circ\varphi^{-1}$ extends to a smooth function in the ordinary sense.
</MathBox>

The definition of the smoothness of a function $f\in C_\mathbf{p}^\infty (M)$ at a point $\mathbf{p}$ on a smooth manifold $M$ is independent of the chart $(U,\varphi)$. If $f\circ\varphi^{-1}$ is smooth at $\varphi(\mathbf{p})$ and $(V,\psi)$ is any other chart containing $\mathbf{p}$, then on $\psi(U\cap V)$

$$
  f\circ\psi^{-1} = (f\circ\varphi^{-1})\circ(\varphi\circ\psi^{-1})
$$

which is smooth at $\psi(\mathbf{p})$.

Given a function $f:M\to\R^k$ and a chart $(U,\varphi)$ for a smooth manifold $M$, the function $\tilde{f}:\varphi(U)\to\R^k$ defined by $\tilde{f}(\mathbf{x}) = f\circ\varphi^{-1}(\mathbf{x})$ is called the coordinate representation of $f$. By definition, $f$ is smooth if and only if its coordinate representation is smooth in some smooth chart around each point. Smooth functions have smooth coordinate representations in every smooth chart.

<MathBox title='Smoothness criterion of real-valued functions' boxType='proposition' tag='proposition-8'>
Let $M$ be a manifold of dimension $n$, and $f:M\to\R$ a real-valued function on $M$. The following are equivalent:
1. The function $f:M\to\R$ is smooth.
2. The manifold $M$ has an atlas such that for every chart $(U,\varphi)$ in the atlas, $f\circ\varphi^{-1} : \R^n \supset \varphi(U) \to\R$ is smooth.
3. For every chart $(V,\psi)$ on $M$, the function $f\circ\psi^{-1} : \R^n \supset \psi(V) \to\R$ is smooth.

<details>
<summary>Proof</summary>

**(2) $\implies$ (1):** This follows directly from the definition of a smooth function, since by **(2)** every point $\mathbf{p}\in M$ has a coordinate neighbourhood $(U,\varphi)$ such that $f\circ\varphi^{-1}$ is smooth at $\varphi(\mathbf{p})$.

**(1) $\implies$ (3):** Let $(V,\psi)$ be an arbitrary chart on $M$ and let $\mathbf{p}\in V$. Note that $f\circ\psi^{-1}$ is smooth at $\psi(\mathbf{p})$. Since $\mathbf{p}$ is an arbitrary point of $V$, then $f\circ\psi^{-1}$ is smooth on $\psi(V)$. 

**(3) $\implies$ (2):** This follows trivially.
</details>
</MathBox>

<MathBox title='Pullback of functions on a manifold' boxType='definition'>
Let $F:N\to M$ be a map and $h:M\to\R$ a function on $M$. The *pullback* of $h$ by $F$, denoted by $F^* h$, is the composite function $h\circ F: N\to\R$.
</MathBox>

### Smooth maps between manifolds

<MathBox title='Smooth maps between manifolds' boxType='definition'>
Let $M$ and $N$ be smooth manifolds of dimension $m$ and $n$, respectively. A continuous map $F:M\to N$ is smooth at $\mathbf{p}\in M$ if there are smooth charts $(U,\varphi)$ containing $p$ and $(V,\psi)$ containing $F(\mathbf{p})$ such that $F(U) \subseteq V$ and the composite map 

$$
  \psi\circ F\circ\varphi^{-1} : \varphi(F^{-1} (V) \cap U)\subseteq \R^n \to \R^m 
$$ 

is smooth at $\varphi(\mathbf{p})$. The map $F$ is smooth if is smooth at every point of $N$.


If $M$ and $N$ are smooth manifolds with boundary, smoothness of $F$ is defined in exactly the same way.

$$
\begin{CD}
  U\subseteq M @>F>> F(U)\subseteq V\subseteq N \\
  @V{\varphi}VV @VV{\psi}V \\
  \varphi(U)\subseteq\R^m @>>\psi\circ F\circ\varphi^{-1}> \psi(V)\subseteq\R^n
\end{CD}
$$
</MathBox>

In case $M = \R^m$, we can take $(\R^m, \operatorname{id}_{\R^m}$ as a chart about $F(\mathbf{p})$ in $\R^m$. By definition, $F:N\to\R^m$ is smooth at $\mathbf{p}\in N$ if and only if there is a chart $(U,\varphi)$ about $\mathbf{p}\in N$ such that $F\circ\varphi^{-1}: \varphi(U)\to\R^m$ is smooth at $\varphi(\mathbf{p})$. 

If $F:M\to N$ is a smooth map, and $(U,\varphi)$ and $(V,\psi)$ are any smooth charts for smooth manifolds $M$ and $N$, respectively, we call $\tilde{F} = \psi\circ F \circ\varphi^{-1}$ the coordinate representation of $F$ with respect to the given coordinates. It maps the set $\varphi(U\cap F^{-1} (V))$ to $\psi(V)$

<MathBox title='' boxType='proposition'>
Every smooth map is continuous.

<details>
<summary>Proof</summary>

Suppose $M$ and $N$ are smooth manifolds with or without boundary, and that $F:M\to N$ is smooth. Given $\mathbf{p}\in M$, smoothness of $F$ means that there are smooth charts $(U,\varphi)$ containing $p$, and $(V,\psi)$ containing $F(\mathbf{p})$, such that $F(U) \subseteq V$ and $\psi\circ F\circ \varphi^{-1}: \varphi(U)\to\psi(V)$ is smooth, hence continuous. Since $\varphi: U\to\varphi(U)$ and $\psi:V\to\psi(V)$ are homemorphisms, it follows that

$$
  F|_U = \psi^{-1}\circ (\psi\circ F\circ \varphi^{-1})\circ\varphi: U\to V
$$

which is a composition of continuous maps. Since $F$ is continuous in a neighbourhood of each point, it is continuous on $M$.
</details>
</MathBox>

<MathBox title='' boxType='proposition' tag='proposition-10'>
Suppose $F:N\to M$ is smooth at $\mathbf{p}\in N$. If $(U,\varphi)$ is any chart about $\mathbf{p}\in N$ and $(V,\psi)$ is any chart about $F(\mathbf{p})\in M$, then $\psi\circ F\circ\varphi^{-1}$ is smooth at $\varphi(\mathbf{p})$.

<details>
<summary>Proof</summary>

Since $F$ is smooth at $\mathbf{p}\in N$, there are charts $(U_\alpha, \varphi_\alpha)$ about $\mathbf{p}\in N$ and $(V_\beta, \psi_\beta)$ about $F(\mathbf{p})\in M$ such that $\psi_\beta \circ F \circ\varphi_\alpha^{-1}$ is smooth at $\varphi_\alpha (\mathbf{p})$. By the smooth compatbility of charts in a smooth structure, both $\varphi_\alpha \circ\varphi^{-1}$ and $\psi\circ\psi_\beta^{-1}$ are smooth on open subsets of Euclidean spaces. Hence, the composition

$$
  \psi\circ F\circ\varphi^{-1} = (\psi\circ\psi_\beta^{-1}) \circ (\psi_\beta \circ F \circ\varphi_\alpha^{-1}) \circ (\varphi_\alpha \circ\varphi^{-1})
$$

is smooth at $\varphi(\mathbf{p})$.
</details>
</MathBox>

<MathBox title='Smoothness criterion of a map between manifolds in terms of charts' boxType='proposition' tag='proposition-11'>
Let $N$ and $M$ be smooth manifolds, and $F:N\to M$ a continuous map. The following are equivalent
1. The map $F:N\to M$ is smooth.
2. There are atlases $\mathcal{U}$ for $N$ and $\mathcal{V}$ for $M$ such that for every chart $(U,\varphi)\in\mathcal{U}$ and $(V,\psi)\in\mathcal{V}$, the map
$$
  \psi\circ F\circ\varphi^{-1} : \varphi(U\cap F^{-1}(V)) \to\psi(V)\subseteq\R^m
$$
is smooth.
3. For every chart $(U,\varphi)$ on $N$ and $(V,\psi)$ on $M$, the map
$$
  \psi\circ F\circ^{-1} : \varphi(U\cap F^{-1}(V)) \to\R^m
$$
is smooth.

<details>
<summary>Proof</summary>

**(2) $\implies$ (1):** Let $\mathbf{p}\in N$. Suppose $(U,\varphi)$ is a chart about $\mathbf{p}$ in $\mathcal{U}$ and $(V,\psi)$ is a chart about $F(\mathbf{p})$ in $\mathcal{V}$. By **(2)**, $\psi\circ F\circ\varphi^{-1}$ is smooth at $\varphi(\mathbf{p})$. By the definition of a smooth map, $F:N\to M$ is smooth at $\mathbf{p}$. Since $\mathbf{p}$ is an arbitrary point in $N$, the map $F:N\to M$ is smooth.

**(1) $\implies$ (3):** Suppose $(U,\varphi)$ and $(V,\psi)$ are charts on $N$ and $M$ respectively such that $U\cap V^{-1} \neq\emptyset$. Let $\mathbf{p}\in U\cap F^{-1} (V)$. Then $(U,\varphi)$ is a chart about $\mathbf{p}$ and $(V,\psi)$ is a chart about $F(\mathbf{p})$. By proposition $\ref{\proposition-10}$, $\psi\circ F\circ\varphi^{-1}$ is smooth at $\varphi(\mathbf{p})$. Since $\varphi(\mathbf{p})$ is an arbitrary point of $\varphi(U \cap F^{-1} (V))$, the map $\psi\circ F\circ\varphi^{-1} : \varphi(U \cap F^{-1}(V))\to\R^m$ is smooth.

**(3) $\implies$ (2):** This follows trivially.
</details>
</MathBox>

<MathBox title='Smoothness of maps between manifolds is local' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary, and let $F:M\to N$ be a map.
1. If every point $\mathbf{p}\in M$ has a neighbourhood $U$ such that the restriction $F|_U$ is smooth then $F$ is smooth.
2. Conversely, if $F$ is smooth, then its restriction to every open subset is smooth.
</MathBox>

<MathBox title='Gluing lemma for smooth maps' boxType='corollary'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary, and ket $\Set{U_\alpha}_{\alpha\in A}$ be an open cover of $M$. Suppose for each $\alpha\in A$, we are given a smooth map $F_\alpha: U_\alpha \to N$ such that the maps agree on overlaps, i.e. $F_\alpha|_{U_\alpha \cap U_\beta} = F_\beta |_{U_\alpha \cap U_\beta}$ for all $\alpha$ and $\beta$. Then there exists a unique smooth map $F:M\to N$ such that $F|_{U_\alpha} = F_\alpha$ for each $\alpha\in A$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$, $N$ and $P$ be smooth manifolds with or without boundary.
1. Every constant map $c:M\to N$ is smooth
2. The identity map $\operatorname{id}:M\to M$ is smooth
3. If $U\subseteq M$ is an open submanifold with or without boundary, then the inclusion map $U \hookrightarrow M$ is smooth
4. If $F:M\to N$ and $G:N\to P$ are smooth, then so is $G\circ F: M\to P$

<details>
<summary>Proof</summary>

**(4):** Let $(U,\varphi)$, $(V,\psi)$ and $(W,\sigma)$ be charts on $N$, $M$ and $P$ respectively. Then

$$
  \sigma\circ(G\circ F)\circ\varphi^{-1} = (\sigma\circ G\circ \psi^{-1}) \circ (\psi\circ F\circ\varphi^{-1})
$$

Since $F$ and $G$ are smooth, it follows by proposition $\ref{proposition-11}$**(1)**$\implies$**(3)** that $\sigma\circ G \circ\psi^{-1}$ and $\psi\circ F \circ\varphi^{-1}$ are smooth. As a composition of smooth maps of open subsets of Euclidean spaces, $\sigma\circ (G\circ F)\circ\varphi^{-1}$ is smooth. By proposition $\ref{\proposition-11}$**(3)**$\implies$**(1)**, it follows that $G\circ F$ is smooth.

$$
\begin{CD}
  U\subseteq M @>F>> F(U)\subseteq V\subseteq N @>G>> G(F(U)) \subseteq W\subseteq P \\
  @V{\varphi}VV @V{\psi}VV @VV{\sigma}V \\
  \varphi(U)\subseteq\R^m @>>\psi\circ F\circ \varphi^{-1}> \psi(V)\subseteq\R^n @>>\sigma\circ G\circ\psi^{-1}> \sigma(W)\subseteq\R^p
\end{CD}
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M_1,\dots,M_k$ and $N$ are smooth manifolds with or without boundary, such that at most on of $M_1,\dots,M_k$ has nonzero boundary. For each $i=1,\dots,k$, let $\pi_i: \prod_{j=1}^k M_j \to M_i$ denote the projection onto the $M_i$ factor. A map $F:N\to \prod_{i=1}^k M_i$ is smooth if and only if each of the component maps $F_i = \pi_i \circ F: N\to M_i$ is smooth.
</MathBox>

### Diffeomorphism of manifolds

<MathBox title='Diffeomorphism of manifolds' boxType='definition'>
If $M$ and $N$ are smooth manifolds with or without boundary, a *diffeomorphism* $M$ to $N$ is a smooth bijective map $F:M\to N$ that has a smooth inverse. The manifolds $M$ and $N$ are *diffeomorphic*, denoted $M\cong N$, if there exists a diffeomorphism between them.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $U$ be an open subset of a manifold $M$ of dimension $n$. If $F:U\to F(U)\subseteq\R^n$ is a diffeomorphism onto an open subset of $\R^n$, then $(U,F)$ is a chart in the smooth structure of $M$.

<details>
<summary>Proof</summary>

For any chart $(U_\alpha, \varphi_\alpha)$ in the maximal atlas of $M$, both $\varphi_\alpha$ and $\varphi_\alpha^{-1}$ are smooth by proposition $\ref{proposition-4}$. As composites of smooth maps, both $F\circ\varphi_\alpha^{-1}$ and $\varphi_\alpha \circ F^{-1}$ are smooth. Hence, $(U,F)$ is compatible with the maximal atlas. By the maximality of the atlas, the chart $(U,F)$ is in the atlas.
</details>
</MathBox>

<MathBox title='Properties of diffeomorphism of manifolds' boxType='proposition'>
1. Every composition of diffeomorphisms is a diffeomorphism.
2. Every finite product of diffeomorphism between smooth manifolds is a diffeomorphism.
3. Every diffeomorphism is a homeomorphism and an open map.
4. The restriction of a diffeomorphism to an open submanifold with or without boundary is a diffeomorphism onto its image.
5. "Diffeomorphic" is an equivalence relation on the class of all smooth manifolds with or without boundary.
</MathBox>

<MathBox title='Diffeomorphism invariance of dimension' boxType='theorem'>
A nonempty smooth manifold of dimension $m$ cannot be diffeomorphic to an $n$-dimensional smooth manifold unless $m=n$.

<details>
<summary>Proof</summary>

$$
\begin{CD}
  U\subseteq M @>F>> F(U)\subseteq V\subseteq N \\
  @V{\varphi}VV @VV{\psi}V \\
  \varphi(U)\subseteq\R^m @>>\psi\circ F\circ\varphi^{-1}> \psi(V)\subseteq\R^n
\end{CD}
$$

Suppose $M$ is a nonempty smooth $m$-manifold, $N$ is a nonempty smooth $n$-manifold, and $F:M\to N$ is a diffeomorphism. Choose any point $\mathbf{p}\in M$, and let $(U,\varphi)$ and $(V,\psi)$ be smooth coordinate charts containing $\mathbf{p}$ and $F(\mathbf{p})$ respectively. Then the restriction of $\tilde{F} = \psi\circ F\circ\varphi^{-1}:\varphi(U)\to\psi(V)$ is a diffeomorphism from an open subset of $\R^m$ to an open subset of $\R^n$. 

Because $\tilde{F}^{-1} \circ\tilde{F} = \operatorname{id}_{\varphi(U)}$, the chain rule implies that for each $\mathbf{x}\in \varphi(U)$

$$
\begin{align*}
  \operatorname{id}_{\R^n} =& \D(\operatorname{id}_{\varphi(U)})(\mathbf{x}) = \D(\tilde{F}^{-1}\circ\tilde{F})(\mathbf{x}) \\
  =& \D(\tilde{F}^{-1})(\tilde{F}(\mathbf{x}))\circ\D\tilde{F}(\mathbf{x})
\end{align*}
$$

Similarly, $\tilde{F}\circ\tilde{F}^{-1} = \operatorname{id}_{\psi(V)}$ implies that $\operatorname{id}_{\R^m} = \D F(\mathbf{x})\circ\D(\tilde{F}^{-1})(\tilde{F}(\mathbf{x}))$. This implies that $\D(\tilde{F}(\mathbf{x}))$ is invertible with inverse $\D(\tilde{F}^{-1})(\tilde{F}(\mathbf{x}))$, and hence $m = n$.
</details>
</MathBox>

<MathBox title='Diffeomorphism invariance of the boundary' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary, and that $F:M\to N$ is a diffeomorphism. Then $F(\partial M) = \partial N$, and $F$ restricts to a diffeomorphism from $\mathrm{int}(M)$ to $\mathrm{int}(N)$.
</MathBox>

### Smoothness in terms of components

<MathBox title='Smoothness criterion of a vector-valued function' boxType='proposition' tag='proposition-17'>
Let $N$ be a manifold and $F:N\to\R^m$ a continuous map. The following are equivalent:
1. The map $F:N\to\R^m$ is smooth.
2. The manifold $N$ has an atlas such that for every chart $(U,\varphi)$ in the atlas, the map $F\circ\varphi^{-1}: \varphi(U)\to\R^m$ is smooth.
3. For every chart $(U,\varphi)$ on $N$, the map $F\circ\varphi^{-1}:\varphi(U)\to\R^m$ is smooth.

<details>
<summary>Proof</summary>

**(2)** $\implies$ **(1):** In proposition $\ref{proposition-11}$.2, take $\mathcal{V}$ to be the atlas with the single chart $(\R^m, \operatorname{id}_{\R^m})$ on $M = \R^m$.

**(1)** $\implies$ **(3):** In proposition $\ref{proposition-11}.3$ let $(V,\psi)$ be the chart $(\R^m,\operatorname{id}_{\R^m})$ on $M = \R^m$.

**(3)** $\implies$ **(2):** This follows trivially.
</details>
</MathBox>

<MathBox title='Smoothness criterion in terms of components' boxType='proposition'>
Let $N$ be a manifold. A vector-valued function $F:N\to\R^m$ is smooth if and only if its component functions $F^1,\dots,F^m : N\to\R$ are all smooth.

<details>
<summary>Proof</summary>

- The map $F:N\to\R^m$
- $\iff$ for every chart $(U,\varphi)$ on $N$, the map $F\circ\varphi^{-1}:\varphi(U)\to\R^m$ is smooth (by proposition $\ref{proposition-17}$)
- $\iff$ for every chart $(U,\varphi)$ on $N$, the functions $F^i \circ \varphi^{-1} :\varphi(U)\to\R$ are all smooth (definition of smoothness for maps of Euclidean space)
- $\iff$ the function $F^i :N\to\R$ are all smooth (by proposition $\ref{proposition-8}$)
</details>
</MathBox>

<MathBox title='Smoothness criterion of a map in terms of vector-valued functions' boxType='proposition'>
Let $F:N\to M$ be a continuous map between two manifolds of dimensions $n$ and $m$ respectively. The following are equivalent:
1. The map $F:N\to M$ is smooth.
2. The manifold $M$ has an atlas such that for every chart $(V,\psi = (y^i)_{i=1}^m)$ in the atlas, the vector-valued function $\psi\circ F: F^{-1} (V)\to\R^m$ is smooth.
3. For every chart $(V,\psi = (y^i)_{i=1}^m)$ on $M$, the vector-valued function $\psi\circ F: F^{-1} (V)\to\R^m$ is smooth.

<details>
<summary>Proof</summary>

**(2)** $\implies$ **(1):** Let $\mathcal{V}$ be the atlas for $M$ in **(2)**, and let $\mathcal{U} = \Set{(U,\varphi)}$ be an arbitrary atlas $N$. For each chart $(V,\psi)$ in the atlas $\mathcal{V}$, the collection $\Set{(U\cap F^{-1} (V), \varphi|_{U\cap F^{-1}(V)})}$ is an atlas for $F^{-1} (V)$. Since $\psi\circ F: F^{-1}(V)\to\R^m$ is smooth, by proposition $\ref{proposition-17}$**(1)** $\implies$ **(3)**,

$$
  \psi\circ F\circ\varphi^{-1}: \varphi(U\cap F^{-1}(V)) \to\R^m
$$

is smooth. It then follows from proposition $\ref{proposition-11}$**(2)** $\implies$ **(1)** that $F:N\to M$ is smooth.

**(1)** $\implies$ **(3):** Being a coordinate map, $\psi$ is smooth ($\ref{proposition-4}$). As the composite of two smooth maps, $\psi\circ F$ is smooth.

**(3)** $\implies$ **(2):** This follows trivially.
</details>
</MathBox>

<MathBox title='Smoothness criterion of a map in terms of components' boxType='proposition'>
Let $F:N\to M$ be a continuous map between two manifolds of dimensions $n$ and $m$ respectively. The following are equivalent:
1. The map $F:N\to M$ is smooth.
2. The manifold $M$ has an atlas such that for every chart $(V,\psi = (y^i)_{i=1}^m)$ in the atlas, the components $y^i \circ F: F^{-1} (V)\to\R$ of $F$ relative to the chart are all smooth.
3. For every chart $(V,\psi = (y^i)_{i=1}^m)$ on $M$, the components $y^i \circ F: F^{-1} (V) \to\R$ of $F$ relative to the charts are all smooth.
</MathBox>

### Partitions of unity

<MathBox title='Partition of unity' boxType='definition'>
Suppose $M$ is a topological space, and let $\mathcal{X} = \Set{X_\alpha}_{\alpha\in A}$ be an arbitrary open cover of $M$, indexed by a set $A$. A *partition of unity* subordinate to $\mathcal{X}$ is an indexed collection of continuous function $\Set{\psi_\alpha:M\to\R}_{\alpha\in A}$ with the following properties:
1. $0\leq\psi_\alpha(x)\leq 1$ for all $\alpha\in A$ and all $x\in M$
2. $\operatorname{supp}(\psi_\alpha) = \overline{\Set{\mathbf{p}\in M | \psi_\alpha(p) \neq 0}}\subseteq X_\alpha$ for each $\alpha\in A$.
3. The collection of supports $\Set{\operatorname{supp}(\psi_\alpha)}_{\alpha\in A}$ is locally finite, meaning that every point has a neighbourhood that intersects $\operatorname{supp}(\psi_\alpha)$ for only finitely many values of $\alpha$.
4. $\sum_{\alpha\in A} \psi_\alpha (x) = 1$ for all $x\in M$

If $M$ is a smooth manifold with or without boundary, a *smooth parition of unity* is one for which each of the functions $\psi_\alpha$ is smooth.
</MathBox>

<MathBox title='Existence of partitions of unity' boxType='theorem'>
Suppose $M$ is a smooth manifold with or without boundary, and $\mathcal{X} = (X_\alpha)_{\alpha\in A}$ is any indexed open cover of $M$. Then there exists a smooth partition of unity subordinate to $\mathcal{X}$.

<details>
<summary>Proof</summary>

For simplicity, suppose $M$ is a smooth manifold without boundary. Each set $X_\alpha$ is a smooth manifold in its own right, and thus has a basis $\mathcal{B}_\alpha$ of regular coordinate balls and it is easy to check that $\mathcal{B} = \bigcup_\alpha \mathcal{B}_\alpha$ is a basis for the topology of $M$. It follows that $\mathcal{X}$ has a countable, locally finite refinement $\Set{B_i}$ consisting of elements of $\mathcal{B}$. The cover $\Set{\overline{B}_i}$ is also locally finite.

For each $i$, the fact that $B_i$ is a regular coordinate ball in some $X_\alpha$ guarantees that there is a coordinate ball $B'_i \subseteq X_\alpha$ such that $B'_i \supseteq \overline{B}_i$, and a smooth coordinate map $\varphi_i: B'_i \to\R^n$ such that $\varphi_i(\overline{B}_i) = \overline{B}_{r_i}(\mathbf{0})$ and $\varphi_i(B'_i) = B_{r'_i}(\mathbf{0})$ for some $r_i < r'_i$. For each $i$, defined a function $f_i:M\to\R$ by

$$
  f_i = \begin{cases}
    H_i \circ\varphi_i \quad& \text{on } B'_i \\
    0 \quad& \text{on } M\setminus\overline{B}_i
  \end{cases}
$$

where $H_i:\R^n \to\R$ is a smooth function that is positive in $B_{r_i}(\mathbf{0})$ and zero elsewhere. On the set $B'_i\setminus\overline{B}_i$ where the two definitions overlap, both definitions yield the zero function, $f_i$ is well-defined and smooth with $\operatorname{supp}(f_i) = \overline{B}_i$.

Define $f:M\to\R$ by $f(x) = \sum_i f_i(x)$. Because of the local finiteness of the cover $\Set{\overline{B}_i}$, this sum has only finitely many nonzero terms in a neighbourhood of each point and thus defines a smooth function. Because each $f_i$ is nonnegative everywhere and positive on $B_i$, and every point of $M$ is in some $B_i$, it follows that $f(x) > 0$ everywhere on $M$. Thus, the functions $g_i:M\to\R$ defined by $g_i (x) \frac{f_i (x)}{f(x)}$ are also smooth. It is immediate from the definition that $0\leq g_i \leq 1$ and $\sum_i g_i \equiv 1$.

Finally, we need to reindex our functions so that they are indexed by the same set $A$ as our open cover. Because the cover $\Set{B'_i}$ is a refinement of $\mathcal{X}$, for each $i$ we can choose some index $a(i)\in A$ such that $B'_i \subseteq X_{a(i)}$. For each $\alpha\in A$, define $\psi_\alpha: M\to\R$ by

$$
  \psi_\alpha = \sum_{i:a(i) = \alpha} g_i
$$

If there are no indices $i$ for which $a(i) = \alpha$, then this sum should be interpreted as the zero function. It follos that

$$
  \operatorname{supp}(\psi_\alpha) = \overline_{\bigcup_{i:a(i) = \alpha} B_i} = \bigcup_{i:a(i) = \alpha} \overline{B}_i \subseteq X_\alpha
$$

Each $\psi_\alpha$ is a smooth function that satisfies $0\leq\psi_\alpha \leq 1$. Moreover, the collection of supports $\Set{\operatorname{supp}(\psi_\alpha)}_{\alpha\in A}$ is still locally finite, and $\sum_\alpha \psi_\alpha \equiv \sum_i g_i \equiv 1$, which is the desired partition of unity.
</details>
</MathBox>

#### Applications of partitions of unity

<MathBox title='Bump function' boxType='definition'>
If $M$ is a topological space, $A\subseteq M$ is a closed subset, and $U\subseteq M$ is an open subset containing $A$, a continuous function $\psi:M\to\R$ is called a *bump function* for $A$ supported in $U$ if $0\leq\psi\leq 1$ on $M$ and $\psi\equiv 1$ on $A$ and $\operatorname{supp}(\psi) \subseteq U$.
</MathBox>

<MathBox title='Existence of smooth bump functions' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. For any closed subset $A\subseteq M$ and any open subset $U$ containing $A$, there exists a smooth bump function for $A$ supported in $U$.

<details>
<summary>Proof</summary>

Let $U_0 = U$ an $U_1 = M\setminus A$ and let $\Set{\psi_0, \psi_1}$ be a smooth partition of unity subordinate to the open cover $\Set{U_0, U_1}$. Because $\psi_1 \equiv 0$ on $A$ with $\psi_0 = \sum_i \psi_i = 0$, the functino $\psi_0$ has the required properties.
</details>
</MathBox>

<MathBox title='Extension lemma for smooth function' boxType='lemma'>
Suppose $M$ is a smooth manifold with or without boundary, $A\subseteq M$ is a closed subset, and $f:A\to\R^k$ is a smooth function. For any open subset $U$ containing $A$, there exists a smooth function $\tilde{f}:M\to\R^k$ such that $\tilde{f}|_A = f$ and $\operatorname{supp}(\tilde{f})\subseteq U$.

<details>
<summary>Proof</summary>

For each $p\in A$, choose a neighbourhood $W_p$ of $p$ and a smooth function $\tilde{f}_p :W_p \to R^k$ that agrees with $f$ on $W_p \cap A$. Replacing $W_p$ by $W_p \cap U$, we may assume $W_p \subseteq U$. The collection of sets $\Set{W_p | p\in A}\cup M\setminus A$ is an open cover of $M$. Let $\Set{\psi_p | p\in A} \cup \Set{\psi_0}$ be a smooth partition of unity subordinate to this cover, with $\operatorname{supp}(\psi_p)\subseteq W_p$ and $\operatorname{supp}(\psi_0) \subseteq M\setminus A$.

For each $p\in A$, the product $\psi_p \tilde{f}_p$ is smooth on $W_p$, and has a smooth extension to all of $M$ if we interpret it to be zero on $M\setminus\operatorname{supp}(\psi_p)$. Thus, we can defined $\tilde{f}: M\to\R^k$ by

$$
  \tilde{f}(x) = \sum_{p\in A} \psi_p (x)\tilde{f}_p (x)
$$

Because the collection of supports $\Set{\psi_p}$ is locally finite, this sum has only a finite number of nonzero terms in a neighbourhood of any point of $M$, and therefore defines a smooth function. If $x\in A$, then $\psi_0 (x) = 0$ and $\tilde{f}_p (x) = f(x)$ for each $p$ such that $\psi_p (x) \neq 0$, so

$$
\begin{align*}
  \tilde{f}(x) =& \sum_{p\in A} \psi_p(x)f(x) \\
  =& \left( \psi_0(x) + \sum_{p\in A} \psi_p (x) \right)f(x) \\
  =& f(x)
\end{align*}
$$

so $\tilde{f}$ is indeed an extension of $f$. It follows that 

$$
  \operatorname{supp}(\tilde{f}) = \overline{\bigcup_{p\in A}\operatorname{supp}(\psi_p)} = \bigcup_{p\in A} \operatorname{supp}(\psi_p) \subseteq U
$$
</details>
</MathBox>

<MathBox title='Exhaustion function' boxType='definition'>
If $M$ is a topological space, and *exhaustion function* for $M$ is a continuous function $f:M\to\R$ with the property that the set $f^{-1}((-\infty,c])$, called the sublevel set of $f$, is compact for each $c\in\R$. As $n$ ranges over the positive integers, the sublevel sets $f^{-1}((-\infty, n])$ form an exhaustion of $M$ by compact sets.
</MathBox>

<MathBox title='Existence of smooth exhaustion functions' boxType='proposition'>
Every smooth manifold with or without boundary admits a smooth positive exhaustion function.

<details>
<summary>Proof</summary>

Let $\Set{V_j}_{j=1}^\infty$ be any countable open cover of $M$ by precompact open subsets, and let $\Set{\psi_j}$ be a smooth partition of unity subordinate to this cover. Define $f\in C^\infty (M)$ by

$$
  f(\mathbf{p}) = \sum_{j=1}^\infty j\psi_j(p)
$$

Then $f$ is smooth because only finitely many terms are nonzero in a neighbourhood of any point, and positive because $f(\mathbf{p}) \geq\sum_j \psi_j (\mathbf{p}) = 1$.

To see that $f$ is an exhaustion function, let $c\in\R$ be arbitrary, and choose a positive integer $N > c$. If $p\notin \bigcup_{j=1}^N \overline{V}_j$, then $\psi_j(p) = 0$ for $1\leq j\leq N$, so

$$
\begin{align*}
  f(\mathbf{p}) =& \sum_{j=N+1}^\infty j\psi_j (p) \\
  \geq& \sum_{j=N+1}^\infty N\psi_j (p) \\
  =& N\sum_{j=1}^\infty \psi_j (p) = N > c
\end{align*}
$$

Equivalently, if $f(\mathbf{p}) \leq c$, then $p\in \bigcup_{j=1}^N \overline{V}_j$. Thus $f^{-1}((-\infty, c])$ is a closed subset of the compact set $\bigcup_{j=1}^N \overline{V}_j$ and is therefore compact.
</details>
</MathBox>

<MathBox title='Level sets of smooth functions' boxType='proposition'>
Let $M$ be a smooth manifold. If $K$ is any closed subset of $M$, there is a smooth nonnegative function $f:M\to\R$ such that $f^{-1}(0) = K$.

<details>
<summary>Proof</summary>

**$M = \R^n$**<br/>
First, consider the special case in which $M = \R^n$ and $K\subseteq\R^n$ is a closed subset. For each $x \in M\setminus K$, there is a positive number $r \leq 1$ such that $B_r (x) \subseteq M\setminus K$. By second-countability, $M\subseteq K$ is the union of countably many such balls $\Set{B_{r_i}(x_i)}_{i=1}^\infty$.

Let $h:\R^n \to\R$ be a smooth bump function that is equal to $1$ on $\overline{B}_{1/2} (0)$ and supported in $B_1 (0)$. For each positive integer $i$, let $C_i \geq 1$ be a constant that bounds the absolute values of $h$ and all of its partial derivatives up through order $i$. Define $f:\R^n \to\R$ by

$$
  f(x) = \sum_{i=1}^\infty \frac{(r_i)^i}{2^i C_i} h\left( \frac{x-x_i}{r_i} \right)
$$

The terms of the series are bounded in absolute value by those of the convergent series $\sum_i \frac{1}{2^i}$, so the entire series converges uniformly to a continuous function by the Weierstrass $M$-test. Because the $i$th term is positive extactly when $x\in B_{r_i}(x_i)$, it follows that $f$ is zero in $K$ and positive elsewhere.

It remains to show that $f$ is smooth. Suppose $k\geq 1$ and assume by induction that all partial derivatives of $f$ of order less than $k$ exist and are continuous. By the chain rule and induction, every $k$th partial derivative of the $i$th term in the series can be written in the form

$$
  \frac{(r_i)^{i-k}}{2^i C_i} \D_k\left[h\left( \frac{x - x_i}{r_i} \right)\right]
$$

where $\D_k (h)$ is some $k$th partial derivative of $h$. By our choices of $r_i$ and $C_i$, as as $i\geq k$, each of these terms is bounded in absolute value by $\frac{1}{2^i}$, so the differentiated series also converges uniformly to a continuous function. It the follows from properties of uniform convergence that the $k$th partial derivatives of $f$ exist and are continuous. This completes the induction, and show that $f$ is smooth.

**$M$ arbitrary smooth manifold**<br/>
Let $M$ be an arbitrary smooth manifold, and $K\subseteq M$ any closed subset. Let $\Set{B_\alpha}$ be an open cover of $M$ by smooth coordinate balls, and let $\Set{\psi_\alpha}$ be a subordinate partition of unity. Since each $B_\alpha$ is diffeomorphic to $\R^n$, the preceeding argument show that for each $\alpha$ there is a smooth nonnegative function $f_\alpha: B_\alpha \to\R$ such that $f_\alpha^{-1}(0) = B_\alpha \cap K$. The functino $f = \sum_\alpha \psi_\alpha f_\alpha$ does the trick.
</details>
</MathBox>

## Partial derivatives

<MathBox title='Partial derivative' boxType='definition'>
On a manifold $M$ of dimension $n$, let $(U,\varphi = (x^i)_{i=1}^n)$ be a chart and $f\in C^\infty (M)$ a smooth function on $M$. If $(r^i)_{i=1}^n$ are the standard coordinates on $\R^n$, then $x^i = r^i \circ\varphi$. For $\mathbf{p}\in U$, we define the *partial derivative* of $f$ with respect to $x^i$ at $p$ to be

$$
\begin{align*}
  \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} f :=& \left.\frac{\partial f}{\partial x^i}(\mathbf{p}) := \frac{\partial (f\circ\varphi^{-1})}{\partial r^i} (\varphi(\mathbf{p})) \\
  :=& \left.\frac{\partial}{\partial r^i}\right|_{\varphi(\mathbf{p})} (f\circ\varphi^{-1})
\end{align*}
$$

Since $\mathbf{p} = \varphi^{-1}(\varphi(\mathbf{p}))$, this can be rewritten in the form

$$
  \frac{\partial f}{\partial x^i} \varphi^{-1}(\varphi(\mathbf{p})) = \frac{\partial (f\circ\varphi^{-1})}{\partial r^i}(\varphi(\mathbf{p}))
$$

Thus, as a function on $\varphi(U)$

$$
  \frac{\partial f}{\partial x^i} \circ \varphi^{-1} = \frac{\partial (f\circ\varphi^{-1})}{\partial r^i}
$$
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $(U, \varphi = (x^i)_{i=1}^n)$ is a chart on a smooth manifold. Then $\frac{\partial x^i}{\partial x^j} = \delta_j^i$, the Kronecker delta function.

<details>
<summary>Proof</summary>

At a point $\mathbf{p}\in U$, by the definition of $\left.\frac{\partial x^i}{\partial x^j}\right|_\mathbf{p}$

$$
\begin{align*}
  \frac{\partial x^i}{x^j}(\mathbf{p}) =& \frac{\partial x^i \circ\varphi^{-1}}{\partial r^j}(\varphi(\mathbf{p})) \\
  =& \frac{\partial (r^j \circ\varphi\circ\varphi^{-1})}{\partial r^j}(\varphi(\mathbf{p})) \\
  =& \frac{\partial r^i}{\partial r^j}(\varphi(\mathbf{p})) \\
  =& \delta_j^i
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Jacobian matrix' boxType='definition'>
Let $F:N\to M$ be a smooth map between an $n$-manifold $N$ and $m$-manfiold $M$, and let $(U,\varphi=(x^i)_{i=1}^n)$ and $(V,\psi=(y^j)_{j=1}^m)$ be charts on $N$ and $M$ respectively suc that $F(U)\subset V$. Denote by

$$
  F^j := y^j \circ F = r^i \circ\psi\circ F : U \to\R
$$

the $j$th component of $F$ in the chart $(V,\psi)$. Then the matrix $\mathbf{J}_F = \left[\frac{\partial F^i}{\partial x^i}\right]$ is called the *Jacobian matrix* if $F$ relative to the charts $(U,\varphi)$ and $(V,\psi)$. In case $\dim(N) = \dim(M)$, the determinant $\det(\mathbf{J}_F)$ is called the *Jacobian determinant* of $F$ relative to the two charts.
</MathBox>

<MathBox title='Jacobian matrix of a transition map' boxType='example'>
Let $(U,\varphi=(x^j)_{j=1}^n)$ and $(V,\psi=(y^i)_{i=1}^m)$ be overlapping charts on a smooth manifold $M$. The transition map $\psi\circ\varphi^{-1} : \varphi(U\cap V) \to \psi(U\cap V)$ is a diffeomorphism of open subsets of $\R^n$. The Jacobian matrix is given by 

$$
  \mathbf{J}_{\psi\circ\varphi^{-1}} = \left[ \frac{\partial(\psi\circ\varphi^{-1})^i}{\partial r^j} \right]
$$

where

$$
\begin{align*}
  \frac{\partial (\psi\circ\varphi^{-1})}{\partial r^j}(\varphi(\mathbf{p})) =& \frac{\partial(r^i \circ\psi\circ\varphi^{-1})}{\partial r^j}(\varphi(\mathbf{p})) \\
  =& \frac{\partial(y^i \circ\varphi^{-1})}{\partial r^j}(\varphi(\mathbf{p})) \\
  =& \frac{\partial y^i}{\partial x^j} (\mathbf{p})
\end{align*}
$$
</MathBox>

## Inverse function theorem

<MathBox title='Inverse function theorem for manifolds' boxType='theorem'>
Let $F:N\to M$ be a smooth map between two manifolds of the same dimension, and $\mathbf{p}\in N$. Suppose $F(U)\subseteq V$  for some charts $(U,\varphi=(x^i)_{i=1}^n)$ about $\mathbf{p}\in N$ and $(V,\psi=(y^i)_{i=1}^n)$ about $F(\mathbf{p})\in M$. Set $F^i = y^i \circ F$. Then $F$ is locally invertible at $\mathbf{p}$ if and only if its Jacobian determinant $\det\left[\frac{\partial F^i}{\partial x^j (\mathbf{p})}\right]$ is nonzero.

<details>
<summary>Proof</summary>

Since $F^i = y^i \circ F = r^i \circ\psi\circ F$, the Jacobian matrix of $F$ relative to the charts $(U,\varphi)$ and $(V,\psi)$ is

$$
\begin{align*}
  \left[ \frac{\partial F}{\partial x^j}(\mathbf{p}) \right] =& \left[ \frac{\partial (r^i \circ\psi\circ F)}{\partial x^j}(\mathbf{p}) \right] \\
  =& \left[\frac{\partial (r^i \circ \psi\circ F\circ\varphi^{-1})}{\partial r^j} (\varphi(\mathbf{p})) \right]
\end{align*}
$$

which is precisely the Jacobian matrix at $\varphi(\mathbf{p})$ of the map

$$
  \psi\circ F\circ\varphi^{-1} : \R^n \supset\varphi(U) \to\psi(U) \to\psi(V) \subset\R^n
$$

between two open subsets of $\R^n$. By the inverse function theorem for $\R^n$

$$
  \det\left[\frac{\partial F^i}{\partial x^j}(\mathbf{p})\right] = \det\left[\frac{\partial r^i \circ (\psi\circ F\circ\varphi^{-1})}{\partial r^j} (\varphi(\mathbf{p}))\right] \neq 0
$$

if and only if $\psi\circ F\circ\varphi^{-1}$ is locally invertible at $\varphi(\mathbf{p})$. Since $\psi$ and $\varphi$ are diffeomorphisms ($\ref{proposition-4}$), this last statement is equivalent to the local invertibility of $F$ at $\mathbf{p}$.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Let $N$ be a manifold of dimension $n$. A set of $n$ smooth functions $\Set{F_i}_{i=1}^n$ defined on a coordinate neighbourhood $(U,(x^i)_{i=1}^n)$ of a point $\mathbf{p}\in N$ forms a coordinate system about $\mathbf{p}$ if and only if the Jacobian determinant $\det\left[\frac{\partial F^i}{\partial x^j (\mathbf{p})}\right]$ is nonzero.

<details>
<summary>Proof</summary>

Let $F = (F^1,\dots,F^n): U\to\R^n$. Then
- $\det\left[\frac{\partial F^i}{\partial x^j (\mathbf{p})}\right] \neq 0$
- $\iff F:U\to\R^n$ is locally invertible at $\mathbf{p}$ (by the inverse function theorem)
- $\iff$ there is a neighbourhood $W$ of $\mathbf{p}$ in $N$ such that $F:W\to F(W)$ is a diffemorphism (by the definition of local invertibility)
- $\iff (W,(F^i)_{i=1}^n)$ is a coordinate chart about $\mathbf{p}$ in the differentiable structure of $N$. 
</details>
</MathBox>

# Tangent space

## Geometric tangent vectors

<MathBox title='Geometric tangent vector' boxType='definition'>
Given a point $\mathbf{a}\in\R^n$, the *geometric tangent space* to $\R^n$ at $\mathbf{a}$, denoted $\R_\mathbf{a}^n$, is the set 

$$
  \Set{\mathbf{a}} \times \R^n = \Set{(\mathbf{a}, \mathbf{v}) = \mathbf{v}_\mathbf{a} | \mathbf{v}\in \R^n}
$$

A *geometric tangent vector* $\mathbf{v}$ in $\R^n$ is an element of $\R_\mathbf{a}^n$ with initial point at $\mathbf{a}\in\R^n$. The set $\R_\mathbf{a}^n$ is a vector space.
</MathBox>

As a vector space, $\R_\mathbf{a}^n$ is essentially the same as $\R^n$ itself; the only reason for the additional index $\mathbf{a}$ is so that the geometric tangent spaces $\R_\mathbf{a}^n$ and $\R_\mathbf{b}^n$ at distinct points $\mathbf{a}, \mathbf{b}\in \R^n$ will be disjoint sets.

The directional derivate of a geometric tangent vector $\mathbf{v}$ at $\mathbf{a}$ is a map $\D_\mathbf{v}|_\mathbf{a}: C^\infty (\R^n) \to\R$ defined by

$$
  \D_\mathbf{v}|_\mathbf{a}(f) = \D_\mathbf{v} f(\mathbf{a}) = \left.\frac{\d}{\d t}\right|_{t=0} f(\mathbf{a} + t\mathbf{v})
$$

This operation is linear over $\R$ and satisfies the product rule

$$
  \D_\mathbf{v}|_\mathbf{a} (fg) = f(\mathbf{a})\D_\mathbf{v}|_\mathbf{a}(g) + g(a)\D_\mathbf{v}|_\mathbf{a}(f)
$$

If $\mathbf{v}_\mathbf{a} = v^i \mathbf{e}_i|_\mathbf{a}$ in terms of the standard basis, then by the rule, $\D_\mathbf{v}|_\mathbf{a}(f)$ can written as

$$
  \D_\mathbf{v}|_\mathbf{a}(f) = v^i \frac{\partial f}{\partial x^i}(\mathbf{a})
$$

<MathBox title='Derivation' boxType='definition'>
If $\mathbf{a}$ is a point of $\R^n$, a function $w: C^\infty (\R^n)\to\R$ is called a *derivation* at $\mathbf{a}$ if it is linear over $\R$ and satisfies the following product rule

$$
  w(fg) = f(\mathbf{a})wg + g(\mathbf{a})wf
$$
</MathBox>

Let $T_\mathbf{a}\R^n$ denote the set of all derivations of $C^\infty(\R^n)$ at $\mathbf{a}$. Clearly, $T_\mathbf{a} \R^n$ is a vector space under the operations

$$
\begin{align*}
  (w_1 + w_2)f =& w_1 f + w_2 f \\
  (cw)f =& c(wf)
\end{align*}
$$

<MathBox title='Properties of derivations' boxType='proposition'>
Suppose $\mathbf{a}\in\R^n$, $w\in T_\mathbf{a} \R^n$ and $f,g\in C^\infty(\R^n)$.
1. If $f$ is a constant function, then $wf = 0$.
2. If $f(\mathbf{a}) = g(\mathbf{a}) = 0$, then $w(fg) = 0$.

<details>
<summary>Proof</summary>

**(1):** It suffices to consider the constant function $f_1 (\mathbf{x}) \equiv 1$, for then $f(\mathbf{x}) \equiv c$ implies $wf = w(cf_1) = cw f_1 = 0$ by linearity. For $f_1$, the product rule gives

$$
\begin{align*}
  wf_1 =& w(f_1 f_1) \\
  =& f_1 (\mathbf{a})wf_1 + f_1 (\mathbf{a})w f_1 = 2wf_1
\end{align*}
$$

which implies that $wf_1 = 0$.

**(2):** Applying the product rule gives

$$
  w(fg) = f(\mathbf{a})wg + g(\mathbf{a})wf = 0 + 0 = 0
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $\mathbf{a}\in\R^n$.
1. For each geometric tangent vector $\mathbf{v}_\mathbf{a} \in\R_\mathbf{a}^n$, the directional derivative $\D_\mathbf{v}|_\mathbf{a}: C^\infty (\R^n) \to\R$ is a derivation at $\mathbf{a}$.
2. The map $\mathbf{v}_a \mapsto \D_\mathbf{v}|_\mathbf{a}$ is an isomorphism from $\R_\mathbf{a}^n$ onto $T_\mathbf{a}\R^n$.

<details>
<summary>Proof</summary>

**(1):** This follows from the product rule of the directional derivative.

**(2):** It is easily seen that $\mathbf{v}_\mathbf{a} \mapsto \D_\mathbf{v}|_\mathbf{a}$ is linear. To see that it is injective, suppose $\mathbf{v}_\mathbf{a}\in\R_\mathbf{a}^n$ has the property that $\D_\mathbf{v}|_\mathbf{a}$ is the zero derivation. Writing $\mathbf{v}_\mathbf{a} = v^i \mathbf{e}_i|_\mathbf{a}$ in terms of the standard basis, and taking $f$ to be the $j$th coordinate function $x^j: \R^n\to\R$ thought of as a smooth function on $\R^n$, we obtain

$$
  0 = \D_\mathbf{v}|_\mathbf{a}(x^j) = v^i \left.\frac{\partial}{\partial x^i}(x^j)\right|_{\mathbf{x}=\mathbf{a}} = v^i \delta_i^j = v^j
$$

Since this is true for each $j$, it follows that $\mathbf{v}_\mathbf{a}$ is the zero vector.

To prove surjectivity, let $w\in T_\mathbf{a} \R^n$ be arbitrary and define $\mathbf{v} = v^i \mathbf{e}_i$ where $v^i = w(x^i)$. We will show that $w = \D_\mathbf{v}|_\mathbf{a}$. Let $f:\R^n \to\R$ be any smooth function. By Taylor's theorem, we can write

$$
\begin{align*}
  f(\mathbf{x}) =& f(\mathbf{a}) + \sum_{i=1}^n \frac{\partial f}{\partial x_i}(\mathbf{a})(x^i - a^i) \\
  &+ \sum_{i,j=1}^n (x^i - a^i)(x^j - a^j) \int_0^1 (1-t)\frac{\partial^2 f}{\partial x^i \partial x^j}(\mathbf{a} + t(\mathbf{x} - \mathbf{a}))\;\d t
\end{align*}
$$

Note that each term in the last sum above is a product of two smooth functions of $\mathbf{x}$ that vanish at $\mathbf{x} = \mathbf{a}$: one is (x^i - a^i), and the other is $(x^j - a^j)$ times the integral. The derivation $w$ annihilates this sum by its properties, giving

$$
\begin{align*}
  wf =& w(f(\mathbf{a})) + \sum_{i=1}^n w\left(\frac{\partial f}{\partial x^i}(\mathbf{a})(x^i - a^i)\right) \\
  =& 0 + \sum_{i=1}^n \frac{\partial f}{\partial x^i}(x)(w(x^i) - w(a^i)) \\
  =& \sum_{i=1}^n \frac{\partial f}{\partial x^i} (\mathbf{a})v^i = \D_\mathbf{v}|_\mathbf{a}(f)
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Partial derivatives form a tangent basis' boxType='corollary'>
For $\mathbf{a}\in\R^n$, the set of $n$ derivations

$$
  \Set{\boldsymbol{\partial}_i\rvert_\mathbf{a} := \left.\frac{\partial}{\partial x^i}\right\rvert_\mathbf{a} }_{i=1}^n,\quad \left.\frac{\partial}{\partial x^i}\right|_\mathbf{a} f = \frac{\partial f}{\partial x^i}(\mathbf{a})
$$

form a basis for $T_\mathbf{a} \R^n$, which therefore has dimension $n$.

<details>
<summary>Proof</summary>

Note that $\left.\frac{\partial}{\partial x^i}\right|_\mathbf{a} = \D_{\mathbf{e}_i}|_\mathbf{a}$.
</details>
</MathBox>

## Tangent vectors on manifolds

<MathBox title='Tangent space' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. If $\mathbf{p}\in M$, a linear function $\mathbf{v}: C_\mathbf{p}^\infty(M)\to\R$ is called a *derivation* at $\mathbf{p}$ if it satisfies the product rule

$$
  \mathbf{v}(fg) = f(\mathbf{p})\mathbf{v}g + g(\mathbf{p})\mathbf{v}f,\quad \forall f,g\in C_\mathbf{p}^\infty(M)
$$

The set of all derivations of $C_\mathbf{p}^\infty (M)$ at $\mathbf{p}$, denoted $T_\mathbf{p} M$, is a vector space called the *tangent space* to $M$ at $\mathbf{p}$. An element $\mathbf{v}$ of $T_\mathbf{p} M$ is called a *tangent vector* at $\mathbf{p}$. 
</MathBox>

<MathBox title='Partial derivatives are tangent vectors' boxType='proposition'>
On a manifold $M$ of dimension $n$, let $(U,\varphi = (x^i)_{i=1}^n)$ be a chart containing $\mathbf{p}\in M$. The partial derivatives 

$$
  \boldsymbol{\partial}_i |_\mathbf{p} := \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} : C_\mathbf{p}^\infty (M)\to\R
$$ 

are tangent vectors, i.e. $\boldsymbol{\partial}_i |_\mathbf{p} \in T_\mathbf{p} M$.
</MathBox>

<MathBox title='Properties of tangent vectors on manifolds' boxType='definition'>
Suppose $M$ is a smooth manifold with or without boundary, $\mathbf{p}\in M$, $\mathbf{v} \in T_\mathbf{p} M$ and $f, g\in C^\infty (M)$.
1. If $f$ is a constant function, then $\mathbf{v}f = 0$.
2. If $f(\mathbf{p}) = g(\mathbf{p}) = 0$, then $\mathbf{v}(fg) = 0$.
</MathBox>

## Differential of a smooth map

<MathBox title='Differential' boxType='definition'>
If $M$ and $N$ are smooth manifolds with or without boundary and $F:M\to N$ is a smooth map, the differential of $F$ at $\mathbf{p}\in M$ is the map

$$
  \d F_\mathbf{p} : T_\mathbf{p} M \to T_{F(\mathbf{p})}N
$$

such that for $\mathbf{v}\in T_\mathbf{p} M$, we let $\d F_\mathbf{p} (\mathbf{v})$ be the derivation at $F(\mathbf{p})$ that acts on $f\in C_{F(\mathbf{p})}^\infty$ by the rule

$$
  \d F_\mathbf{p} (\mathbf{v}) = \mathbf{v}(f\circ F)
$$

<details>
<summary>Details</summary>

Note that if $f\in C^\infty (N)$, then $f\circ F \in C^\infty (M)$, so $\mathbf{v}(f\circ F)$ makes sense. The operator $\d F_\mathbf{p} (\mathbf{v}): C^\infty (N)\to\R$ is linear because $\mathbf{v}$ is, and is a derivation at $F(\mathbf{p})$ because for any $f,g\in C^\infty (N)$ we have

$$
\begin{align*}
  \d F_\mathbf{p}(\mathbf{v})(fg) =& \mathbf{v}((fg)\circ F) = \mathbf{v}((f\circ F)(g\circ F)) \\
  =& f\circ F(\mathbf{p})\mathbf{v}(g\circ F) + g\circ F(\mathbf{p})\mathbf{v}(f\circ F) \\
  =& f(F(\mathbf{p}))\d F_\mathbf{p} (\mathbf{v})(g) + g(F(\mathbf{p}))\d F_\mathbf{p} (\mathbf{v})(f)
\end{align*}
$$
</details>
</MathBox>

The differential is also called the *tangent map* or the *(total) derivative*, especially in differential geometry literature. Because the differential "pushes" tangent vectors forward from the domain manifold to the codomain, is also called the *(pointwise) pushforward*. Different notations are used for the differential including
- $F'(\mathbf{p})$
- $\D F(\mathbf{p})$
- $F_{*,\mathbf{p}}$
- $T_\mathbf{p} F$


<MathBox title='Properties of differentials' boxType='proposition' tag='proposition-19'>
Let $M$, $N$ and $P$ be smooth manifolds with or without boundary, $F:M\to N$ and $G:N\to P$ be smooth maps and let $\mathbf{p}\in M$. The differentials of $F$ at $\mathbf{p}$ and $G$ at $F(\mathbf{p})$ are linear maps

$$
  T_\mathbf{p}N \xrightarrow{\d F_\mathbf{p}} T_{F(\mathbf{p})}M \xrightarrow{\d G_{F(\mathbf{p})}} T_{G(F(\mathbf{p}))}P
$$


1. $\d F_\mathbf{p}: T_\mathbf{p} M \to T_{F(\mathbf{p})}N$ is linear
2. **Chain rule:** $\d(G\circ F)_\mathbf{p} = \d G_{F(\mathbf{p})} \circ\d F_\mathbf{p}: T_\mathbf{p} M \to T_{G\circ F(\mathbf{p})} P$
3. $\d(\operatorname{id}_M)_\mathbf{p} = \operatorname{id}_{T_\mathbf{p} M}: T_\mathbf{p} M \to T_\mathbf{p} M$
4. If $F$ is a diffeomorphism, then $\d F_\mathbf{p}: T_\mathbf{p} M \to T_{F(\mathbf{p})} N$ is an isomorphism and $(\d F_\mathbf{p})^{-1} = \d(F^{-1})_{F_(\mathbf{p})}$

<details>
<summary>Proof</summary>

**(2):** Let $\mathbf{v}\in T_\mathbf{p} N$ and let $f\in C_{G(F(\mathbf{p}))}^\infty (P)$ be a smooth function at $G(F(\mathbf{p}))$ in $P$. Then

$$
  (\d(G\circ F)_\mathbf{p} (\mathbf{v}))f = \mathbf{v}(f\circ G\circ f)
$$

and

$$
\begin{align*}
  (\d G_{F(\mathbf{p})} \circ \d F_\mathbf{p})(\mathbf{v})f =& \d G_{F(\mathbf{p})}(\d F_\mathbf{p}(\mathbf{v}))f \\
  =& (\d F_\mathbf{p}(\mathbf{v}))(f\circ G) \\
  =& \mathbf{v}(f\circ G \circ F)
\end{align*}
$$

**(3):** Note that

$$
  \d(\mathrm{id}_M)(\mathbf{v})f = \mathbf{v}(f\circ \operatorname{id}_M ) = \mathbf{v}(f)
$$

for any $\mathbf{v}\in T_\mathbf{p} M$ and $f\in C_\mathbf{p}^\infty (M)$.

**(4):** If $F$ is a diffeomorphism, it has a differentiable inverse $G:M\to N$ such that $G\circ F = \operatorname{id}_N$and $F\circ G = \operatorname{id}_M$. By the chain rule for $\mathbf{p}\in M$

$$
\begin{align*}
  \d(G\circ F)_\mathbf{p} = \d G_{F(\mathbf{p})} \circ \d F_\mathbf{p} = \d(\operatorname{id}_N)_{F(\mathbf{p})} = \operatorname{id}_{T_\mathbf{p}M} \\
  \d(F\circ G)_{F(\mathbf{p})} = \d F_\mathbf{p} \circ \d G_{F(\mathbf{p})} = \d(\operatorname{id}_M)_\mathbf{p} = \operatorname{id}_{T_{F(\mathbf{p})}M} 
\end{align*}

Hence $\d F_\mathbf{p}$ and $\d G_\mathbf{p}$ are diffeomorphisms
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, $\mathbf{p}\in M$ and $\mathbf{v}\in T_\mathbf{p} M$. If $f,g\in C^\infty(M)$ agree on some neighbourhood of $\mathbf{p}$, then $\mathbf{v}f = \mathbf{v}g$.

<details>
<summary>Proof</summary>

Let $h = f - g$ so that $h$ is a smooth function that vanishes in a neighbourhood of $\mathbf{p}$. Let $\psi\in C^\infty (M)$ be a smooth bump function that is identically equal to $1$ on the support of $h$ and is supported in $M\setminus\Set{\mathbf{p}}$. Because $\psi\equiv 1$ where $h$ is nonzero, the product $\psi h$ is identically equal to $h$. Since $h(\mathbf{p}) = \psi(\mathbf{p}) = 0$, it follows that $\mathbf{v}h = \mathbf{v}(\psi h) = 0$. By linearity, this implies $\mathbf{v}f = \mathbf{v}g$.
</details>
</MathBox>

<MathBox title='The tangent space to an open submanifold' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, $U\subseteq M$ an open subset, and let $\iota: U \hookrightarrow M$ be the inclusion map. For every $\mathbf{p}\in U$, the differential $\d\iota_\mathbf{p}: T_\mathbf{p} U \to T_\mathbf{p} M$ is an isomorphism.

<details>
<summary>Proof</summary>

To show injectivity, suppose $\mathbf{v}\in T_\mathbf{p} U$ and $\d\iota_\mathbf{p} (\mathbf{v}) = 0\in T_\mathbf{p} M$. Let $B$ a neighbourhood of $\mathbf{p}$ such that $\overline{B} \subseteq U$. If $f\in C^\infty (U)$ is arbitrary, the extension lemma for smooth function guarantees that there exists $\tilde{f}\in C^\infty(M)$ such that $\tilde{f}\equiv f$ on $\overline{B}$. Then since $f$ and $\tilde{f}|_U$ are smooth function on $U$ that agree in a neighbourhood of $\mathbf{p}$, it follows from the previous proposition that

$$
  \mathbf{v}f = \mathbf{v}(\tilde{f}|_U) = \mathbf{v}(\tilde{f}\circ\iota) = \d\iota(\mathbf{v})_\mathbf{p} \tilde{f} = 0
$$

Since this holds for every $f\in C^\infty (U)$, it follows that $\mathbf{v} = \mathbf{0}$, so $\d\iota_\mathbf{p}$ is injective.

To show surjectivity, suppose $w\in T_\mathbf{p} M$ is arbitrary. Define an operator $\mathbf{v}: C^\infty(U) \to\R$ by setting $\mathbf{v}f = \mathbf{w}\tilde{f}$, where $\tilde{f}$ is any smooth function on all of $M$ that agrees with $f$ on $\overline{B}$. By the previous proposition, $\mathbf{v}f$ is independent of the choice of $\tilde{f}$, so $\mathbf{v}$ is well-defined, and it is easy to check that it is a derivation of $C^\infty (U)$ at $\mathbf{p}$. For any $g\in C^\infty (M)$

$$
  \d\iota_\mathbf{p} (\mathbf{v})g = \mathbf{v}(g\circ\iota) = \mathbf{w}(\tilde{g\circ\iota}) = \mathbf{w}g
$$

where the last two equalities follow from the fact that $g\circ\iota$, $\tilde{g\circ\iota}$ and $g$ all agree on $B$. Thus, $\d\iota_\mathbf{p}$ is also surjective.
</details>
</MathBox>

<MathBox title='Dimension of the tangent space' boxType='proposition'>
If $M$ is a an $n$-dimensional smooth manifold, then for each $\mathbf{p}\in M$, the tangent space $T_\mathbf{p} M$ is an $n$-dimensional vector space.

<details>
<summary>Proof</summary>

Given $\mathbf{p}\in M$, let $(U,\varphi)$ be a smooth coordinate chart containing $\mathbf{p}$. Because $\varphi$ is a diffeomorphism from $U$ onto an open subset $\tilde{U}\subseteq\R^n$, follows from the properties of differentials that $\d\varphi_p$ is an isomorphism from $T_\mathbf{p} U \to T_{\varphi(\mathbf{p})}\tilde{U}$. Since the previous proposition guarantees that $T_\mathbf{p} M \cong T_\mathbf{p} U$ and $T_{\varphi(\mathbf{p})}\tilde{U} \cong T_{\varphi(p)} \R^n$ it follows that $\dim(T_\mathbf{p} M) = \dim(T_{\varphi(\mathbf{p})}\R^n = n$.
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Let $\iota:\mathbb{H}^n \to\R^n$ denote the inclusion map. For any $\mathbf{a}\in\partial \mathbb{H}^n$, the differential $\d\iota_\mathbf{a}: T_\mathbf{a} \mathbb{H}^n \to T_\mathbf{a} \R^n$ is an isomorphism.

<details>
<summary>Proof</summary>

To show that $\d\iota_\mathbf{a}$ is injective, assume $\d\iota_\mathbf{a} (\mathbf{0}) = 0$. Suppose $f:\mathbb{H}^n \to\R^n$ is smooth, and let $\tilde{f}$ be any extension of $f$ to a smooth function defined on all of $\R^n$. Then $\tilde{f}\circ\iota = f$ and

$$
  \mathbf{v}f = \mathbf{v}(\tilde{f}\circ\iota) = \d\iota_\mathbf{a} (\mathbf{v})\tilde{f} = 0
$$

which implies that $\d\iota_a$ is injective.

To show surjectivity, let $\mathbf{w}\in T_\mathbf{a} \R^n$ be arbitrary. Define $\mathbf{v}\in T_\mathbf{a} \mathbb{H}^n$ by $\mathbf{v}f = \mathbf{w}\tilde{f}$, where $\tilde{f}$ is any smooth extension of $f$. Writing $\mathbf{w} = w^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{a}$ in terms of the standard basis for $T_\mathbf{a} \R^n$, means that

$$
  \mathbf{v}f = w^i \frac{\partial\tilde{f}}{\partial x^i}(\mathbf{a})
$$

This is independent of the choice of $\tilde{f}$, because by continuity the derivatives of $\tilde{f}$ at $\mathbf{a}$ are determined by those of $f$ in $\mathbb{H}^n$. It is easy to check that $\mathbf{v}$ is a derivation at $\mathbf{a}$ and that $\mathbf{w} = \d\iota_\mathbf{a} (\mathbf{v})$, so $\d\iota_\mathbf{a}$ is surjective.
</details>
</MathBox>

<MathBox title='Dimension of the tangent space on a manifold with boundary' boxType='proposition'>
Suppose $M$ is a an $n$-dimensional smooth manifold with boundary, then for each $\mathbf{p}\in M$, the tangent space $T_\mathbf{p} M$ is an $n$-dimensional vector space.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary. If $\mathbf{p}\in\mathrm{int}(M)$ it follows that $T_\mathbf{p}(\mathrm{int}(M)) \cong T_\mathbf{p} M$ because $\mathrm{int}(M)$ is an open submanifold. Since $\mathrm{int}(M)$ is a smooth $n$-manifold without boundary, its tangent spaces all have dimension $n$.

If $\mathbf{p}\in\partial M$, let $(U,\varphi)$ be a smooth boundary chart containing $\mathbf{p}$, and let $\tilde{U} = \varphi(U)\subseteq \mathbb{H}^n$. Then we have the isomorphisms

$$
  T_\mathbf{p} M \cong T_\mathbf{p} U \cont T_{\varphi(\mathbf{p})}\tilde{U} \cong T_{\varphi(\mathbf{p})} \mathbb{H}^n \cong T_{\varphi(\mathbf{p})}\R^n
$$
</details>
</MathBox>

<MathBox title='The tangent space to a vector space' boxType='proposition'>
Suppose $V$ is a finite-dimensional vector space with its standard smooth manifold structure. For each point $\mathbf{a}\in V$ and vector $\mathbf{v}\in V$, define the directional derivative $\D_\mathbf{v}|_\mathbf{a}:C^\infty (V) \to\R$ by

$$
  \D_\mathbf{v}|_\mathbf{a} = \left.\frac{\d}{\d t}\right|_{t=0} f(\mathbf{a} + t\mathbf{v})
$$

The map $v \mapsto \D_\mathbf{v}|_\mathbf{a}$ is a canonical isomorphism from $V$ to $T_a V$ such that for any linear map $L: V\to W$, the following diagram commutes:

$$
\begin{CD}
  V @>\cong>> T_\mathbf{a} V \\
  @V{L}VV @V{\d L_\mathbf{a}}VV \\
  W @>>\cong> T_{L_\mathbf{a}}W
\end{CD}
$$

<details>
<summary>Proof</summary>

Suppose $L:V\to W$ is a linear map. Because its components with respect to any choices of bases for $V$ and $W$ are linear functions of the coordinates, $L$ is smooth. Unwinding the definitions and using the linearity of $L$, we compute

$$
\begin{align*}
  \d L_\mathbf{a}(\D_\mathbf{v}|_\mathbf{a})f =& \D_\mathbf{v}|_\mathbf{a} (f\circ L) \\
  =& \left.\frac{\d}{\d t}\right|_{t=0} f(L(\mathbf{a} + t\mathbf{v})) \\
  =& \left.\frac{\d}{\d t}\right|_{t=0} f(L\mathbf{a} + tL\mathbf{v}) \\
  =& \D_{L\mathbf{v}}|_{L\mathbf{a}}(f)  
\end{align*}
$$
</details>
</MathBox>

<MathBox title='The tangent space to a product manifold' boxType='proposition'>
Let $M_1,\dots, M_k$ be smooth manifolds, and for each $j=1,\dots,k$, let $pi_j: M_1 \times\cdots\times M_k \to M_j$ be the projection onto the $M_j$ factor. For any point $\mathbf{p} = (\mathbf{p}_j)_{j=1}^k \in \prod_{j=1}^k M_i$, the map $\alpha: T_\mathbf{p} \left(\prod_{j=1}^k M_j \right) \to \bigoplus_{j=1}^k T_{\mathbf{p}_j} M_j$ defined by

$$
  \alpha(\mathbf{v}) = (\d(\pi_j)_\mathbf{p}(\mathbf{v}))_{j=1}^k
$$

is an isomorphism. The same is true if one of the spaces $M_j$ is a smooth manifold with boundary.
</MathBox>

## Bases for the tangent space at a point

Suppose $M$ is a smooth $n$-manifold without boundary, and let $(U,\varphi)$ be a smooth coordinate chart on $M$. Since $\varphi: U\to\tilde{U}\subseteq\R^n$ is a diffeomorphism onto its image, then by proposition $\ref{proposition-19}.4$  the differential 

$$
  \d\varphi_\mathbf{p}: T_\mathbf{p} U \to T_{\varphi(\mathbf{p})} \R^n
$$ 

is a vector space isomorphism. Furthermore, since $U$ is an open submanifold it follows that $T_\mathbf{p} U \cong T_\mathbf{p} M$ for every $\mathbf{p}\in M$. This implies that $\d\varphi_\mathbf{p}: T_\mathbf{p} M \to T_{\varphi(\mathbf{p})} \R^n$ is an isomorphism.

<MathBox title='' boxType='proposition' tag='proposition-26'>
Let $(U,\varphi=(x^i)_{i=1}^n)$ be a chart about a point $\mathbf{p}$ in a smooth $n$-manifold $M$. If $(r^i)_{i=1}^n$ are the standard coordinates on $\R^n$, then

$$
  \d\varphi_\mathbf{p} \left(\left.\frac{\partial}{\partial x^i} \right|_\mathbf{p} \right) = \left.\frac{\partial}{\partial r^i}\right|_{\varphi(\mathbf{p})}
$$

<details>
<summary>Proof</summary>

For any $f\in C_\varphi(\mathbf{p})^\infty (\R^n)$ we have

$$
\begin{align*}
  \d\varphi_\mathbf{p} \left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) =& \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} (f\circ\varphi) \tag{definition of $\d\varphi$} \\
  =& \left.\frac{\partial}{\partial r^i}\right|_{\varphi(\mathbf{p})} (f\circ\varphi\circ\varphi^{-1}) \tag{definition of $\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}$} \\
  =& \left.\frac{\partial}{\partial r^i}\right|_{\varphi(\mathbf{p})} f
\end{align*}
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary, and let $\mathbf{p}\in M$. For any smooth chart $(U, (x^i)_{i=1}^n)$ containing $\mathbf{p}$, the tangent space $T_\mathbf{p} M$ has basis

$$
  \Set{\boldsymbol{\partial}_i \vert_\mathbf{p} := \left.\frac{\partial}{\partial x^i}\right \vert_\mathbf{p}}_{i=1}^n
$$

<details>
<summary>Proof</summary>

An isomorphism of vector spaces maps a basis to a basis. By proposition $\ref{proposition-26}$, the isomorphism $\d\varphi_\mathbf{p}: T_\mathbf{p}M \to T_{\varphi(\mathbf{p})} \R^n$ maps $\Set{\left.\partial / \partial x^i}\right\vert_\mathbf{p}}_{i=1}^n$ to $\Set{\left.\partial / \partial r^i \right\vert_\mathbf{p}}_{i=1}^n$, which is a basis for $T_{\varphi(\mathbf{p})} \R^n$. Thus, $\Set{\left. \partial / \partial x^i \right\vert_\mathbf{p}}_{i=1}^n$ is a basis for $T_\mathbf{p} M$.
</details>
</MathBox>

A tangent vector $\mathbf{v}\in T_\mathbf{p} M$ can be written uniquely as a linear combination

$$
  \mathbf{v} = \sum_{i=1}^n v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} = \sum_{i=1}^n v^i \boldsymbol{\partial}_i|_\mathbf{p}
$$

The ordered basis $(\boldsymbol{\partial}_i|_\mathbf{p})_{i=1}^n$ is a called a *coordinate basis* for $T_\mathbf{p} M$ and the scalars $(v^i)_{i=1}^n$ are called the *components* of $\mathbf{v}$ with respect to the coordinate basis. If $\mathbf{v}$ is known, its components can be easily computed from its action on the coordinate functions. For each $j$, the components of $\mathbf{v}$ are given by $v^j = \mathbf{v}(x^j)$, where $x^j:U\to\R$ is a smooth real-valued function, because

$$
\begin{align*}
  \mathbf{v}(x^j) =& \left(\sum_{i=1}^n v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right)(x^j) \\
  =& \sum_{i=1}^n v^i \frac{\partial x^j}{\partial x^i}(\mathbf{p}) \\
  =& \sum_{i=1}^n v^i \delta_i^j = v^j
\end{align*}
$$

### Coordinate representation of differentials

In order to find a coordinate representation of differential, consider first the special case of a smooth map $F:U\to V$, where $U\subseteq\R^n$ and $V\subseteq\R^m$ are open subsets of Euclidean spaces. For any $\mathbf{p}\in U$, we determine the matrix of $\d F_\mathbf{p}: T_\mathbf{p} \R^n \to T_{F(\mathbf{p})} \R^m$ in terms of the standard coordinate bases. Using $(x^i)_{i=1}^n$ to denote the coordinates in the domain and $(y^j)_{j=1}^m$ to denote those in the codomain, we apply the chain rule to compute the action of $\d F_\mathbf{d}$ on a typical basis vector:

$$
\begin{align*}
  \d F_\mathbf{p}\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) f =& \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} (f \circ F) \\
  =& \sum_{j=1}^m \frac{\partial f}{\partial y^j} (F(\mathbf{p})) \frac{\partial F^j}{\partial x^i}(\mathbf{p}) \\
  =& \left(\sum_{j=1}^m \frac{\partial F^j}{\partial x^i}(\mathbf{p}) \left.\frac{\partial}{\partial y^j}\right|_{F(\mathbf{p})} \right)f
\end{align*}
$$

Thus

$$
  \d F_\mathbf{p}\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) = \sum_{j=1}^m \frac{\partial f}{\partial y^j} (F(\mathbf{p})) \frac{\partial F^j}{\partial x^i}(\mathbf{p})
$$

In other words, the matrix of $\d F_\mathbf{p}$ in terms of the coordinate basis is

$$
\begin{bmatrix}
  \frac{\partial F^1}{\partial x^1}(\mathbf{p}) & \cdots & \frac{\partial F^1}{\partial x^n}(\mathbf{p}) \\
  \vdots & \ddots & \vdots \\
  \frac{\partial F^m}{\partial x^1}(\mathbf{p}) & \cdots & \frac{\partial F^m}{\partial x^n}(\mathbf{p})
\end{bmatrix}
$$

which is called the *Jacobian (matrix)* of $F$ at $\mathbf{p}$. The Jacobian is the matrix representation of the total derivative $\D F(\mathbf{p}): \R^n \to\R^m$. Thus, in this case, $\d F_\mathbf{p}: T_\mathbf{p}\R^n \to T_{F(\mathbf{p})} \R^m$ corresponds to the total derivative $\D F(\mathbf{p}):\R^n \to\R^m$, under our usual identification of Euclidean spaces with their tangent spaces. The same calcalulation applies if $U$ is an open subset of $\mathbb{H}^n$ and $V$ is an open subset of $\mathbb{H}^m$.

Consider the more general case of a smooth map $F:M\to N$ between smooth manifolds with or without boundary. Choosing smooth coordinate charts $(U,\varphi)$ for $M$ containing $\mathbf{p}\in M$ and $(V,\psi)$ for $N$ containing $F(\mathbf{p})$, we obtain the coordinate representation $\hat{F} = \psi\circ F\circ\varphi^{-1}: \varphi(U\cap F^{-1}(V)) \to\psi(V)$.

Let $\hat{\mathbf{p}} = \varphi(\mathbf{p})$ denote the coordinate representation of $\mathbf{p}$. By the computation above, $\d\hat{F}_{\hat{\mathbf{p}}}$ is represented with respect to the standard coordinate bases by the Jacobian matrix of $\hat{F}$ at $\hat{\mathbf{p}}$. Using the fact that $F\circ\varphi^{-1} = \psi^{-1} \circ\hat{F}$ we get 

$$
\begin{align*}
  \d F_\mathbf{p}\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right) =& \d F_\mathbf{p} \left(\d(\varphi^{-1})_{\hat{\mathbf{p}}} \left( \left.\frac{\partial}{\partial x^i}\right|_\mathbf{\hat{p}} \right) \right) \\
  =& \d(\psi^{-1})_{\hat{F}(\hat{\mathbf{p}})} \left(\d\hat{F}_{\hat{\mathbf{p}}} \left( \left.\frac{\partial}{\partial x^i}\right|_\mathbf{\hat{p}} \right) \right) \\
  =& \d(\psi^{-1})_{\hat{F}(\hat{\mathbf{p}})} \left(\sum_{j=1}^m \frac{\partial\hat{F}^j}{\partial x^i}(\hat{\mathbf{p}})\left.\frac{\partial}{\partial y^j}\right|_{\hat{F}(\hat{\mathbf{p}})} \right) \\
  =& \sum_{j=1}^m \frac{\partial\hat{F}^j}{\partial x^i}(\hat{\mathbf{p}})\left.\frac{\partial}{\partial y^j}\right|_{F(\mathbf{p})}
\end{align*}
$$

Thus, $\d F_\mathbf{p}$ is represented in coordinate bases by the Jacobian matrix of $F$. In the fact, the definition of the differential is formulated to give a coordinate-independent meaning to the Jacobian matrix.

### Change of coordinates

<MathBox title='Transition matrix for coordinate vectors' boxType='proposition'>
Suppose $(U,\varphi = (x^i)_{i=1}^n)$ and $(V,\psi = (\tilde{x}^i)_{i=1}^n)$ are two smooth charts on an $n$-manifold $M$ and $\mathbf{p}\in U \cap V$. Then

$$
  \left.\frac{\partial}{\partial x^j}\right|_\mathbf{p} = \sum_{i=1}^n \frac{\partial\tilde{x}^i}{\partial x^j}(\varphi(\mathbf{p})) \left.\frac{\partial \tilde{x}^i}{\partial x^j}\right|_{\mathbf{p}}
$$

<details>
<summary>Proof</summary>

The transition map $\psi\circ\varphi^{-1}: \varphi(U \cap V)\to \psi(U\cap V)$ can be written

$$
  \psi\circ\varphi^{-1} (\mathbf{x}) = \left( \tilde{x}^i(\mathbf{x}) \right)_{i=1}^n 
$$

The differential $\d(\psi\circ\phi^{-1})_{\varphi(\mathbf{p})}$ takes the form

$$
\begin{align*}
  \d(\psi\circ\varphi^{-1})_{\varphi(\mathbf{p})} \left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right) = \sum_{j=1}^n \frac{\partial \tilde{x}^j}{\partial x^i}(\varphi(\mathbf{p})) \left.\frac{\partial}{\partial \tilde{x}^j}\right|_{\psi(\mathbf{p})}
\end{align*}
$$

Using the definitions of coordinate vectors, we obtain

$$
\begin{align*}
  \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} =& \d(\varphi^{-1})_{\varphi(\mathbf{p})}\left(\left.\frac{\partial}{\partial x^i}\right|_{\varphi(\mathbf{p})}\right) \\
  =& \d(\psi^{-1})_{\psi(\mathbf{p})} \circ \d(\psi\circ\varphi^{-1})_{\varphi(\mathbf{p})} \left(\left.\frac{\partial}{\partial x^i}\right|_{\varphi(\mathbf{p})}\right) \\
  =& \d(\psi^{-1})_{\psi(\mathbf{p})}\left(\sum_{j=1}^n \frac{\partial \tilde{x}^j}{\partial x^i} (\varphi(\mathbf{p})) \left.\frac{\partial}{\partial \tilde{x}^j}\right|_{\psi(\mathbf{p})} \right) \\
  =& \sum_{j=1}^n \frac{\partial\tilde{x}^j}{\partial x^i} (\varphi(\mathbf{p})) \left.\frac{\partial}{\partial \tilde{x}^j}\right|
\end{align*}
$$
</details>
</MathBox>

Let $M$ be a smooth $n$-manifold and consider a tangent space $T_\mathbf{p} M$ on $\mathbf{p}\in M$. In terms of the charts $(U,\varphi = (x^i)_{i=1}^n)$ and $(V,\psi = (\tilde{x}^i)_{i=1}^n)$ on $M$ with $\mathbf{p}\in U\cap V$, a tangent vector $\mathbf{v}\in T_\mathbf{p}M$ has components

$$
  \mathbf{v} = \sum_{i=1}^n v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} = \sum_{k=1}^n \tilde{v}^k \left.\frac{\partial}{\partial\tilde{x}^k}\right|_\mathbf{p}
$$

Applying both coordinate representations to $\tilde{x}^j$ gives

$$
\begin{align*}
  \sum_{i=1}^n v^i \frac{\partial\tilde{x}^j}{\partial x^i}(\varphi(\mathbf{p})) =& \sum_{k=1}^n \tilde{v}^k \left.\frac{\partial \tilde{x}^j}{\partial\tilde{x}^k}\right|_\mathbf{p} \\
  =& \sum_{k=1}^n \tilde{v}^k \delta_k^j = \tilde{v}^j
\end{align*}
$$

showing that the components of $\mathbf{v}$ transform by the rule

$$
  \tilde{v}^i = \sum_{j=1}^n v^j \frac{\partial\tilde{x}^i}{\partial x^j}(\varphi(\mathbf{p}))
$$

## Tangent bundle

<MathBox title='Tangent bundle' boxType='definition'>
If $M$ is a smooth manifold $M$ with or without boundary, the *tangent bundle* of $M$, denoted $TM$, is the disjoint union of the tangent spaces at all points of $M$:

$$
  TM := \bigsqcup_{\mathbf{p}\in M} T_\mathbf{p} M := \bigcup_{\mathbf{p}\in M} \Set{\mathbf{p}} \times T_\mathbf{p} M
$$

The tangent bundle is equipped with a natural *projection map* $\pi:TM \to M$, sending each vector in $T_\mathbf{p} M$ to the point $\mathbf{p}$ at which it is tangent, i.e. $\pi(\mathbf{p},\mathbf{v}) = \mathbf{p}$. 
</MathBox>

In the special case $M = \R^n$, the tangent bundle of $\R^n$ can be canonically identified with the union of its geometric tangent spaces, which in turn is just the Cartesian product of $\R^n$ with itself:

$$
\begin{align*}
  T\R^n =& \bigsqcup_{\mathbf{a}\in\R^n} T_\mathbf{a}\R^n \cong \bigsqcup_{\mathbf{a}\in\R^n} \R_\mathbf{a}^n \\
  =& \bigsqcup_{\mathbf{a}\in\R^n} \Set{\mathbf{a}} \times\R^n = \R^n \times\R^n
\end{align*}
$$

An element $(\mathbf{a},\mathbf{v})\in T\R^n$ of this Cartesian product can be thought of as representing either the geometric tangent vector $\mathbf{v}_\mathbf{a}$ or the derivation $\D_\mathbf{v}|_\mathbf{a}$.

In general, the tangent bundle of a smooth manifold cannot be identified in any natural way with a Cartesian product, because there is no canonical way to identify tangent spaces at different points with each other.

<MathBox title='The tangent bundle is a smooth manifold' boxType='proposition'>
For any smooth $n$-manifold $M$, the tangent bundle $TM$ has a natural topology and smooth structure that make it into a $2n$-dimensional smooth manifold. With respect to this structure, the projection $\pi:TM\to M$ is smooth.

<details>
<summary>Proof</summary>

$$
\begin{CD}
  \pi^{-1}(U) \subseteq TM @>\tilde{\varphi}>> @ \varphi(U)\times\R^n \subseteq \R^{2n} \\
  @V{\pi}VV @VVV \\
  U \subseteq M @>>\varphi> \varphi(U)\subseteq \R^n
\end{CD}
$$

Given any smooth chart $(U,\varphi)$ for $M$, note that $\pi^{-1} (U)\subseteq TM$ is the set of all tangent vector to $M$ at all points of $U$. Let $(x^i)_{i=1}^n$ denote the coordinate functions of $\varphi$, and define a map $\tilde{\varphi}: \pi^{-1}(U)\to\R^{2n}$ by

$$
  \tilde{\varphi}\left(v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) = \left(x^1(\mathbf{p}),\dots,x^n (\mathbf{p}),v^1,\dots,v^n \right)
$$

It image set is $\varphi(U)\times\R^n$ which is an open subset of $\R^{2n}$. It is a bijection onto its image, because its inverse can be written explicitly as

$$
  \tilde{\varphi}^{-1}(x^1,\dots,x^n,v^1,\dots,v^n) = v^i \left.\frac{\partial}{\partial x^i}\right|_{\varphi^{-1}(\mathbf{x})}
$$

Suppose we are given two smooth charts $(U,\varphi)$ and $(V,\psi)$ for $M$, and let $(\psi^{-1}(U), \tilde{\varphi})$ and $(\tilde^{-1}(V), \tilde{\psi})$ be the corresponding charts on $TM$. The sets

$$
\begin{align*}
  \tilde{\varphi}\left(\pi^{-1}(U) \cap \pi^{-1}(V) \right) =& \varphi(U \cap V) \times\R^n \\
  \tilde{\psi}\left(\pi^{-1}(U) \cap \pi^{-1}(V) \right) =& \psi(U \cap V) \times\R^n
\end{align*}
$$

are open in $\R^{2n}$, and the transition map $\tilde{\psi}\circ\tilde{\varphi}^{-1}: \varphi(U\cap V)\times\R^n \to \psi(U\cap V)\times\R^n$ can be written as

$$
\begin{align*}
  &\tilde{psi}\circ\varphi^^{-1}(x^1,\dots,x^n,v^1,\dots,v^n) \\
  &= \left(\tilde{x}^1(\mathbf{x}),\dots,\tilde{x}^n(\mathbf{x}), \frac{\partial \tilde{x}^1}{\partial x^j}(\mathbf{x})v^j,\dots,\frac{\partial\tilde{x}^n}{\partial x^j}(\mathbf{x})v^j \right)
\end{align*}
$$

which is clearly smooth.

Choosing a countable cover $\Set{U_i}$ of $M$ by smooth coordinate domains, we obtain a countable cover of $TM$ by coordinate domains $\Set{\pi^{-1}(U_i)}$ satisfying the conditions of the smooth manifold chart lemma. To check the Hausdorff condition, note that any two points in the same fibre of $\pi$ lie in one chart, while if $(\mathbf{p},\mathbf{v})$ and $(\mathbf{q}, \mathbf{w})$ lie in different fibers, there exits disjoint smooth coordinate domains $U$ and $V$ for $M$ such that $\mathbf{p}\in U$ and $\mathbf{q}\in V$, and then $\pi^{-1}(U)$ and $\pi^{-1}(V)$ are disjoint coordinate neighbourhoods containing $(\mathbf{p}, \mathbf{v})$ and $(\mathbf{q},\mathbf{w})$, respectively.

To se that $\pi$ is smooth, note that with respect to the charts $(U,\varphi)$ for $M$ and $(\pi^{-1}(U), \tilde{\varphi})$ for $TM$, its coordinate representation is $\pi(\mathbf{p},\mathbf{v}) = \mathbf{x}$.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
If $M$ is a smooth $n$-manifold with or without boundary, and $M$ can be covered by a single smooth chart, then $TM$ is diffeomorphic to $M\times\R^n$.

<details>
<summary>Proof</summary>

If $(U,\varphi)$ is a global smooth chart for $M$, then $\varphi$ is, in particular a diffeomorphism from $U = M$ to an open subset $\hat{U}\subseteq \R^n$ or $\mathbb{H}^n$. The proof from the previous proposition showed that the natural coordinate chart $\tilde{\varphi}$ is a bijection from $TM$ for $\hat{U}\times\R^n$, and the smooth structure on $TM$ is defined essentially by declaring $\tilde{\varphi}$ to be a diffeomorphism.
</details>
</MathBox>

Let $F:M\to N$ be a smooth map between smooth manifolds $M$ and $N$. By combining the differentials of $F$ at all points of $M$, we obtain a globally defined map $\d F: TM\to TN$ between tangent bundles, called the *global differential* or *global tangent map*. This is just the map whose restriction to each tangent space $T_\mathbf{p}M \subseteq TM$ is $\d F_p$.

<MathBox title='' boxType='proposition'>
If $F: M\to N$ is a smooth map, its global differential $\d F: TM\to TN$ is a smooth map.

<details>
<summary>Proof</summary>

From the local expression for $\d F_p$ in coordinates, it follows that $\d F$ has the following coordinate representation in terms of natural coordinates for $TM$ and $TN$:

$$
  \mathbf{d}F(x^1,\dots,x^n,v^1,\dots^n) = \left(F^1(\mathbf{x}),\dots,F^n(\mathbf{x}),\frac{\partial F^1}{\partial x^i}(\mathbf{x})v^i,\dots,\frac{\partial F^n}{\partial x^i}(\mathbf{x})v^i \right)
$$

This map is smooth, because $F$ is smooth.
</details>
</MathBox>

<MathBox title='Properties of the global differential' boxType='proposition'>
Suppose $F:M\to N$ and $G:N\to P$ are smooth maps.
1. $\d(G\circ F) = \d G\circ\d F$
2. $\d(\operatorname{id}_M) = \operatorname{id}_{TM}$ 
3. if $F$ is a diffeomorphism, then $\d F:TM\to TN$ is also a diffeomorphism, and $(\d F)^{-1} = \d(F^{-1})$ allowing us to write $\d F^{-1}$ unambiguously
</MathBox>

## Velocity vectors of curves

<MathBox title='Smooth curves in a manifold' boxType='definition'>
If $M$ is a manifold with or without boundary, a *smooth curve* in $M$ is a smooth map $\gamma: I\subseteq\R \to M$ where the interval $I$ can be both open and closed.

The *velocity* of $\gamma$ at $t_0 \in I$ is defined as the tangent vector

$$
  \gamma'(t_0) := \d\gamma\left(\left.\frac{\d}{\d t}\right|_{t_0} \right) \in T_{\gamma(t_0)}M
$$

where $\left.\frac{\d}{\d t}\right|_{t_0}$ is the standard coordinate basis vector in $T_{t_0}\R$. This tangent vector acts on functions by

$$
\begin{align*}
  \gamma' (t_0)f =& \d\gamma\left(\left.\frac{\d}{\d t}\right|_{t_0} \right) = \left.\frac{\d}{\d t}\right|_{t_0} (f\circ\gamma) \\
  =& (f\circ\gamma)'(t_0)
\end{align*}
$$
</MathBox>

Note that when $\gamma: I\to\R$ is a smooth curve in $\R$, the notation $c(t)$ can be ambigious. If $x$ is the standard coordinate on $\R$, then as a velocity $\gamma'(t)$ is a tangent vector at $\gamma(t)$, i.e. a multiple of $\d/\d x|_{\gamma(t)}$. On the other hand, in calculus notation $\gamma'(t)$ is the derivative of a real-valued function and is therefore a scalar. To destinguish between the two meanings of $\gamma'(t)$ when $\gamma$ maps into $\R$, we write $\dot{\gamma}(t)$ for the calculus derivative.

<MathBox title='Coordinate representation of velocity curves' boxType='proposition' tag='proposition-41'>
Let $\gamma: I\to M$ be a smooth curve on a smooth $n$-manifold $M$, and let $(U,\varphi (x^i)_{i=1}^n)$ be a smooth chart about $\gamma(t) \in M$. The coordinate representation of the velocity curve $\gamma'(t)$ is given by

$$
\begin{align*}
  \gamma'(t_0) =& \sum_{i=1}^n \frac{\d\gamma^i}{\d t}(t_0)\left.\frac{\partial}{\partial x^i}\right|_{\gamma(t_0)} \\
  =& \sum_{i=1}^n \dot{\gamma}^i (t_0) \left.\frac{\partial}{\partial x^i}\right|_{\gamma(t_0)}
\end{align*}
$$

<details>
<summary>Proof</summary>

Using the fact that $\gamma = \varphi^{-1} \circ\hat{\gamma}$, the coordinate formula for the differential yields

$$
\begin{align*}
  \gamma'(t_0) =& \d\gamma\left(\left.\frac{\d}{\d t}\right|_{t_0} \right) = \d(\varphi^{-1})_{\hat{\gamma}(t_0)} \left(\d\hat{\gamma}_{t_0} \left(\left.\frac{\d}{\d t}\right|_{t_0} \right)\right) \\
  =& \d(\varphi^{-1})_{\hat{\gamma}(t_0)} \left(\sum_{j=1}^n \frac{\d\gamma^j}{\d t}(t_0) \left.\frac{\partial}{\partial x^j}\right|_{\hat{\gamma}(t_0)} \right) \\
  =& \frac{\d\gamma^j}{\d t}(t_0) \left.\frac{\partial}{\partial x^j}\right|_{\gamma(t_0)}
\end{align*}
$$
</details>
</MathBox>

The coordinate representation shows that the velocity $\gamma'(t_0)$ is the tangent vector whose components in a coordinate basis are the derivatives of the component functions of $\gamma$.

<MathBox title='Tangent vectors are velocity vectors' boxType='proposition'>
Suppose $M$ is a smooth $n$-manifold with or without boundary and $\mathbf{p}\in M$. Every $\mathbf{v}\in T_\mathbf{p}M$ is the velocity of some smooth curve in $M$.

<details>
<summary>Proof</summary>

First, suppose $\mathbf{p}\in\mathrm{int}(M)$. Let $(U,\varphi = (x^i)_{i=1}^n)$ be a smooth coordinate chart centered at $\mathbf{p}$, i.e. $\varphi(\mathbf{p}) = \mathbf{0} \in\R^n$. The coordinate representation of the vector $\mathbf{v}\in T_\mathbf{p} M$ in this chart is

$$
  \mathbf{v} = \sum_{i=1}^n v^i \left.\frac{\partial}{x^i}\right|_\mathbf{p}
$$ 

in terms of the coordinate basis. For sufficiently small $\varepsilon > 0$, let $\gamma(-\varepsilon, \varepsilon) \to U$ be the curve with coordinate representation

$$
  \hat{\gamma}(t) = (tv^i)_{i=1}^n
$$

which is clearly a smooth curve. Since $\gamma = \varphi^{-1} \circ\hat{\gamma}$, we get 

$$
  \gamma(0) = \varphi^{-1}(\hat{\gamma}(0)) = \varphi^{-1}(\mathbf{0}) = \mathbf{p}
$$

From the coordinate represenation of the velocity $\gamma'$ we get (proposition $\ref{proposition-41}$)

$$
  \gamma'(0) = \sum_{i=1}^n \dot{\gamma}^i(0) \left.\frac{\partial}{\partial x^i}\right|_{\gamma(0)} = \sum_{i=1} v^i \left.\frac{\partial}{\partial x^i}\right|_{\gamma(0)} = \mathbf{v}
$$

Next, suppose $\mathbf{p}\in\partial M$. In this case, $\hat{gamma}(t) = (tv^i)_{i=1}^n$ only represents a point in $M$ when $tv^n \geq 0$. We can accommadate this by suitably restricting the domain of $\gamma$:
- if $v^n = 0$, we define $\gamma:(-\varepsilon, \varepsilon)\to U$ as before
- if $v^n >0$, we let the domain be $[0, \varepsilon)$
- if $v^n < 0$, we let the domain be $(-\varepsilon, 0]$

In each case, $\gamma$ is a smooth curve in $M$ with $\gamma(0) = \mathbf{p}$ and $\gamma'(0) = \mathbf{v}$.
</details>
</MathBox>

<MathBox title='Tangent vectors are directional derivatives' boxType='proposition'>
Suppose $\mathbf{\mathbf{X_p}}$ is a tangent vector at a point $\mathbf{p}$ of a smooth manifold $M$ and $f\in C_\mathbf{p}^\infty (M)$. If $\gamma:(-\varepsilon,\varepsilon) \to M$ for $\varepsilon > 0$ is a smooth curve starting at $\mathbf{p}$ with $\gamma'(0) = \mathbf{\mathbf{X_p}}$, then

$$
  \mathbf{\mathbf{X_p}} f = \left.\frac{\d}{\d t}\right|_0 (f\circ\gamma)
$$

<details>
<summary>Proof</summary>

By the definitions of $\gamma'(0)$ and $\d\gamma_0$ we have

$$
  \mathbf{\mathbf{X_p}} f = \gamma'(0)f = \d\gamma_0 \left(\left.\frac{\d}{\d t}\right|_0 \right)f = \left.\frac{\d}{\d t}\right|_0 (f\circ\gamma)
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition' tag='proposition-43'>
Let $F:M\to N$ be a smooth map, and let $\gamma:I\to M$ be a smooth curve. For any $t_0 \in I$, the velocity at $t = t_0$ of the composite curve $F\circ\gamma:I\to N$ is given by

$$
  (F\circ\gamma)'(t_0) = \d F(\gamma'(t_0))
$$

<details>
<summary>Proof</summary>

From the definition of the velocity of a curve we get

$$
\begin{align*}
  (F\circ\gamma)'(t_0) =& \d(F\circ\gamma)_{t_0} \left(\left.\frac{\d}{\d t}\right|_{t_0} \right) \\
  =& \d F_{\gamma(t_0)} \circ \d\gamma\left(\left.\frac{\d}{\d t}\right|_{t_0} \right) \\
  =& \d F_{\gamma(t_0)} (\gamma'(t_0))
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Differential of smooth maps in terms of a curve' boxType='corollary' tag='corollary-4'>
Suppose $F:M\to N$ is a smooth map, and let $\mathbf{p}\in\mathbf{M}$ and $\mathbf{v}\in T_\mathbf{p}M$. Then

$$
  \d F_\mathbf{p}(\mathbf{v}) = \left.\frac{\d}{\d t}\right|_0 (F\circ\gamma)(t) = (F\circ\gamma)'(0)
$$

for any smooth curve $\gamma:I\to M$ such that $0\in I$, $\gamma(0) = \mathbf{p}$ and $\gamma'(0) = \mathbf{v}$. In other words, $\d F_\mathbf{p}(\mathbf{v})$ is the velocity vector of the image curve $F\circ\gamma$ at $F(\mathbf{p})$.

<details>
<summary>Proof</summary>

Applying proposition $\ref{proposition-43}$ with $\gamma(0) = \mathbf{p}$ and $\gamma'(0) = \mathbf{v}$ we get

$$
\begin{align*}
  \d F_\mathbf{p}(\mathbf{v}) =& \d F_\mathbf{p}(\gamma'(0)) \\
  =& \d F_\mathbf{p} \circ \d\gamma_0 \left(\left.\frac{\d}{\d t}\right|_0 \right) \
  =& \d(F\circ\gamma)_0 \left(\left.\frac{\d}{\d t}\right|_0 \right) \\
  =& \left.\frac{\d}{\d t}\right|_0 (F\circ\gamma)(t)
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Differential of left multiplication' boxType='example'>
If $g$ is a matrix in the general linear group $\mathrm{GL}_n (\R)$, let $\ell_g : \mathrm{GL}_n (\R) \to\mathrm{GL}_n (\R)$ be left-multiplation by $g$. Thus $\ell_g (B)$ for any $B \in \mathrm{GL}_n (\R)$. Since $\mathrm{GL}_n (\R)$ is an open subset of the vector space $\R^{\n\times n}$, the tangent space $T_g (\mathrm{GL}_n(\R))$ can be identified with $\R^{n\times n}$. With this identification it can be shown that the differential $\d(\ell_g)_I : T_I (\mathrm{GL}_n (\R)) \to T_g (\mathrm{GL}_n (\R))$ is also left multiplication by $g$.

Let $X \in T_\mathbf{I} (\mathrm{GL}_n (\R)) \to T_g (\mathrm{GL}_n (\R))$. To compute $\d(\ell_g)_I (X)$, choose a curve $\gamma(t)$ in $\mathrm{GL}_n (\R)$ with $\gamma(0) = I$ and $\gamma'(0) = X$. Then $\ell_g (\gamma(t)) = g\gamma(t)$ is simply matrix multiplication. By $\ref{corollary-4}$

$$
\begin{align*}
  \d(\ell_g)_I (X) =& \left.\frac{\d}{\d t}\right|_0 \ell_g (\gamma(t)) \\
  =& \left.\frac{\d}{\d t}\right|_{0} g\gamma(t) = g\gamma(t)
\end{align*}
$$

In this computation

$$
  \left.\frac{\d}{\d t}\right|_0 g\gamma(t) = g\gamma'(0)
$$

by $\R$-linearity and proposition $\ref{proposition-41}$.
</MathBox>

## Alternative definitions of the tangent space

### Derivations of the space of germs

<MathBox title='Germ' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. A *smooth function element* on $M$ is an ordered pair $(f,U)$ where $U$ is an open subset of $M$ and $f:U\to\R$ is a smooth function.

For two function elements, we define an equivalence relation $(f,U)\sim_\mathbf{p} (g, V)$ if $f \equiv g$ on some neighbourhood of a point $\mathbf{p}\in M$. The equivalence class of a function element $(f,U)$, denoted $[(f,U)]_\mathbf{p}$, is called the *germ* of $f$ at $\mathbf{p}$. The set of all germs of smooth functions at $\mathbf{p}$ is denoted $C_\mathbf{p}^\infty (M)$. It is a real vector space and an associative algebra under the operations

- **(scalar multiplication):** $c[(f,U)]_\mathbf{p} = [(cf, U)]_\mathbf{p}$
- **(addition):** $[(f,U)]_\mathbf{p} + [(f + g, U\cap V)]_\mathbf{p}$
- **(multiplication):** $[(f,U)]_\mathbf{p} \cdot [(g,V)]_\mathbf{p} = [(fg, U\cap V)]$

A *derivation* of $C_\mathbf{p}^\infty$ is a linear map $v:C_\mathbf{p}^\infty (M) \to\R$ satisfying the product rule

$$
  v[fg]_\mathbf{p} = f(\mathbf{p})v[g]_\mathbf{p} + g(\mathbf{p})v[f]_\mathbf{p}
$$
</MathBox>

It is common to define the tangent space to $M$ at $\mathbf{p}$ as the vector space $D_\mathbf{p} M$ of derivations of $C_\mathbf{p}^\infty(M)$. The map $\phi: D_\mathbf{p}M \to T_\mathbf{p} M$ defined by $(\varphi\mathbf{v})f = \mathbf{v}([f]_\mathbf{p})$ is an isomorphism.

### Equivalence classes of curves

<MathBox title='Tangent space' boxType='definition'>
Let $M$ be an $n$-dimensional smooth manifold and let $\mathbf{p}\in M$. The set of all curves in $M$ passing through $p$ is defined as

$$
  C_p (M) := \Set{ \gamma:(-\varepsilon, \epsilon) \to M | \gamma \textrm{ differentiable } \gamma(0) = p }
$$

For any chart $h: U\subseteq M \to\R^n$ there is an equivalence relation

$$
  \gamma\sim\alpha :\iff (h\circ\gamma)'(0) = (h\circ\alpha)'(0)
$$

The equivalence class $[\gamma]_\sim := \Set{\alpha | \gamma\sim\alpha }$ represents a tangent vector. The tangent space of $M$ at $p$, denoted $T_p M$ is defined as the set of all tangent vectors at $p$

$$
  T_p M := C_p(M)/\sim
$$
</MathBox>

<MathBox title='Coordinate basis' boxType='definition'>
Let $M$ be an $n$-dimensional smooth manifold having a chart $h:U\subseteq M \to \R^n$ with inverse $\phi = h^{-1}$. Since the tangent space $T_p M$ is isomorphic to $\R^n$ there is a linear and bijective map $h_* : T_p M \to \R^n$ given by $[\gamma]\mapsto (h\circ\gamma)'(0)$ where the equivalence class $[\gamma]$ is a tangent vector in $T_p M$. The coordinate basis with respect to $h$ is defined as

$$
  \partial_j := \phi_* (\mathbf{e}_j)
$$

where $\phi_* := h_*^{-1}$ and $(\mathbf{e}_i)_{i=1}^n$ is the standard basis of $\R^n$.
</MathBox>

<MathBox title='Differential' boxType='definition'>
Let $M, N$ be two smooth manifolds and let $f:M\to N$ be a smooth function. The differential of $f$ at $\mathbf{p}\in M$ is defined as

$$
\begin{align*}
  \d f_p:& T_p M \to T_{f(\mathbf{p})} \\
  & [\gamma] \mapsto [f\circ\gamma]
\end{align*}
$$

The differential of $f$ is defined as

$$
  \d f: p\mapsto\d f_p
$$
</MathBox>

### Tangent spaces of submanifolds

<MathBox title='Tangent spaces of submanifolds' boxType='definition'>
Let $M\subseteq\R^n$ be a $k$-dimensional submanifold. Then there is a chart $(U, h)$ of $\R^n$ such that

$$
  h(M\cap U) = \left( \R^k \times \mathbf{0}_{n-k} \right) \cap U'
$$

Since $h$ is a homemorphism, we may form an inverse $\phi: \R^k \cap U \to M\cap U$ giving a local parametrization. The tangent space for $\mathbf{p}\in M$ is defined as

$$
  \mathrm{T}_p M := \d\phi_{\tilde{p}} [\R^k] = \Set{ J_\phi \left( \phi^{-1}(p)x \right) | x\in\R^k } \subseteq\R^n 
$$

The tangent space can be reformulated in terms of a parametrized curve $\gamma:\R\to M$

$$
  \mathrm{T}_p M = \Set{ \gamma'(0) | \gamma:(-\varepsilon, \varepsilon) \to M \textrm{ differentiable with } \gamma(0) = p }
$$

<details>
<summary>Proof</summary>

To prove the reformulation, first let $v \in \mathrm{T}_p M$ such that $v = J_\phi\left(\tilde{p} \right)x$ with $\tilde{p} = \phi^{-1}(p)$ and $x\in\R^k$. Then for $\tilde{\gamma}(t) = \tilde{p} + tx$

$$
\begin{align}
  v &= J_\phi \left(\tilde{\gamma}(0) right)\tilde{\gamma}(0) \\
  &= \frac{\d}{\d t}\left(\gamma \circ \tilde{\gamma} \right)|_{t=0} = \gamma'
\end{align}
$$

This shows that $T_p M \subseteq \Set{ \gamma'(0) | \gamma:(-\varepsilon, \varepsilon) \to M \textrm{ differentiable with } \gamma(0) = p }$

Finally, let $\gamma: (-\varepsilon, \varepsilon) \to M$ differentiable with $\gamma (0) = p$. Since $M$ is a submanifold, there is a chart $h: U\cap M \to \R^k \cap U'$, which defines an inverse of $\phi$. Define $x:= \frac{\d}{\d t} (h \circ \gamma)|_{t=0}$ so that $\tilde{\gamma} = h\circ \gamma$. Then

$$
\begin{align}
  \gamma'(0) &= \frac{\d}{\d t}\left(\phi \circ \gamma)\right)|_{t=0} \\
  &= J_\phi \left(\tilde{\gamma}(0) \right)\tilde{\gamma}'(0) = J_\phi \left(\phi^{-1}(p)\right)x
\end{align}
$$

This shows that $T_p M \supseteq \Set{ \gamma'(0) | \gamma:(-\varepsilon, \varepsilon) \to M \textrm{ differentiable with } \gamma(0) = p }$
</details>
</MathBox>

# Submersions, immersions and embeddings

<MathBox title='Rank' boxType='definition'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary. Given a smooth map $F:M\to N$ and a point $\mathbf{p}\in M$, we define the *rank* of $F$ at $\mathbf{p}$ to be the rank of the linear map $\d F_\mathbf{p}:T_\mathbf{p}M \to T_{F(\mathbf{p})}N$, which is the rank of the Jacobian matrix of $F$ in any smooth smooth chart, or the dimension of $\operatorname{ran}(\d F_\mathbf{p}) \subseteq T_{F(\mathbf{p})} N$. 

The rank of $F$ at each point bounded above by $\min\Set{\dim(M),\dim(N)}$. If the rank of $\d F_\mathbf{p}$ is equal to this upper bound, then $F$ has full rank at $\mathbf{p}$, and if $F$ has full rank everywhere, we say that $F$ has *full rank*. If $F$ has the same rank at every point, we say that is has constant rank.

A smooth map $F:M\to N$ is called a *smooth submersion* if its differential is surjective at each point, i.e. $\operatorname{rank}(F) = \dim(N)$. It is called a *smooth immersion* if its differential is injective at each point, i.e. $\operatorname{rank}(F) = \dim(M)$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $F:M\to N$ is a smooth map and $\mathbf{p}\in M$. If $\d F_\mathbf{p}$ is surjective, then $\mathbf{p}$ has a neighbourhood $U$ such that $F|_U$ is a submersion. If $\d F_\mathbf{p}$ is injective, then $\mathbf{p}$ has a neighbourhood $U$ such that $F|_U$ is an immersion.

<details>
<summary>Proof</summary>

If we choose any smooth coordinate for $M$ near $\mathbf{p}$ and for $N$ near $F(\mathbf{p})$, either hypothesis mean that the Jacobian matrix of $F$ in coordinates has full rank at $\mathbf{p}$. If $\dim(M)= m$ and $\dim(N) = n$, the set of $m\times n$ matrices of full rank is an open subset of $\mathcal{M}_{m,n}(\mathbb{R})$. By continuity, the Jacobian of $F$ has full rank in some neighbourhood of $\mathbf{p}$.
</details>
</MathBox>

## Local diffeomorphism

<MathBox title='Local diffeomorphism' boxType='definition'>
If $M$ and $N$ are smooth manifolds with or without boundary, a map $F:M\to N$ is called a *local diffeomorphism* if every point $\mathbf{p}\in M$ has a neighbourhood $U$ such that $F(U)$ is open in $N$ and $F|_U:U\to F(U)$ is a diffeomorphism.
</MathBox>

<MathBox title='Inverse function theorem for manifolds' boxType='theorem'>
Suppose  $M$ and $N$ are smooth manifolds, and let $F:M\to N$ be a smooth map. If $\mathbf{p}\in M$ is a point such that $\d F_\mathbf{p}$ is invertible, then there are connected neighbourhoods $U_0$ of $\mathbf{p}$ and $V_0$ of $F(\mathbf{p})$ such that $F|_U:U_0 \to V_0$ is a diffeomorphism.

<details>
<summary>Proof</summary>

The fact that $\d F_\mathbf{p}$ is bijective implies that $M$ and $N$ have the same dimension, say $n$. Choose smooth charts $(U,\varphi)$ centered at $\mathbf{p}$ and $(V,\psi)$ centered at $F(\mathbf{p})$ with $F(U) \subseteq V$. Then $\tilde{F} = \psi\circ F\circ\varphi^{-1}$ is a smooth map from the open subset $\tilde{U} = \varphi(U)\subseteq\R^n$ into $\tilde{V} = \psi(V)\subseteq\R^n$ with $\tilde{F}(\mathbf{p}) = 0$. Because $\varphi$ and $\psi$ are diffeomorphisms, the differential $\d\tilde{F}_0 = \d_{\psi_{F(\mathbf{p})}} \circ \d F_\mathbf{p} \circ \d(\varphi^{-1})_0$ is nonsingular. The ordinary inverse function theorem shows that there are connected open subsets $\tilde{U}_0 \subseteq\tilde{U}$ and $\tilde{V}_0 \subseteq\tilde{V}$ containing $0$ such that $\tilde{F}$ restricts to a diffeomorphism from $\tilde{U}_0$ to $\tilde{V}_0$. Then $U_0 = \varphi^{-1} (\tilde{U}_0)$ and $V_0 = \psi^{-1}(\tilde{V}_0)$ are connected neighbourhoods of $\mathbf{p}$ and $F(\mathbf{p})$, respectively, and it follows by composition that $F|_{U_0}$ is a diffeomorphism from $U_0$ to $V_0$.
</details>
</MathBox>

<MathBox title='Properties of local diffeomorphisms' boxType='proposition'>
1. Every composition of local diffeomorphisms is a local diffeomorphism.
2. Every finite product of local diffeomorphisms between smooth manifolds is a local diffeomorphism.
3. Every local diffeomorphism is a local homeomorphism and an open map.
4. The restriction of a local diffeomorphism to an open submanifold with or without boundary is a local diffeomorphism.
5. Every diffeomorphism is a local diffeomorphism.
6. Every bijective local diffeomorphism is a diffeomorphism.
7. A map between smooth manifolds with or without boundary is a local diffeomorphism if and only if in a neighbourhood of each point of its domain, it has a coordinate representation that is a local diffeomorphism.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds without boundary, and that $F:M\to N$ is a map.
1. $F$ is a local diffeomorphism if and only if it is both a smooth immersion and a smooth submersion.
2. If $\dim(M) = \dim(N)$ and $F$ is neither a smooth immersion or a smooth submersion, then it is a local diffeomorphism.

<details>
<summary>Proof</summary>

**(1):** Suppose first that $F$ is a local diffeomorphism. Given $\mathbf{p}\in M$ there is a neighbourhood $U$ of $\mathbf{p}$ such that $F$ is a diffeomorphism from $U$ to $F(U)$. It follows that $\d F_\mathbf{p}:T_\mathbf{p}M\to T_{F(\mathbf{p})} N$ is an isomorphism. Thus, $\operatorname{rank}(F) = \dim(M) = \dim(N)$, so $F$ is both a smooth immersion and a smooth submersion.

Conversely, if $F$ is both a smooth immersion and a smooth submersion, then $\d F_\mathbf{p}$ is an isomorphism at each $\mathbf{p}\in M$, and the inverse function theorem for manifolds shows that $\mathbf{p}$ has a neighbourhood on which $F$ restricts to a diffeomorphism onto its image.

**(2):** Note that if $M$ and $N$ have the same dimension, then either injectivity or surjectivity of $\d F_\mathbf{p}$ implies bijectivity, so $F$ is a smooth submersion if and only if it is a smooth immersion, and thus **(2)** follows from **(1)**.
</details>
</MathBox>

## The rank theorem

<MathBox title='Rank theorem' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds of dimensions $m$ and $n$, respectively, and that $F:M\to N$ is a smooth map with constant rank $\operatorname{rank}(F) = r$. For each $\mathbf{p}\in M$, there exists smooth charts $(U,\varphi)$ for $M$ centered at $\mathbf{p}$ and $(V,\psi)$ for $N$ centered at $F(\mathbf{p})$ such that $F(U) \subseteq V$, in which $F$ has a coordinate representation of the form

$$
  \tilde{F}(x^1,\dots,x^r,x^{r+1},\dots,x^m) = (x^1,\dots,x^r,0,\dots,0)
$$

In particular, if $F$ is a smooth submersion, this becomes

$$
  \tilde{F}(x^1,\dots,x^n,x^{n+1},\dots,x^m) = (x^1,\dots,x^n)
$$

and if $F$ is a smooth immersion, it is

$$
  \tilde{F}(x^1,\dots,\dots,x^m) = (x^1,\dots,x^m,0,\dots,0)
$$

<details>
<summary>Proof</summary>

Because the theorem is local, after choosing smooth coordinates we can replace $M$ and $N$ by open subsets $U\subseteq\R^m$ and $V\subseteq\R^n$. The fact that $\D F(\mathbf{p})$ has rank $r$ implies that its matrix has some $r\times r$ submatrix with nonzero determinant. By reordering the coordinates, we may assume it is the upper left submatrix, $\left(\frac{\partial F^i}{\partial x^j}\right)$ for $i,j=1,\dots,r$. 

Let us relabel the standard coordinates as $(x, y) = (x^1,\dots,x^r, y^1,\dots,y^{m-r})$ in $\R^n$ and $(v,w) = (v^1,\dots,v^r,w^1,\dots,w^{n-r})$ in $\R^n$. By initial translations of the coordinates, we may assume without loss of generality that $\mathbf{p} = (0, 0)$ and $F(\mathbf{p}) = (0,0)$. If we write $F(x,y) = (Q(x,y), R(x,y))$ for some smooth maps $Q: U\to\R^r$ and $R:U\to\R^{n-r}$, then our hypothesis is that $\left(\frac{\partial Q^i}{\partial x^j}\right)$ is nonsingular at $(0,0)$.

Define $\varphi:U\to\R^m$ by $\varphi(x,y) = (Q(x,y), y)$. Its total derivative at $(0,0)$ is

$$
  \D\varphi(0,0) = \begin{bmatrix}
    \frac{\partial Q^i}{\partial x^j}(0,0) & \frac{\partial Q^i}{\partial y^j}(0,0) \\
    0 & \delta_j^i
  \end{bmatrix}
$$

The matrix $\D\varphi(0,0)$ is nonsingular by virtue of the hypothesis. Thus, by the inverse function theorem, there are connected neighbourhoods $U_0$ of $(0,0)$ and $\tilde{U}_0$ of $\varphi(0,0) = (0,0)$ such that $\varphi:U_0\to\tilde{U}_0$ is a diffeomorphism. By shrinking $U_0$ and $\tilde{U}_0$ if necessary, we may assume $\tilde{U}_0$ is an open cube. Writing the inverse map as $\varphi^{-1}(x,y) = (A(x,y), B(x,y))$ for some smooth functions $A:\tilde{U}_0 \to \R^r$ and $B:\tilde{U}_0 \to\R^{m-r}$, we get

$$
\begin{align*}
  (x,y) =& \varphi(A(x,y), B(x,y)) \\
  =& (Q(A(x,y), B(x,y)), B(x,y))
\end{align*}
$$

Comparing $y$ components shows that $B(x,y) = y$ and therefore $\varphi^{-1}$ has the form

$$
  \varphi^{-1}(x,y) = (A(x,y),y)
$$

On the other hand, $\varphi\circ\varphi^{-1} = \operatorname{id}$ implies that $Q(A(x,y),y)$ = x, and therefore $F\circ\varphi^{-1}$ has the form

$$
  F\circ\varphi^{-1}(x,y) = (x, \tilde{R}(x,y))
$$

where $\tilde{R}:\tilde{U}_0 \to\R^{n-r}$ is defined by $\tilde{R}(x,y) = R(A(x,y), y)$. The Jacobian matrix fo this composite map at an arbitrary point $(x,y)\in\tilde{U}$ is

$$
  \D(F\circ \varphi^{-1})(x,y) = \begin{bmatrix}
    \delta_j^i & 0 \\
    \frac{\partial\tilde{R}^i}{\partial x^j}(x,y) & \frac{\partial\tilde{R}^i}{\partial y^j} (x,y)
  \end{bmatrix}
$$

Since composing with a diffeomorphism does not change the rank of a map, this matrix has rank $r$ everywhere in $\tilde{U}_0$. The first $r$ columns are obviously linearly independent, so the rank can be $r$ on if the derivatives $\frac{\partial\tilde{R}^i}{\partial y^j}$ vanish identically on $\tilde{U}_0$, which implies that $\tilde{R}$ is independent of $(y^1,\dots,y^{m-r})$. Thus, if we let $S(x) = \tilde{R}(x,0)$, then we have

$$
  F\circ\varphi^{-1}(x,y) = (x, S(x))
$$

To complete the proof, we need to define an appropriate smooth chart in some neighbourhood of $(0,0)\in V$. Let $V_0 \subseteq V$ be the open subset defined by $V_0 = \Set{(v,w)\in V | (v,0)\in\tilde{U}_0}$. Then $V_0$ is a neighbourhood of $(0,0)$. Because $\tilde{U}_0$ is a cube and $F\circ\varphi^{-1}$ has the form above, it follows that $F\circ \varphi^{-1}(\tilde{U}_0) \subseteq V_0$, and therefore $F(U_0)\subseteq V_0$. Define $\psi:V_0 \to\R^n$ by $\psi(v,w) = (v, w - S(v))$. This is a diffeomorphism onto its image, because its inverse is given explicitly by $\psi^{-1}(s,t) = (s,t + S(s))$. Thus, $(V_0, \psi)$ is a smooth chart. It follows that 

$$
\begin{align*}
  \psi\circ F\circ\varphi^{-1} (x,y) =& \psi(x, S(x)) \\
  =& (x, S(x) - S(x)) = (x,0)
\end{align*}
$$

which was to be proved.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Let $M$ and $N$ be smooth manifold, let $F:M\to N$ be a smooth map, and suppose $M$ is connected. Then the following are equivalent:
1. For each $\mathbf{p}\in M$ there exist smooth charts containing $\mathbf{p}$ and $F(\mathbf{p})$ in which the coordinate representation of $F$ is linear.
2. $F$ has constant rank

<details>
<summary>Proof</summary>

First, suppose $F$ has a linear coordinate representation in a neighbourhood of each point. Since every linear map has constant rank, it follows that the rank of $F$ is constant in a neighbourhood of each point, and thus by connectedness it is constant on all of $M$. Conversely, if $F$ has constant rank, the rank theorem shows that it has the linear coordinate representation in a neighbourhood of each point.
</details>
</MathBox>

<MathBox title='Global rank theorem' boxType='theorem'>
Let $M$ and $N$ be smooth manifold, and suppose $F:M\to N$ is a smooth map of constant rank.
1. if $F$ is surjective, then it is a smooth submersion
2. if $F$ is injective, then it is a smooth immersion
3. if $F$ is bijective, then it is a diffeomorphism

<details>
<summary>Proof</summary>

Let $\dim(M) = m$ and $\dim(N) = n$, and suppose $\operatorname{rank}(F) = r$ is constant.

**(1):** Assume $F$ is not a smooth submersion, which means that $r < n$. By the rank theorem, for each $\mathbf{p}\in M$ there are smooth charts $(U,\varphi)$ for $M$ centered at $\mathbf{p}$ and $(V,\psi)$ for $N$ centered at $F(\mathbf{p})$ such that $F(U) \subseteq V$ and the coordinate representation of $F$ is given by the rank theorem, Shrinking $U$ if necessary, we may assume it is a regular coordinate ball and $F(\overline(U))\subseteq V$. This implies that $F(\overline{U})$ is a compact subset of the set $\Set{y\in V | y^{r+1} = \cdots = y^n = 0}$, so it is closed in $N$ and contains no open subset of $N$; hence it is nowhere dense in $N$. Since very open cover of a manifold has a countable subcover, we can choose countably many such charts $\Set{(U_i,\varphi_i)}$ covering $M$, with corresponding charts $\Set{(V_i,\psi_i)}$ covering $F(M)$. Because $F(M)$ is equal to the countable union of the nowhere dense sets $F(\overline{U}_i)$, it follows from the Baire category theorem that $F(M)$ has empty interior in $N$, meaning that $F$ cannot be surjective.

**(2):** Asuume that $F$ is not a smooth immersion, so that $r < m$. By the rank theorem, for each $\mathbf{p}\in M$ we can choose charts on neighbourhoods of $\mathbf{p}$ and $F(\mathbf{p})$ in which $F$ has the coordinate representation given by the rank theorem. It follows that $F(0,\dots,0,\varepsilon) = F(0,\dots,0,0)$ for any sufficiently small $\varepsilon$, so $F$ is not injective.

**(3):**  This follows from **(1)** and **(2)**, because a bijective smooth map of constant rank is a smooth submersion by part **(1)** and a smooth immersion by part **(2)**. It follows that $F$ is a local diffeomorphism, and because it is bijective, it is a diffeomorphism.
</details>
</MathBox>

### Rank theorem for manifolds with boundary

<MathBox title='Local immersion theorem for manifolds with boundary' boxType='theorem'>
Suppose $M$ is a smooth $m$-manifold with boundary, $N$ is a smooth $n$-manifold, and $F:M\to N$ is a smooth immersion. For any $\mathbf{p}\in\partial M$, there exist a smooth boundary chart $(U,\varphi)$ for $M$ centered at $p$ and a smooth coordinate chart $(V,\psi)$ for $N$ centered at $F(\mathbf{p})$ with $F(U)\subseteq V$, in which $F$ has the coordinate representation

$$
  \hat{F}(x^1,\dots,x^m) = (x^1,\dots,x^m,0,\dots,0)
$$

<details>
<summary>Proof</summary>

By choosing initial smooth charts for $M$ and $N$, we may assume $M$ and $N$ are open subsets of $H^m$ and $\R^n$, respectively, and also that $\mathbf{p} = 0 \in H^m$ and $F(\mathbf{p}) = 0\in\R^n$. By definition os smoothness for functions on $H^m$, it follows that $F$ extends to a smooth map $\tilde{F}:W\to\R^n$, where $W$ is some open subset of $\R^m$ containing $0$. Because $\d\tilde{F}_0 = \d F_0$ is injective, by shrinking $W$ if necessary, we may assume $\tilde{F}$ is a smooth immersion. Let us write coordintes on $\R^m$ as $x = (x^i)_{i=1}^m$ and those on $\R$ as $(v,w) = (v^1,0\dots,v^m, w^1,\dots,w^{n-m})$.

By the rank theorem, there exist smooth charts $(U_0, \varphi_0)$ for $\R^m$ centered at $0$ and $(V_0,\psi_0)$ for $\R^n$ centered at $0$ such that $\hat{F} = \psi_0 \circ\tilde{F}\circ\varphi_0^{-1}$ is given by the coordinate representation in the hypothesis. The only problem with these coordinates is that $\varphi_0$ might not restrict to a boundary chart for $M$. But we can correct this easily as follow. 

Because $\varphi_0$ is a diffeomorphism from $U_0$ to an open subset $\hat{U}_0 = \psi_0(U_0)\subseteq\R^m$, the map $\varphi_0^{-1} \times\operatorname{id}_{\R^{n-m}}$ is a diffeomorphism from $\tilde{U}_0 \times\R^{n-m}$ to $U_0 \times\R^{n-m}$. Let $\psi = (\varphi_0^{-1} \times \operatorname{id}_{\R^{n-m}}) \circ\varphi_0$, which is a diffeomorphism from some open subset $V\subseteq V_0$ containing $0$ to a neighbourhood of $0$ in $\R^n$. Using the hypothesis coordinate representation, we compute

$$
\begin{align*}
  \psi\circ F(x) =& \left(\varphi_0^{-1} \times\operatorname{id}_{\R^{n-m}} \right) \circ\varphi_0 \circ F \circ\varphi_0^{-1} \circ\varphi_0(x) \\
  =& \left(\varphi_0^{-1} \times\operatorname{id}_{\R^{n-m}} \right) \circ \hat{F}(\varphi_0(x)) \\
  =& \left(\varphi_0^{-1} \times\operatorname{id}_{\R^{n-m}} \right)(\varphi(x),0) = (x,0)
\end{align*}
$$

Thus, the original coordinates for $M$ (restricted to a sufficiently small neighbourhood of $0$) and the chart $(V,\psi)$ for $N$ satisfy the desired conditions.
</details>
</MathBox>

## Embeddings

<MathBox title='Smooth embedding' boxType='definition'>
If $M$ and $N$ are smooth manifolds with or without boundary, a *smooth embedding* of $M$ into $N$ is a smooth immersion $F:M\to N$ that is also a topological embedding, i.e. a homeomorphism onto its image $F(M)\subseteq N$ in the subspace topology. A smooth embedding is a map that is both a topological embedding and a smooth immersion.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary, and let $F:M\to N$ be an injective smooth immersion. If any of the following holds, then $F$ is a smooth embedding.
1. $F$ is an open or closed map
2. $F$ is a proper map
3. $M$ is compact
4. $M$ has empty boundary and $\dim(M) = \dim(N)$

<details>
<summary>Proof</summary>

**(1)**, **(2)** and **(3)** follow from properties of topological embeddings.

**(4):** If $M$ has empty boundary and $\dim(M) = \dim(N)$, then $\d F_\mathbf{p}$ is nonsingular everywhere, and it follows that $F(M) \subseteq \mathrm{int}(N)$. Since $F:M\to\mathrm{int}(N)$ is a local diffeomorphism, it is an open map. It follows that $F:M\to N$ is a composition of open maps $M\to \mathrm{int}(N)\hookrightarrow N$, so it is an embedding.
</details>
</MathBox>

<MathBox title='Local embedding theorem' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary, and $F:M\to N$ is a smooth map. Then $F$ is a smooth immersion if and only if every point in $M$ has a neighbourhood $U\subseteq M$ such that $F|_U:U\to N$ is a smooth embedding.

<details>
<summary>Proof</summary>

One direction is immediate: if every point has a neighbourhood on which $F$ is a smooth embedding, then $F$ has full rank everywhere, making it a smooth immersion.

Conversely, suppose $F$ is a smooth immersion, and let $\mathbf{p}\in M$. We show first that $\mathbf{p}$ has a neighbourhood on which $F$ is injective. If $F(\mathbf{p}) \notin\partial N$, then either the rank theorem (if $\mathbf{p}\notin\partial M$) or the local immersion theorem (if $\mathbf{p}\in\partial M$) implies that there is a neighbourhood $U_1$ on $\mathbf{p}$ on which $F$ has a coordinate representation from the rank theorem. It follows from this formula that $F|_{U_1}$ is injective.

On the other hand, suppose $F(\mathbf{p})\in\partial N$ and let $(W,\psi)$ be any smooth boundary chart for $N$ centered at $F(\mathbf{p})$. If we let $U_0 = F^{-1}(W)$, which is a neighbourhood of $\mathbf{p}$, and let $\iota:\mathbb{H}^n \to\R^n$ be the inclusion map, then the preceeding argument can be applied to the composite map $\iota\circ\psi\circ F|_{U_0}: U_0 \to\R^n$ to show that $\mathbf{p}$ has a neighbourhood $U_1 \subseteq U_0$ such that $\iota\circ\psi\circ F|_{U_1}$ is injective, from which it follows that $F|_{U_1}$ is injective.

Let $\mathbf{p}\in M$ be arbitrary, and let $U_1$ be a neighbourhood of $\mathbf{p}$ on which $F$ is injective. There exists a precompact neighbourhood $U$ of $\mathbf{p}$ such that $\overline{U}\subseteq U_1$. The restriction of $F$ to $\overline{U}$ is an injective continuous map with compact domain, so it is a topological embedding by the closed map lemma. Because any restriction of a topological embedding is again a topological embedding, $F|_U$ is both a topological embedding and a smooth immersion, hence a smooth embedding.
</details>
</MathBox>

## Submersions

<MathBox title='Section' boxType='definition'>
If $\pi:M\to N$ is any continuous map, a *section* of $\pi$ is a continuous right inverse for $\pi$, i.e. a continuous map $\sigma:N\to M$ such that $\pi\circ\sigma = \operatorname{id}_N$.

A *local section* of $\pi$ is a continuous map $\sigma:U\to M$ defined on some open subset $U\subseteq N$ and satisfying the analogous relation $\pi\circ\sigma = \operatorname{id}_U$.
</MathBox>

<MathBox title='Local section theorem' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds, and let $\pi:M\to N$ be a smooth map. Then $\pi$ is a smooth submersion if and only if every point of $M$ is in the image of a smooth local section of $\pi$.

<details>
<summary>Proof</summary>

Let $\dim(M) = m$ and $\dim(N) = n$. 

First, suppose $\pi$ is a smooth submersion. Given $\mathbf{p}\in M$, let $\mathbf{q} = \pi(\mathbf{p})\in N$. By the rank theorem, we can chose smooth coordinates $(x^i)_{i=1}^m$ centered at $\mathbf{p}$ and $(y^j)_{j=1}^n$ centered at $\mathbf{q}$ in which $\pi$ has the coordinate representation

$$
  \pi(x^1,\dots,x^n,x^{n+1},\dots,x^m) = (x^1,\dots,x^n)
$$

If $\varepsilon > 0$ is sufficiently small, the coordinate cube

$$
  C_\varepsilon = \Set{x: \norm{ x^i } < \varepsion, i=1,\dots,m}
$$

is a neighbourhood of $\mathbf{p}$ whose image under $\pi$ is the cube

$$
  C'_\varepsilon = \Set{y: \norm{ y^i } < \varepsilon, i=1,\dots,m}
$$

The map $\sigma: C'_\varepsilon \to C_\varepsilon$ whose coordinate representation is

$$
  \sigma(x^1,\dots,x^n) = (x^1,\dots,x^n,0,\dots,0)
$$

is a smooth local section of $\pi$ satisfying $\sigma(\mathbf{q}) = \mathbf{p}$.

Conversely, assume each point of $M$ is in the image of a smooth local section. Given $\mathbf{p}\in M$, let $\sigma:U\to M$ be a smooth local section such that $\sigma(\mathbf{q}) = \mathbf{p}$, where $\mathbf{q} = \pi(\sigma(\mathbf{q})) = \pi(\mathbf{p})\in N$. The equation $\pi\circ\sigma = \operatorname{id}_U$ implies that $\d\pi_\mathbf{p} \circ \d\sigma_\mathbf{q} = \operatorname{id}_{T_\mathbf{q} N}$, which in turn implies that $\d\pi_\mathbf{p}$ is surjective.
</details>
</MathBox>

<MathBox title='Properties of smooth submersions' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds, and let $\pi:M\to N$ be a smooth submersion. Then $\pi$ is an open map, and if it is surjective it is a quotient map.

<details>
<summary>Proof</summary>

Suppose $W$ is an open subset of $M$ and $\mathbf{q}$ is a point of $\pi(W)$. For any $\mathbf{p}\in W$ such that $\pi(\mathbf{p}) = \mathbf{q}$, there is a neighbourhood $U$ of $\mathbf{q}$ on which there exists a smooth local section $\sigma:U\to M$ of $\pi$ satisfying $\sigma(\mathbf{q}) = \mathbf{p}$. For each $\mathbf{y}\in \sigma^{-1}(W)$, the fact that $\sigma(\mathbf{y})\in W$ implies $\mathbf{y} = \pi(\sigma(\mathbf{y}))\in \pi(W)$. Thus $\sigma^{-1}(W)$ is a neighbourhood of $q$ contained in $\pi(W)$, which implies that $\pi(W)$ is open. The second assertion follows from the first because every surjective open continuous map is a quotient map. 
</details>
</MathBox>

<MathBox title='Characteristic property of surjective smooth submersions' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds, and let $\pi:M\to N$ be a surjective smooth submersion. For any smooth manifold $P$ with or without boundary, a map $F:N\to P$ is smooth if and only if $F\circ\pi$ is smooth

$$
\begin{CD}
  M @>{F\circ\pi}>> P \\
  @V{\pi}VV @| \\
  N @>>{F}> P
\end{CD}
$$

<details>
<summary>Proof</summary>

If $F$ is smooth, then $F\circ\pi$ is smooth by composition. Conversely, suppose $F\circ\pi$ is smooth, and let $\mathbf{q}\in N$ be arbitrary. Since $\pi$ is surjective, there is a point $\mathbf{p}\in\pi^{-1}(\mathbf{q})$, and then the local section theorem guarantees the existence of a neighbourhood $U$ of $\mathbf{q}$ and a smooth local section $\sigma:U\to M$ of $\pi$ such that $\sigma(\mathbf{q}) = \mathbf{p}$. Then $\pi\circ\sigma = \operatorname{id}_U$ implies

$$
\begin{align*}
  F|_U =& F|_U \circ \operatorname{id}_U \\
  =& F|_U \circ (\pi\circ\sigma) \\
  =& (F\circ\pi)\circ\sigma
\end{align*}
$$

which is a composition of smooth maps. This shows that $F$ is smooth in a neighbourhood of each point, so it is smooth.
</details>
</MathBox>

<MathBox title='Passing smoothly to the quotient' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds, and let $\pi:M\to N$ be a surjective smooth submersion. If $P$ is a smooth manifold with or without boundary and $F:M\to P$ is a smooth map that is constant on the fibers of $\pi$, then there exists a unique smooth map $\tilde{F}:N\to P$ such that $\tilde{F}\circ\pi = F$

$$
\begin{CD}
  M @>{F\circ\pi}>> P \\
  @V{\pi}VV @| \\
  N @>>{\tilde{F}}> P
\end{CD}
$$

<details>
<summary>Proof</summary>

Since a surjective smooth submersion is a quotient map, the passing to the quotient theorem, shows that there exists a unique continuous map $\tilde{F}:N\to P$ satisfying $\tilde{F}\circ\pi = F$, which is mooth by the characteristic property of surjective smooth submersions.
</details>
</MathBox>

<MathBox title='Uniqueness of smooth quotients' boxType='theorem'>
Suppose $M$, $N_1$ and $N_2$ are smooth manifolds, and let $\pi_1:M\to N_1$ and $\pi_2:M\to N_2$ be a surjective smooth submersions that are constannt on each other's fibers. Then there exists a unique diffeomorphism $F:N_1\to N_2$ such that $F\circ \pi_1 = \pi_2$

$$
\begin{CD}
  M @= M \\
  @V{\pi_1}VV @VV{\pi_2}V \\
  N_1 @>>{F}> N_2
\end{CD}
$$
</MathBox>

## Smooth covering maps

<MathBox title='Smooth covering map' boxType='definition'>
If $E$ and $M$ are connected smooth manifolds with or without boundary, a map $\pi:E\to M$ is called a *smooth covering map* if $\pi$ is smooth and surjective, and point in $M$ has a neighbourhood $U$ such that each component of $\pi^{-1}(U)$ is mapped diffeomorphically onto $U$ by $\pi$. In this context, we say that $U$ is *evenly covered*. The space $M$ is called the *base of the covering*, and $E$ is called a *covering manifold* of $M$. If $E$ is simply connected, it is called the *universal covering manifold of* $M$.
</MathBox>

<MathBox title='Properties of smooth coverings' boxType='proposition'>
1. Every smooth covering map is a local diffeomorphism, a smooth submersion, an open map, and a quotient map.
2. An injective smooth covering map is a diffeomorphism.
3. A topological covering map is a smooth covering map if and only if it is a local
diffeomorphism.
</MathBox>

<MathBox title='Local section theorem for smooth covering maps' boxType='theorem'>
Suppose $E$ and $M$ are smooth manifolds with or without boundary, and let $\pi:E\to M$ be a smooth covering map. Given any evenly covered open subsets $U\subseteq M$, any $\mathbf{q}\in U$ and any $\mathbf{p}$ in the fibre of $\pi$ over $\mathbf{q}$, there exists a unique smooth local section $\sigma:U\to E$ such that $\sigma(\mathbf{q}) = \mathbf{p}$.

<details>
<summary>Proof</summary>

Let $\tilde{U}_0$ be the component of $\pi^{-1}(U)$ containing $\mathbf{p}$. Since the restriction of $\pi$ to $U_0$ is a diffeomorphism onto $U$, the map $\sigma = \left(\pi|_{\tilde{U}_0}\right)^{-1}$ is the required smooth local section.

To prove uniqueness, suppose $\sigma':U\to E$ is any other smooth local section satisfying $\sigma'(\mathbf{q}) = \mathbf{p}$. Since $U$ is connected, $\sigma'(U)$ is contained in the component $\tilde{U}_0$ containing $\mathbf{p}$. Because $\sigma'$ is a right inverse for the bijective map $\pi|_{\tilde{U}_0}$, it must be equal to its inverse, and therefore equal to $\sigma$.
</details>
</MathBox>

<MathBox title='Covering spaces of smooth manifolds' boxType='proposition'>
Suppose $M$ is a connected smooth $n$-manifold, and let $\pi:E\to M$ be a topological covering map. Then $E$ is a topological $n$-manifold, and has a unique smooth structure such that $\pi$ is a smooth covering map.

<details>
<summary>Proof</summary>

Because $\pi$ is a local homeomorphism, $E$ is locally Euclidean. 

**$E$ is Hausdorff**<br/>
To show that it is Hausdorff, let $\mathbf{p}_1$ and $\mathbf{p}_2$ be distinct points in $E$. If $\varphi(\mathbf{p}_1) = \pi(\mathbf{p}_2)$ and $U\subseteq M$ is an evenly covered subset containing $\pi(\mathbf{p}_1)$, then the components of $\pi^{-1}(U)$ containing $\mathbf{p}_1$ and $\mathbf{p}_2$ are disjoint open subsets of $E$ that separate $\mathbf{p}_1$ and $\mathbf{p}_2$.

On the other hand, if $\pi(\mathbf{p}_1) \neq\pi(\mathbf{p}_2)$, there are disjoint open subsets $U_1, U_2 \subseteq M$ containing $\pi(\mathbf{p}_1)$ and $\pi(\mathbf{p}_2)$, respectively, and then $\pi^{-1}(U_1)$ and $\pi^{-1}(U_2)$ are disjoint open subsets of $E$ containing $\mathbf{p}_1$ and $\mathbf{p}_2$. Thus, $E$ is Hausdorff.

**$E$ is second-countable**<br/>
To show that $E$ is second-countable, we will first show that each fiber of $\pi$ is countable. Given $\mathbf{q}\in M$ and and arbitrary point $\mathbf{p}_0 \in\pi^{-1}(\mathbf{q})$, we will construct a surjective map $\beta: \pi(M,\mathbf{q})\to\pi^{-1}(\mathbf{q})$. This suffices since $\pi_1(M, \mathbf{q})$ is countable by the fundamental group property.

Let $[f]\in\pi_1(M,\mathbf{q})$ be the class of an arbitrary loop $f:[0,1]\to M$ based at $\mathbf{q}$. The path-lifting property of covering maps guarantees that there is a lift $\tilde{f}:[0,1]\to E$ of $f$ starting at $\mathbf{p}_0$, and the monodromy theorem shows that the endpoint $\tilde{f}(1) \in\pi^{-1}(\mathbf{q})$ depends only on the path class of $f$, so it makes sense to define $\beta[f] = \tilde{f}(1)$. To see that $\beta$ is surjective, just note that for any point $\mathbf{p}\in\pi^{-1}(\mathbf{q})$, there is a path $\tilde{f}$ in $E$ from $\mathbf{p}_0$ to $\mathbf{p}$, and then $f = \pi\circ\tilde{f}$ is a loop in $M$ such that $\mathbf{p} = \beta[f]$.

The collection of all evenly covered open subset is an open cover of $M$, and therefore has a countable subcover $\Set{U_i}$. For any given $i$, each component of $\pi^{-1}(U_i)$ contains exactly one point in each fibre oover $U_i$, so $\pi^{-1}(U_i)$ has countably many components. The collection of all components of all sets of the form $\pi^{-1}(U_i)$ is thus a countable open cover of $E$. Since each such component is second-countble, it follows that $E$ is second-countable. This completes the proof that $E$ is a topological manifold.

**Smooth structure on $E$**<br/>
To construct a smooth structure on $E$, suppose $\mathbf{p}$ is any point in $E$, and let $U$ be an evenly covered neighbourhood of $\pi(\mathbf{p})$. After shrinking $U$ if necessary, we may assume also that it is the domain of a smooth coordinate map $\varphi:U\to\R^n$. If $\tilde{U}$ is the component of $\pi^{-1}(U)$ containing $\mathbf{p}$, and $\tilde{\varphi} = \varphi\circ\pi|_{\tilde{U}}: \tilde{U}\to\R^n$, then $(\tilde{U},\tilde{\varphi})$ is a chart on $E$. If two such charts $(\tilde{U},\tilde{\varphi})$ and $(\tilde{V},\tilde{\psi})$ overlap, the transition map can be written

$$
\begin{align*}
  \tilde{\psi}\circ\tilde{\varphi}^{-1} =& \left(\psi\circ\pi|_{\tilde{U}\cap\tilde{V}} \right) \circ \left(\varphi\circ\pi|_{\tilde{U}\cap\tilde{V}} \right)^{-1} \\
  =& \psi\circ(\pi|_{\tilde{U}\cap\tilde{V}})\circ(\pi|_{\tilde{U}\cap\tilde{V}})^{-1}\circ\varphi^{-1} \\
  =& \psi\circ\varphi^{-1}
\end{align*}
$$

which is smooth. Thus, the collection of all such charts defines a smooth structure on $E$, which is unique.

Finally, $\pi$ is a smooth covering map because its coordinate representation in terms of any pair of charts $(\tilde{U},\tilde{\varphi})$ and $(U,\varphi)$ constructed above is the identity.
</details>
</MathBox>

<MathBox title='Covering spaces of smooth manifolds with boundary' boxType='proposition'>
Suppose $M$ is a connected smooth $n$-manifold with boundary, and let $\pi:E\to M$ be a topological covering map. Then $E$ is a topological $n$-manifold with boundary such that $\partial E = \pi^{-1}(\partial M)$, and it has a unique smooth structure such that $\pi$ is a smooth covering map.
</MathBox>

<MathBox title='Existence of a universal covering manifold' boxType='corollary'>
If $M$ is a connected smooth manifold, there exists a simply coneected smooth manifold $\tilde{M}$, called the *universal covering manifold* of $M$, and a smooth covering map $\pi:\tilde{M}\to M$. The universal covering manifold is unique in the following sense: if $\tilde{M}$ is any other simply connected smooth manifold that admits a smooth covering map $\pi': \tilde{M}'\to M$, then there exists a diffeomorphism $\pi:\tilde{M}\to\tilde{M}'$ such that $\pi'\circ\phi = \pi$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $E$ and $M$ are nonempty connected smooth manifolds with or without boundary. If $\pi:E\to M$ is a proper local diffeomorphism, then $\pi$ is a smooth covering map.

<details>
<summary>Proof</summary>

Because $\pi$ is a local diffeomorphism, it is an open map, and because it is proper, it is a closed map. Thus, $\pi(E)$ is both open and closed in $M$. Since it is obviously nonempty, it is all of $M$, so $\pi$ is surjective.

Let $\mathbf{q}\in M$ be arbitrary. Since $\pi$ is a local diffeomorphism, each point of $\pi^{-1}(\mathbf{q})$ has a neighbourhood on which $\pi$ is injective, so $\pi^{-1}(\mathbf{q})$ is a discrete subset of $E$. Since $\pi$ is proper, $\pi^{-1}(\mathbf{q})$ is also compact, so it is finite. Write $\pi^{-1}(\mathbf{q}) = \Set{p_i}_{i=1}^k$. For each $i$, there exists a neighbourhood $V_i$ of $\mathbf{p}_i$ on which $\pi$ is a diffeomorphism onto an open subset $U_i\subseteq M$. Shrinking each $V_i$ if necessary, we may assume also that $V_i \cap V_j = \emptyset$ for $i\neq j$.

Set $U = \bigcap_{i=1}^k U_i$, which is a neighbourhood of $\mathbf{q}$. Then $U$ satisfies $U \subseteq U_i$ for each $i$. Because $K = E\setminus \bigcup_{i=1}^k V_k$ is closed in $E$ and $\pi$ is a closed map, $\pi(K)$ is closed in $M$. Replacing $U$ by $U\setminus \pi(K)$, we can assume $U$ also satisfies $pi^{-1}(U) \subseteq \bigcup_{i=1}^k V_i$.

Finally, after replacing $U$ by the connected component of $U$ containing $\mathbf{q}$, we can assume $U$ is connected and still satisfies the two partial order conditions. It remains to show that $U$ is evenly covered.

Let $\tilde{V}_i = \pi^{-1}(U) \cap V_i$. By the second condition, $\pi^{-1}(U) = \bigcup_{i=1}^k \tilde{V}_i$. Because $\pi:V_i \to U_i$ is a diffeomorphism, the first condition implies that $\pi:\tilde{V}_i \to U$ is still a diffeomorphism, and in particular $\tilde{V}_i$ is connected. Because $\tilde{V}_i$ are disjoint connected open subsets of $\pi^{-1}(U)$, they are exactly the components of $\pi^{-1}(U)$.
</details>
</MathBox>

# Smooth submanifolds

## Embedded submanifold

<MathBox title='Embedded submanifold' boxType='definition'>
Suppose $M$ is a smooth manifold with or without boundary. An *embedded submanifold* of $M$ is a subset $S\subseteq M$ that is a manifold (without boundary) in the subspace topology, endowed with a smooth structure with respect to which the inclusion map $S\hookrightarrow M$ is a smooth embedding. Embedded submanifolds are also known as *regular submanifolds*. An embedded submanifold $S$ is called *properly embedded* if the inclusion $S\hookrightarrow M$ is a proper map.

If $S$ is an embedded submanifold of $M$, the difference $\dim(M) - \dim(S)$ is called the *codimension* of $S$ in $M$, and the containing manifold $M$ is called the *ambient manifold* for $S$. An *embedded hypersurface* is an embedded submanifold of codimension $1$.
</MathBox>

<MathBox title='Open submanifolds have codimension zero' boxType='proposition'>
Suppose $M$ is a smooth manifold. The embedded submanifolds of codimension $0$ in $M$ are exactly the open submanifolds.

<details>
<summary>Proof</summary>

Suppose $S\subseteq M$ is an open submanifold, and let $\iota:S\hookrightarrow M$ be the inclusion map. because $S$ is an open submanifold, it follows that it is a smooth manifold with same dimension as $M$ and there has codimension $0$. 

Any point $\mathbf{p}\in S$ is contained in the domain of some chart $(V,\varphi)$ for $M$. If $\mathbf{p}\in U\subseteq S$, then $(W, \varphi|_W)$ with $W = U \cap V$ is a smooth chart for $S$. In terms of these charts, $\iota$ is represented in coordinates by an identity map, making it a smooth immersion. Since $S$ has the subspace topology, $\iota$ is a smooth embedding. Thus $S$ is an embedded submanifold.

Conversely, suppose $S$ is any codimension-$0$ embedded submanifold of $M$. Then the inclusion $\iota:S\hookrightarrow M$ is a smooth embedding by definition, and therefore it is a local diffeomorphism, which in turn makes it an open map. Thus $S$ is an open subset of $M$.
</details>
</MathBox>

<MathBox title='Images of embeddings as submanifolds' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, $N$ is a smooth manifold, and $F:N\to M$ is a smooth embedding. Let $S = F(N)$. With the subspace topology, $S$ is a topological manifold, and it has a unique smooth structure making it into an embedded submanifold of $M$ with the property that $F$ is a diffeomorphism onto its image.

<details>
<summary>Proof</summary>

If we give $S$ the subspace topology that it inherits from $M$, then the assumption that $F$ is an embedding means that $F$ can be considered as a homeomorphism from $N$ onto $S$, and thus $S$ is a topological manifold. We give $S$ a smooth structure by taking the smooth charts to be those of the form $(F(U), \varphi\circ F^{-1})$, where $(U,\varphi)$ is any smooth chart for $N$; smooth compatibility of these charts follows immediately from the smooth compatibility of the corresponding charts for $N$. With this smooth structure on $S$, the map $F$ is a diffeomorphism onto its image (essentially
by definition), and this is obviously the only smooth structure with this property. The inclusion map $S\hookrightarrow M$ is equal to the composition of a diffeomorphism followed by a smooth embedding

$$
  S \xrightarrow{F^{-1}} N \xrightarrow{F} M
$$

and therefore it is a smooth embedding.
</details>
</MathBox>

<MathBox title='Slices of product manifolds' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds. For each $p\in N$, the subset $M\times\Set{p}$, called a *slice* of the product manifold, is an embedded submanifold of $M\times N$ diffeomorphic to $M$. 

<details>
<summary>Proof</summary>

The set $M\times\Set{p}$ is the image of the smooth embedding $x\mapsto (x,p)$.
</details>
</MathBox>

<MathBox title='Graphs as submanifolds' boxType='proposition'>
Suppose $M$ is a smooth $m$-manifold (without boundary), $N$ is a smooth $n$-manifold with or without boundary, $U\subseteq M$ is open, and $f: U\to N$ is a smooth map. Let $\Gamma(f) \subseteq M\times N$ denote the graph of $f$

$$
  \Gamma(f) = \Set{(\mathbf{x},\mathbf{y})\in M\times N | \mathbf{x}\in U, \mathbf{y}\in f(\mathbf{x})}
$$

Then $\Gamma(f)$ is an embedded $m$-dimensional submanifold of $M\times N$.

<details>
<summary>Proof</summary>

Define a map $\gamma_f:U\to M\times N$ by $\gamma_f(\mathbf{x}) = (\mathbf{x},f(\mathbf{x}))$. It is a smooth map whose image is $\Gamma(f)$. Because the projection $\pi_M: M\times N\to M$ satisfies $\pi_M \circ \gamma_f (\mathbf{x}) = \mathbf{x}$, the composition $\d(\pi_M)_{(\mathbf{x},f(\mathbf{x}))} \circ \d(\gamma_f)_\mathbf{x}$ is the identity on $T_\mathbf{x} M$ for each $\mathbf{x}\in U$. Thus $\d(\gamma_f)_\mathbf{x}$ is injective, so $\gamma_f$ is a smooth immersion. It is a homeomorphism onto its image because $\pi_M|_{\Gamma(f)}$ is a continuous inverse for it. Hence, $\Gamma(f)$ is an embedded submanifold diffeomorphic to $U$.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary and $S\subseteq M$ is an embedded submanifold. Then $S$ is properly embedded if and only if it is a closed subset of $M$.

<details>
<summary>Proof</summary>

If $S$ is properly embedded, then it is closed by properties of proper maps. Conversely, if $S$ is closed in $M$, then the conditions for properness show that the inclusion map $S\hookrightarrow M$ is proper.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Every compact embedded submanifold is properly embedded.

<details>
<summary>Proof</summary>

Compact subsets of Hausdorff spaces are closed.
</details>
</MathBox>

<MathBox title='Global graphs are properly embedded' boxType='proposition'>
Suppose $M$ is a smooth manifold, $N$ is a smooth manifold with or without boundary, and $f:M\to N$ is a smooth map. Let $\Gamma(f) \subseteq M\times N$ denote the graph of $f$

$$
  \Gamma(f) = \Set{(\mathbf{x},\mathbf{y})\in M\times N | \mathbf{x}\in U, \mathbf{y}\in f(\mathbf{x})}
$$

With the smooth immersion $\gamma_f:U\subseteq M\to M\times N$ given by $\gamma_f(\mathbf{x}) = (\mathbf{x},f\mathbf{x})$, the graph $\Gamma(f) \subseteq M\times N$ is properly embedded in $M\times N$.

<details>
<summary>Proof</summary>

In this case, the projection $\pi_M :M\times N$ is a smooth left inverse for the embedding $\gamma_f :M\to M\times N$. Thus, $\gamma_f$ satisfies the conditions for properness. 
</details>
</MathBox>

### Slice charts for embedded submanifolds

<MathBox title='Slice' boxType='definition'>
If $U\subseteq\R^n$ is open and $k\in\Set{0,\dots,n}$, a $k$-dimensional *slice* of $U$, or simply a $k$-slice, is any subset of the form

$$
  S = \Set{(x^1,\dots,x^k,x^{k+1},\dots,x^n)\in U | x^{k+1} = c^{k+1}\dots,x^n = c^n}
$$

for some constants $c^{k+1},\dots,c^n$.

Let $M$ be a smooth $n$-manifold, and let $(V,\varphi)$ be a smooth chart on $M$. If $S$ is a subset of $V$ such that $\varphi(S)$ is a $k$-slice of $\varphi(V)$, then $S$ is a $k$-slice of $V$.

A subset $S\subseteq M$ is said to satisfy the local $k$-slice conditions if each point of $S$ is contained in the domain of a smooth chart $(V,\varphi)$ for $M$ such that $S\cap V$ is a single $k$-slice in $U$. Any such chart is called a *slice chart* for $S$ in $M$, and the corresponding coordinates are called *slice coordinates*.
</MathBox>

<MathBox title='Local slice criterion for embedded submanifolds' boxType='theorem'>
Let $M$ be a smooth $n$-manifold. If $S\subseteq M$ is an embedded $k$-dimensional submanifold, then $S$ satisfies the local $k$-slice condtion. Conversely, if $S\subseteq M$ is a subset that satisfies the local $k$-slice condition, then with the subspace topology, $S$ is topological $k$-manifold, and it has a smooth structure making it into a $k$-dimensional embedded submanifold of $M$.

<details>
<summary>Proof</summary>

First, suppose $S\subseteq M$ is an embedded $k$-dimensional submanifold. Since the inclusion map $S\hookrightarrow M$ is an immersion, the rank theorem shows that for any $\mathbf{p}\in S$ there are smooth charts $(U,\varphi)$ for $S$ and $(V,\psi)$ for $M$, both centered at $\mathbf{p}$, in which the inclusion map $\iota|_U :U\to V$ has the coordinate representation

$$
  (x^1,\dots,x^k)\mapsto (x^1,\dots,x^k,0,\dots,0)
$$

Choose $\varepsilon > 0$ small enough that both $U$ and $V$ contain coordinate balls of redius $\varepsilon$ centered at $\mathbf{p}$, and denote these coordinate balls by $U_0 \subseteq U$ and $V_0 \subseteq V$. It follows that $U_0 = \iota|_U(U_0)$ is exactly a single slice in $V_0$. Because $S$ has the subspace topology, the fact that $U_0$ is open in $S$ means that there is an open subset $W\subseteq M$ such that $U_0 = W \cap S$. Setting $V_1 = V_0 \cap W$, we obtain a smooth chart $(V_1, \psi|_{V_1})$ for $M$ containing $\mathbf{p}$ such that $V_1 \cap S = U_0$, which is a single slice of $V_1$.

Conversely, suppose $S$ satisfies the local $k$-slice condition. With the subspace topology, $S$ is Hausdorff and second-countable, because both properties are inherited by subspaces. To see that $S$ is locally Euclidean, we construct an atlas. The basic idea of the construction is that if $(x^1,\dots,x^n)$ are slice coordinates for $S$ in $M$, we can use $(x^1,\dots,x^k)$ as local coordinates for $S$.

Let $\pi:\R^n \to\R^k$ denote the projection onto the first $k$ coordinates. Let $(U,\varphi)$ be any slice chart for $S$ in $M$ and define

$$
\begin{align*}
  V =& U \cap S \\
  \hat{V} =& \pi\circ\varphi(V) \\
  \psi =& \pi\circ\varphi|_V: V\to\hat{V}
\end{align*}
$$

By definition of slice charts, $\varphi(V)$ is the intersection of $\varphi(U)$ with a certain $k$-slice $A\subseteq\R^n$ defined by setting $x^{k+1} = c^{k+1},\dots,x^n = c^n$, and therefore $\varphi(V)$ is open in $A$. Since $\pi|_A$ is a diffeomorphism from $A$ to $\R^n$, it follows that $\hat{V}$ is open in $\R^k$. Moreover, $\psi$ is a homeomorphism because it has a continuous inverse given by $\varphi^{-1}\circ j|_{\hat{V}}$ where $j:\R^k \to\R^n$ is the map

$$
  j(x^1,\dots,x^k) = (x^k,\dots,x^k,c^{k+1},\dots,c^n)
$$

Thus, $S$ is a topological $k$-manifold, and the inclusion map $\iota:S\hookrightarrow M$ is a topological embedding.

To put a smooth structure on $S$, we need to verify that the charts constructed above are smoothly compatible. Suppose $(U,\varphi)$ and $(U',\varphi')$ are two slice charts for $S$ in $M$, and let $(V,\psi)$ and $(V',\psi')$ be the corresponding charts for $S$. The transition map is given by $\psi'\circ\psi = \pi\circ\varphi'\circ\varphi^{-1} \circ j$, which is a composition of four smooth maps. Thus, the atlas we have constructed is in fact a smooth atlas, and it defines a smooth structure on $S$. In terms of a slice chart $(U,\varphi)$ for $M$ and the corresponding chart $(V,\varphi)$ for $S$, the inclusion map $S\hookrightarrow M$ has a coordinate representation of the form

$$
  (x^1,\dots,x^k)\mapsto(x^1,\dots,x^k,c^{k+1},\dots,c^n)
$$

which is a smooth immersion. Since the inclusion is a smooth immersion and a topological embedding, $S$ is an embedded submanifold.
</details>
</MathBox>

<MathBox title='Local slice criterion for embedded submanifolds' boxType='theorem'>
If $M$ is a smooth $n$-manifold with boundary, then with the subspace topology, $\partial M$ is a topological $(n-1)$-dimensional manifold (without boundary), and has a smooth structure such that is a properly embedded submanifold of $M$.
</MathBox>

### Level sets

<MathBox title='Local slice criterion for embedded submanifolds' boxType='theorem'>
If $\Phi: M\to N$ is any map and $\mathbf{c}$ is any point of $N$, the preimage $\Phi^{-1}(\mathbf{c})$ is a *level set* of $\phi$. 
</MathBox>

<MathBox title='Constant-rank level set theorem' boxType='theorem'>
Let $M$ and $N$ be smooth manifolds, and let $\Phi: M\to N$ be a smooth map with constant rank $r$. Each level set of $\Phi$ is a properly embedded submanifold of codimension $r$ in $M$.

<details>
<summary>Proof</summary>

Let $m = \dim(M)$, $n = \dim(N)$ and $k = m - r$. Let $\mathbf{c}\in N$ be arbitrary, and let $S$ denote the level set $\varphi^{-1}(\mathbf{c})\subseteq M$. From the rank theorem, for each $\mathbf{p}\in S$ there are smooth charts $(U,\varphi)$ centered at $\mathbf{p}$ and $(V,\psi)$ centered at $\mathbf{c} = \Phi(\mathbf{p})$ in which $\Phi$ has a coordinate representation of

$$
  \Phi(x^1,\dots,x^r,x^{r+1},\dots,x^m) = (x^1,\dots,x^r,0,\dots,0)
$$
 
and therefore $S\cap U$ is the slice

$$
  \Set{(x^1,\dots,x^r,x^{r+1},\dots,x^m)\in U | x^1 =\cdots = x^r = 0}
$$

Thus, $S$ satisfies the local $k$-slice condition, so it is an embedded submanifold of dimension $k$. It is closed in $M$ by continuity, so it is properly embedded.
</details>
</MathBox>

<MathBox title='Submersion level set theorem' boxType='corollary'>
If $M$ and $N$ are smooth manifolds and $\Phi: M\to N$ is a smooth submersion, then each level set of $\Phi$ is a properly embedded submanifold whose codimension is equal to the dimension of $N$.

<details>
<summary>Proof</summary>

Every smooth submersion has constant rank equal to the dimension of its codomain.
</details>
</MathBox>

<MathBox title='Regular and critical values' boxType='definition'>
If $M$ and $N$ are smooth manifolds and $\Phi: M\to N$ is a smooth map, a point $\mathbf{p}\in M$ is said to be a *regular point* of $\Phi$ if $\d\Phi_\mathbf{p}: T_\mathbf{p} M \to T_{\Phi(\mathbf{p})}N$ is surjective; it is a *critical point* of $\Phi$ otherwise. In particular, every point of $M$ is critical if $\dim(M) < \dim(N)$, and every point is regular if and only if $F$ is a submersion.

A point $\mathbf{c}\in N$ is a *regular value* of $\Phi$ is every point of the level set $\Phi^{-1}(\mathbf{c})$ is a regular point, and a *critical value* otherwise. In particular, if $\Phi^{-1}(\mathbf{c}) = \emptyset$ then $\mathbf{c}$ is a regular value.

A level set $\Phi^{-1}(\mathbf{c})$ is called a *regular value set* if $\mathbf{c}$ is a regular value of $\Phi$. In other words, a regular level set is a level set consisting entirely of regular points of $\Phi$.
</MathBox>

<MathBox title='Critical point and regular value' boxType='definition'>
Suppose $f:M\to N$ is a smooth map. A point $\mathbf{p}\in M$ is called a critical point of $f$ if the differential of $f$ at $p$, denoted $\d f_p$, is not surjective. Equivalently, the Jacobian of the map $\psi\circ f\phi^{-1}: \R^n \to\R^M$ has not maximal rank, i.e.

$$
  \operatorname{rank}f_p := \operatorname{rank}\left( J_{\psi\circ f\phi^{-1}} [h(p)] \right) < n
$$

A point $q\in N$ is called a regular value $f$ if $f^{-1}[\Set{q}]\in M$ does not contain critical points.
</MathBox>

<MathBox title='Regular value theorem' boxType='theorem'>
Let $M, N$ be smooth manifolds of dimension $m$ and $n$ with $m\geq n$. Suppose $f:M\to N$ is a smooth map, and $q\in N$ be a regular value of $f$. Then $f^{-1}[\Set{q}]$ is a $(m-n)$-dimensional submanifold of $M$.
</MathBox>

<MathBox title='Regular level set theorem' boxType='corollary'>
Every regular level set of a smooth map between smooth manifolds is a properly embedded submanifold whose codimension is equal to the dimension of the codomain.

<details>
<summary>Proof</summary>

Let $\Phi:M\to N$ be a smooth map and let $\mathbf{c}\in N$ be a regular value. The set $U$ of points $\mathbf{p}\in M$ where $\operatorname{rank}(\d\Phi_\mathbf{p}) = \dim(N)$ is open in $M$ and contains $\Phi^{-1}(\mathbf{c})$ because of the assumption that $\mathbf{c}$ is a regular value. It follows that $\Phi|_U:U\to N$ is a smooth submersion, and the submersion level set theorem shows that $\Phi^{-1}(\mathbf{c})$ is an embedded submanifold of $U$. Since the composition of smooth embeddings $\Phi^{-1}(\mathbf{c}) \hookrightarrow U \hookrightarrow M$ is again a smooth embedding, it follows that $\Phi^{-1}(\mathbf{c})$ is en embedded submanifold of $M$, and it is closed by continuity. 
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $S$ be a subset of a smooth $m$-manifold $M$. Then $S$ is an embedded $k$-submanifold if and only if every point of $S$ has a neighbourhood $U\subseteq M$ such that $U\cap S$ is a level set of a smooth submersion $\Phi:U\to\R^{m-k}$.

<details>
<summary>Proof</summary>

First, suppose $S$ is an embedded $k$-submanifold. If $(x^1,\dots,x^m)$ are slice coordinates for $S$ on an open subset $U\subseteq M$, the map $\Phi:U\to\R^{m-k}$ given in coordinates by $\Phi(\mathbf{x}) = (x^{k+1},\dots,x^m)$ is easily seen to be a smooth submersion, one of whose level sets is $S\cap U$.

Conversely, suppose around every point $\mathbf{p}\in S$ there is a neighbourhood $U$ and a smooth submersion $\Phi:U\to\R^{m-k}$ such that $S\cap U$ is a level set of $\Phi$. By the submersion level set theorem, $S\cap U$ is an embedded submanifold of $U$, so it satisfies the local slice condition. It follows that $S$ is itself an embedded submanifold of $M$. 
</details>
</MathBox>

<MathBox title='Defining map' boxType='definition'>
If $S\subseteq M$ is an embedded submanifold, a smooth map $\Phi: M\to N$ such that $S$ is a regular level set of $\Phi$, is called a *defining map* for $S$. More generally, if $U$ is an open subset of $M$ and $\Phi:U\to N$ is a smooth map such that $S\cap U$ is a regular level set of $\Phi$, then $\Phi$ is called a *local defining map* for $S$.
</MathBox>

## Immersed submanifolds

<MathBox title='Immersed submanifold' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. An *immersed submanifold* of $M$ is a subset $S\subseteq M$ endowed with a topology with respect to which it is a topological manifold (without boundary), and a smooth structure with respect to which the inclusion map $S\hookrightarrow M$ is a smooth immersion. If $S$ is an immersed submanifold then $\dim(M) - \dim(S)$ is the *codimension* of $S$ in $M$. Every embedded submanifold is also an immersed submanifold.
</MathBox>

<MathBox title='Images of immersions as submanifolds' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, $N$ is a smooth manifold, and $F:N\to M$ is an injective smooth immersion. Let $S = F(N)$. Then $S$ has a unique topology and smooth structure such that it is a smooth submanifold of $M$ and such that $F:N\to S$ is a diffeomorphism onto its image.

<details>
<summary>Proof</summary>

We give $S$ a topology by declaring a set $U\subseteq S$ to be open if and only if $F^{-1}(U) \subseteq N$ is open, and then give it a smooth structure by taking the smooth charts to be those of the form $(F(U),\varphi\circ F^{-1})$ where $(U,\varphi)$ is any smooth chart for $N$. The smooth compatibility condition follows from that for $N$. With this topology and smooth structure on $S$, the map $F$ is a diffeomorphism onto its image, and these are the only topology and smooth structure on $S$ with this property. The inclusion  $S\hookrightarrow M$ can be written as the composition

$$
  S \xrightarrow{F^{-1}} N \xrightarrow{F} M
$$

In this case, the first map is a diffeomorphism and the second is a smooth immerision, so the composition is a smooth immersion.
</details>
</MathBox>

<MathBox title='Criteria for embedded submanifolds' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, and $S\subseteq M$ is an immersed submanifold. If any of the following holds, then $S$ is embedded.
1. $S$ has codomain $0$ in $M$
2. The inclusion map $S\subseteq M$ is proper
3. $S$ is compact
</MathBox>

<MathBox title='Immersed submanifolds are locally embedded' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, and $S\subseteq M$ is an immersed submanifold. Then for each $\mathbf{p}\in S$ there exists a neighbourhood $U$ of $\mathbf{p}$ in $S$ that is an embedded submanifold of $M$.

<details>
<summary>Proof</summary>

The local embedding theorem shows that each $\mathbf{p}\in S$ has a neighbourhood $U$ in $S$ such that the inclusion $\iota_U:U\hookrightarrow M$ is an embedding.
</details>
</MathBox>

<MathBox title='Parametrization' boxType='definition'>
Suppose $S\subseteq M$ is an immersed $k$-dimensional submanifold. A *local parametrization* of $S$ is a continuous map $X:U\to M$ whose domain is an open subset $U\subseteq \R^k$, whose image is an open subset of $S$, and which, considered as a map into $S$, is a homeomorphism onto its image. It is alled a *smooth local parametrization* if it is a diffeomorphism onto its image. If the image of $\mathbf{X}$ is all of $S$, it is called a *global parametrization*.
</MathBox>

<MathBox title='Parametrization' boxType='definition'>
Suppose $M$ is a smooth manifold with or without boundary, $S\subseteq M$ is an immersed $k$-submanifold, $\iota:S\hookrightarrow M$ is the inclusion map, and $U$ is an open subset of $\R^k$. A map $X:U\to M$ is a smooth local parametrization of $S$ if and only if there is a smooth coordinate chart $(V,\varphi)$ for $S$ such that $X = \iota\circ\varphi^{-1}$. Therefore, every point of $S$ is in the image of some local parametrization.
</MathBox>

## Restricting maps to submanifolds

<MathBox title='Restricting the domain of a smooth map' boxType='theorem'>
If $M$ and $N$ are smooth manifolds with or without boundary, $F:M\to N$ is a smooth map, and $S\subseteq M$ is an immersed or embedded submanifold, then $F|_S :S\to N$ is smooth.

<details>
<summary>Proof</summary>

The inclusion map $\iota:S\hookrightarrow M$ is smooth by definition of an immersed submanifold. Since $F|_S = F\circ\iota$, the result follows.
</details>
</MathBox>

<MathBox title='Restricting the codomain of a smooth map' boxType='theorem'>
Suppose $M$ is a smooth manifold (without boundary), $S\subseteq M$ is an immersed submanifold, and $F:N\to M$ is a smooth map whose image is contained in $S$. If $F$ is continuous as a map from $N$ to $S$, then $F:N\to S$ is smooth.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in N$ be arbitrary and let $\mathbf{q} = F(\mathbf{p})\in S$. Since immersed submanifolds are locally embedded, there is a neighbourhood $V$ of $\mathbf{q}$ in $S$ such that $\iota|_V: V\hookrightarrow M$ is a smooth embedding. Thus, there exists a smooth chart $(W,\psi)$ for $M$ that is a slice chart for $V$ in $M$ centered at $\mathbf{q}$. The fact that $(W,\psi)$ is a slice chart means that $(V_0, \tilde{\psi})$ is a smooth chart for $V$, where $V_0 = W \cap V$ and $\tilde{\psi} = \pi \circ\psi$ with $\pi:\R^n \to\R^k$ being the projection onto the first $k = \dim(S)$ coordinates. Since $V_0 = (\iota|_V)^{-1}(W)$ is open in $V$, it is open in $S$ in its given topology, and so $(V_0, \tilde{\psi})$ is also a smooth chart for $S$.

Let $U = F^{-1}(V_0)$, which is an open subset of $N$ containing $\mathbf{p}$. Choose a smooth chart $(U_0,\varphi)$ for $N$ such that $\mathbf{p}\in U_0 \subseteq U$. Then the coordinate representation of $F:N\to S$ with respect to the charts $(U_0, \varphi)$ and $(V_0,\tilde{\psi})$ is

$$
  \tilde{\psi}\circ F\circ\varphi^{-1} = \pi \circ(\psi\circ F\circ\varphi^{-1})
$$

which is smooth because $F:N\to M$ is smooth.
</details>
</MathBox>

<MathBox title='Embedded case' boxType='corollary'>
Suppose $M$ is a smooth manifold, and that $S\subseteq M$ is an embedded submanifold. Then every smooth map $F:N\to M$ whose image is contained in $S$ is also smooth as a map from $N$ to $S$.

<details>
<summary>Proof</summary>

Since $S\subseteq M$ has the subspace topology, a continuous map $F:N\to M$ whose image is contained in $S$ is automatically continuous into $S$, by the characteristic property of the subspace topology.
</details>
</MathBox>

<MathBox title='Weakly embedded submanifold' boxType='definition'>
If $M$ is a smooth manifold, an immersed submanifold $S\subseteq M$ is *weakly embedded in* $M$ if every smooth map $F:N\to M$ whose image lies in $S$ is smooth as a map from $N$ to $S$.
</MathBox>

### Uniqueness of smooth structures on submanifolds

<MathBox title='' boxType='theorem'>
Suppose $M$ is a smooth manifold. If $S\subseteq M$ is an embedded submanifold, it has a unique subspace topology and smooth structure (as described in the local slice condition theorem). 

<details>
<summary>Proof</summary>

Suppose $S\subseteq M$ is an embedded $k$-submanifold. It then satisfies the local $k$-slice condition, so it is an embedded submanifold with the subspace topology. Suppose were some other topology and smooth structure on $S$, making it into an immersed submanifold of some dimension. Let $\tilde{S}$ denote the same set $S$, considered as a smooth manifold with non-standard topology and smooth structure, and let $\tilde{\iota}:\tilde{S}\hookrightarrow M$ denote the inclusion map, which by assumption is an injective immesion (but not necessarily an embedding). Because $\tilde{\iota}(\tilde{S}) = S$, the embedded codomain restriction of smooth maps implies that $\tilde{\iota}$ is also smooth when considered as a map from $\tilde{S}$ to $S$. For each $\mathbf{p}\in\tilde{S}$, the differential $\d\tilde{\iota}_\mathbf{p}: T_\mathbf{p}\tilde{S} \to T_\mathbf{p}M$ is equal to the composition

$$
  T_\mathbf{p}\tilde{S} \xrightarrow{\d\tilde{\iota}_\mathbf{p}} T_\mathbf{p}S \xrightarrow{\d\iota_\mathbf{p}} T_\mathbf{p}M
$$

where $\iota: S\hookrightarrow M$ is also an inclusion. Because this composition is injective, $\d\tilde{\iota}_\mathbf{p}$ must be injective. In particular, this means that $\tilde{\iota}:\tilde{S}\to S$ is an immersion. Because it is bijective, it follows from the global rank theorem that it is a diffeomorphism. In other words, the topology and smooth manifold structure of $\tilde{S}$ are the same as those of $S$.
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Suppose $M$ is a smooth manifold, and that $S\subseteq M$ is an embedded submanifold. For the given topology on $S$, there is only one smooth structure making $S$ into an immersed submanifold.
</MathBox>

<MathBox title='' boxType='theorem'>
If $M$ is a smooth manifold and $S\subseteq M$ is a weakly embedded submanifold, then $S$ has only one topology and smooth structure with respect to which it is an immersed submanifold.
</MathBox>

### Extending functions from submanifolds

<MathBox title='Extension lemma for functions of submanifolds' boxType='lemma'>
Suppose $M$ is a smooth manifold, $S\subseteq M$ is a smooth manifold, and that $f\in C^\infty (S)$.
1. If $S$ is embedded, then there exists a neighbourhood $U$ of $S$ in $M$ and a smooth function $\tilde{f}\in C^\infty(U)$ such that $\tilde{f}|_S = f$.
2. If $S$ is properly embedded, then the neighbourhood $U$ in part **(1)** can be taken to be all of $M$.
</MathBox>

### The tangent space to a submanifold

Let $M$ be a smooth manifold with or without boundary, and let $S\subseteq M$ be an immersion or embedded submanifold. Since the inclusion map $\iota:S\hookrightarrow M$ is a smooth immersion, at each point $\mathbf{p}\in S$ we have an injective linear map $\d\iota_\mathbf{p}:T_\mathbf{p}S \to T_\mathbf{p}M$. In terms of derivations, this injection works in the following way: for any vector $\mathbf{v}\in T_\mathbf{p} S$, the image vector $\tilde{\mathbf{v}} = \d\iota_\mathbf{p}(\mathbf{v}) \in T_\mathbf{p}M$ acts on smooth functions on $M$ by

$$
\begin{align*}
  \tilde{\mathbf{v}} f = \d\iota_\mathbf{p}(\mathbf{v})f = \mathbf{v}(f\circ\iota) = \mathbf{v}(f|_S)
\end{align*}
$$

Identifying $T_\mathbf{p}M$ with its image under this map, the tangent space $T_\mathbf{p}M$ can be thought of as a certain linear subspace of $T_\mathbf{p}M$. This identification makes sense regardless of whether $S$ is embedded or immersed.

<MathBox title='' boxType='propositon'>
Suppose $M$ is a smooth manifold with or without boundary, $S\subseteq M$ is an immersed or embedded submanifold, and $\mathbf{p}\in S$. A vector $\mathbf{v}\in T_\mathbf{p}M$ is in $T_\mathbf{p}S$ if and only if there is a smooth curve $\gamma:I\subseteq\R \to M$ whose image is contained in $S$, and which is also smooth as a map into $S$, such that $0 \in I$, $\gamma(0) = \mathbf{p}$, and $\gamma'(0) = \mathbf{v}$.
</MathBox>

<MathBox title='' boxType='propositon'>
Suppose $M$ is a smooth manifold, $S\subseteq M$ is an embedded submanifold, and $\mathbf{p}\in S$. As a subspace of $T_\mathbf{p}M$, the tangent space $T_\mathbf{p}S$ is characterized by

$$
  T_\mathbf{p}S = \Set{\mathbf{v}\in T_\mathbf{p}M | \mathbf{v}f = 0, f\in C^\infty (M) \land f|_S = 0}
$$

<details>
<summary>Proof</summary>

First, suppose $\mathbf{v}\in T_\mathbf{p}M \subseteq T_\mathbf{p} M$. This means, that $\mathbf{v} = \d\iota_\mathbf{p}(\mathbf{w})$ for some $\mathbf{w}\in T_\mathbf{p} S$, where $\iota:S\to M$ is an inclusion. If $f$ is an y smooth real-valued function on $M$ that vanishes on $S$, then $f\circ\iota \equiv 0$ so

$$
  \mathbf{v}f = \d\iota_\mathbf{p}(\mathbf{w})f = \mathbf{w}(f\circ\iota) = 0
$$

Conversely, if $\mathbf{v}\in T_\mathbf{p}M$ satisfies $\mathbf{v}f = 0$ whenever $f$ vanishes on $S$, we need to show that there is a vector $\mathbf{w}\in T_\mathbf{p}S$ such that $\mathbf{v} = \d\iota_\mathbf{p}(\mathbf{w})$. Let $(x^1,\dots,x^n)$ be slice coordinates for $S$ in some neighbourhood $U$ of $\mathbf{p}$, so that $U\cap S$ is the subset of $U$ where $x^{k+1} = \cdots = x^n = 0$ and $(x^1,\dots,x^k)$ are coordinates for $U\cap S$. Because the inclusion map $\iota:S\cap U\hookrightarrow M$ has the coordinate representation

$$
  \iota(x^1,\dots,x^k) = (x^1,\dots,x^k,0,\dots,0)
$$

in these coordinates, it follows that $T_\mathbf{p}S$, i.e. $\d\iota_\mathbf{p}(T_\mathbf{p} S)$, is exactly the subspace of $T_\mathbf{p}M$ spanned by $\boldsymbol{\partial}_i|_\mathbf{p}$. If we write the coordinate representation of $\mathbf{v}$ as

$$
  \mathbf{v} = \sum_{i=1}^n v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}
$$

we see that $\mathbf{v}\in T_\mathbf{p} S$ if and only if $v^i = 0$ for $i > k$.

Let $\varphi$ be a smooth bump function supported in $U$ that is equal to $1$ in a neighbourhood of $\mathbf{p}$. Choose an index $j > k$, and consider the function $f(x) = \varphi(\mathbf{x})x^j$, extended to be zero on $M\setminus\operatorname{supp}(\varphi)$. Then $f$ vanishes identically on $S$, so

$$
  0 = \mathbf{v}f = \sum_{i=1}^n v^i \frac{\partial (\varphi(\mathbf{x}x^j))}{\partial x^i}(\mathbf{p}) = v^i \delta_i^j = v^j
$$

Thus, $\mathbf{v}\in T_\mathbf{p} S$ as desired.
</details>
</MathBox>

<MathBox title='' boxType='propositon'>
Suppose $M$ is a smooth manifold and that $S\subseteq M$ is an embedded submanifold. If $\Phi:U\to N$ is any local defining map for $S$, then $T_\mathbf{p}S = \ker(\d\Phi_\mathbf{p}): T_\mathbf{p}M \to T_{\Phi(\mathbf{p})}N$ for each $\mathbf{p}\in S\cap U$.

<details>
<summary>Proof</summary>

Recall that we identify $T_\mathbf{p}S$ with the subspace $\d\iota_\mathbf{p}(T_\mathbf{p}S) \subseteq T_\mathbf{p}M$, where $\iota:S\hookrightarrow M$ is the inclusion map. Because $\Phi\circ\iota$ is constant on $S\cap U$, it follows that $\d\Phi_\mathbf{p}\circ\d\iota_\mathbf{p}$ is the zero map from $T_\mathbf{p}S$ to $T_{\Phi(\mathbf{p})}N$, and therefore $\operatorname{ran}(\mathbf{d}\iota_\mathbf{p}) \subseteq \ker(\d\Phi_\mathbf{p})$. On the other hand, $\d\Phi_\mathbf{p}$ is surjective by the definition of a defining map, so the rank-nullity theorem implies that

$$
\begin{align*}
  \dim(\ker(\d\Phi_\mathbf{p})) =& \dim(T_\mathbf{p}M) - \dim(T_{\Phi(\mathbf{p})}N) \\
  =& \dim(T_\mathbf{p}S) = \dim(\operatorname{ran}(\d\iota_\mathbf{p}))
\end{align*}
$$

which implies that $\operatorname{ran}(\d\iota_\mathbf{p}) = \ker(\d\Phi_\mathbf{p})$.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Suppose $S\subseteq M$ is a level set of a smooth submersion $\Phi = (\Phi^1,\dots,\Phi^k):M \to\R^k$. A vector $\mathbf{v}\in T_\mathbf{p}M$ is tangent to $S$ if and only if $\mathbf{v}\Phi^1 =\cdots=\mathbf{v}\Phi^k = 0$.
</MathBox>

<MathBox title='Inward- and outward-pointing vector' boxType='definition'>
If $M$ a smooth manifold with boundary and $\mathbf{p}\in\partial M$, a vector $\mathbf{v}\in T_\mathbf{p}M\setminus T_\mathbf{p}\partial M$ is *inward-pointing* if for some $\varepsilon > 0$ there exists a smooth curve $\gamma:[0,\varepsilon) \to M$ such that $\gamma(0) = \mathbf{p}$ and $\gamma'(0) = \mathbf{v}$. The vector is *outward-pointing* if there exists such a curve whose domain is $(-\varepsilon, 0]$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth $n$-manifold with boundary, $\mathbf{p}\in \partial M$, and $(x^i)_{i=1}^n$ are smooth boundary coordinates defined on a neighbourhood of $\mathbf{p}$. The inward-pointing vectors in $T_\mathbf{p}M$ are precisely those with positive $x^n$-component, the outward-pointing ones are those with negative $x^n$-component, and the ones tangent to $\partial M$ are those with zero $x^n$-component. Thus, $T_\mathbf{p} M$ is the disjoint union of $T_\mathbf{p}\partial M$, set of inward-pointing vectors, and the set of outward-pointing vectors. A vector $\mathbf{v}\in T_\mathbf{p}$ is inward-pointing if and only if $-\mathbf{v}$ is outward-pointing.
</MathBox>

<MathBox title='Boundary defining function' boxType='definition'>
If $M$ is a smooth manifold with boundary, a *boundary defining function* for $M$ is a smooth function $f:M\to[0,\infty)$ such that $f^{-1}(0) = \partial M$ and $\d f_\mathbf{p} \neq 0$ for all $\mathbf{p}\in\partial M$.
</MathBox>

<MathBox title='' boxType='proposition'>
Every smooth manifold with boundary admits a boundary defining function.

<details>
<summary>Proof</summary>

Let $\Set{(U_\alpha, \varphi_\alpha)}$ be a collection of smooth charts whose domains cover an $n$-manifold $M$. For each $\alpha$, defined a smooth function $f_\alpha: U_\alpha \to[0,\infty)$ as follows: if $U_\alpha$ is an interior chart, let $f_\alpha \equiv 1$, while if $U_\alpha$ is a boundary chart, let $f_\alpha(x^1,\dots,x^n) = x^n$. Thus, $f_\alpha(\mathbf{p})$ is positive if $\mathbf{p}\in\mathrm{int}(M)$ and zero if $\mathbf{p}\in\partial M$. 

Let $\Set{\psi_\alpha}$ be a partition of unity subordinate to this cover, and let $f = \sum_\alpha \psi_\alpha f_\alpha$. Then $f$ is smooth, identically zero on $\partial M$, and strictly positive in $\mathrm{int}(M)$. To see that $\d f$ does not vanish on $\partial M$, suppose $\mathbf{p}\in\partial M$ and that $\mathrm{v}$ is an inward-pointing vector at $\mathbf{p}$. For each $\alpha$ such that $\mathbf{p}\in U_\alpha$, we have $f_\alpha(\mathbf{p})$ = 0 and $\d f_\alpha|_\mathbf{p} = \d x^n|_\mathbf{p}(\mathbf{v}) > 0$ by properties of inward-pointing vectors. Thus

$$
  \d f_\mathbf{p}(\mathbf{v}) = \sum_\alpha (f_\alpha (\mathbf{p})\d\psi_\alpha|_\mathbf{p}(\mathbf{v}) + \psi_\alpha(\mathbf{p})\d f_\alpha|_\mathbf{p}(\mathbf{v}))
$$

For each $\alpha$, the first term in parenthesis is zero and the second is nonnegative, and there is at least one $\alpha$ for which the second term is positive. Thus $\d f_\mathbf{p}(\mathbf{v}) > 0$, which implies that $\d f_\mathbf{p}\neq 0$.
</details>
</MathBox>

## Submanifolds with boundary

<MathBox title='Smooth submanifold with boundary' boxType='definition'>
If $M$ is a smooth manifold with or without boundary, a *smooth submanifold with boundary* in $M$ is a subset $S\subseteq M$ endowed with a topology and smooth structure making it into a smooth manifold with boundary such that the inclusion map is a smooth immersion. If the inclusion map is an embedding, then it is called an *embedded submanifold with boundary*. In the general case, it is an *immersed submanifold with boundary*. A *regular domain* in $M$ is a properly embedded codimension-$0$ submanifold with boundary.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold without boundary and $D\subseteq M$ is a regular domain. The topological interior and boundary of $D$ are equal to its manifold interior and boundary, respectively.

<details>
<summary>Proof</summary>

Suppose $\mathbf{p}\in D$ is arbitrary. If $\mathbf{p}$ is in the manifold boundary of $D$, then the local immersion theorem shows that there exists a smooth boundary chart $(U,\varphi)$ for $D$ centered at $\mathbf{p}$ and a smooth chart $(V,\psi)$ for $M$ centered at $\mathbf{p}$ in which any smooth immersion $F:M\to D$ has the coordinate representation $F(x^1,\dots,x^n) = (x^1,\dots,x^n)$, where $n = \dim(M) = \dim(D)$. Since $D$ has the subspace topology, $U = D\cap W$ for some open subset $W\subseteq M$, so $V_0  = V \cap W$ is a neighbourhood of $\mathbf{p}$ in $M$ such that $V_0 \cap D$ consists of all the points in $V_0$ whose $x^m$ coordinate is nonnegative. Thus every neighbourhood of $\mathbf{p}$ intersects both $D$ and $M\setminus D$, so $\mathbf{p}$ is in the topological boundary of $D$.

On the other hand, suppose $\mathbf{p}$ is in the manifold interior of $D$. The manifold interior is a smooth embedded codimension-$0$ submanifold without boundary in $M$, so it is an open subset. Thus, $\mathbf{p}$ is in the topological interior of $D$.

Conversely, if $\mathbf{p}$ is in the topological interior of $D$, then it is not in the topological boundary, so the preceding argument shows that it is not in the manifold boundary and hence must be in the manifold interior. Similarly, if $\mathbf{p}$ is in the topological boundary, it is also in the manifold boundary.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold and that $f\in C^\infty (M)$.
1. For each regular value $b$ of $f$, the sublevel set $f^{-1}((-\infty,b])$ is a regular domain in $M$.
2. If $a$ and $b$ are two regular values of $f$ with $a < b$, then $f^{-1}([a,b])$ is a regular domain in $M$.
</MathBox>

<MathBox title='' boxType='proposition'>
If $M$ is a smooth manifold and $D\subseteq M$ is a regular domain, then there exists a defining funtion for $D$. If $D$ is compact, then $f$ can be taken to be a smooth exhaustion function for $M$.
</MathBox>

<MathBox title='Properties of embedded submanifolds with boundary' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary.
1. Every open subset of $M$ is an embedded codimension-$0$ submanifold with (possibly empty) boundary.
2. If $N$ is a smooth manifold with boundary and $F:N\to M$ is a smooth embedding, then with the subspace topology $F(N)$ is a topogical manifold with boundary, and it has a smooth structure making it into an embedded submanifold with boundary in $M$.
3. An embedded submanifold with boundary in $M$ is properly embedded if and only if it is closed.
4. If $S\subseteq M$ is an immersed submanifold with boundary, then for each $\mathbf{p}\in S$ there exists a neighbourhood $U$ of $\mathbf{p}$ in $S$ that is embedded in $M$.
</MathBox>

<MathBox title='Half-slice' boxType='definition'>
Suppose $M$ is a smooth manifold (without boundary). If $(U, (x^i))$ is a chart for $M$, a $k$-dimensional *half-slice* of $U$ is a subset of the following form for some constants $c^{k+1},\dots,c^n$:

$$
  \Set{(x^1,\dots,x^n)\in U | x^{k+1} = c^{k+1},\dots, x^n = c^n, x^k \geq 0}
$$

A subset $S\subseteq M$ satisfies the local $k$-slice condition for submanifolds with boundary if each point of $S$ is contained in the domain of a smooth chart $(U, (x^i))$ such that $S\cap U$ is either an ordinary $k$-dimensional slice or a $k$-dimensional half-slice. In the former case, the chart is called an *interior slice chart* for $S$ in $M$, and in the latter, it is a *boundary slice chart* for $S$ in $M$.
</MathBox>

<MathBox title='' boxType='theorem'>
Let $M$ be a smooth $n$-manifold without boundary. If $S\subseteq M$ is an embedded $k$-dimensional submanifold with boundary, then $S$ satisfies the local $k$-slice condition for submanifolds with boundary. Conversely, if $S\subseteq M$ is a subset that satisfies the local $k$-slice condition for submanifolds with boundary, then with the subspace topology, $S$ is a topological $k$-manifold with boundary, and it has a smooth structure making it into an embedded submanifold without boundary in $M$.
</MathBox>

<MathBox title='Restricting maps to submanifolds with boundary' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifold with boundary and let $S\subseteq M$ be an embedded submanifold.
1. **(restricting the domain):** If $F:M\to N$ is a smooth map, then $F|_S: S\to N$ is smooth.
2. **(restricting the codomain):** If $\partial M = \emptyset$ and $F:N\to M$ is a smooth map whose image is contained in $S$, then $F$ is a smooth map from $N$ to $S$.
</MathBox>

# Lie groups

<MathBox title='Lie group' boxType='definition'>
A *Lie group* is a smooth manifold $G$ (without boundary) that is also a group in the algebraic sense, with the property that the multiplication map $G\times G\to G$ given by $m(g,h) = gh$, and inversion map $i:G\to G$ given by $i(g) = g^{-1}$, are both smooth. A Lie group is, in particular, a *topological group*, a topological space with a group structure such that the multiplication and inversion maps are continuous.
</MathBox>

If $G$ is a Lie group, any element $g\in G$ defines maps $L_g,R_g: G\to G$, called *left translation* and *right translation*, respectively, given by

$$
\begin{align*}
  L_g(h) =& gh \\
  R_g(h) =& hg
\end{align*}
$$

Because $L_g$ can be expressed as the composition of smooth maps $G\xrightarrow{\iota_g} G\times G \xrightarrow{m} G$, where $\iota_g(h) = (g,h)$ and $m$ is multiplication, it follows that $L_g$ is smooth. It is actually a diffeomorphism of $G$, because $L_{g^{-1}}$ is a smooth inverse for it. Similarly $R_g$ is a diffeomorphism.

<MathBox title='' boxType='proposition'>
If $G$ is a smooth manifold with a group structure such that the map $G\times G\to G$ given by $(g,h) \mapsto gh^{-1}$ is smooth, then $G$ is a Lie group.
</MathBox>

## Lie group homomorphism

<MathBox title='Lie group homomorphism' boxType='proposition'>
If $G$ and $H$ are Lie groups, a *Lie group homomorphism* from $G$ to $H$ is a smooth map $F:G\to H$ that is also a group homomorphism. It is called a *Lie group isomorphism* if it is also a diffeomorphism, which implies that is has an inverse that is also a Lie group homomorphism. In this case, $G$ and $H$ are *isomorphic Lie groups*.
</MathBox>

<MathBox title='' boxType='theorem'>
Every Lie group homomorphism has constant rank.

<details>
<summary>Proof</summary>

Let $F:G\to H$ be a Lie group homomorphism, and let $e$ and $\tilde{e}$ denote the idenity elements of $G$ and $H$, respectively. Suppose $g_0$ is an arbitrary element of $G$. We will show that $\d F_{g_0}$ has the same rank as $\d F_e$. The fact that $F$ is a homomorphism means that for all $g\in G$

$$
\begin{align*}
  F(L_{g_0}(g)) =& F(g_0 g) = F(g_0)F(g) \\
  L_{F(g_0)}(F(g))
\end{align*}
$$

or in other words, $F\circ L_{g_0} = L_{F(g_0)} \circ F$. Taking differentials of both sides at the identiy using the composition property of differentials gives

$$
  \d F_{g_0} \circ \d\left(L_{g_0}\right)_e = \d\left( L_{F(g_0)} \right)_{\tilde{e}} \circ \d F_e
$$

Left multiplication by any element of a Lie group is a diffeomorphism, so both $\d\left(L_{g_0}\right)_e$ and $\d\left(L_{F(g_0)} \right)_{\tilde{e}}$ are isomorphisms. Because composing with an isomorphism does not change the rank of a linear map, it follows that $\d F_{g_0}$ and $\d F_e$ have the same rank.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
A Lie group homomorphism is a Lie group isomorphism if and only if it is bijective.

<details>
<summary>Proof</summary>

The global rank theorem shows that a bijective Lie group homomorphism is a diffeomorphism.
</details>
</MathBox>

### Universal covering group

<MathBox title='Existence of a universal covering group' boxType='theorem'>
Let $G$ be a connected Lie group. There exists a simply connected Lie group $\tilde{G}$, called the *universal covering group* of $G$ that admits a smooth covering map $\pi:\tilde{G}\to G$ that is also a Lie group homomorphism.

<details>
<summary>Proof</summary>

Let $\tilde{G}$ be the universal covering manifold of $G$ and $\pi:\tilde{G}\to G$ be the corresponding smooth covering map. Then $\pi\times\pi: \tilde{G}\times\tilde{G}\to G\times G$ is also a smooth covering map.

Let $m:G\times G\to G$ and $i:G\to G$ denote the multiplication and inversion maps, respectively, and let $\tilde{e}$ be an arbitrary element of the fibre $\pi^{-1}(e) \subseteq \tilde{G}$. Since $\tilde{G}$ is simply connected, the lifting criterion for covering maps guarantees that the map $m\circ (\pi\times\pi): \tilde{G}\times\tilde{G} \to G$ has a unique continuous lift $\tilde{m}:\tilde{G}\times\tilde{G}\to\tilde{G}$ satisfying $\tilde{m}(\tilde{e},\tilde{e}) = \tilde{e}$ and $\pi\circ\tilde{m}= m\circ(\pi\times\pi)$

$$
\begin{CD}
  \tilde{G}\times\tilde{G} @>{\tilde{m}}>> \tilde{G} \\
  @V{\pi\times\pi}VV @VV{\pi}V \\
  G\times G @>>{m}> G
\end{CD}
$$

Because $\pi$ is a local diffeomorphism and $\pi\circ\tilde{m} = m\circ(\pi\times\pi)$ is smooth, it follows that $\tilde{m}$ is smooth. By the same reasoning, $i\circ\pi:\tilde{G}\to G$ has a smooth lift $\tilde{i}:\tilde{G}\to\tilde{G}$ satisfying $\tilde{i}(\tilde{e}) = \tilde{e}$ and $\pi\circ\tilde{i} = i\circ\pi$

$$
\begin{CD}
  \tilde{G} @>{\tilde{i}}>> \tilde{G} \\
  @V{\pi}VV @VV{\pi}V \\
  G @>>{i}> G
\end{CD}
$$

We define multiplication and inversion in $\tilde{G}$ by $xy = \tilde{m}(x,y)$ and $x^{-1} = \tilde{i}(x)$ for all $x,y\in\tilde{G}$. Then the commutative diagrams can be rewritten as $\pi(xy) = \pi(x)\pi(y)$ and $\pi(x^{-1}) = \pi(x)^{-1}$.

It remains only to show that $\tilde{G}$ is a group with these operations for then it is a Lie group because $\tilde{m}$ and $\tilde{i}$ are smooth, and the first commutative diagram shows that $\pi$ is a homeomorphism.

First, we show that $\tilde{e}$ is an identity for multiplication in $\tilde{G}$. Consider the map $f:\tilde{G}\to\tilde{G}$ defined by $f(x) = \tilde{e}x$. Then the first commutative diagram implies that $\pi\circ f(x) = \pi(\tilde{e})\pi(x) = e\pi(x) = \pi(x)$, so $f$ is a lift of $\pi:\tilde{G}\to G$. The identity map $\operatorname{id}_{\tilde{G}}$ is another lift of $\pi$, and it agrees with $f$ at a point because $f(\tilde{e}) = \tilde{m}(\tilde{e},\tilde{e}) = \tilde{e}$, so the unique lifting property of covering maps implies that $f = \operatorname{id}_{\tilde{G}}$, or equivalently $\tilde{e}x = x$ for all $x\in\tilde{G}$. The same argument shows that $x\tilde{e} = x$.

Next, to show that multiplication in $\tilde{G}$ is associative, consider the two maps $\alpha_L,\aplha_R: \tilde{G}\times\tilde{G}\to\tilde{G}\times\tilde{G}$ defined by

$$
\begin{align*}
  \alpha_L (x,y,z) =& (xy)z \\
  \alpha_R (x,y,z) =& x(yz)
\end{align*}
$$

The the first commutative diagram applied repeatedly implies that

$$
\begin{align*}
  \pi\circ\alpha_L(x,y,z) =& (\pi(x)\pi(y))\pi(z) \\
  =& \pi(x)(\pi(y)\pi(z)) \\
  =& \pi\circ\alpha_R (x,y,z)
\end{align*}
$$

so $\alpha_L$ and $\alpha_R$ are both lifts of the same map $\alpha(x,y,z) = \pi(x)\pi(y)\pi(z)$. Because $\alpha_L$ and $\alpha_R$ agree at $(\tilde{e},\tilde{e},\tilde{e})$, they are equal. A similar argument showst that $x^{-1} x = xx^{-1} = \tilde{e}$, so $\tilde{G}$ is a group.
</details>
</MathBox>

<MathBox title='Uniqueness of the universal covering group' boxType='theorem'>
For any connected Lie group $G$, the universal convering group is unique in the following sense: if $\tilde{G}$ and $\tilde{G}'$ are simply connected Lie groups that admit smooth covering maps $\pi:\tilde{G}\to G$ and $\pi': \tilde{G}\to G$ that are also Lie group homomorphism, then there exists a Lie group homomorphism $\phi:\tilde{G}\to\tilde{G}'$ such that $\pi'\circ\Phi = \pi$.
</MathBox>

## Lie subgroups

<MathBox title='Lie subgroup' boxType='definition'>
Suppose $G$ is a Lie group. A *Lie subgroup* of $G$ is a subgroup of $G$ endowed with a topology and smooth structure making it into a Lie group and an immersed submanifold of $G$.
</MathBox>

<MathBox title='Embedded submanifolds are Lie subgroups' boxType='proposition'>
Let $G$ be a Lie group, and suppose $H\subseteq G$ is a subgroup that is also an embedded manifold. Then $H$ is a Lie subgroup.

<details>
<summary>Proof</summary>

We only need to check that multiplication $H\times H\to H$ and inversion $H\to H$ are smooth maps. Because multiplication is a smooth map from $G\times G$ into $G$, its restriction is clearly smooth from $H\times H$ into $G$ (this is true even if $H$ is merely immersed). Because $H$ is a subgroup, multiplication takes $H\times H$ into $H$, and since $H$ is embedded, this is a smooth map into $H$. A similar argument applies to inversion. This proves that $H$ is a Lie subgroup.
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $G$ is a Lie group and $H\subseteq G$ is an open subgroup. Then $H$ is an embedded Lie subgroup. In addition, $H$ is cloes, so it is a union of connected components of $G$.

<details>
<summary>Proof</summary>

If $H$ is open in $G$, it is embedded. In addition, every left coset $gH = \Set{gh | h\in H}$ is open in $G$ because it is the image of the open subset $H$ under the diffeomorphism $L_g$. Because $G\setminus H$ is the union of the cosets of $H$ other than $H$ itself, it is open, and therefore $H$ is closed in $G$. Because $H$ is both open and closed, it is a union of components.
</details>
</MathBox>

If $G$ is a group and $S\subseteq G$, the subgroup generated by $S$ is the smallest subgroup containing $S$, i.e. the intersection of all subgroups containing $S$.

<MathBox title='' boxType='proposition'>
Suppose $G$ is a Lie group, and that $W\subseteq G$ is any neighbourhood of the identity.
1. $W$ generates an open subgroup of $G$
2. If $W$ is connected, it generates a connected open subgroup of $G$
3. If $G$ is connected, then $W$ generates $G$

<details>
<summary>Proof</summary>

**(1):** Let $W\subseteq G$ by any neighbourhood of the identity, and let $H$ be the subgroup generated by $W$. As a matter of notation, if $A$ and $B$ are subsets of $G$, let us write

$$
\begin{align*}
  AB =& \Set{ab | a\in A, b\in B} \\
  A^{-1} =& \Set{a^{-1} | a\in A}
\end{align*}
$$

For each $k\in\N_+$, let $W_k$ denote the set of all elements of $G$ that can be expressed as products of $k$ or fewer elements of $W\cup W^{-1}$. It follows that $H = \bigcup_{k\in\N_+} W_k$. Furthermore, $W^{-1}$ is open because it is the image of $W$ under the inversion map, which is a diffeomorphism. Thus $W_1 = W \cup W^{-1}$ is open, and for each $k > 1$ we have

$$
  W_k = W_1 W_{k-1} = \bigcup_{g\in W_1} L_g (W_{k-1})
$$

Because each $L_g$ is a diffeomorphism, it follows by induction that each $W_k$ is open, and thus $H$ is open.

**(2):** Suppose $W$ is connected. Then $W^{-1}$ is also connected because it is a diffeomorphic image of $W$, and $W_1 = W \cup W^{-1}$ is connected because it is a union of connected sets with the identity in common. Therefore, $W_2 = m(W_1 \times W_1)$ is connected because it is the image of a connected space under the continuous multiplication map $m$, and it follows by induction that $W_k = m(W_1\times W_{k-1})$ is connected for each $k$. Thus, $H = \bigcup_{k\in\N_+} W_k$ is connected because it is a union of connected subsets with the identity in common.

**(3):**Assume $G$ is connected. Since $H$ is an open subgroup, it is closed by the previous lemma, and it is not empty because it contains the identity. Thus, $H = G$.
</details>
</MathBox>

<MathBox title='Identity component' boxType='definition'>
If $G$ is a Lie group, the connected component of $G$ containing the identity is called the *identity component* of $G$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $G$ be a Lie group and let $G_0$ be its identity component. Then $G_0$ is a normal subgroup of $G$, and is the only connected open subgroup. Every connnected component of $G$ is diffeomorphic to $G_0$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $F:G\to H$ be a Lie group homomorphism. The kernel of $F$ is a properly embedded Lie subgroup of $G$, whose codimension is equal to the rank of $F$.

<details>
<summary>Proof</summary>

Because $F$ has constant rank, its kernel $F^{-1}(e)$ is a properly embedded submanifold of comdimension equal to $\operatorname{rank}(F)$. It is thus a Lie subgroup.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
If $F:G\to H$ is an injective Lie group homomorphism, the image of $F$ has a unique smooth manifold structure such that $F(G)$ is a Lie subgroup of $H$ and $F:G\to F(G)$ is a Lie group isomorphism.

<details>
<summary>Proof</summary>

Since a Lie group has constant rank, it follows from the global rank theorem that $F$ is a smooth immersion. Then $F(G)$ has a unique smooth manifold structure such that it is an immersed submanifold of $H$, and $F$ is a diffeomorphism onto its image. It is a Lie group because $G$ is, and it is a subgroup for algebraic reasons, so it is a Lie subgroup. Because $F:G\to F(G)$ is a group isomorphism and a diffeomorphism, it is a Lie group isomorphism.
</details>
</MathBox>

<MathBox title='Embedded Lie subgroups are properly embedded submanifolds' boxType='theorem'>
Suppose $G$ is a Lie group and that $H\subseteq G$ is a Lie subgroup. Then $H$ is closed in $G$ if and only if it is embedded.

<details>
<summary>Proof</summary>

Assume first that $H$ is embedded in $G$. To prove that $H$ is closed, let $g$ be an arbitrary point of $\overline{H}$. Then there is a sequence $(h_i)_{i\in\N}$ of points in $H$ converging to $g$. Let $U$ be the domain of a slice chart for $H$ containing the identity, and let $W$ be a smaller neighbourhood of $e$ such that $\overline{W}\subseteq U$. Then there is a neighbourhood $V$ of $e$ with the property that $g_1 g_2^{-1} \in W$, whenever $g_1, g_2\in V$.

Because $h_i g^{-1} \to e$, by discarding finitely many terms of the sequence we may assume $h_i g^{-1} \in V$ for all $i$. This implies that

$$
  h_i h_j^{-1} = (h_i g^{-1})(h_j g^{-1})^{-1}\in W,\; \forall i,j \in\N
$$

Fixing $j$ and letting $i\to \infty$, we find that $h_i h_j^{-1} \to gh_j^{-1} \in\overline{W}\subseteq U$. Since $H \cap U$ is a slice, it is closed in $U$, and therefore $gh_j^{-1}\in H$, which implies $g\in H$. Thus $H$ is closed.

Conversely, assume $H$ is a closed Lie subgroup, and let $m = \dim(H)$ and $n = \dim(G)$. We need to show that $H$ is an embedded submanifold of $G$. If $m = n$, then by the conditions for embeddedness $H$ is embedded, so we may assume $m < n$.

If suffices to show that for some $h_1\in H$, there is a neighbourhood $U_1$ of $h_1$ in $G$ such that $H \cap U_1$ is an embedded submanifold of $U_1$. If $h$ is any other point of $H$, the right translation $R_{hh_1^{-1}}: G\to G$ is a diffeomorphism of $G$ that takes $H$ to $H$, and takes $U_1$ to a neighbourhood $U'_1$ of $h$ such that $U'_1 \cap H$ is embedded in $U'_1$, so it follows from the local slice criterion that $H$ is an embedded submanifold of $G$.

Because every immersed submanifold is locally embedded, there exists a neighbourhood $V$ of $e$ in $H$ and a slice chart $(U,\varphi)$ for $V$ in $G$ centered at $e$ By shrinking $U$ if necessary, we may assume it is a coordinate cube, and $U\cap V$ is the set of points whose coordinates are of the form $(x^1,\dots,x^m,0,\dots,0)$. Let $S\subseteq U$ be the set of points with coordinates of the form $(0,\dots,0,x^{m+1},\dots,x^n)$. It is the slice perpendiculaar to $U \cap V$ in these coordinates. Then $S$ is an embedded submanifold of $U$ and hence of $G$. Note that in these coordinates, $T_e V$ is spanned by the first $m$ coordinate vectors and $T_e S$ by the last $n-m$, so $T_e G = T_e V \oplus T_e S$.

Consider the map $\psi:V\times S\to G$ obtained by restricting group multiplication: $\psi(v,s) = vs$. Since $\psi(v,e) = v$ for $v\in V$ and $\psi(e,s) = s$ for $s\in S$, it follows easily that the differential of $\psi$ at $(e,e)$ satisfies $\d\psi(X,0) = X$ and $\d\psi(0,Y) = Y$ for $X\in T_e V$ and $Y\in T_e S$, and therefore $\d\psi_{(e,e)}$ is bijective. By the inverse function theorem, there are connected neighbourhoods $W_0$ of $(e,e)$ in $V\times S$ and $U_0$ of $e$ in $G$ such that $\psi:W_0 \to U_0$ is a diffeomorphism. Shrinking the neighbourhoods if necessary, we may assume $W_0 = V_0 \times S_0$, where $V_0$ and $S_0$ are neighbourhoods of $e$ in $V$ and $S$, respectively.

Let $K = S_0 \cap H$. There are two things we need to show about $K$:
1. $\psi(V_0 \times K) = H\cap U_0$
2. $K$ is a discrete set in the topology of $H$

To prove **(1)**, let $(v,s)\in V_0 \times S_0$ be arbitrary. Since $H$ is a subgroup and $V_0 \subseteq H$, it follows that $vs\in H$ if and only if $s\in H$, which is to say that $\psi(v,s)\in H\cap U_0$ if and only if $(v,s) \in V_0 \times K$. To prove **(2)**, suppose $h\in K$. Righ translation $R_h: H\to H$ is a diffeomorphism of $H$ taking $e$ to $h$ and takin $V_0$ to a neighbourhood $V_h$ of $h$. Note that $V_h = R_h(V_0) = \psi(V_0 \times \Set{h})$, while $K = \psi(\Set{e}\times K)$. Since $\psi$ is injective on $V_0 \times S_0$, it follows that

$$
  V_h \cap K = \psi(\Set{e}\times\Set{h}) = \Set{h}
$$

Thus each point $h\in K$ is isolated in $H$, which implies that $K$ is discrete. Since $K$ is a discrete subset of the manifold $H$, it is countable, and since $H$ is closed in $G$, it follows that $K = S_0 \cap H$ is closed in $S_0$. Thus, there is a point $h_1 \in K$ that is isolated in $S_0$ (this step fails if $H$ is not closed - for example, if $H$ is a dense subgroup of the torus, then $K$ is dense in $S_0$). This means that there is a neighbourhood $S_1$ of $h_1$ in $S_0$ such that $S_1 \cap H = \Set{h_1}$. Then $U_1 = \psi(V_0 \times S_1)$ is a neighbourhood of $h_1$ in $G$ with the property that $U_1 \cap H$ is the slice $\psi(V_0 \times\Set{h_1})$ in $U_1$. The existence of such a neighbourhood for one point of $H$ implies that $H$ is embedded.
</details>
</MathBox>

## Group actions

<MathBox title='Group action' boxType='definition'>
If $G$ is a group and $M$ is a set, a *left action* of $G$ on $M$ is a map $G\times M\to M$, often written as $(g,\mathbf{p})\mapsto g\cdot \mathbf{p}$ that satisfies
1.  $g_1\cdot (g_2\cdot \mathbf{p}) = (g_1 g_2)\cdot \mathbf{p}$ for all $g_1, g_2 \in G$ and $\mathbf{p} \in M$
2. $e\cdot \mathbf{p} = \mathbf{p}$ for all $\mathbf{p}\in M$

A *righ action* is defined analogously as a map $M\times G\to M$, written $(\mathbf{p},g)\mapsto \mathbf{p}\cdot g$, with the appropriate composition law
1.  $(\mathbf{p}\cdot g_1) \cdot g_2 = \mathbf{p}\cdot (g_1 g_2)\cdot \mathbf{p}$ for all $g_1, g_2 \in G$ and $\mathbf{p} \in M$
2. $\mathbf{p}\cdot e = \mathbf{p}$ for all $\mathbf{p}\in M$

If $M$ is a topological space and $G$ is a topological group, an action of $G$ on $M$ called a continuous action if the defining map $G\times M\to M$ or $M\times G\to M$ is continuous. In this case, $M$ is a (left or right) $G$-space. If in addition $M$ is a smooht manifold with or without boundary, $G$ is a Lie group, and the defining map is smooth, then the action is called a $smooth action$.
</MathBox>

Sometimes actions are labeled like $\theta: G\times M\to M$ and $\theta_g (\mathbf{p})$. With this notation, the conditions for a left action read
1. $\theta_{g_1} \circ\theta_{g_2} = \theta_{g_1 g_2}$
2. $\theta_e = \operatorname{id}_M$

while for a right action the first equation is replaced by 
1. $\theta_{g_2}\circ\theta_{g_2} = \theta_{g_1 g_2}$.

A right action can always be converted to a left action by the trick of defining $\mathbf{p}\cdot g$ to be $\mathbf{p} \cdot g^{-1}$. Similarly, a left action can be converted to a right action.

<MathBox title='Group action terminology' boxType='definition'>
Suppose $\theta:G\times M\to M$ is a left action of group $G$ on a set $M$.
- For each $\mathbf{p}\in M$ the *orbit* of $p$, denoted by $G\cdot p$, is the set of all images of $p$ under the action by elements of $G$:
$$
  G\cdot p = \Set{g\cdot p | g\in G}
$$
- For each $\mathbf{p}\in M$, the *isotropy group* or *stabilizer* of $p$, denoted by $G_p$, is the set of elements of $G$ that fix $p$:
$$
  G_p = \Set{g\in G | g\cdot p = p}
$$
The definition of a group guarantees that $G_p$ is a subgroup of $G$.
- The action is *transitive* if for every pair of points $p,q\in M$, there exists $g\in G$ such that $g\cdot p = q$, or equivalently, if the only orbit is all of $M$.
- The action is *free* if the only element of $G$ that fixes any element of $M$ is the identity: $g\cdot p = p$ for some $\mathbf{p}\in M$ implies $g\cdot e$, or equivalently, if every isotopy group is trivial.
</MathBox>

<MathBox title='Automorphism group' boxType='definition'>
Suppose $E$ and $M$ are topological spaces, and that $\pi:E\to M$ is a topological covering map. An *automorphism* of $\pi$, also called a *deck/covering transformation*, is a homeomorphism $\varphi:E\to E$ such that $\pi\circ\varphi = \pi$:

$$
\begin{CD}
  E @>{\varphi}>> E \\
  @V{\pi}VV @VV{\pi}V \\
  M @= M
\end{CD}
$$

The set $\mathrm{Aut}_\pi (E)$ of all automorphisms of $\pi$, called the *automorphism group* of $\pi$, is a group under composition, acting on $E$ from the left.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $E$ and $M$ are smooth manifolds with or without boundary, and $\pi: E\to M$ is a smooth covering map. With the discrete topology, the automorphism group $\mathrm{Aut}_\pi (E)$ is a zero-dimensional Lie group acting smoothly and freely on $E$.

<details>
<summary>Proof</summary>

Suppose $\varphi\in\mathrm{Aut}_\pi (E)$ is an automorphism that fixes a point $\mathbf{p}\in E$. We can consider $\varphi$ as a lift of $\pi$:

$$
\begin{CD}
  E @>{\varphi}>> E \\
  @| @VV{\pi}V \\
  E @>>{\pi}> M
\end{CD}
$$

Since the identity map of $E$ is another such lift that agrees with $\varphi$ at $\mathbf{p}$, the unique lifting property of covering maps guarantees that $\varphi = \operatorname{id}_E$. Thus, the action of $\mathrm{Aut}_\pi (E)$ is free.

To show that $\mathrm{Aut}_\pi (E)$ is a Lie group, we need only verify that is is countable. Let $q\in E$ be arbitrary, $\mathbf{p} = \pi(\mathbf{q})\in M$, and let $U\subseteq M$ be an evenly covered neighbourhood of $\mathbf{p}$. Because $E$ is second-countable, $\pi^{-1}(U)$ has countable many components, and because each component contains exactly one point of $\pi^{-1}(\mathbf{p})$, it follows that $\pi^{-1}(\mathbf{p})$ is countable. Let $\theta^{(\mathbf{q})}: \mathrm{Aut}_\pi (E)\to E$ be the map $\theta^{(\mathbf{q})}(\varphi) = \varphi(\mathbf{q})$. Then $\theta^{(\mathbf{q})}$ maps $\mathrm{Aut}_\pi (E)$ into $\pi^{-1}(\mathbf{p})$, and the fact that the action is free implies that it is injective, thus $\mathrm{Aut}_\pi (E)$ is countable.
</details>
</MathBox>

### Equivariant maps

<MathBox title='Equivariant map' boxType='definition'>
Suppose $G$ is a Lie group, and that $M$ and $N$ are booth smooth manifolds endowed with smooth left or right $G$-actions. A map $F:M\to N$ is *equivariant* with respect to the given $G$-actions if for each $g\in G$

1. $F(g\cdot\mathbf{p}) = g\cdot F(\mathbf{p})$ (for left actions)
2. $F(\mathbf{p}\cdot g) = F(\mathbf{p})\cdot g$ (for right actions)

Equivalently, if $\theta$ and $\varphi$ are the given actions on $M$ and $N$, respectively, $F$ is equivariant if the following diagram commutes for eaach $g\in G$:

$$
\begin{CD}
  M @>{F}>> N \\
  @V{\theta_g}VV @VV{\varphi_g}V \\
  M @>>{F}> N
\end{CD}
$$

The condition is also expressed by saying the $F$ *intertwines* $\theta$ and $\varphi$.
</MathBox>

<MathBox title='Equivariant rank theorem' boxType='theorem'>
Let $M$ and $N$ be smooth manifolds and let $G$ be a Lie group. Suppose $F:M\to N$ is smooth map that is equivariant with respect to a transitive smooth $G$-action on $M$ and any smooth $G$-action on $N$. Then $F$ has constant rank. Thus, if $F$ is surjective, it is a smooth submersion; if it is injective, it is smooth immersion; and if it is bijective, it is a diffeomorphism.

<details>
<summary>Proof</summary>

Let $\theta$ and $\varphi$ denote the $G$-actions on $M$ and $N$, respectively, and let $\mathbf{p}$ and $\mathbf{q}$ be arbitrary points in $M$. Choose $g\in G$ such that $\theta_g (\mathbf{p}) = \mathbf{q}$. Because $\varphi_g \circ F = F\circ\varphi_g$, the following diagram commutes:

$$
\begin{CD}
  T_\mathbf{p}M @>{\d F_\mathbf{p}}>> T_{F(\mathbf{p})}N \\
  @V{\d(\theta_g)_\mathbf{p}}VV @VV{\d(\varphi_g)_{F(\mathbf{p})}}V \\
  T_\mathbf{q} M @>>{\d F_\mathbf{q}}> T_{F(\mathbf{q})} N
\end{CD}
$$

Because the vertical linear maps in this diagram are isomorphisms, the horizontal ones have the same rank. In other word, the rank of $F$ is the same at any two arbitrary points $\mathbf{p},\mathbf{q}\in M$, so $F$ has constant rank. The final statement follows from the global rank theorem.
</details>
</MathBox>

<MathBox title='Orbit map' boxType='definition'>
Suppose $G$ is a Lie group, $M$ is a smooth manifold, and that $\theta:G\times M\to M$ is a smooth left action (the definition for right actions is analogous). For each $\mathbf{p}\in M$, define a map $\theta^{(\mathbf{p})}:G\to M$ by $\theta^{(\mathbf{p})}(g) = g\cdot\mathbf{p}$. This is called the *orbit map*, because its image is the orbit $G\cdot\mathbf{p}$. In addition, the preimage $\left(\theta^{(\mathbf{p})}\right)^{-1}(\mathbf{p})$ is the isotropy group $G_\mathbf{p}$.
</MathBox>

<MathBox title='Properties of the orbit map' boxType='proposition'>
Suppose $\theta$ is a smooth left action of a Lie group $G$ on a smooth manifold $M$. For each $\mathbf{p}\in M$, the orbit map $\theta^{(\mathbf{p})}: G\to M$ is smooth and has constant rank, so the isotropy group $G_\mathbf{p} = \left(\theta^{(\mathbf{p})}\right)^{-1}(\mathbf{p})$ is a properly embedded Lie subgroup of $G$. If $G_\mathbf{p} = \Set{e}$, then $\theta^{(\mathbf{p})}$ is an injective smooth immersion, so the orbit $G\cdot\mathbf{p}$ is an immersed submanifold of $M$.

<details>
<summary>Proof</summary>

The orbit map is smooth because it is equal to the composition

$$
  G\cong G\times\Set{\mathbf{p}} \hookrightarrow G\times M \xrightarrow{\theta} M
$$

It follows from the definition of a group action that $\theta^{(\mathbf{p})}$ is equivariant with respect to the action of $G$ on itself by left translation and the given action on $M$

$$
\begin{align*}
  \theta^{(\mathbf{p})}(g'g) =& (g'g)\cdot \mathbf{p} = g'\cdot(g\cdot\mathbf{p}) \\
  =& g'\cdot \theta^{\mathbf{p}}(g)
\end{align*}
$$

Since $G$ acts transitively on itself, the equivariant rank theorem shows that $\theta^{(\mathbf{p})}$ has constant rank. Thus $G_\mathbf{p}$ is a properly embedded submanifold and a Lie subgroup.

Suppose $G_p = \Set{e}$. If $\theta^{(\mathbf{p})}(g') = \theta^{(\mathbf{p})}(g)$, then

$$
\begin{gather*}
  g' \cdot\mathbf{p} = g\cdot \mathbf{p} \\
  \iff (g^{-1}g')\cdot\mathbf{p} = \mathbf{p} \\
  \iff g^{-1}g' = e \iff g = g'
\end{gather*}
$$

showing that $\theta^{(\mathbf{p})}$ is injective. By the equivariant rank theorem, it is a smooth immersion, and thus the orbit (endowed with a suitable topology and smooth structure) is an immersed submanifold.
</details>
</MathBox>

### Semidirect products

<MathBox title='Semidirect product' boxType='definition'>
Suppose $H$ and $N$ are Lie groups, and that $\theta: H\times N\to N$ is a smooth left action of $H$ on $N$. It is called an *action by automorphisms* if for each $h\in H$, the map $\theta_h:N\to N$ is a group automorphism of $N$. Given such an action, we define a new Lie group $N \rtimes_\theta H$, called a *semidirect product* of $H$ and $N$ as follows. As a smooth manifold, $N \rtimes_\theta H$ is just the Cartesian product $N\times H$, but the group multiplication is defined by

$$
  (n,h)(n', h') = (n\theta_h(n'), hh')
$$
</MathBox>

<MathBox title='Properties of semidirect products' boxType='proposition'>
Suppose $H$ and $N$ are Lie groups, and that $\theta: H\times N\to N$ is a smooth action of $H$ on $N$ by automorphism. Let $G = N \rtimes_\theta H$.
1. The subsets $\tilde{N} = N\times\Set{e}$ and $\tilde{H} = \Set{e}\times H$ are closed Lie subgroups of $G$ isomorphic to $N$ and $H$, respectively.
2. $\tilde{N}$ is a normal subgroup of $\tilde{G}$
3. $\tilde{N} \cap\tilde{H} = \Set{(e,e)}$ and $\tilde{N}\tilde{H}= G$ 
</MathBox>

<MathBox title='Characterization of semidirect products' boxType='theorem'>
Suppose $G$ is a Lie group, and that $N,H\subseteq G$ are closed Lie subgroups such that $N$ is normal, $N\cap H = \Set{e}$ and $NH = G$. Then the map $(n,h)\mapsto nh$ is a Lie group isomorphism between $N \rtimes_\theta H$ and $G$, where $\theta: H\times N\to N$ is the action by conjugation: $\theta_h (n) = hnh^{-1}$.
</MathBox>

### Representations

<MathBox title='Linear action' boxType='definition'>
Let $G$ be a Lie group and $V$ be a finite-dimensional vector space. An action of $G$ on $V$ is called a *linear action* if for each $g\in G$, the map from $V$ to itself given by $x\mapsto g\cdot x$ is linear.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $G$ be a Lie group and $V$ be a finite-dimensional vector space. A smooth left action of $G$ on $V$ is linear if and only if it is of the form $g\cdot x = \rho(g)x$ for some representation $\rho$ of $G$.

<details>
<summary>Proof</summary>

Every action induced by a representation is evidently linear. To prove the converse, assumme that we are given a linear action of $G$ on $V$. The hypothesis implies that for each $g\in G$ there is a linear map $\rho(g) \in \mathrm{GL}(V)$ such that $g\cdot x = \rho(g)x$ for all $x\in V$. The fact that the action satisfies the left action properties translates to $\rho(g_1 g_2) = \rho(g_1)\rho(g_2)$, so $\rho: G\to \mathrm{GL}(V)$ is a group homomorphism. Thus, to show that it is a Lie group representation, we need only show that it is smooth.

Choose a basis $\Set{\mathbf{e}_i}$ for $V$, and for each $i$ let $\pi^i: V\to\R$ be the projection onto the $i$th coordinate with respect to this basis: $\pi^i (x^j \mathbf{e}_j) = x^i$. If we let $\rho_j^i(g)$ denote the matrix entries of $\rho(g)$ with respect to this basis, it follows that $\rho_j^i(g) = \pi^i (g\cdot\mathbf{e}_i)$, so each function $\rho_j^i$ is a composition of smooth function. Because the matrix entries form global smooth coordinates for $\mathrm{GL}(V)$ ,this implies that $\rho$ is smooth.
</details>
</MathBox>

# Vector fields

<MathBox title='Vector field' boxType='definition'>
If $M$ is a smooth manifold with or without boundary, a *vector field* on $M$ is a section of the map $\pi:TM\to M$. More specifically, a vector field is a continuous map $\mathbf{X}:M\to TM$, usually written $\mathbf{p}\mapsto \mathbf{\mathbf{X_p}}$, with the property that

$$
  \pi\circ \mathbf{X} = \operatorname{id}_M
$$

or equivalently, $\mathbf{\mathbf{X_p}}\in T_\mathbf{p}M$ for each $\mathbf{p}\in M$. If $\mathbf{X}$ is smooth it is a *smooth vector field*, otherwise it is called a *rough vector field*. The set of all smooth vector fields on $M$, denoted $\mathfrak{X}(M)$, is a vector space under pointwise addition and scalar multiplication:

$$
  (\alpha \mathbf{X} + \beta \mathbf{Y})_\mathbf{p} = \alpha \mathbf{\mathbf{X_p}} + \beta \mathbf{Y_p},\; \alpha,\beta\in\R
$$

The zero element of this vector space is the zero vector field, whose value at each $\mathbf{p}\in M$ is $\mathbf{0}\in T_\mathbf{p}M$. In addition, smooth vector fields can be multiplied by smooth real-valued functions: if $f\in C^\infty(M)$ and $\mathbf{X}\in\mathfrak{X}(M)$, we define $f\mathbf{X}:M\to TM$ by

$$
  (f\mathbf{X})_\mathbf{p} = f(\mathbf{p})\mathbf{\mathbf{X_p}}
$$

The support of $\mathbf{X}$ is defined as

$$
  \operatorname{supp}(X) = \overline{\Set{\mathbf{p}\in M | \mathbf{\mathbf{X_p}} \neq \mathbf{0}}}
$$

A vector field is *compactly supported* if its support is a compact set. 

If $U\subseteq M$ is an arbitrary subset, a *vector field along* $U$ is a continuous map $X:A\to TM$ satisfying

$$
  \pi\circ X = \operatorname{id}_U
$$

or equivalently, $\mathbf{\mathbf{X_p}}\in T_\mathbf{p}M$ for each $\mathbf{p}\in U$. The vector field along $U$ is smooth if for each $\mathbf{p}\in U$ there is a neighbourhood of $\mathbf{p}$ in $M$ and a smooth vector field $\tilde{X}$ on $V$ that agrees with $\mathbf{X}$ on $V \cap U$.
</MathBox>

Suppose $M$ is a smooth $n$-manifold with or without boundary. If $X:M\to TM$ is a rough vector field and $(U, (x^i))$ is any smooth coordinate chart for $M$, we can write $\mathbf{X}$ at any point $\mathbf{p}\in U$ in terms of the coordinate basis vectors:

$$
  \mathbf{\mathbf{X_p}} = X^i(\mathbf{p}) \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}
$$

This defines $n$ functions $X^i:U\to\R$, called the *component functions* of $\mathbf{X}$ in the given chart.

<MathBox title='Smoothness criterion for vector fields' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $X:M\to TM$ be a rough vector field. If $(U, (x^i))$ is any smooth coordinate chart on $M$, then the restriction of $\mathbf{X}$ to $U$ is smooth if and only if its component functions with respect tor this chart are smooth.

<details>
<summary>Proof</summary>

Let $(x^i, v^i)$ be the natural coordinates on $\pi^{-1}(U)\subseteq TM$ associated with the chart $(U,(x^i))$. By definition of natural coordinates, the coordinate representation of $X:M\to TM$ on $U$ is

$$
  \hat{X}(\mathbf{p}) = (x^i,\dots,x^n,X^1(\mathbf{x}),\dots,X^n(\mathbf{x}))
$$

where $X^i$ is the $i$th component function of $\mathbf{X}$ in $x^i$-coordinates. It follows immediately that smoothness of $\mathbf{X}$ in $U$ is equivalent to smoothness of its component functions.
</details>
</MathBox>

<MathBox title='Extension lemma for vector fields' boxType='lemma'>
Let $M$ be a smooth manifold with or without boundary, and let $A\subseteq M$ be a closed subset. Suppose $\mathbf{X}$ is a smooth vector field along $A$. Given any subset $U$ containing $A$, there exists a smooth global vector field $\tilde{X}$ on $M$ such that $\tilde{X}|_A$ and $\operatorname{supp}(\tilde{X})\subseteq U$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary. Given $\mathbf{p}\in M$ and $\mathbf{v}\in T_\mathbf{p} M$, there is a smooth global vector field $\mathbf{X}$ on $M$ such that $\mathbf{\mathbf{X_p}} = \mathbf{v}$.

<details>
<summary>Proof</summary>

The assignment $\mathbf{p}\mapsto\mathbf{v}$ is an example of a vector field along the set $\Set{\mathbf{p}}$. It is smooth because it can be extended to a constant-coefficient vector field in a coordinate neighbourhood of $\mathbf{p}$. Thus, the proposition follows from the extension lemma with $A = \Set{\mathbf{p}}$ and $U = M$.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary. 
1. If $\mathbf{X}$ and $\mathbf{Y}$ are smooth vector field on $M$ and $f,g\in C^\infty (M)$, then $f\mathbf{X} + g\mathbf{Y}$ is a smooth vector field.
2. $\mathfrak{X}(M)$ is a module over the ring $C^\infty (M)$
</MathBox>

## Local and global frames

<MathBox title='Linear independence' boxType='proposition'>
Suppose $M$ is a smooth $n$-manifold with or without boundary. An ordered $k$-tuple $(\mathbf{X}_1,\dots,\mathbf{X}_k)$ of vector fields defined on some subset $A\subseteq M$ is *linearly independent* if $(\mathbf{X}_1|_\mathbf{p},\dots, \mathbf{X}_k|_\mathbf{p})$ is a linearly independent $k$-tuple in $T_\mathbf{p} M$ for each $\mathbf{p}\in A$. The $k$-tuple $(\mathbf{X}_1,\dots,\mathbf{X}_k)$ of vector fields *spans* the tangent bundle $TM$ if the $k$-tuple $(\mathbf{X}_1|_\mathbf{p},\dots,\mathbf{X}_k|\mathbf{p})$ spans $T_\mathbf{p}M$ for each $\mathbf{p}$.
</MathBox>

<MathBox title='Frame' boxType='definition'>
Suppose $M$ is a smooth $n$-manifold with or without boundary. A *local frame* for $M$ is an ordered $n$-tuple of vector fields $(\mathbf{E}_i)_{i=1}^n$ defined on an open subset $U\subseteq M$ that is linearly independent and spans the tangent bundle. Thus, the vectors $(\mathbf{E}_i|_\mathbf{p})_{i=1}^n$ form a basis for $T_p M$ at each $\mathbf{p}$. It is called a *global frame* if $U = M$, and a *smooth frame* if each of the vector fields $\mathbf{E}_i$ is smooth. If $M$ admits a smooth global frame, it is called *parallelizable*.

In particular, if $M = \R^n$, then a $k$-tuple of vector fields $(\mathbf{E}_i)_{i=1}^k$ defined on some subset $A\subseteq\R^n$ is *orthonormal* if for each $\mathbf{p}\in A$, the vectors $(\mathbf{E}_i|_\mathbf{p})_{i=1}^k$ are orthonormal with respect to the Euclidean inner product. A (local/global) frame consisiting of orthonormal vector fields is called an *orthonormal field*.
</MathBox>

<MathBox title='Completion of local frames' boxType='proposition'>
Suppose $M$ is a smooth $n$-manifold with or without boundary.
1. If $(\mathbf{X}_i)_{i=1}^k$ is a linearly independent $k$-tuple of smooth vector fields on an open subset $U\subseteq M$ with $1\geq k < n$, then for each $\mathbf{p}\in U$ there exis smooth vector fields $X_{k+1},\dots,X_n$ in a neighbourhood $V$ of $\mathbf{p}$ such that $(\mathbf{X}_i)_{i=1}^n$ is a smooth local frame for $M$ on $U\cap V$.
2. If $(\mathbf{v}_i)_{i=1}^k$ is a linearly independent $k$-tuple of vectors in $T_\mathbf{p}M$ for some $\mathbf{p}\in M$ with $1\leq k < n$, then there exists a smooth local frame $(\mathbf{X}_i)_{i=1}^k$ on a neighbourhood of $\mathbf{p}$ such that $\mathbf{X}_i|\mathbf{p} = \mathbf{v}_i$. 
3. If $(\mathbf{X}_i)_{i=1}^n$ is a linearly independent $n$-tuple of smooth vector fields along a closed subset $A\subseteq M$, then there exists a smooth local fram $(\tilde{\mathbf{X}}_1)_{i=1}^n$ on some neighbourhood of $A$ such that $\tilde{\mathbf{X}}_i|_A = \mathbf{X}_i$.
</MathBox>

<MathBox title='Gram-Schmidt algorithm for frames' boxType='lemma'>
Suppose $(\mathbf{X}_i)_{i=1}^n$ is a smooth local frame for $T\R^n$ over an open subset $U\subseteq \R^n$. Then there is a smooth orthonormal frame $(\mathbf{E}_i)_{i=1}^n$ over $U$ such that for each $\mathbf{p}\in U$

$$
  \operatorname{span}(\mathbf{E}_i|_\mathbf{p})_{i=1}^n = \operatorname{span}(\mathbf{X}_i|_\mathbf{p})_{i=1}^n
$$

<details>
<summary>Proof</summary>

Applying the Gram-Schmidt algorithm to the vectors $(\mathbf{X}_j|_\mathbf{p})$ at each $\mathbf{p}\in U$, we obtain an $n$-tuple of rough vector fields $(\mathbf{E}_i)_{i=1}^n$ given inductively by

$$
  \mathbf{E}_j = \frac{\mathbf{X}_j - \sum_{i=1}^{j-1} (X_j \cdot \mathbf{E}_i)\mathbf{E}_i}{|\mathbf{X}_j - \sum_{i=1}^{j-1} (\mathbf{X}_j \cdot \mathbf{E}_i)\mathbf{E}_i|},\; j=1,\dots,n
$$

For eahc $j=1,\dots,n$ and each $\mathbf{p}\in U$, then $X_j|_\mathbf{p}\notin \operatorname{span}(\mathbf{E}_1|_\mathbf{p},\dots,\mathbf{E}_{j-1}|_\mathbf{p})$, so the denominator above is a nowhere-vanishing smooth function on $U$. Thus, this formula defines $(\mathbf{E}_i)_{i=1}^n$ as a smooth orthonormal frame on $U$.
</details>
</MathBox>

## Vector fields as derivations of $C^\infty (M)$

Vector fields define operators on the space of smooth real-valued functions. Let $M$ be a smooth manifold with or without boundary. If $\mathbf{X}\in\mathfrak{X}(M)$ and $f\in C^\infty (U)$ is a smooth real-valued function defined on an open subset $U\subseteq M$, we obtain a new function $Xf:U\to\R$ defined By

$$
  (Xf)(\mathbf{p}) = \mathbf{\mathbf{X_p}}f
$$

In particular, for any open subset $V \subseteq U$

$$
  (Xf)|_V = X(f|_V)
$$

<MathBox title='Smoothness criterion for vector fields' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $X:M\to TM$ be a rough vector field. The following are equivalent:
1. $\mathbf{X}$ is smooth
2. for every $f\in C^\infty (M)$, the function $Xf$ is smooth on $M$
3. for every open subset $U\subseteq M$ and every $f\in C^\infty (M)$, the function $Xf$ is smooth on $U$

<details>
<summary>Proof</summary>

**(1)** $\implies$ **(2)**<br/>
Assume $\mathbf{X}$ is smooth, and let $f\in C^\infty(M)$. For any $\mathbf{p}\in M$, we can choose smooth coordinates $(x^i)$ on a neighbourhood $U$ of $\mathbf{p}$. Then for $\mathbf{x}\in U$, we can write

$$
  Xf(\mathbf{x}) = \left( X^i(\mathbf{x})\left.\frac{\partial}{\partial x^i}\right|_\mathbf{x} \right)f = X^i(\mathbf{x})\frac{\partial f}{\partial x^i}(\mathbf{x})
$$

Since the component functions $X^i$ are smooth on $U$, if follows that $Xf$ is smooth in $U$. Since the same is true in a neighbourhood of each point, $Xf$ is smooth on $M$.

**(2)** $\implies$ **(3)**<br/>
Suppose $U\subseteq M$ is open and $f\in C^\infty (U)$. For any $\mathbf{p}\in U$, let $\psi$ be a smooth bump function that is equal to $1$ in a neighbourhood of $\mathbf{p}$ and supported in $U$, and define $\tilde{f} = \psi f$, extended to be zero on $M\setminus\operatorname{supp}(\psi)$. Then $X\tilde{f}$ is smooth by assumption, and is equal to $Xf$ in a neighbourhood of $\mathbf{p}$. This shows that $Xf$ is smooth in a neighbourhood of each point of $U$.

**(3)** $\implies$ **(1)**<br/>
Suppose $Xf$ is smooth whenever $f$ is smooth on an open subset of $M$. If $(x^i)$ are any smooth local coordinates on $U\subseteq M$, we can think of each coordinate $x^i$ as a smooth function on $U$. Applying $\mathbf{X}$ to one of these functions, we obtain

$$
  Xx^i = X^j \frac{\partial}{\partial x^j}(x^i) = X^i
$$

Because $Xx^i$ is smooth by assumption, it follows that the component functions of $\mathbf{X}$ are smooth, so $\mathbf{X}$ is smooth.
</details>
</MathBox>

<MathBox title='Vector fields are derivations' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary. A map $D:C^\infty(M) \to C^\infty(M)$ is a derivation if and only if it is of the form $Df = Xf$ for some smooth vector field $\mathbf{X}\in\mathfrak{X}(M)$.

<details>
<summary>Proof</summary>

A smooth vector field $\mathbf{X}\in\mathfrak{X}(M)$ defines a map from $C^\infty(M)$ to itself by $f\mapsto Xf$. This map is clearly linear over $\R$ and satisfies the product rule

$$
\begin{align*}
  (Xfg)(\mathbf{p}) =& \mathbf{\mathbf{X_p}}(fg) = \left(X^i (\mathbf{p})\left.\frac{\partial }{\partial x^i}\right|_\mathbf{p}\right)fg \\
  =& X^i (\mathbf{p}) \frac{\partial fg}{\partial x^i} (\mathbf{p}) \\
  =& X^i (\mathbf{p}) \left(f(\mathbf{p})\frac{\partial g}{\partial x^i}(\mathbf{p}) +  g(\mathbf{p}) \frac{\partial f}{\partial x^i}(\mathbf{p}) \right) \\
  =& f(\mathbf{p}) X^i (\mathbf{p})\frac{\partial g}{\partial x^i}(\mathbf{p}) + g(\mathbf{p}) X^i (\mathbf{p})\frac{\partial f}{\partial x^i}(\mathbf{p}) \\
  =& f(\mathbf{p}) \mathbf{\mathbf{X_p}}g + g(\mathbf{p})\mathbf{\mathbf{X_p}} f
\end{align*}
$$

showing that that $\mathbf{X}$ induces a derivation.

Conversely, suppose $D:C^\infty (M)$. We need to construct a vector field $\mathbf{X}$ such that $Df = Xf$ for all $f$. If there is such a vector field, its value at $\mathbf{p}$ must be the derivation at $\mathbf{p}$ whose action on any smooth real-valued function $f\in C^\infty(M)$ is given by

$$
  \mathbf{\mathbf{X_p}}f = (Df)(\mathbf{p})
$$

The linearity of $D$ guarantees that this expression depends linearly on $f$, and the fact that $D$ is a derivation yields the product rule for tangent vectors. Thus, the map $\mathbf{\mathbf{X_p}}:C^\infty(M) \to\R$ so defined is indeed a tangent vector, i.e. a derivation of $C^\infty(M)$ at $\mathbf{p}$. This defines $\mathbf{X}$ as a rough vector field. Because $Xf = DF$ is smooth whenever $f\in C^\infty (M)$, this vector field is smooth.
</details>
</MathBox>

## Vector fields and smooth maps

<MathBox title='Related vector fields' boxType='definition'>
Let $M$ and $N$ be smooth manifolds with or without boundary. Suppose $F:M\to N$ is smooth and that $\mathbf{X}$ is a vector field on $M$. If there is a vector field $\mathbf{Y}$ on $N$ such that $\d F_\mathbf{p}(\mathbf{\mathbf{X_p}}) = \mathbf{Y}_{F(\mathbf{p})}$ for each $\mathbf{p}\in M$, we say that $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related. 
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $F$ is a smooth map between manifolds with or without boundary, $\mathbf{X}\in\mathfrak{X}(M)$, and $\mathbf{Y}\in\mathfrak{X}(N)$. Then $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related if and only if for every smooth real-valued function $f$ defined on an open subset of $N$

$$
  \mathbf{X}(f\circ F) = (\mathbf{Y}f) \circ F
$$

<details>
<summary>Proof</summary>

For any $\mathbf{p}\in M$ and any smooth real-value $f$ defined in a neighbourhood of $F(\mathbf{p})$

$$
  \mathbf{X}(f\circ F)(\mathbf{p}) = \mathbf{X_p}(f\circ F) = \d F_\mathbf{p}(\mathbf{\mathbf{X_p}})f
$$

while

$$
  (\mathbf{Y}f)\circ F(\mathbf{p}) = (\mathbf{Y}f)(F(\mathbf{p})) = \mathbf{Y}_{F(\mathbf{p})}f
$$

Thus, the first expression is true for all $f$ if and only if $\d F_\mathbf{p}(\mathbf{\mathbf{X_p}}) = \mathbf{Y}_{F(\mathbf{p})}$ for all $\mathbf{p}\in M$, i.e. if and only if $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related.
</details>
</MathBox>

<MathBox title='Existence of unique related vector fields' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds with or without boudary, and $F:M\to N$ is a diffeomorphism. For every $\mathbf{X}\in\mathfrak{X}(M)$, there is a unique smooth vector field on $N$ that is $F$-related to $\mathbf{X}$.

<details>
<summary>Proof</summary>

For $Y\in\mathfrak{X}(N)$ to be $F$-related to $\mathbf{X}$ means that $\d F_\mathbf{p}(\mathbf{\mathbf{X_p}}) = \mathbf{Y}_{F(\mathbf{p})}$ for every $\mathbf{p}\in M$. If $F$ is a diffeomorphism, therefore, we define $\mathbf{Y}$ by

$$
  Y_\mathbf{q} = \d F_{F^{-1}(\mathbf{q})}(X_{F^{-1}(\mathbf{q})})
$$

It is clear that $\mathbf{Y}$, so defined, is the unique (rough) vector field that is $F$-related to $\mathbf{X}$. Note that $Y:N\to TN$ is the composition of the following smooth maps:

$$
  N \xrightarrow{F^{-1}} M \xrightarrow{X} TM \xrightarrow{\d F} TN 
$$

It follows that $\mathbf{Y}$ is smooth.
</details>
</MathBox>

Let $F:M\to N$ be a diffeomorphism between smooth manifolds and consider a vector field $\mathbf{X}\in\mathfrak{X}(M)$. The unique vector field that is $F$-related to $\mathbf{X}$ is usually denoted $F_* X$ and is called the *pushforward* of $\mathbf{X}$ by $F$. The $F$-related vector $F_* X$ is explicitly defined By

$$
  (F_* X)_\mathbf{q} = \d F_{F^{-1}(\mathbf{q})} (X_{F^{-1}(\mathbf{q})})
$$

<MathBox title='' boxType='corollary'>
Suppose $F:M\to N$ is a diffeomorphism and $\mathbf{X}\in\mathfrak{X}(M)$. For any $f\in C^\infty(N)$

$$
  ((F_* X)f) \circ F = X(f\circ F)
$$
</MathBox>

## Vector fields and submanifolds

<MathBox title='Tangent vector field' boxType='definition'>
Let $S\subseteq M$ be an immersed or embedded submanifold (with or without boundary). Given a point $\mathbf{p}\in S$, a vector field $\mathbf{X}\in\mathfrak{X}(M)$ is *tangent* to $S$ at $\mathbf{p}$ if $\mathbf{\mathbf{X_p}}\in T_\mathbf{p}S \subseteq T_\mathbf{p}M$. It is tangent to $S$ if it is tangent to $S$ at every point of $S$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth manifold, $S\subseteq M$ be an embedded submanifold with or without boundary, and let $\mathbf{X}\in\mathfrak{X}$ be a smooth vector field on $M$. Then $\mathbf{X}$ is tangent to $S$ if and only if $(Xf)|_S = 0$ for every $f\in C^\infty (M)$ such that $f|_S \equiv 0$.

<details>
<summary>Proof</summary>

This follows directly from the characterizing property of tangent spaces to embedded submanifolds.
</details>
</MathBox>

<MathBox title='Restricting vector fields to submanifolds' boxType='proposition'>
Let $M$ be a smooth manifold, $S\subseteq M$ be an immersed submanifold with or without boundary, and let $\iota:S\hookrightarrow M$ denote the inclusion map. If $\mathbf{Y}\in\mathfrak{X}(M)$ is tangent to $S$, then there is a unique smooth vector field on $S$, denoted by $\mathbf{Y}|_S$, that is $\iota$-related to $\mathbf{Y}$.

<details>
<summary>Proof</summary>

The fact that $\mathbf{Y}$ is tangent to $S$ means by definition that $\mathbf{Y_p}$ is in the image of $\d\iota_\mathbf{p}$ for each $\mathbf{p}\in S$. Thus, for each $\mathbf{p}$ there is a vector $\mathbf{\mathbf{X_p}} \in T_\mathbf{p}S$ such that $\mathbf{Y_p} = \d\iota_\mathbf{p}(\mathbf{\mathbf{X_p}})$. Since $\d\iota_\mathbf{p}$ is injective, $\mathbf{\mathbf{X_p}}$ is unique, so this defines $\mathbf{X}$ as a rough vector field on $S$. If we can show that $\mathbf{X}$ is smooth, it is the unique vector field that is $\iota$-related to $\mathbf{Y}$. It suffices to show that it is smooth in a neighbourhood of each point.

Let $\mathbf{p}$ be any point in $S$. Since an immersed submanifold (with or without boundary) is locally embedded, there is a neighbourhood $V$ of $\mathbf{p}$ in $S$ that is embedded in $M$. Let $(U, (x^i))$ be a slice chart (or boundary slice chart) for $V$ in $M$ centered at $\mathbf{p}$, so that $V\cap U$ is the subset where $x^{k+1} = \cdots = x^n = 0$ (and $x^k \geq 0$ if $\partial S$), and $(x^1,\dots,x^k)$ for local coordinates for $S$ in $V \cap U$. If $Y = \sum_{i=1}^n Y^i \frac{\partial}{\partial x^i}$ in these coordinates it follows from our construction that $\mathbf{X}$ has the coordinate representation $Y = \sum_{i=1}^k Y^i \frac{\partial}{\partial x^i}$, which is clearly smooth on $V \cap U$.
</details>
</MathBox>

## Lie brackets

<MathBox title='Lie bracket' boxType='definition'>
Let $\mathbf{X},\mathbf{Y}\in\mathfrak{X}(M)$ be smooth vector fields on a smooth manifold $M$. The *Lie bracket* of $\mathbf{X}$ and $\mathbf{Y}$ is an operator $[\mathbf{X},\mathbf{Y}]:C^\infty (M) \to C^\infty(M)$ defined by

$$
  [\mathbf{X},\mathbf{Y}]f = \mathbf{XY}f - \mathbf{YX}f
$$
</MathBox>

<MathBox title='Lie bracket is a smooth vector field' boxType='lemma'>
The Lie bracket of any pair of smooth vector fields is a smooth vector field.

<details>
<summary>Proof</summary>

It suffices to show that $[\mathbf{X},\mathbf{Y}]$ is a derivation of $C^\infty(M)$. For arbitrary $f,g\in C^\infty (M)$ we get

$$
\begin{align*}
  [\mathbf{X},\mathbf{Y}](fg) =& X(Y(fg)) - Y(X(fg)) \\
  =& X(fYg + g\mathbf{Y}f) - Y(f\mathbf{X}g + gXf) \\
  =& \cancel{XfYg} + f\mathbf{X}Yg + \cancel{Xg\mathbf{Y}f} + gX\mathbf{Y}f \\
  &- \bcancel{\mathbf{Y}f\mathbf{X}g} - fYXg - YgXf - \bcancel{g\mathbf{Y}Xf} \\
  =& f\mathbf{X}Yg + gX\mathbf{Y}f - fYXg - g\mathbf{Y}Xf \\
  =& f[\mathbf{X},\mathbf{Y}]g + g[\mathbf{X},\mathbf{Y}]f
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Coordinate formula for the Lie bracket' boxType='proposition'>
Let $\mathbf{X},\mathbf{Y}\in\mathfrak{X}(M)$ be smooth vector fields on a smooth manifold $M$ with or without boundary. The value of the vector field $[X, Y]$ at a point $\mathbf{p}\in M$ is the derivation at $\mathbf{p}$ given by

$$
  [\mathbf{X},\mathbf{Y}]_\mathbf{p} f = \mathbf{\mathbf{X_p}} (\mathbf{Y}f) - \mathbf{Y_p}(Xf)
$$

Let $\mathbf{X} = X^i \boldsymbol{\partial}_i$ and $\mathbf{Y} = Y^j \boldsymbol{\partial}_j$ be the coordinate expression for $\mathbf{X}$ and $\mathbf{Y}$ in terms of some smooth local coordinates $(x^i)$ for $M$. Then $[\mathbf{X},\mathbf{Y}]$ has the following coordinate expression

$$
  [\mathbf{X},\mathbf{Y}] = \left( X^i \frac{\partial Y^j}{\partial x^i} - Y^i \frac{\partial X^j}{\partial x^i} \right)\frac{\partial}{\partial x^j}
$$

or more concisely,

$$
  [\mathbf{X},\mathbf{Y}] = (\mathbf{X}Y^j - \mathbf{Y}X^j)\frac{\partial}{\partial x^j}
$$

<details>
<summary>Proof</summary>

Since $[\mathbf{X},\mathbf{Y}]$ is a smooth vector field, its action on a function $f\in C^\infty (M)$ is determined locally. For any $U\subseteq M$ we have $([\mathbf{X},\mathbf{Y}]f)|_U = [\mathbf{X},\mathbf{Y}](f|_U)$. Thus it suffices to compute in a single smooth chart, where we have

$$
\begin{align*}
  [\mathbf{X},\mathbf{Y}]f =& X^i \frac{\partial}{\partial x^i}\left( Y^j \frac{\partial f}{\partial x^j} \right) - Y^j \frac{\partial }{\partial x^j} \left(  X^i \frac{\partial f}{\partial x^i} \right) \\
  =& X^i \frac{\partial Y^j}{\partial x^i} \frac{\partial f}{\partial x^j} + \cancel{X^i Y^j \frac{\partial^2 f}{\partial x^i \partial x^j}} \\
  &- Y^j \frac{\partial X^i}{\partial x^j}\frac{\partial f}{\partial x^i} - \cancel{Y^j X^i \frac{\partial^2 f}{\partial x^j \partial x^i}} \\
  =& X^i \frac{\partial Y^j}{\partial x^i}\frac{\partial f}{\partial x^j} - Y^j \frac{\partial X^i}{\partial x^j} \frac{\partial f}{\partial x^i} \\
  =& X^i \frac{\partial Y^j}{\partial x^i}\frac{\partial f}{\partial x^j} - Y^i \frac{\partial X^j}{\partial x^i} \frac{\partial f}{\partial x^j} \\
  =& \left( X^i \frac{\partial Y^j}{\partial x^i} - Y^i \frac{\partial X^j}{\partial x^i} \right)\frac{\partial f}{\partial x^j}
\end{align*}
$$
</details>
</MathBox>

Note that for coordinate vector fields $(\partial/\partial x^i)$ in any smooth chart $(U, (x^i)_{i=1}^n)$ on an $n$-manifold $M$, the Lie bracket is trivially

$$
  \left[\frac{\partial}{\partial x^i}, \frac{\partial}{\partial x^j} \right] = \frac{\partial^2 }{\partial x^i x^j} - \frac{\partial^2}{\partial x^j x^i} \equiv 0,\; \forall i,j = 1,\dots,n
$$

because the components functions of the coordinate vector fields are constants. This is also a restatement of the fact that mixed partial derivatives of smooth functions commute.

<MathBox title='Properties of the Lie bracket' boxType='proposition'>
The Lie bracket satisfies the following identities for all $\mathbf{X},\mathbf{Y},\mathbf{Z}\in\mathfrak{X}(M)$:
1. **Bilinearity:** For $a,b\in\R$:
    - $[a\mathbf{X} + b\mathbf{Y}, \mathbf{Z}] = a[\mathbf{X},\mathbf{Z}] + b[\mathbf{Y},\mathbf{Z}]$
    - $[Z, a\mathbf{X} + b\mathbf{Y}] = a[\mathbf{Z},\mathbf{X}] + b[Z,Y]$
2. **Antisymmetry:** $[\mathbf{X},\mathbf{Y}] = - [\mathbf{Y},\mathbf{X}]$
3. **Jacobi identity:** 
$$
  [\mathbf{X},[\mathbf{Y},\mathbf{Z}]] + [\mathbf{Y},[\mathbf{Z},\mathbf{X}]] + [\mathbf{Y},[\mathbf{X},\mathbf{Y}]] = 0
$$
4. For $f,g\in C^\infty(M)$:
$$
  [f\mathbf{X}, g\mathbf{Y}] = fg[\mathbf{X},\mathbf{Y}] + (f\mathbf{X}g)Y - (g\mathbf{Y}f)X
$$

<details>
<summary>Proof</summary>

Bilinearity and antisymmetry are obvious consequences of the definition. The proof of the Jacobi identity is just a computation

$$
\begin{align*}
  &[\mathbf{X},[\mathbf{Y},\mathbf{Z}]]f + [\mathbf{Y},[\mathbf{Z},\mathbf{X}]]f + [\mathbf{Z},[\mathbf{X},\mathbf{Y}]]f \\
  =& \mathbf{X}[\mathbf{Y},\mathbf{Z}]f - [\mathbf{Y},\mathbf{Z}]\mathbf{X}f + \mathbf{Y}[\mathbf{Z},\mathbf{X}]f \\
  &- [\mathbf{Z},\mathbf{X}]\mathbf{Y}f + \mathbf{Z}[\mathbf{X},\mathbf{Y}]f - [\mathbf{X},\mathbf{Y}]\mathbf{Z}f \\
  =& \color{red}{\mathbf{XYZ}f} \color{green}{-\mathbf{XZY}f} \color{blue}{-\mathbf{YZX}f} \color{cyan}{+\mathbf{ZYX}f} \color{blue}{+\mathbf{YZX}f} \color{orange}{-\mathbf{YXZ}f} \\
  & \color{magenta}{-\mathbf{ZXY}f} \color{green}{+\mathbf{XZY}f} \color{magenta}{+\mathbf{ZXY}f} \color{cyan}{-\mathbf{ZYX}f} \color{red}{-\mathbf{XYZ}f} \color{orange}{+\mathbf{YXZ}f} \\
  =& 0
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Naturality of the Lie brackets' boxType='proposition'>
Let $F:M\to N$ be a smooth map between manifolds with or without boundary, and let $X_1, X_2\in \mathfrak{X}(X)$ and $Y_1, Y_2\in\mathfrak{X}(N)$ be vector fields such that $X_i$ is $F$-related to $Y_i$ for $i=1,2$. Then $[X_1, X_2]$ is $F$-related to $[Y_1, Y_2]$.

<details>
<summary>Proof</summary>

Since $X_i$ and $Y_i$ are $F$-related

$$
\begin{align*}
  X_1 X_2 (f\circ F) =& X_1((X_2f) \circ F) \\
  =& (Y_1 Y_2 f) \circ F
\end{align*}
$$

Similarly,

$$
  X_2 X_1 (f\circ F) = (Y_2 Y_1 f) \circ F
$$

Thus,

$$
\begin{align*}
  [X_1, X_2](f\circ F) =& X_1 X_2 (f\circ F) - X_2 X_1 (f\circ F) \\
  =& (Y_1 Y_2 f) \circ F - (Y_2 Y_1 f)\circ F \\
  =& ([Y_1, Y_2]f)\circ F
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Pushforwards of Lie brackets' boxType='corollary'>
Suppose $F:M\to N$ is a diffeomorphism and $X_1, X_2 \in\mathfrak{X}(M)$. Then $F_*[X_1, X_2]= [F_* X_1, F_* X_2]$.

<details>
<summary>Proof</summary>

This is just a special case of the naturality of the Lie bracket in which $F$ is a diffeomorphism and $Y_i = F_* X_i$ for $i=1,2$.
</details>
</MathBox>

<MathBox title='Bracket of vector fields tangent to submanifolds' boxType='corollary'>
Let $M$ be a smooth manifold and let $S\subseteq M$ be an immersed submanifold with or without boundary in $M$. If $Y_1$ and $Y_2$ are smooth vector fields on that are tangent to $S$, then $[Y_1, Y_2]$ is also tangent to $S$.

<details>
<summary>Proof</summary>

There exist smooth vector fields $X_1$ and $X_2$ on $S$ such that $X_i$ is $\iota$-related to $Y_i$ for $i=1,2$, where $\iota:S\hookrightarrow M$ is the inclusion. By the naturality of the Lie bracket, $[X_1,X_2]$ is $\iota$-related to $[Y_1, Y_2]$, which is therefore tangent to $S$.
</details>
</MathBox>

## The Lie algebra of a Lie group

<MathBox title='Left-invariant vector field' boxType='definition'>
Suppose $G$ is a Lie group. A vector field $\mathbf{X}$ on $G$ is *left-invariant* if it is invariant under all left translation, in the sense that it is $L_g$-related to itself for every $g\in G$:

$$
  \d(L_g)_{g'}(X_{g'}) = X_{gg'},\; \forall g,g'\in G
$$

Since $L_g$ is a diffeomorphism, this can be abbreviated as $(L_g)_* X = X$ for every $g\in G$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $G$ be a Lie group, and suppose $\mathbf{X}$ and $\mathbf{Y}$ are smooth left-invariant vector fields on $G$. Then $[\mathbf{X},\mathbf{Y}]$ is also left-invariant.

<details>
<summary>Proof</summary>

Let $g\in G$ be arbitrary. Since $(L_g)_* X = X$ and $(L_g)_* Y = Y$ by definition of left-invariance, it follows from the pushforward property of Lie brackets that

$$
  (L_g)_* [\mathbf{X},\mathbf{Y}] = [(L_g)_* X, (L_g)_* Y] = [X, Y]
$$

Thus, $[\mathbf{X},\mathbf{Y}]$ is $L_g$-related to itself for each $g$, meaning that it is left-invariant.
</details>
</MathBox>

<MathBox title='Lie algebra' boxType='definition'>
A *Lie algebra* over $\R$ is a real vector space $\mathfrak{g}$ endowed with a map called the *bracket* from $\mathfrak{g}\times\mathfrak{g}$ to $g$, denoted by $(\mathbf{X}, \mathbf{Y})\mapsto [\mathbf{X},\mathbf{Y}]$, that satisfies the following properties for all $X,Y,Z\in\mathfrak{g}$:
1. **Bilinearity:** For $a,b\in\R$:
    - $[a\mathbf{X} + b\mathbf{Y}, Z] = a[\mathbf{X},\mathbf{Z}] + b[\mathbf{Y},\mathbf{Z}]$
    - $[Z, a\mathbf{X} + b\mathbf{Y}] = a[\mathbf{Z},\mathbf{X}] + b[Z,Y]$
2. **Antisymmetry:** $[\mathbf{X},\mathbf{Y}] = - [\mathbf{Y},\mathbf{X}]$
3. **Jacobi identity:** 
$$
  [X,[\mathbf{Y},\mathbf{Z}]] + [Y,[\mathbf{Z},\mathbf{X}]] + [Z,[\mathbf{X},\mathbf{Y}]] = 0
$$

A linear subspace $\mathfrak{h}\subseteq\mathfrak{g}$ is called a *Lie subalgebra of* $\mathfrak{g}$ if it is closed under brackets. In this case $\mathfrak{h}$ is itself a Lie algebra with the restriction of the same bracket.

If $\mathfrak{g}$ and $\mathfrak{h}$ are Lie algebras, a linear map $A:\mathfrak{g}\to\mathfrak{h}$ is called a *Lie algebra homomorphism* if it preserves bracket: $A[\mathbf{X},\mathbf{Y}] = [AX, AY]$. An invertible Lie algebra homomorphism is called a *Lie algebra isomorphism*. If there exists a Lie algebra isomorphism from $\mathfrak{g}$ to $\mathfrak{h}$, then they are *isomorphic* as Lie algebras.

The Lie algebra of all smooth left-invariant vector fields on a Lie group $G$ is called the Lie algebra of $G$ and is denoted $\mathrm{Lie}(G)$. A local or global frame consisting of left-invariant vector fields is called a *left-invariant frame*.
</MathBox>

<MathBox title='' boxType='theorem'>
Let $G$ be a Lie group. The evaluation map $\varepsilon: \mathrm{Lie}(G)\to T_e G$ given by $\varepsilon(X) = \mathbf{X}_e$ is a vector space isomorphism. Thus, $\mathrm{Lie}(G)$ is finite-dimensional, with $\dim(\mathrm{Lie}(G)) = \dim(G)$.

<details>
<summary>Proof</summary>

It is clear from the definition that $\varepsilon$ is linear over $\R$. First, we show that $\varepsilon$ is injective. If $\varepsilon(X) = \mathbf{X}_e = 0$ for some $X\in\mathrm{Lie}(G)$, the left-invariance of $\mathbf{X}$ implies that $\mathbf{X}_g = \d(L_g)_e(\mathbf{X}_e) = 0$ for every $g\in G$, so $X = 0$.

To show that $\varepsilon$ is surjective, let $\mathbf{v}\in T_e G$ be arbitrary, and define a (rough) vector field $\mathbf{v}^\mathrm{L}$ on $G$ by

$$
  \mathbf{v}^{\mathbf{L}}|_g = \d(L_g)_e(\mathbf{v})
$$

If there is a left-invariant vector field on $G$ whose value at the identity is $\mathbf{v}$, clearly it has to be given by this formula.

First we need to check that $\mathbf{v}^\mathrm{L}$ is smooth. It suffices to show that $\mathbf{v}^\mathrm{L}f$ is smooth whenever $f\in C^\infty(G)$. Choose a smooth curve $\gamma:(-\delta,\delta)\to G$ such that $\gamma(0) = e$ and $\gamma'(0) = \mathbf{v}$. Then for all $g\in G$,

$$
\begin{align*}
  \left(\mathbf{v}^\mathrm{L} f\right)(g) =& \mathbf{v}^\mathrm{L}|_g f = \d(L_g)_e (\mathbf{v}) f \\
  =& \mathbf{v}(f\circ L_g) = \gamma'(0)(f\circ L_g) \\
  =& \left.\frac{\d}{\d t}\right|_{t=0} (f\circ L_g \circ \gamma)(t)
\end{align*}
$$

If we define $\varphi: (-\delta, \delta)\times G \to\R$ by $\varphi(t, g) = f\circ L_g \circ \gamma(t) = f(g\gamma(t))$, the computation above shows that $\left(\mathbf{v}^\mathrm{L} f\right) = \frac{\partial\varphi}{\partial t}(0,g)$. Because $\varphi$ is a composition of group multiplication, $f$ and $\gamma$, it is smooth. It follows that $\frac{\partial\varphi}{\partial t}(0,g)$ depends smoothly on $g$, so $\mathbf{v}^\mathrm{L}$ is smooth.

Next, we show that $\mathbf{v}^\mathrm{L}$ is left-invariant, which is to say that $\d(L_h)_g \left(\mathbf{v}^\mathrm{L}|_g \right) = \mathbf{v}^\mathrm{L}|_{hg}$ for all $g,h\in G$. This follows from the definition of $\mathbf{v}^\mathrm{L}$ and the fact that $L_h \circ L_g = L_{hg}$:

$$
\begin{align*}
  \d(L_h)_g \left(\mathbf{v}^\mathrm{L}|_g \right) =& \d(L_h)_g \circ \d(L_g)_e (\mathbf{v}) \\
  =& \d(L_h \circ L_g)_e (\mathbf{v}) \\
  =& \d(L_{hg}_e(\mathbf{v})) \\
  =& \mathbf{v}^\mathrm{L}|_{hg}
\end{align*}
$$

Thus, $\mathbf{v}^\mathrm{L}\in\mathrm{Lie}(G)$. Since $L_e$ (left translation by the identity) is the identity map of $G$, it follows that $\varepsilon\left(\mathbf{v}^\mathrm{L}\right) = \mathbf{v}^\mathrm{L}|_e = \mathbf{v}$, so $\varepsilon$ is surjective.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Every left-invariant rough vector field on a Lie group is smooth.

<details>
<summary>Proof</summary>

Let $\mathbf{v}\in T_e G$ be arbitrary, and define a (rough) vector field $\mathbf{v}^\mathrm{L}$ on $G$ by

$$
  \mathbf{v}^{\mathbf{L}}|_g = \d(L_g)_e(\mathbf{v})
$$

Let $\mathbf{X}$ be a left-invariant rough vector field on a Lie group $G$, and let $\mathbf{v} = \mathbf{X}_e$. The fact that $\mathbf{X}$ is left-invariant implies that $X = \mathbf{v}^{\mathbf{L}}$, which is smooth.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Every Lie group admits a left-invariant smooth global fram, and therefore every Lie group is parallelizable.

<details>
<summary>Proof</summary>

If $G$ is a Lie group, every basis for $\mathrm{Lie}(G)$ is a left-invariant smooth global frame for $G$.
</details>
</MathBox>

<MathBox title='Lie algebra of the general linear group' boxType='proposition'>
The composition of the natural maps

$$
  \mathrm{Lie}(\mathrm{GL}(n,\R)) \to T_{I_n}GL(n,\R) \to\mathfrak{gl}(n,\R)
$$

gives a Lie algebra isomorphism between $\mathrm{Lie}(\mathrm{GL}(n,\R))$ and the matrix algebra $\mathfrak{gl}(n,\R)$.

<details>
<summary>Proof</summary>

Using the matrix entries $X_j^i$ as global coordinates on $\mathrm{GL}(n,\R)\subseteq \mathfrak{gl}(n,\R)$, the natural isomorphism $T_{I_n}\mathrm{GL}(n,\R) \cong \mathfrak{gl}(n,\R)$ takes the formal

$$
  A_j^i \left.\frac{\partial}{\partial X_j^i}\right|_{I_n} \leftrightarrow (A_j^i)
$$

Let $\mathfrak{g}$ denote the Lie algebra of $\mathrm{GL}(n,\R)$. Any matrix $A = (A_j^i)\in\mathfrak{gl}(n,\R)$ determines a left-invariant vector field $A^\mathrm{L}\in\mathfrak{g}$ given by

$$
  A^\mathrm{L}|_X = \d(L_X)_{I_n}(A) = \d(L_X)_{I_n}\left( A_j^i \left.\frac{\partial}{\partial X_j^i}\right|_{I_n} \right)
$$

Since $L_X$ is the restriction to $\mathrm{GL}(n,\R)$ of the linear map $A\mapsto XA$ on $\mathfrak{gl}(n,\R)$, its differential is represented in coordinates by exactly the same linear map. In other words, the left invariant vector field $A^\mathrm{L}$ determined by $A$ is the one whose value at $X\in\mathrm{GL}(n,\R)$ is

$$
  A^\mathrm{L}|_X = X_j^i A_k^j \left.\frac{\partial}{\partial X_k^i}\right|_X
$$

Given two matrices $A,B\in \mathfrak{gl}(n,\R)$, the Lie bracket of the corresponding left-invariant vector fields is given by

$$
\begin{align*}
  \left[A^\mathrm{L}, B^\mathrm{L} \right] =& \left[ X_j^i A_k^j\frac{\partial}{\partial X_k^i}, X_q^p B_r^q \frac{\partial}{\partial X_r^p} \right] \\
  =& X_j^i A_k^j \frac{\partial}{\partial X_k^i}\left(X_q^p B_r^q \right) - X_q^p \frac{\partial}{\partial X_r^p}\left( X_j^i A_k^j \right)\frac{\partial}{\partial X_k^i} \\
  =& X_j^i A_k^j B_r^k \frac{\partial}{\partial X_r^i} - X_q^p B_r^q A_k^r \frac{\partial}{\partial X_k^p} \\
  =& \left( X_j^i A_k^j B_r^k - X_j^i B_k^j A_r^k \right)\frac{\partial}{\partial X_r^i}
\end{align*}
$$

where we have use the fact that $\frac{\partial X_q^p}{\partial X_k^i} = \delta_{kq}^{ip}$, and that $A_j^i$ and $B_j^i$ are constants. Evalutating the last expression when $\mathbf{X}$ is equal to the identity matrix we get

$$
  \left[A^\mathrm{L}, B^\mathrm{L} \right] = \left(A_k^i B_r^k - B_k^i A_r^k \right)\left.\frac{\partial}{\partial X_r^i}\right|_{I_n}
$$

This is the vector corresponding to the matrix commutator bracket $[A, B]$. Since the left-invariant vector field $\left[ A^\mathrm{L}, B^\mathrm{L} \right]$ is determined by its value at the idenitity, this implies that

$$
  \left[A^\mathrm{L}, B^\mathrm{L} \right] = [A, B]^\mathbf{L}
$$

which is precisely the statement that the composite map is a Lie algebra isomorphism.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
If $V$ is any finite-dimensional real vector space, the composition of the canonical isomorphisms

$$
  \mathrm{Lie}(\mathrm{GL}(V)) \to T_{\operatorname{id}} \mathrm{GL}{V} \to \mathfrak{gl}(V)
$$

yields a Lie algebra isomorphism between $\mathrm{Lie}(\mathrm{GL}(V))$ and $\mathfrak{gl}(V)$.
</MathBox>

### Induced Lie algebra homomorphisms

<MathBox title='Induced Lie algebra homomorphisms' boxType='theorem'>
Let $G$ and $H$ be Lie groups, and let $\mathfrak{g}$ and $\mathfrak{h}$ be their Lie algebras. Suppose $F:G\to H$ is a Lie group homomorphism. For every $X\in\mathfrak{g}$, there is a unique vector field in $\mathfrak{h}$ that is $F$-related to $\mathbf{X}$. With this vector field denoted by $F_* X$, the map $F_*:\mathfrak{g}\to\mathfrak{h}$ so defined is an induced Lie algebra homomorphism.

<details>
<summary>Proof</summary>

If there is any vector field $\mathbf{Y}\in\mathfrak{h}$ that is $F$-related to $\mathbf{X}$, it must satisfy $\mathbf{Y}_e = \d F_e (\mathbf{X}_e)$, and thus it must be uniquely determined by

$$
  Y = (\d F_d (\mathbf{X}_e))^\mathrm{L}
$$

To that this $\mathbf{Y}$ is $F$-related to $\mathbf{X}$, we note that the fact that $F$ is a homomorphism implies

$$
\begin{align*}
  F(gg') = F(g)F(g') \implies& F(L_g g') = L_{F(g)} F(g') \\
  \implies& F\circ L_g = L_{F(g)} \circ F \\
  \implies& \d F \circ \d(L_g) = \d(L_{F(g)})\circ \d F
\end{align*}
$$

Thus

$$
\begin{align*}
  \d F(\mathbf{X}_g) =& \d F(\d(L_g)(\mathbf{X}_e)) \\
  =& \d(L_{F(g)})(\d F(\mathbf{X}_e)) \\
  =& \d(L_{F(g)})(\mathbf{Y}_e) = \mathbf{Y}_{F(g)}
\end{align*}
$$

This shows that $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related.

For each $\mathbf{X}\in\mathfrak{g}$, let $F_* X$ denote the unique vector field in $\mathfrak{h}$ that is $F$-related to $\mathbf{X}$. It then follows immediately from the naturality of Lie brackets that $F_*[\mathbf{X},\mathbf{Y}] = [F_* X, F_* Y]$, so $F_*$ is a Lie algebra homomorphism.
</details>
</MathBox>

<MathBox title='Properties of induced homomorphisms' boxType='proposition'>
1. The homomorphism $(\operatorname{id}_G)_*: \mathrm{Lie}(G)\to\mathrm{Lie}(G)$ induced by the identity map of $G$ is the identity of $\mathrm{Lie}(G)$.
2. If $F_1: G\to H$ and $F_2:H\to K$ are Lie group homomorphisms, Then
$$
  (F_2 \circ F_1)_* = (F_2)_* \circ (F_1)_*: \mathrm{Lie}(G) \to\mathrm{Lie}(K)
$$
3. Isomorphic Lie groups have isomorphic Lie algebras.

<details>
<summary>Proof</summary>

Both of the relations $\d(\operatorname{id}_G)_e = \operatorname{id}_{T_e G}$ and $\d(F_2 \circ F_1)_e = \d(F_2)_e \circ \d(F_1)_e$ hold for differentials. Since the induced homomorphism is determined by the differential at the identity, this proves **(1)** and **(2)**. If $F:G\to H$ is an isomorphism, **(1)** and **(2)** together imply that 

$$
  F_* \circ (F^{-1})_* = (F\circ F^{-1})_* = \operatorname{id} = (F^{-1})_* \circ F_*
$$

so $F_*:\mathrm{Lie}(G) \to\mathrm{Lie}(H)$ is an isomorphism.
</details>
</MathBox>

### The Lie algebra of a Lie subgroup

<MathBox title='The Lie algebra of a Lie subgroup' boxType='theorem'>
Suppose $H\subseteq G$ is a Lie subgroup, and $\iota:H\hookrightarrow G$ is the inclusion map. There is a Lie subalgebra $\mathfrak{h}\subseteq \mathrm{Lie}(G)$ that is canonically isomorphic to $\mathrm{Lie}(H)$ characterized by either of the following descriptions

$$
\begin{align*}
  \mathfrak{h} =& \iota_* (\mathrm{Lie}(H)) \\
  =& \Set{X\in\mathrm{Lie}(G) | \mathbf{X}_e \in T_e H}
\end{align*}
$$

<details>
<summary>Proof</summary>

Because the inclusion map $\iota:H\hookrightarrow G$ is a Lie group homomorphism, $\iota_*(\mathrm{Lie}(H))$ is a Lie subalgebra of $\mathrm{Lie}(G)$. By definition of the induced Lie algebra homomorphism, this subalgebra is precisely the set of left-invariant vector fields on $G$ whose values at the identity are of the form $\d\iota_e (\mathbf{v})$ for some $\mathbf{v}\in T_e H$. Since the differential $\d\iota_e: T_e H \to T_e G$ is the inclusion of $T_e H$ as a subspace in $T_e G$, the two characterizations of $\mathfrak{h}$ given in the hypothesis are eqial. Since $\d\iota_e$ is injective on $T_e H$, it follows that $\iota_*$ is injective on $\mathrm{Lie}(H)$; since it is surjective by definition of $\mathfrak{h}$, it is an isomorphism between $\mathrm{Lie}(H)$ and $\mathfrak{h}$. 
</details>
</MathBox>

<MathBox title='The Lie algebra of $\mathrm{GL}(n,\mathbb{C})$' boxType='proposition'>
The composition of maps

$$
  \mathrm{Lie}(\mathrm{GL}(n,\mathbb{C})) \xrightarrow{\varepsilon} T_{I_n} \mathrm{GL}(n,\mathbb{C}) \xrightarrow{\psi} \mathfrak{gl}(n,\mathbb{C})
$$

yields a Lie algebra isomorphism between $\mathrm{Lie}(\mathrm{GL}(n, \mathbb{C})$ and the matrix algebra $\mathfrak{gl}(n,\mathbb{C})$.

<details>
<summary>Proof</summary>

The Lie group homomorphism $\beta: \mathrm{GL}(n,\mathbb{C}) \to\mathrm{GL}(2n,\R)$ defined by replacing each complex matrix entry $a + ib$ with the $2\times 2$ skew symmetric block

$$
\begin{bmatrix}
  a & -b \\
  b & a
\end{bmatrix}
$$

induces a Lie algebra homomorphism

$$
  \beta_*: \mathrm{Lie}(\mathrm{GL}(n,\mathbb{C})) \to \mathrm{Lie}(\mathrm{GL}(2n,\R))
$$

Composing $\beta_*$ with the canonical isomorphisms in the hypothesis yields a commutative diagram

$$
\begin{CD}
  \mathrm{Lie}(\mathrm{GL}(n,\mathbb{C})) @>{\varepsilon}>> T_{I_n} \mathrm{GL}(n, \mathbb{C}) @>{\psi}>> \mathfrak{gl}(n,\mathbb{C}) \\
  @V{\beta_*}VV @VV{\d\beta_{I_n}}V @VV{\alpha}V \\
  \mathrm{Lie}(\mathrm{GL}(2n, \R)) @>>{\varepsilon}> T_{I_{2n}}\mathrm{GL}(2n,\R) @>>{\psi}> \mathfrak{gl}(2n,\R)
\end{CD}
$$

in which $\alpha = \varphi\circ\d\beta_{I_n}\circ\varphi^{-1}$. The isomorphisms in the bottom row of the commutative diagram is a Lie algebra isomorphism for $\mathrm{GL}(2n, \R)$. It remains to show that the top row is also a Lie algrebra isomorphism.

It is easy to see that $\beta$ is (the restriction of) a linear. It follows that $\d\beta_{I_n}: T_{I_n} \mathrm{GL}(n,\mathbb{C}) \to T_{I_{2n}} \mathrm{GL}(2n,\R)$ is given by exactly the same formula as $\beta$, as is $\alpha: \mathfrak{gl}(n,\mathbb{C}) \to\mathfrak{gl}(2n,\R)$. Because $\beta(AB) = \beta(A)\beta(B)$, it follows that $\alpha$ preserves matrix commutators

$$
\begin{align*}
  \alpha[A,B] =& \alpha(AB - BA) \\
  =& \alpha(A)\alpha(B) - \alpha(B)\alpha(A) \\
  =& [\alpha(A), \alpha(B)]
\end{align*}
$$

Thus $\alpha$ is an injective Lie algebra homomorphism from $\mathfrak{gl}(n,\mathbb{C})$ to $\mathfrak{gl}(2n,\R)$. Replacing the bottom row of the commutative diagram by the images of the vertical maps, we obtain a commutative diagram of vector space isomorphisms

$$
  \mathrm{Lie}(\mathrm{GL}(n,\mathbb{C})) @>{\cong}>> \mathfrak{gl}(n,\mathbb{C}) \\
  @V{\beta_*}VV @VV{\alpha}V \\
  \beta_* (\mathrm{Lie}(\mathrm{GL}(n,\mathbb{C}))) @>>{\cong}> \alpha(\mathfrak{gl}(n,\mathbb{C}))
$$

in which the bottom map and the two vertical maps are Lie algebra isomorphisms. It follows that the top maps is also a Lie algebra isomorphism.
</details>
</MathBox>

<MathBox title="Ado's theorem" boxType='theorem'>
Every finite-dimensional real Lie algebra admits a faithful finite-dimensional representation.
</MathBox>

<MathBox title='Representation of Lie algebras' boxType='definition'>
If $\mathfrak{g}$ is a finite-dimensional Lie algrebra, a *representation* of $\mathfrak{g}$ is a Lie algebra homomorphism $\varphi:\mathfrak{g}\to\mathfrak{gl}(V)$ for some finite-dimensional vector space $V$, where $\mathfrak{gl}(V)$ denotes the Lie algebra of linear maps from $V$ to itself. If $\varphi$ is injective, it called *faithful*, in which case $\mathfrak{g}$ is isomorphic to the Lie subalgebra $\varphi(\mathfrak{g}) \subseteq\mathfrak{gl}(V) \cong\mathfrak{gl}(n,\R)$.
</MathBox>

<MathBox title='' boxType='corollary'>
Every finite-dimensional real Lie algebra is isomorphic to a Lie subalgebra of some matrix algebra $\mathfrak{gl}(n,\R)$ with the commutator bracket.

<details>
<summary>Proof</summary>

Let $\mathfrak{g}$ be a finite-dimensional real Lie algebra. By Ado's theorem, $\mathfrak{g}$ has a faithful representation $\rho: \mathfrak{g}\to\mathfrak{gl}(V)$ for some finite-dimensional real vector space $V$. Choosing a basis for $V$ yields an isomorphism of $\mathfrak{gl}(V)$ with $\mathfrak{GL}(n,\R)$ for some $n = \dim(V)$, and composing $\rho$ with this isomorphism yields and injective Lie algebra homomorphism from $\mathfrak{g}$ into $\mathfrak{gl}(n,\R)$. Its image is a Lie subalgebra isomorphic to $\mathfrak{g}$.
</details>
</MathBox>

# Integral curves and flows

## Integral curves

<MathBox title='Integral curve' boxType='definition'>
Suppose $M$ is a smooth manifold with or without boundary. If $V$ is a vector field on $M$, an *integral curve* of $V$ is a differentiable curve $\gamma:I\subseteq\R \to M$ whose velocity at each point is equal to the value of $V$ at that point

$$
  \gamma'(t) = V_{\gamma(t)},\; \forall t\in I
$$

If $0\in I$, the point $\gamma(0)$ is called the *starting point* of $\gamma$.

A *maximal integral curve* is one that cannot be extended to an integral curve on any larger open interval.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $V$ be a smooth vector field on a smooth manifold $M$. For each point $\mathbf{p}\in M$, there exists $\varepsilon > 0$ and a smooth curve $\gamma: (-\varepsilon, \varepsilon) \to M$ that is an integral curve of $V$ starting at $\mathbf{p}$.

<details>
<summary>Proof</summary>

This follows from the existence statement of the fundamental theorem of autonomous ordinary differential equations.
</details>
</MathBox>

<MathBox title='Rescaling lemma' boxType='lemma'>
Let $V$ be a smooth vector field on a smooth manifold $M$ and suppose $\gamma:I\subseteq\R \to M$ is an integral curve of $V$. For any $a\in\R$, the curve $\tilde{\gamma}: \tilde{I}\to M$ defined by $\tilde{\gamma}(t) = \gamma(at)$ is an integral curve of the vector field $aV$, where $\tilde{J} = \Set{t | at \in J}$.

<details>
<summary>Proof</summary>

By the chain rule and the fact that $\gamma$ is an integral curve of $V$

$$
\begin{align*}
  \tilde{\gamma}'(t_0) f =& \left.\frac{\d}{\d t}\right|_{t=t_0} (f\circ\tilde{\gamma})(t) \\
  =& \left.\frac{\d}{\d t}\right|_{t=t_0} (f\circ\gamma)(at) \\
  =& a(f\circ\gamma)'(at_0) = a\gamma' (at_0)f \\
  =& aV_{\tilde{\gamma}(t_0)}f 
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Translation lemma' boxType='lemma'>
Let $V$ be a smooth vector field on a smooth manifold $M$ and suppose $\gamma:I\subseteq\R \to M$ is an integral curve of $V$. For any $b\in\R$, the curve $\hat{\gamma}: \hat{I}\to M$ defined by $\hat{\gamma}(t) = \gamma(t + b)$ is an integral curve of the vector field $V$, where $\hat{J} = \Set{t | t+b \in J}$.

<details>
<summary>Proof</summary>

By the chain rule and the fact that $\gamma$ is an integral curve of $V$

$$
\begin{align*}
  \tilde{\gamma}'(t_0) f =& \left.\frac{\d}{\d t}\right|_{t=t_0} (f\circ\tilde{\gamma})(t) \\
  =& \left.\frac{\d}{\d t}\right|_{t=t_0} (f\circ\gamma)(t + b) \\
  =& (f\circ\gamma)'(t_0 + b) = \gamma' (t_0 + b)f \\
  =& V_{\tilde{\gamma}(t_0)}f 
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Naturality of integral curves' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds and let $F:M\to N$ be a smooth map. Then $\mathbf{X}\in\mathfrak{X}(M)$ and $Y\in\mathfrak{X}(N)$ are $F$-related if an only if $F$ takes integral curves of $\mathbf{X}$ to integral curves of $\mathbf{Y}$, meaning that for each integral curve $\gamma$ of $\mathbf{X}$, then $F\circ\gamma$ is an integral curve of $\mathbf{Y}$.

<details>
<summary>Proof</summary>

Suppose first that $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related, and that $\gamma:I\to M$ is an integral curve of $\mathbf{X}$. We define $\sigma:I\to N$ by $\sigma = F\circ\gamma$, then

$$
\begin{align*}
  \sigma'(t) = (F\circ\gamma)'(t) = \d F_{\gamma(t)}(\gamma'(t)) \\
  =& \d F_{\gamma(t)}(X_{\gamma(t)}) = \mathbf{Y}_{F(\gamma(t))} = \mathbf{Y}_{\sigma(t)}
\end{align*}
$$

so $\sigma$ is an integral curve of $F$.

Conversely, suppose $F$ takes integral curves of $\mathbf{X}$ to integral curves of $\mathbf{Y}$. Given $\mathbf{p}\in M$, let $\gamma:(-\varepsilon, \varepsilon) \to M$ be an integral curve of $\mathbf{X}$ starting at $\mathbf{p}$. Since $F\circ\gamma$ is an integral curve of $\mathbf{Y}$ starting at $F(\mathbf{p})$, we have

$$
  \mathbf{Y}_{F(\mathbf{p})} = (F\circ\gamma)'(0) = \d F_\mathbf{p}(\gamma'(0)) = \d F_\mathbf{p}(\mathbf{\mathbf{X_p}})
$$

which shows that $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related.
</details>
</MathBox>

## Flows

<MathBox title='Global flow' boxType='definition'>
Let $M$ be a smooth manifold. A *global flow* on $M$, also called a *one-parameter group action*, is a continuous left $\R$-action on $M$. That is, a continuous map $\theta:\R\times M\to M$ satisfying the following properties for all $s,t\in\R$ and $\mathbf{p}\in M$.
1. $\theta(t, \theta(s,\mathbf{p})) = \theta(t + s,\mathbf{p})$
2. $\theta(0,\mathbf{p}) = \mathbf{p}$

Given a global flow $\theta$ on $M$, we define two collections of maps as follows:
1. For each $t\in\R$, define a continuous map $\theta_t: M\to M$ by
$$
  \theta_t (\mathbf{p}) = \theta(t,\mathbf{p})
$$
The defining properties above are equivalent the the *group laws*
- $\theta_t \circ \theta_s = \theta_{t+s}$
- $\theta_0 = \operatorname{id}_M$

As is the case for any continuous group action, each map $\theta_t: M\to M$ is a homomorphism, and if the flow is smooth, $\theta_t$ is a diffeomorphism.

2. For each $\mathbf{p}\in M$, define a curve $\theta^{(\mathbf{p})}:\R\to M$ by
$$
  \theta^{(\mathbf{p})}(t) = \theta(t,\mathbf{p})
$$
The image of this curve is the orbit of $\mathbf{p}$ under the group action.
</MathBox>

<MathBox title='Infinitesimal generator' boxType='definition'>
Let $M$ be a smooth manifold. If $\theta:\R\times M\to M$ is a smooth global flow, for each $\mathbf{p}\in M$ we define a tangent vector $V_\mathbf{p}\in T_\mathbf{p}M$ by

$$
  V_\mathbf{p} = \theta^{(\mathbf{p})'}(0)
$$

The assignment $\mathbf{p}\mapsto V_\mathbf{p}$ is a (rough) vector field on $M$, called the *infinitesimal generator* of $\theta$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $\theta:\R\times M\to M$ be a smooth global flow on a smooth manifold $M$. The infinitesimal generator $V$ of $\theta$ is a smooth vector field on $M$, and each curve $\theta^{(\mathbf{p})}$ is an integral curve of $V$.

<details>
<summary>Proof</summary>

To show that $V$ is smooth, it suffices to show that $Vf$ is smooth for every $f \in C^\infty(U)$ defined on an open subset $U\subseteq M$. For any such $f$, and any $\mathbf{p}\in U$, note that

$$
\begin{align*}
  Vf(\mathbf{p}) =& V_\mathbf{p}f = \theta^{(\mathbf{p})'}(0)f \\
  =& \left.\frac{\d}{\d t}\right|_{t=0} f(\theta^{(\mathbf{p})}(t)) \\
  =& \left.\frac{\partial}{\partial t}\right|_{(0,\mathbf{p})} f(\theta(t, \mathbf{p}))
\end{align*}
$$

Because $f(\theta(t,\mathbf{p}))$ is a smooth function of $(t,\mathbf{p})$ by composition, so is its partial derivative with respect to $t$. Thus $Vf(\mathbf{p})$ depends smooth on $\mathbf{p}$, so $V$ is smooth.

Next, we need to show that $\theta^{(\mathbf{p})}$ is an integral curve of $V$, which means that $\theta^{(\mathbf{p})'}(t) = V_{\theta^{(\mathbf{p})}(t)}$ for all $\mathbf{p}\in M$ and all $t\in\R$. Let $t_0\in\R$ be arbitrary, and set $\mathbf{q} = \theta^{(\mathbf{p})}(t_0) = \theta_{t_0}(\mathbf{p})$, so what we have to show is $\theta^{(\mathbf{p})'}(t_0) = V_\mathbf{q}$. By the group law, for all $t$

$$
\begin{align*}
  \theta^{(\mathbf{q})} =& \theta_t (\mathbf{q}) = \theta_t (\theta_{t_0}(\mathbf{p})) \\
  =& \theta_{t + t_0}(\mathbf{p}) = \theta^{(\mathbf{p})}(t + t_0)
\end{align*}
$$

Thus, for any smooth real-valued function $f$ defined on a neighbourhood of $\mathbf{q}$

$$
\begin{align*}
  V_\mathbf{q}f =& \theta^{(q)'}(0)f = \left.\frac{\d}{\d t}\right|_{t=0} f(\theta^{(\mathbf{p})}(t)) \\
  =& \left.\frac{\d}{\d t}\right|_{t=0} f(\theta^{(\mathbf{p})}(t + t_0)) \\
  =& \theta^{(\mathbf{p})'}(t_0)f
\end{align*}
$$
</details>
</MathBox>

### The fundamental theorem on flows

<MathBox title='Local flow' boxType='definition'>
If $M$ is a manifold, a *flow domain* for $M$ is an open subset $D\subseteq \R\times M$ with the property that for each $\mathbf{p}\in M$, the set $\mathcal{D}^{(\mathbf{p})} = \Set{t\in\R | (t,\mathbf{p})\in D}$ is an open interval containing $0$. A (local) flow on $M$ is a continuous map $\theta:\mathcal{D}\to M$ where $\mathcal{D}\subseteq \R\times M$ is a flow domain, that satisfies the following group laws for all $\mathbf{p}\in M$: 
1. for all $s\in \mathcal{D}^{(\mathbf{p})}$ and $t\in \mathcal{D}^{(\theta(s,\mathbf{p}))}$ such that $s+t \in \mathcal{D}^{(\mathbf{p})}$
$$
  \theta(t,\theta(s,\mathbf{p})) = \theta(t+s, \mathbf{p})
$$
2. $\theta(0,\mathbf{p}) = \mathbf{p}$

If $\theta$ is a flow, we define $\theta_t (\mathbf{p}) = \theta^{(\mathbf{p})}(t) = \theta(t,\mathbf{p})$ whenever $(t,\mathbf{p})\in \mathcal{D}$. For each $t\in\R$, we also define

$$
  M_t = \Set{\mathbf{p}\in M | (t,\mathbf{p})\in \mathcal{D}}
$$

so that 

$$
  \mathbf{p}\in M_t \iff t\in \mathcal{D}^{(\mathbf{p})} \iff (t,\mathbf{p})\in \mathcal{D}
$$

If $\theta$ is smooth, the *infinitesimal generator* of $\theta$ is defined by $V_\mathbf{p} = \theta^{(\mathbf{p})'}(0)$.

A *maximal flow* is a flow that admits no extension to a flow on a larger flow domain.
</MathBox>

<MathBox title='' boxType='proposition'>
If $\theta:\mathcal{D}\to M$ is a smooth flow, then the infinitesimal generator $V$ of $\theta$ is a smooth vector field, and each curve $\theta^{(\mathbf{p})}$ is an integral curve of $V$.

<details>
<summary>Proof</summary>

This proof is analogous to the proof for global flows. To show that $V$ is smooth, we need only that for any $\mathbf{p}_0 \in M$, then $\theta(t,\mathbf{p})$ is defined and smooth for all $(t,\mathbf{p})$ sufficiently close to $(0,\mathbf{p}_0)$ because $\mathcal{D}$ is open. 

To show that $\theta^{(\mathbf{p})}$ is an integral curve, assume $t_0 \in\mathcal{D}^{(\mathbf{p})}$. Because both $\mathcal{D}^{(\mathbf{p})}$ and $\mathcal{D}^{(\theta_{t_0}(\mathbf{p}))}$ are open intervals containing $0$, there is $\varepsilon > 0$ such that $t + t_0\in \mathcal{D}^{(\mathbf{p})}$ and $t\in \mathcal{D}^{(\theta_{t_0})(\mathbf{p})}$ whenever $|t| < \varepsilon$, and then $\theta_t(\theta_{t_0}(\mathbf{p})) = \theta_{t+t_0}(\mathbf{p})$ by definition of a flow. The rest of the proof goes through just as before.
</details>
</MathBox>

<MathBox title='Fundamental theorem on flows' boxType='theorem'>
Let $V$ be a smooth vector field on a smooth manifold $M$. There is a unique smooth maximal flow $\theta: \mathcal{D}\to M$ whose infinitesimal generator is $V$. This flow has the following properties.
1. For each $\mathbf{p}\in M$, the curve $\theta^{(\mathbf{p})}: \mathcal{D}^{(\theta)}\to M$ is the unique maximal integral curve of $V$ starting at $\mathbf{p}$.
2. If $s\in \mathcal{D}^{(\mathbf{p})}$, then $\mathcal{D}^{(\theta(s,\mathbf{p}))}$ is the interval $\mathcal{D}^{(\mathbf{p})} - s = \Set{t - s | t\in \mathcal{D}^{(\mathbf{p})}}$. 
3. For each $t\in\R$, the set $M_t$ is open in $M$, and $\theta_t : M_t \to M_{-t}$ is a diffeomorphism with inverse $\theta_{-t}$.

<details>
<summary>Proof</summary>

Suppose $\gamma,\tilde{\gamma}:I\subseteq\R\to M$ are two integral curves of $V$ defined on the same open interval $I$ such that $\gamma(t_0) = \tilde{\gamma}(t_0)$ for some $t_0\in J$. Define

$$
  S = \Set{t\in I | \gamma(t) = \tilde{\gamma}(t)}
$$

Clearly, $S \neq\emptyset$, because $t_0\in S$ by hypothesis, and $S$ is closed in $I$ by continuity. On the other hand, suppose $t_1\in S$. Then in a smooth coordinate neighbourhood around the point $\mathbf{p}(t_1)$, it follows that $\gamma$ and $\tilde{\gamma}$ are both solutions to the same ODE with the same initial condition $\gamma(t_1) = \tilde{\gamma}(t_1) = \mathbf{p}$. By the uniqueness part of the fundamental theorem for ordindary differential equations, $\gamma\equiv\tilde{\gamma}$ on an interval containing $t_1$, which implies that $S$ is open in I. Since $I$ is connected, $S = I$, which implies that $\gamma = \tilde{\gamma}$ on all of $I$. Thus, any two integral curves that agree at one point agree on their common domain.

For each $\mathbf{p}\in M$, let $\mathcal{D}^{(\mathbf{p})}$ be the union of all open intervals $I\subseteq\R$ containing $0$ on which an integral curve starting at $\mathbf{p}$ is defined. Define $\theta^{(\mathbf{p})}:\mathcal{D}^{(\mathbf{p})}\to M$ by letting $\theta^{(\mathbf{p})}(t) = \gamma(t)$, where $\gamma$ is any integral curve starting at $\mathbf{p}$ and defined on an open interval containing $0$ and $t$. Since all such integral curves agree at $t$ by the argument above, $\theta^{(\mathbf{p})}$ is well defined, and is obviously the unique maximal integral curve starting at $\mathbf{p}$.

Let $\mathcal{D} = \Set{(t,\mathbf{p})\in\R\times M | t\in \mathcal{D}^{(\mathbf{p})}}$, and defined $\theta:\mathcal{D}\to M$ by $\theta(t,\mathbf{p}) = \theta^{(\mathbf{p})}(t)$. As usual, we also write $\theta_t(\mathbf{p}) = \theta(t,\mathbf{p})$. By definition, $\theta$ satisfies property **(a)**: for each $\mathbf{p}\in M$, the $\theta^{(\mathbf{p})}$ is the unique maximal integral curve of $V$ starting at $\mathbf{p}$. To verify the group laws, fix any $\mathbf{p}\in M$ and $s\in \mathcal{D}^{(\mathbf{p})}$, and write $\mathbf{q} = \theta(s,\mathbf{p}) = \theta^{(\mathbf{p})}(s)$. The curve $\gamma:\mathcal{D}^{(\mathbf{p})} - s \to M$ defined by $\gamma(t) = \theta^{(\mathbf{p})}(t+s)$ starts at $\mathbf{q}$, and the translation lemma shows that $\gamma$ is an integral curve of $V$. By uniqueness of ODE solutions, $\gamma$ agrees with $\theta^{(\mathbf{p})}$ on their common domain, which is equivalent to the composition group law, and the identity group law is immediate from the definition. By maximality of $\theta^{(\mathbf{q})}$, the domain of $\gamma$ cannot be larger than $\mathcal{D}^{(\mathbf{q})}$, which mean that $\mathcal{D}^{(\mathbf{p})} - s \subseteq \mathcal{D}^{(\mathbf{q})}$. Since $0\in \mathcal{D}^{(\mathbf{p})}$, this implies that $-s\in \mathcal{D}^{(\mathbf{q})}$, and the group law implies that $\theta^{(\mathbf{q})}(-s) = \mathbf{p}$. Applying the same argument with $(-s,\mathbf{q})$ in place of $(s,\mathbf{q})$, we find that $\mathcal{D}^{(\mathbf{q})} + s \subseteq \mathcal{D}^{(\mathbf{p})}$, which is the same as $\mathcal{D}^{(\mathbf{q})} \subseteq \mathcal{D}^{(\mathbf{p})} - s$. This proves **(2)**.

Next, we show that $\mathcal{D}$ is open in $\R\times M$ (so it is a flow domain), and that $\theta: \mathcal{D}\to M$ is smooth. Define a subset $W\subseteq \mathcal{D}$ as the set of all $(t,\mathbf{p})\in \mathcal{D}$ such that $\theta$ is defined and smooth on a product neighbourhood of $(t,\mathbf{p})$ of the form $I\times u\subseteq \mathcal{D}$, where $I\subseteq\R$ is open interval containing $0$ and $t$, and $U\subseteq M$ is a neighbourhood of $\mathbf{p}$. Then $W$ is open in $\R\times M$, and the restriction of $\theta$ to $W$ is smooth, so it suffices to show that $W = \mathcal{D}$. Suppose this is not the case. Then there exists some point $(\tau,\mathbf{p})\in \mathcal{D}\setminus W$. For simplicity, assume $\tau > 0$; the argument for $\tau < 0$ is similar.

Let $t_0 = \inf\Set{t\in\R | (t,\mathbf{p}_0)\notin W}$. By the fundamental ODE theorem, $\theta$ is defined an smooth in som product neighbourhood of $(0,\mathbf{p}_0)$, so $t_0 > 0$. Since $t_0 \leq\tau$ and $\mathcal{D}^{(\mathbf{p}_0)}$ is an open interval containing $0$ and $\tau$, it follows that $t_0\in \mathcal{D}^{(\mathbf{p}_0)}$. Let $\mathbf{q}_0 = \theta^{(\mathbf{p}_0)}(t_0)$. By the fundamental ODE theorem, there exists $\varepsilon > 0$ and a neighbourhood $U_0$ of $\mathbf{q}_0$ such that $(-\varepsilon,\varepsilon)\times U_0 \subseteq W$. We will use the group law to show that $\theta$ extends smoothly to a neighbourhood of $(t_0,\mathbf{p})$, which contradicts our choice of $t_0$.

Choose some $t_1 < t_0$ such that $t_1 + \varepsilon > t_0$ and $\theta^{(\mathbf{p}_0)}(t_1) \in U_0$. Since $t_1 < t_0$, we have $(t_1,\mathbf{p}_0)\in W$, and so there is a product neighbourhood $(t_1 -\delta, t_1 + \delta)\times U_1\subseteq W$. By definition of $W$, this implies that $\theta$ is defined and smooth on $[0,t_1 + \delta)\times U_1$. Because $\theta(t_1, \mathbf{p}_0)\in U_0$, we can choose $U_1$ small enough that $\theta$ maps $\Set{t_1}\times U_1$ into $U_0$. Define $\tilde{\theta}:[0,t_1 + \varepsilon)\times U_1\to M$ by

$$
  \tilde{\theta}(t,\mathbf{p}) = \begin{cases}
    \theta_t (\mathbf{p}),\quad& \mathbf{p}\in U_1, 0\leq t < t_1,
    \theta_{t-t_1}\circ\theta_{t_1}(\mathbf{p}),\quad& \mathbf{p}\in U_1, t_1 - \varepsilon < t < t_1 + \varepsilon
  \end{cases}
$$

The group law for $\theta$ guarantees that these definitions agree where they overlap, and out choices of $U_1$, $t_1$ and $\varepsilon$ ensure that this defines a smooth map. By the translation lemma, each map $t\mapsto \tilde{\theta}(t,\mathbf{p})$ is an integral curve of $V$, so $\tilde{\theta}$ is a smooth extension of $\theta$ to a neighbourhood of $(t_0, \mathbf{p}_0)$, contradicting our choice of $t_0$. This completes the proof that $W = \mathcal{D}$.

Finally, we prove **(3)**. The fact that $M_t$ is open is an immediate consequence of the fact that $\mathcal{D}$ is open. From **(2)** we deduce

$$
\begin{align*}
  \mathbf{p}\in M_t \implies& t\in \mathcal{D}^{(\mathbf{p})} \\
  \implies& \mathcal{D}^{(\theta_t(\mathbf{p}))} = \mathcal{D}^{(\mathbf{p})} - t \\
  \implies& -t \in \mathcal{D}^{(\theta_t (\mathbf{p}))} \implies \theta_t(\mathbf{p})\in M_{-t}
\end{align*}
$$

which shows that $\theta_t$ maps $M_t$ to $M_{-t}$. Moreover, the group laws then show that $\theta_{-t}\circ \theta_{t}$ is equal to the identity on $M_t$. Reversing the roles of $t$ and $-t$ shows that $\theta_t \circ\theta_{-t}$ is the identity on $M_{-t}$, completing the proof.
</details>
</MathBox>

<MathBox title='Naturality of flows' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds, $F:M\to N$ is a smooth map, $\mathbf{X}\in\mathfrak{X}(M)$ and $Y\in\mathfrak{X}(N)$. Let $\theta$ be the flow of $\mathbf{X}$ and $\eta$ the flow of $\mathbf{Y}$. If $\mathbf{X}$ and $\mathbf{Y}$ are $F$-related, then for each $t\in\R$, it follows that $F(M_t)\subseteq N_t$ and $\eta_t \circ F = F \circ\theta_t$ on $M_t$

$$
\begin{CD}
  M_t @>{F}>> N_t \\
  @V{\theta_t}VV @VV{\eta_t}V \\
  M_{-t} @>>{F}> N_{-t}
\end{CD}
$$

<details>
<summary>Proof</summary>

By naturality of integral curves, for any $\mathbf{p}\in M$, the curve $F\circ\theta^{(\mathbf{p})}$ is an integral curve of $\mathbf{Y}$ starting at $F\circ\theta^{(\mathbf{p})}(0) = F(\mathbf{p})$. By uniqueness of integral curves, therefore, the maximal integral curve $\eta^{(F(\mathbf{p}))}$ must be defined at least on the interval $\mathcal{D}^{(\mathbf{p})}$, and $F\circ\theta^{(\mathbf{p})} = \eta^{(F(\mathbf{p}))}$ on that interval. This means that

$$
\begin{align*}
  \mathbf{p}\in M_t \implies& t\in \mathcal{D}^{(\mathbf{p})} \implies t\in \mathcal{D}^{(F(\mathbf{p}))} \\
  \implies& F(\mathbf{p}) \in N_t
\end{align*}
$$

which is equivalent to $F(M_t) \subseteq N_t$ and

$$
  F\left(\theta^{(\mathbf{p})}(t) \right) = \eta^{(F(\mathbf{p}))}(t),\; \forall t\in \mathcal{D}^{(\mathbf{p})}
$$

which is equivalent to $\eta_t \circ F(\mathbf{p}) = F\circ\theta_t(\mathbf{p})$ for all $\mathbf{p}\in M_t$.
</details>
</MathBox>

<MathBox title='Diffeomorphism invariance of flows' boxType='corollary'>
Let $F:M\to N$ be a diffeomorphism. If $\mathbf{X}\in\mathfrak{X}(M)$ and $\theta$ is the flow of $\mathbf{X}$, then the flow of $F_* \mathbf{X}$ is $\eta_t = F\circ\theta_t \circ F^{-1}$, with domain $N_t = F(M_t)$ for each $t\in\R$.
</MathBox>

### Complete vector fields

<MathBox title='Complete vector field' boxType='definition'>
A smooth vector field is complete if it generates a global flow, or equivalently, if each of its maximal integral curves is defined for all $t\in\R$.
</MathBox>

<MathBox title='Uniform time lemma' boxType='lemma'>
Let $\mathbf{V}$ be a smooth vector field on a smooth manifold $M$, and let $\theta$ be its flow. Suppose there is $\varepsilon > 0$ such that for every $\mathbf{p}\in M$, the domain of $\theta^{(\mathbf{p})}$ contains $(-\varepsilon,\varepsilon)$. Then $V$ is complete.

<details>
<summary>Proof</summary>

Suppose for the sake of contradiction that for some $\mathbf{p}\in M$, the domain $\mathcal{D}^{(\mathbf{p})}$ of $\theta^{(\mathbf{p})}$ is bounded above (a similar proof works if it is bounded below). Let $b = \sup(D^{(\mathbf{p})})$, let $t_0 > 0$ such that $b - \varepsilon < t_0 < b$, and let $\mathbf{q} = \theta^{(\mathbf{p})}(t_0)$. The hypothesis implies that $\theta^{(\mathbf{q})}(t)$ is defined at least for $t\in(-\varepsilon,\varepsilon)$. Define a curve $\gamma:(-\varepsilon, t_0 + \varepsilon) \to M$ by

$$
  \gamma(t) = \begin{cases}
    \theta^{(\mathbf{p})}(t),\quad& -\varepsilon < t < b
    \theta^{(\mathbf{q})}(t - t_0),\quad& t_0 - \varepsilon < t < t_0 + \varepsilon
  \end{cases}
$$

These two definitions agree where they overlap, because $\theta^{(\mathbf{q})}(t-t_0) = \theta_{t-t_0}(\mathbf{q}) = \theta_{t-t_0}\circ\theta_{t_0}(\mathbf{p}) = \theta_t(\mathbf{p}) = \theta^{(\mathbf{p})(t)}$ by the group law for $\theta$. By the translation lemma, $\gamma$ is an integral curve starting at $\mathbf{p}$. Since $t_0 + \varepsilon > b$, this is a contradiction.
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Every compactly supported smooth vector field on a smooth manifold is complete.

<details>
<summary>Proof</summary>

Suppose $\mathbf{V}$ is a compactly supported vector field on a smooth manifold $M$, and let $K = \operatorname{supp}(V)$. For each $\mathbf{p}\in K$, there is a neighbourhood $U_\mathbf{p}$ of $\mathbf{p}$ and a positive number $\varepsilon_\mathbf{p}$ such that the flow of $\mathbf{V}$ is defined at least on $(-\varepsilon_\mathbf{p}, \varepsilon_\mathbf{p})\times U_\mathbf{p}$. By compactness, finitely many such sets $U_{\mathbf{p}_i},\dots,U_{\mathbf{p}_k}$ cover $K$. With $\varepsilon = \min\Set{\varepsilon_{\mathbf{p}_1},\dots,\varepsilon_{\mathbf{p}_k}}$, it follows that every maximal integral curve starting in $K$ is defined at least on $(-\varepsilon, \varepsilon)$. Since $\mathbf{V} \equiv 0$ outside of $K$, every integral curve starting in $M\setminus K$ is constant and thus can be defined on all of $\R$. Thus the hypotheses of the uniform time lemma are satisfied, so $\mathbf{V}$ is complete.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
On a compact smooth manifold, every smooth vector field is complete.
</MathBox>

<MathBox title='' boxType='theorem'>
Every left-invariant vector field on a Lie group is complete.

<details>
<summary>Proof</summary>

Let $G$ be a Lie group, let $\mathbf{X}\in\mathrm{Lie}(G)$, and let $\theta: \mathcal{D}\to G$ denote the flow of $\mathbf{X}$. There is some $\varepsilon > 0$ such that $\theta^{(e)}$ is defined on $(-\varepsilon, \varepsilon)$.

Let $g\in G$ be arbitrary. Because $\mathbf{X}$ is $L_g$-related to itself, it follows from naturality that the curve $L_g \circ\theta^{(e)}$ is an integral curve of $\mathbf{X}$ starting at $g$ and therefore is equal to $\theta^{(g)}$. This shows that for each $g\in G$, the integral curve $\theta^{(g)}$ is defined at least on $(-\varepsilon, \varepsilon)$, so the uniform time lemma guarantees that $\mathbf{X}$ is complete.
</details>
</MathBox>

<MathBox title='Escape lemma' boxType='lemma'>
Suppose $M$ is a smooth manifold and $\mathbf{V}\in\mathfrak{X}(M)$. If $\gamma:I\subseteq\R\to M$ is a maximal integral curve of $\mathbf{V}$ whose domain $I$ has a finite least upper bound $b$, the for any $t_0 \in I$, $\gamma([t_0, b))$ is not contained in any compact subset of $M$.
</MathBox>

## Flowouts

<MathBox title='Flowout theorem' boxType='theorem'>
Suppose $M$ is a smooth $n$-manifold, $S\subseteq M$ is an embedded $k$-dimensional submanifold, and that $\mathbf{V}\in\mathfrak{X}(M)$ is a smooth vector field that is nowhere tangent to $S$. Let $\theta: D\to M$ be the flow of $V$, let $\mathcal{O} = (\R\times S) \cap D$ and let $\Phi = \theta|_\mathcal{O}$.

1. $\Phi: \mathcal{O}\to M$ is an immersion.
2. $\frac{\partial}{\partial t}\in\mathfrak{X}(\mathcal{O})$ is $\Phi$-related to $V$.
3. There exists a smooth positive function $\delta:S\to\R$ such that the restriction of $\Phi$ to $\mathcal{O}_\delta$ is injective, where $\mathcal{O}_\delta \subseteq \mathcal{O}$ is the flow domain

$$
  \mathcal{O}_\delta = \Set{(t,\mathbf{p})\in \mathcal{O} : \norm{ t } < \delta(\mathbf{p})}
$$

Thus, $\Phi$ is an immersed submanifold of $M$ containing $S$, and $V$ is tangent to this submanifold. The submanifold $\Phi(\mathcal{O}_\delta) \subseteq M$ is called a *flowout* from $S$ along $V$.
4. If $S$ has codimension $1$, then $\Phi|_{\mathcal{O}_\delta}$ is a diffeomorphism onto an open submanifold of $M$.

<details>
<summary>Proof</summary>

**(2):** Fix $\mathbf{p}\in S$, and let $\sigma: \mathcal{D}^{(\mathbf{p})}\to\R\times S$ be the curve $\sigma(t) = (t,\mathbf{p})$. Then $\Phi\circ\sigma(t) = \theta(t,\mathbf{p})$ is an integral curve of $V$, so for any $t_0\in \mathcal{D}^{(\mathbf{p})}$ it follows that

$$
  \d\Phi_{(t_0,\mathbf{p}_0)}\left(\left.\frac{\partial}{\partial t}\right|_{(t_0,\mathbf{p}_0)} \right) = (\Phi\circ\sigma)'(t_0) = V_{\Phi(t_0, \mathbf{p})}
$$

**(1):** The restriction of $\Phi$ to $\Set{0}\times S$ is the composition of the diffeomorphism $\Set{0}\times S \cong S$ with the embedding $S\hookrightarrow M$, so it is an embedding. Thus, the restriction of $\d\Phi_{(0,\mathbf{p})}$ to $T_\mathbf{p}S$ (viewed as a subspace of $T_{(0,\mathbf{p})} \cong T_0 \R \oplus T_\mathbf{p}S$) is the inclusion $T_\mathbf{p}S \hookrightarrow T_\mathbf{p}M$. If $(\mathbf{e}_i)_{i=1}^k$ is any basis for $T_\mathbf{p}S$, it follows that $\d\Phi_{(0,\mathbf{p})}$ maps the basis $\left(\left.\frac{\partial}{\partial t}\right|_{(0,\mathbf{p})},E_1,\dots,E_k \right)$ for $T_{(0,\mathbf{p})} \mathcal{O}$ to $(V_\mathbf{p}, E_1,\dots, E_k)$. Since $V_\mathbf{p}$ is not tangent to $S$, this $(k+1)$-tuple is linearly independent and thus $\d\Phi_{0,\mathbf{p}}$ is injective.

To show that $\d\Phi$ is injective at other points, we argue as in the proof of the equivariant rank theorem. Given $(t_0, \mathbf{p}_0)\in \mathcal{O}$, let $\tau_{t_0}: \mathcal{O}\to\R\times S$ be the translation $\tau_{t_0}(t,\mathbf{p}) = (t + t_0, \mathbf{p})$. By the group law for $\theta$, the following diagram commutes (where the horizontal maps might be defined only in open subsets containing $(0, \mathbf{p}_0)$ and $\mathbf{p}_0$, respectively):

$$
\begin{CD}
  \mathcal{O} @>{\tau_0}>> \mathcal{O} \\
  @V{\Phi}VV @VV{\Phi}V \\
  M @>>{\theta_{t_0}}> M
\end{CD}
$$

Both horizontal maps in the diagram above are local diffeomorphisms. Taking differentials, we obtain

$$
\begin{CD}
  T_{(0,\mathbf{p}_0)}\mathcal{O} @>{\d(\tau_0)_{(0,\mathbf{p}_0)}}>> T_{(t_0,\mathbf{p}_0)}\mathcal{O} \\
  @V{\d\Phi_{(0,\mathbf{p}_0)}}VV @VV{\Phi_{(t_0,\mathbf{p}_0)}}V \\
  T_{\mathbf{p}_0} M @>>{\d(\theta_{t_0})_{\mathbf{p}_0}}> T_{\Phi_{(t_0,\mathbf{p}_0)}}M
\end{CD}
$$

Becaus the horizontal maps are isomorphisms, the two vertical maps have the same rank. Since we have already shown that $\d\Phi_{(0,\mathbf{p}_0)}$ has full rank, so does $\d\Phi_{(t_0,\mathbf{p}_0)}$. This completes the proof that $\Phi$ is an immersion.

**(3):** Given a point $\mathbf{p}_0 \in S$, choose a slice chart $(U,(x^i))$ for $S$ in $M$ centered at $\mathbf{p}_0$, so that $U\cap S$ is the set where $x^{k+1}=\dots=x^n = 0$, where $n = \dim(M)$. Because $V$ is not tangent to $S$, one of the last $n-k$ components of $V_{\mathbf{p}_0}$, say $V^j(\mathbf{p}_0)$ must be nonzero. Shrinking $U$ if necessary, we may assume there is a constant $c > 0$ such that

$$
  \left| V^j(\mathbf{p}) \right| \geq c,\; \forall \mathbf{p}\in U
$$

Since $\Phi^{-1}(U)$ is open in $\R\times S$, we may choose a number $\varepsilon_{\mathbf{p}_0} > 0$ and a neighbourhood $W_{\mathbf{p}_0}$ of $\mathbf{p}_0$ in $S$ such that $(-\varepsilon_{\mathbf{p}_0}, \varepsilon_{\mathbf{p}_0})\times W_{\mathbf{p}_0} \subseteq \mathcal{O}$ and $\Phi\left((-\varepsilon_{\mathbf{p}_0}, \varepsilon_{\mathbf{p}_0})\times W_{\mathbf{p}_0} \right) \subseteq U$. Write the component function of $\Phi$ in these local coordinates as

$$
  \Phi(t,\mathbf{p}) = (\Phi^i(t,\mathbf{p}))_{i=1}^n
$$

Because $\Phi$ is the restriction of the flow, the component function $\Phi^j$ satisfies

$$
  \frac{\partial\Phi^j}{\partial t}(t,\mathbf{p}) = V^j (\Phi(t,\mathbf{p})),\quad V^j(0,\mathbf{p}) = 0
$$

By the inequality above and the fundamental theorem of calculus, $|\Phi^j (t,\mathbf{p})|\geq c|t|$, and thus for $(t,\mathbf{p})\in (-\varepsilon_{\mathbf{p}_0}, \varepsilon_{\mathbf{p}_0})\times W_{\mathbf{p}_0}$ we conclude that $\Phi(t,\mathbf{p})\in S$ if and only if $t = 0$.

Choose a smooth partition of unity $\Set{\psi_\mathbf{p} | \mathbf{p}\in S}$ subordinate to the open cover $\Set{W_\mathbf{p}|\mathbf{p}\in S}$ of $S$ and define $f:S\to\R$ by

$$
  f(\mathbf{q}) = \sum_{\mathbf{p}\in S} \varepsilon_\mathbf{p}\psi_\mathbf{p}(\mathbf{q})
$$

Then $f$ is smooth and positive. For each $\mathbf{q}\in S$, there are finitely many $\mathbf{p}\in S$ such that $\Psi_\mathbf{p}(\mathbf{q}) > 0$. If $\mathbf{p}_0$ is one of these points such that $\varepsilon_{\mathbf{p}_0}$ is maximum among all such $\varphi_\mathbf{p}$, then

$$
  f(\mathbf{q}) \leq \varepsilon_{\mathbf{p}_0}\sum_{\mathbf{p}\in S}\psi_\mathbf{p}(\mathbf{q}) = \varepsilon_{\mathbf{p}_0}
$$

It follows that if $(t,\mathbf{q})\in \mathcal{O}$ such that $|t|< f(\mathbf{q})$, then $(t,\mathbf{q})\in(-\varepsilon_{\mathbf{p}_0},\varepsilon_{\mathbf{p}_0})\times W_{\mathbf{p}_0}$, so $\Phi(t,\mathbf{q})\in S$ if and only if $t=0$.

Let $\delta = \frac{1}{2}f$. We will show that $\Phi|_{\mathcal{O}_\delta}$ is injective. Suppose $\Phi(t,\mathbf{q}) = \Phi(t',\mathbf{q}')$ for some $(t,\mathbf{q}),(t',\mathbf{q}')\in \mathcal{O}_\delta$. By renaming the points if necessary, we may arrange that $f(\mathbf{q}')\leq f(\mathbf{q})$. Our assumption means that $\theta_t (\mathbf{q}) = \theta_{t'}(\mathbf{q}')$, and the group law for $\theta$ then implies that $\theta_{t-t'}(\mathbf{q}) = \mathbf{q}' \in S$. The fact that $(t,\mathbf{q})$ and $(t',\mathbf{q}')$ are in $\mathcal{O}_\delta$ implies that

$$
\begin{align*}
  |t - t'| \tleq& |t| + |t'| \\
  <& \frac{1}{2}f(\mathbf{q}) + \frac{1}{2}f(\mathbf{q}') \leq f(\mathbf{q})
\end{align*}
$$

which forces $t = t'$ and $\mathbf{q} = \mathbf{q}'$.

**(4):** If $S$ has codimension $1$, then $\Phi|_{\mathcal{O}_\delta}$ is an injective smooth immersion between manifolds of the same dimension, so it is an embedding and a diffeomorphism onto an open submanifold.
</details>
</MathBox>

### Regular and singular points

<MathBox title='Regular and singular point' boxType='definition'>
If $V$ is a vector field on a smooth manifold $M$, a point $\mathbf{p}\in M$ is a *singular point* of $V$ if $V_\mathbf{p} = 0$ and a regular point otherwise.
</MathBox>

<MathBox title='Equilibrium point' boxType='definition'>
If $\theta:\mathcal{D}\to M$ is flow on a smooth manifold $M$, a point $\mathbf{p}\in M$ is called an *equilibrium point* of $\theta$ if $\theta(t,\mathbf{p}) = \mathbf{p}$ for all $t\in \mathcal{D}^{(\mathbf{p})}$.
</MathBox>

The following proposition shows that the equilibrium points of a smooth flow are precisely the singular points of its infinitesimal generator.

<MathBox title='' boxType='proposition'>
Let $V$ be a smooth vector field on a smooth manifold $M$, and let $\theta:\mathcal{D}\to M$ be the flow generated by $V$. If $\mathbf{p}\in M$ is a singular point of $V$, then $\mathcal{D}^{(\mathbf{p})} = \R$ and $\theta^{(\mathbf{p})}$ is the constant curve $\theta^{(\mathbf{p})}(t) \equiv \mathbf{p}$. If $\mathbf{p}$ is a regular point, then $\theta^{(\mathbf{p})}: \mathcal{D}^{(\mathbf{p})} \to M$ is a smooth immersion.

<details>
<summary>Proof</summary>

If $V_\mathbf{p} = 0$, then the constant curve $\gamma:\R\to M$ given by $\gamma(t)\equiv\mathbf{p}$ is clearly an integral curve of $V$, so by uniqueness and maximality it must be equal to $\theta^{(\mathbf{p})}$.

To verify the second statement, we proce its contrapositive: if $\theta^{(\mathbf{p})}$ is not an immersion then $\mathbf{p}$ is a singular point. The assumption that $\theta^{(\mathbf{p})}$ is not an immersion means that $\theta^{(\mathbf{p})'}(s) = 0$ for some $s\in \mathcal{D}^{(\mathbf{p})}$. Write $\mathbf{q} = \theta^{(\mathbf{p})}(s)$. Then the preceding argument implies that $\mathcal{D}^{(\mathbf{q})} = \R$ and $\theta^{(\mathbf{q})}(t) = \mathbf{q}$ for all $t\in\R$. If follows from the fundamental theorem on flows that $\mathcal{D}^{(\mathbf{p})} = \R$ as well, and for all $t\in\R$ the group law gives

$$
\begin{align*}
  \theta^{(\mathbf{p})}(t) =& \theta_t(\mathbf{p}) = \theta_{t-s}(\theta_s(\mathbf{p})) \\
  =& \theta_{t-s}(\mathbf{q}) = \mathbf{q}
\end{align*}
$$

Setting $t=0$ yields $\mathbf{p} = \mathbf{q}$, and thus $\theta^{(\mathbf{p})}(t) \equiv\mathbf{p}$ and $V_\mathbf{p} = \theta^{(\mathbf{p})'}(0) = 0$.
</details>
</MathBox>

<MathBox title='Canonical form near a regular point' boxType='theorem'>
Let $V$ be a smooth vector field on a smooth manifold $M$, and let $\mathbf{p}\in M$ be a regular point of $V$. There exist smooth coordinates $(\mathbb{S}^i)$ on some neighbourhood of $\mathbf{p}$ in which $V$ has the coordinate representation $\frac{\partial}{\partial \mathbb{S}^1}$. If $S\subseteq M$ is any embedded hypersurface with $\mathbf{p}\in S$ and $V_\mathbf{p}\in T_\mathbf{p} S$, then the coordinates can also be chosen so that $\mathbb{S}^1$ is alocal defining function for $S$.

<details>
<summary>Proof</summary>

If no hypersurface $S$ is given, choose any smooth coordinates $(U, (x^))$ centered at $p$, and let $S\subseteq U$ be the hypersurface defined by $x^j = 0$, where $j$ is chosen so that $V^j(\mathbf{p}) \neq 0$.

Regardless of whether $S$ was given or was constructed as above, since $V_\mathbf{p} \notin T_\mathbf{p}S$, we can shrink $S$ if necessary so that $V$ is nowhere tangent to $S$. The flowout theorem then says that there is a flow domain $O_\delta \subseteq \R\times S$ such that the flow of $V$ restricts to a diffeomorphism $\Phi$ from $O_\delta$ onto an open subset $W\subseteq M$ containing $S$. There is a product neighbourhood $(-\varepsilon,\varepsilon)\times W_0$ of $(0,\mathbf{p})$ in $O_\delta$. Choose a smooth local parametrization $X:\Omega\to S$ whose image is contained in $W_0$, where $\Omega$ is ano open subset of $\R^{n-1}$ with coordinates denoted by $(\mathbb{S}^2,\dots,\mathbb{S}^n)$. If follows that the map $\Psi:(-\varepsilon, \varepsilon)\times\Omega\to M$ given by

$$
  \Psi(t,\mathbb{S}^2,\dots,\mathbb{S}^n) = \Phi(t, X(\mathbb{S}^2,\dots,\mathbb{S}^n))
$$

is a diffeomorphism onto a neighbourhood of $\mathbf{p}\in M$. Because the diffeomorphism $(t,\mathbb{S}^1,\dots,\mathbb{S}^2)\mapsto (t,X(\mathbb{S}^2,\dots,\mathbb{S}^n))$ pushes $\frac{\partial}{\partial t}$ forward to itself and $\Phi_*\left(\frac{\partial}{\partial t}\right) = V$, it follows that $\Psi_*\left(\frac{\partial}{\partial t} \right) = V$. Thus $\Psi^{-1}$ is a smooth coordinate chart in which $V$ has the coordinate representation $\frac{\partial}{\partial t}$. Renaming $t$ to $\mathbb{S}^1$ completes the proof. 
</details>
</MathBox>

## Flows and flowouts on manifolds with boundary

<MathBox title='Boundary flowout theorem' boxType='theorem'>
Let $M$ be a smooth manifold with nonempty boundary, and let $N$ be a smooth vector field on $M$ that is inward-pointing at each point of $\partial M$. There exist a smooth function $\delta: \partial M\to\R^+$ and a smooth embedding $\Phi: \mathcal{P}_\delta \to M$ where $\mathcal{P}_\delta = \Set{(t,\mathbf{p}) | \mathbf{p}\in\partial M, 0\leq t < \delta(\mathbf{p})} \subseteq \R\times\delta M$ such that $\Phi(\mathcal{P}_\delta)$ is a neighbourhood of $\partial M$, and for each $\mathbf{p}\in\partial M$ the map $t\mapsto \Phi(t,\mathbf{p})$ is an integral curve of $N$ starting at $\mathbf{p}$.
</MathBox>

<MathBox title='Collar neighbourhood' boxType='definition'>
Let $M$ be a smooth manifold with boundary. A neighbourhood of $\partial M$ is called a *collar neighbourhood* if it is the image of a smooth embedding $[0,1)\times\partial M \to M$ that restricts to the obvious idenitfication $\Set{0}\times\partial M\to\partial M$.
</MathBox>

<MathBox title='Collar neighbourhood theorem' boxType='theorem'>
If $M$ be a smooth manifold with nonempty boundary, then $\partial M$ has a collar neighbourhood.

<details>
<summary>Proof</summary>

There exists a smooth vector field $N\in\mathfrak{X}(M)$ whose restriction to $\partial M$ is everywhere inward-pointing. Let $\delta:M\to \R^+$ and $\Phi:P_\delta \to M$ be as in the boundary flowout theorem, and define a map $\psi:[0,1)\times\partial M \to P_\delta$ by $\psi(t,\mathbf{p}) = (t\delta(\mathbf{p}), \mathbf{p})$. Then $\psi$ is a diffeomorphism that restricts to the identity on $\Set{0}\times\partial M$, and therefore the map $\Phi\circ\psi: [0,1)\times\partial M \to M$ is a smooth embedding with open image that restricts to the usual idenitfication $\Set{0}\times\partial M\to\partial M$. The image of $\Phi\circ\psi$ is a collar neighbourhood of $\partial M$.
</details>
</MathBox>

<MathBox title='Smooth manifolds with boundary are homotopy equivalent to their interior' boxType='theorem'>
Let $M$ be a smooth manifold with nonempty boundary, and let $\iota: \mathrm{int}(M)\to M$ denote inclusion. There exists a proper smooth embedding $R:M\to\mathrm{int}(M)$ such that both $\iota\circ R: M\to M$ and $R\circ\iota: \mathrm{int}(M) \to \mathrm{int}(M)$ are smoothly homotopic to identity maps. Therefore, $\iota$ is a homotopy equivalence.

<details>
<summary>Proof</summary>

The collar neighbourhood theorem shows that $\partial M$ has a collar neighbourhood $C$ in $M$, which is the image of a smooth embedding $E:[0,1)\times\partial M \to M$ satisfying $E(0,\mathbf{x}) = \mathbf{x}$ for all $\mathbf{x}\in\partial M$. To simplify the notation, we will use this embedding to idenfity $C$ with $[0,1)\times\partial M$, and denote a point in $C$ as an ordered pair $(s,\mathbf{x})$ with $s\in [0,1)$ and $\mathbf{x}\in\partial M$. Thus, $(s,\mathbf{x})\in\partial M$ if and only if $s = 0$. For any $a \in (0,1)$ let $C(a) = \Set{(s,\mathbf{x})\in C | 0\leq s < a}$ and $M(a) = M\setminus C(a)$, which is a regular domain in $\mathrm{int}(M)$. Let $\psi:[0,1) \to [\frac{1}{3},1)$ be an increasing diffeomorphism that satisfies $\psi(s) = s$ for $\frac{2}{3}\leq s < 1$, and defined $R:M\to\mathrm{int}(M)$ by

$$
  R(\mathbf{p}) = \begin{cases}
    \mathbf{p},\quad& \mathbf{p}\in \mathrm{int}(M(2/3)) \\
    (\psi(s),\mathbf{x}), \quad& \mathbf{p} = (s,\mathbf{x})\in C
  \end{cases}
$$

These definitions both give the identity map on the set $C\setminus C(2/3)$ where they overlap, so $R$ is smooth by the gluing lemma. It is a diffeomorphism onto the closed subset $M(1/3)$, so it is a proper smooth embedding of $M$ into $\mathrm{int}(M)$.

Define $H:M\times I \to M$ by

$$
  H(\mathbf{p},t) = \begin{cases}
    \mathbf{p},\quad& \mathbf{p}\in\mathrm{int}(M(2/3)) \\
    (ts + (1 - t)\psi(s), \mathbf{x}),\quad \mathbf{p} = (s,\mathbf{x})\in C
  \end{cases}
$$

As before, $H$ is smooth, and a straightforward verification shows that it is a homotopy from $\iota\circ R$ to $\operatorname{id}_M$. If $\mathbf{p}\in\mathrm{int}(M)$ then $H(\mathbf{p},t)\in\mathrm{int}(M)$ for all $t\in I$, so the restriction of $H$ to $\mathrm{int}(M) \times I$ is smooth homotopy from $R\circ\iota$ to $\operatorname{id}_{\mathrm{int}(M)}$.
</details>
</MathBox>

<MathBox title='Whitney approximation for manifolds with boundary' boxType='theorem'>
If $M$ and $N$ are smooth manifolds with boundary, then every continuous map from $M$ to $N$ is homotopic to a smooth map.

<details>
<summary>Proof</summary>

The Whitney approximation theorem takes care of the case $\partial N = \emptyset$, so we may assume $\partial N \neq \emptyset$. Let $F:M\to N$ be a continuous map, let $\iota: \mathrm{int}(N)\hookrightarrow N$ be inclusion, and let $R:N\to \mathrm{int}(N)$ be map constructed in the homotopy equivalence theorem, so that $\iota\circ R: N\to N$ is smooth homotopic to $\operatorname{id}_N$. The Whitney approximation theorem shows that $R\circ F: M\to\mathrm{int}(N)$ is homotopic to a smooth map $G$. It follows that $\iota\circ G \simeq \iota R\circ F \simeq F$ so $\iota\circ G:M\to N$ is a smooth map homotopic to $F$.
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Suppose $M$ and $N$ are smooth manifolds with or without boundary. If $F,G:M\to N$ are homotopic smooth maps, then they are smoothly homotopic.

<details>
<summary>Proof</summary>

The Whitney approximation theorem takes care of the case $\partial N = \emptyset$, so we may assume $\partial N \neq \emptyset$. Let $\iota: \mathrm{int}(N)\hookrightarrow N$ and $R:N\to\mathrm{int}(N)$ be as in the homotopy equivalence theorem. Then $R\circ F$ and $R\circ G$ are homotopic smooth maps from $M$ to $\mathrm{int}(N)$, so the Whitney approximation theorem shows that they are smoothly homotopic to each other. Thus, we have smooth homotopies $F\simeq\iota\circ R\circ F\simeq\iota \circ R\circ G \simeq G$. By transitivity of smooth homotopy, it follows that $F$ is smoothly homotopic to $G$.
</details>
</MathBox>

<MathBox title='Attaching smooth manifolds along their boundaries' boxType='theorem'>
Let $M$ and $N$ be smooth $n$-manifolds with nonempty boundaries, and suppose $h:\partial N \to \partial M$ is a diffeomorphism. Let $M \cup_h N$ be the adjunction space formed by identifying each $\mathbf{x}\in\partial N$ with $h(\mathbf{x})\in\partial M$. Then $M\cup_h N$ is a topological manifold (without boundary), and has a smooth structure such that there are regular domains $M', N'\subseteq M\cup_h N$ diffeomorphic to $M$ and $N$, respectively, and satisfying

$$
\begin{align*}
  M' \cup N' =& M \cup_h N \\
  M' \cap N' =& \partial M' = \partial N
\end{align*}
$$

If $M$ and $N$ are both compact, then $M \cup_h N$ is compact, and if they are both connected, then $M \cup_h N$ is connected.

<details>
<summary>Proof</summary>

For simplicity, let $X = M \cup_h N$ denote the quotient space and $\pi: M \sqcup N \to S$ the quotient map. Let $V \subseteq M$ and $W \subseteq N$ be collar neighbourhoods of $\partial M$ and $\partial N$, respectively, and denote the corresponding diffeomorphisms by $\alpha: [0,1) \times\partial M \to V$ and $\beta: [0,1)\times\partial N\to W$. Define a continuous map $\Phi: V\sqcup M \to (-1,1)\times \partial M$ by

$$
  \Phi(\mathbf{x}) = \begin{cases}
    (-t,\mathbf{p}),\quad& \mathbf{x} = \alpha(t,\mathbf{p})\in V \\
    (t,h(\mathbf{q})),\quad& \mathbf{x} = \beta(t,\mathbf{q})\in W
  \end{cases}
$$

Then the restriction of $\Phi$ to $V$ or $W$ is a topological embedding with closed image, from which it follows easily that $\Phi$ is a closed map. Because $\Phi$ is constant on the fibers of $\pi$, it descends to a continuous map $\tilde{\Phi}:\pi(V\sqcup W) \to (-1,1)\times\partial M$. This map is bijective, and it is a homeomorphism because it too is a closed map: if $K\subseteq \pi(V\sqcup W)$ is closed, then $\pi^{-1}(K)$ is closed in $V\sqcup W$, and therefore $\tilde{\Phi}(K) = \Phi(\pi^{-1}(K))$ is closed. Thus, $\pi(V\sqcup W)$ is a topological $n$-manifold. On the other hand, the restriction of $\pi$ to the saturated open subset $\mathrm{int}(M) \sqcup \mathrm{int}(N)$ is an injective quotient map and this a homeomorphism onto its image; this shows that $\mathbf{X}$ is locally Euclidean of dimension $n$. Since $\mathbf{X}$ is the union of the second-countable open subsets $\pi(\mathrm{int}(M)\sqcup\mathrm{int}(N))$ and $\pi(V\sqcup W)$, it is second-countable. Any two fibers in $M\sqcup N$ can be separated by saturated open subsets, so $\mathbf{X}$ is Hausdorff. Thus, it is a topological manifold.

We define a collection of charts on $\mathbf{X}$ as follows:
- $(\pi(U), \varphi\circ\pi^{-1}|_{\pi(U)})\$, for each smooth chart $(U,\varphi)$ for $\mathrm{int}(M)$ or $\mathrm{int}(N)$
- $(\tilde{\Phi}^{-1}(U), \varphi\circ\tilde{\Phi}|_{\tilde{\Phi}^{-1}(U)})$, for each smooth chart $(U,\varphi)$ for $(-1,1)\times\partial M$

These maps are compositions of homeomorphisms, so they define coordinate charts on $\mathbf{X}$, and it is straightforward to check that they are smoothly compatible and thus define a smooth structure on $\mathbf{X}$. The restriction of $\pi$ to $M$ is continuous, closed, and injective, and thus it is a proper embedding. In terms of any of the smooth charts constructed above and corresponding charts on $M$, $\pi$ has a coordinate representation that is either an identity map or an inclusion map, so it is a smooth embedding, and its image $M'$ is therefore a regular domain in $\mathbf{X}$. Similar considerations apply to $N$, and the statement conditions follow immediately from the definitions.

If $M$ and $N$ are compact, then $\mathbf{X}$ is the union of the compact sets $M'$ and $N'$, so it is compact; if they are connected, then $\mathbf{X}$ is the union of the connected sets $M'$ and $N'$ with points of $\partial M' = \partial N'$ in common, so it is connected.
</details>
</MathBox>

<MathBox title='The double of a smooth manifold with boundary' boxType='example'>
Let $M$ be a smooth manifold with boundary. The *double* of $M$ is the manifold $D(M) = M \cup_{\operatorname{id}} M$, where $\operatorname{id}:\partial M\to \partial M$ is the identity map of $\partial M$. It is obtained from $M\sqcup M$ by identifying each boundary point in one copy of $M$ with the same boundary point in the other. It is a smooth manifold without boundary, and contains two regular domains diffeomorphic to $M$. It is easy to check that $D(M)$ is compact if and only if $M$ is compact, and connected if and only if $M$ is connected.
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $M$ is a smooth manifold and that $\mathcal{D}\subseteq M$ is a regular domain. If $V$ is a smooth vector field on $M$ that is tangent to $\partial \mathcal{D}$, then every integral curve of $V$ that starts in $\mathcal{D}$ remains in $\mathcal{D}$ as long as it is defined.

<details>
<summary>Proof</summary>

Suppose $\gamma:I\to M$ is an integral curve of $V$ with $\gamma(0)\in \mathcal{D}$. Define $T\subseteq I$ by $T = \Set{t\in I | \gamma(t) \in \mathcal{D}}$. We will show that $T$ is both open and closed in $I$. Since $I$ is an interval, this implies $T = I$ and proves the lemma.

Since $\mathcal{D}$ is closed in $M$ (by definition of a regular domain), $T$ is closed in $I$ by continuity. To prove it is open, suppose $t_0 \in T$. If $\gamma(t_0) \in \mathrm{int}(\mathcal{D})$, then a neighbourhood of $t_0$ is contained in $T$ by continuity, so we can assume $\gamma(t_0)\in\partial \mathcal{D}$. Because $V$ is tangent to $\partial \mathcal{D}$, there is a smooth vector field $W = V|_{\partial \mathcal{D}}$ that is $\iota$-related to $V$, where $\iota: \partial \mathcal{D} \hookrightarrow M$ is inclusion. Let $\tilde{\gamma}:(t_0 - \varepsilon, t_0 + \varepsilon) \to \partial \mathcal{D}$ be an integral curve of $W$ with $\tilde{\gamma}(t_0) = \gamma(t_0)$. By naturality of integral curves, $\iota\circ\tilde{\gamma}$ is an integral curve of $V$ with the same initial condition, so by uniqueness it must be equal to $\gamma$ where both are defined. This shows that $\gamma(t) \in\partial \mathcal{D}\subseteq \mathcal{D}$ for $t$ in some neighbourhood of $t_0$, so $T$ is open in $I$ as claimed.
</details>
</MathBox>

<MathBox title='Flows on manifolds with boundary' boxType='theorem'>
Let $M$ be a smooth manifold with boundary and suppose $V$ is a smooth vector field on $M$ that is tangent to $\partial M$. There is a unique smooth maximal flow $\theta: \mathcal{D}\to M$ whose infinitesimal generator is $V$. This flow has the following properties.
1. For each $\mathbf{p}\in M$, the curve $\theta^{(\mathbf{p})}: \mathcal{D}^{(\theta)}\to M$ is the unique maximal integral curve of $V$ starting at $\mathbf{p}$.
2. If $s\in \mathcal{D}^{(\mathbf{p})}$, then $\mathcal{D}^{(\theta(s,\mathbf{p}))}$ is the interval $\mathcal{D}^{(\mathbf{p})} - s = \Set{t - s | t\in \mathcal{D}^{(\mathbf{p})}}$. 
3. For each $t\in\R$, the set $M_t$ is open in $M$, and $\theta_t : M_t \to M_{-t}$ is a diffeomorphism with inverse $\theta_{-t}$.

<details>
<summary>Proof</summary>

We can consider $M$ as a regular domain in its double $D(M)$. By the extension lemma for vector fields, we can extend $V$ to a smooth vector field $\tilde{V}$ on $D(M)$. Let $\tilde{\theta}:\tilde{\mathcal{D}}\to D(M)$ be the flow of $\tilde{V}$, and let $\mathcal{D} = \tilde{\mathcal{D}}\cap (\R\times M)$ and $\theta = \tilde{\theta}|_\mathcal{D}$. Then the previous lemma guarantees that $\theta$ maps $\mathcal{D}$ into $M$, and the rest of the conclusions follow from the fundamental theorem on flows applied to $\tilde{V}$.
</details>
</MathBox>

<MathBox title='Canonical form near a regular point on the boundary' boxType='theorem'>
Suppose $M$ is a smooth manifold with boundary and let $V$ be a smooth vector field on $M$ that is tangent to $\partial M$. If $\mathbf{p}\in\partial M$ is a regular point of $V$, there exist smooth boundary coordinates $(\mathbb{S}^i)$ on some neighbourhood of $\mathbf{p}$ in which $V$ has the coordinate representation $\frac{\partial}{\partial \mathbb{S}^1}$.
</MathBox>

## Lie derivatives

<MathBox title='Lie derivative' boxType='definition'>
Suppose $M$ is a smooth manifold, $\mathbf{V}\in\mathfrak{X}(M)$ is a smooth vector field on $M$, and $\theta$ is the flow of $\mathbf{V}$. The *Lie derivative* of a smooth vector field $\mathbf{W}$ with respect to $\mathbf{V}$ is a rough vector field $\mathcal{L}_\mathbf{V} \mathbf{W}$ on $M$ defined by for $\mathbf{p}\in M$

$$
\begin{align*}
  (\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p} =& \left.\frac{\d}{\d t}\right|_{t=0} \d(\theta_{-t})_{\theta_t(\mathbf{p})} (\mathbf{W}_{\theta_t (\mathbf{p})}) \\
  =& \lim_{t\to 0} \frac{\d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})}) - \mathbf{W}_\mathbf{p}}{t}
\end{align*}
$$

provided that the derivative exists. 

<details>
<summary>Details</summary>

For small $t\neq 0$, the difference quotient makes sense: $\theta_t$ is defined in a neighbourhood of $\mathbf{p}$ and $\theta_{-t}$ is the inverse of $\theta_t$, so both $\d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})})$ and $\mathbf{W}_\mathbf{p}$ are elements of $T_\mathbf{p}M$.

If $M$ has nonempty boundary, this definition of $\mathcal{L}_\mathbf{V} \mathbf{W}$ makes sense as long as $\mathbf{V}$ is tangent to $\partial M$ so that its flow exists by the flow theorem for maniolds with boundary.
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $M$ is a smooth manifold with or without boundary, and that $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$ are smooth vector fields on $M$. If $\partial M \neq\emptyset$, assume in addition that $\mathbf{V}$ is tangent to $\partial M$. Then $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p}$ exists for every $\mathbf{p}\in M$, and $\mathcal{L}_\mathbf{V} \mathbf{W}$ is a smooth vector field.

<details>
<summary>Proof</summary>

Let $\theta$ be the flow of $\mathbf{V}$. For arbitrary $\mathbf{p}\in M$, let $(U, (x^i))$ be a smooth chart containing $\mathbf{p}$. Choose an open interval $J_0\subseteq \R$ containing $0$ and an open subset $U_0 \subseteq U$ containing $\mathbf{p}$ such that $\theta$ maps $J_0 \times U_0$ into $U$. For $(t,\mathbf{x})\in J_0 \times U_0$, write the component functions of $\theta$ as $(\theta^i(t,\mathbf{x}))_{i=1}^n$. Then for any $(t,\mathbf{x})\in J_0 \times U_0$ the matrix of $\d(\theta_{-t})_{\theta_t (\mathbf{x})}: T_{\theta_t(\mathbf{x})} M \to T_\mathbf{x} M$ is

$$
  \left(\frac{\partial\theta^i}{\partial x^j}(-t, \theta(t, \mathbf{x})) \right)
$$

Therefore

$$
  \d(\theta_{-t})_{\theta_t(\mathbf{x})}(\mathbf{W}_{\theta_t (\mathbf{x})}) = \frac{\partial\theta^i}{\partial x^j}(-t, \theta(t,\mathbf{x}))\mathbf{W}^j(\theta(t, \mathbf{x})) \left.\frac{\partial}{\partial x^i}\right|_\mathbf{x}
$$

Because $\theta^i$ and $\mathbf{W}^j$ are smooth functions, the coefficient of $\left.\frac{\partial}{\partial x^i}\right|_\mathbf{x}$ depends smoothly on $(t,\mathbf{x})$. It follows that $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{x}$, which is obtained by taking the derivative of this expression with respect to $t$ and setting $t = 0$, exists for each $\mathbf{x}\in U_0$ and depends smoothly on $\mathbf{x}$.
</details>
</MathBox>

<MathBox title='Lie derivative is equal to Lie bracket' boxType='theorem'>
If $M$ is a smooth manifold and $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$, then $\mathcal{L}_\mathbf{V} \mathbf{W} = [\mathbf{V},\mathbf{W}]$.

<details>
<summary>Proof</summary>

Assume $n = \dim(M)$. Suppose $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$, and let $R(\mathbf{V}) \subseteq M$ be the set of regular points of $V$, i.e. the set of points $\mathbf{p}\in M$ such that $\mathbf{V}_\mathbf{p} \neq 0$. Note that $R(\mathbf{V})$ is open in $M$ by continuity, and its close is the support of $\mathbf{V}$. We will show that $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p} = [\mathbf{V},\mathbf{W}]_\mathbf{p}$ for all $\mathbf{p}\in M$, by considering three cases.

**Case 1: $\mathbf{p}\in R(\mathbf{V})$**<br/>
In this case, we can choose smooth coordinates $(u^i)$ on a neighbourhood of $\mathbf{p}$ in which $\mathbf{V}$ has the coordinate representation $V = \frac{\partial}{\partial x^1}$. In these coordinates, the flow of $V$ is $\theta_t (\mathbf{u}) = (u^1 + t, u^2,\dots, u^n)$. For each fixed $t$, the matrix of $\d(\theta_{-t})_{\theta_t (\mathbf{x})}$ in these coordinates is the identity at every point. Consequently, for any $\mathbf{u}\in U$

$$
\begin{align*}
  \d(\theta_{-t})_{\theta_t(\mathbf{u})}(\mathbf{W}_{\theta_t (\mathbf{u})}) =& \d(\theta_{-t})_{\theta_t(\mathbf{x})}\left( \mathbf{W}^j (u^1 + t,u^2,\dots,u^n) \left.\frac{\partial}{\partial u^j}\right|_{\theta_t (\mathbf{u})} \right) \\
  =& \mathbf{W}^j (u^1 + t, u^2,\dots,u^n)\left.\frac{\partial}{\partial u^j}\right|_\mathbf{u}
\end{align*}
$$

Using the definition of the Lie derivative we obtain

$$
\begin{align*}
  (\mathcal{L}_\mathbf{V} \mathbf{W}) =& \left.\frac{\d}{\d t}\right|_{t=0} \mathbf{W}^j (u^1 + t, u^2,\dots,u^n)\left.\frac{\partial}{\partial u^j}\right|_\mathbf{u} \\
  =& \frac{\partial \mathbf{W}^j}{\partial u^1}(u^1,\dots,u^n)\left.\frac{\partial}{\partial u^j}\right|_\mathbf{u}
\end{align*}
$$

On the other hand, $[\mathbf{V},\mathbf{W}]_\mathbf{u}$ is easily seen to be equal to the same expression by the Lie bracket formula.

**Case 2: $\mathbf{p}\in\operatorname{supp}(\mathbf{V})$**<br/>
Because $\operatorname{supp}(V)$ is the closure of $R(\mathbf{V})$, it follows by continuity from case 1 that $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p} = [\mathbf{V},\mathbf{W}]_\mathbf{p}$ for $\mathbf{p}\in\operatorname{supp}(V)$.

**Case 3: $\mathbf{p}\in M\setminus\operatorname{supp}(\mathbf{V})$**<br/>
In this case, $\mathbf{V}\equiv 0$ on a neighbourhood of $\mathbf{p}$. On the one hand, this implies that $\theta_t$ is equal to the identity map in a neighbourhood of $\mathbf{p}$ for all $t$, so $\d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})}) = \mathbf{W}_\mathbf{p}$, which implies that $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p} = 0$. On the other hand $[\mathbf{V},\mathbf{W}]_\mathbf{p} = 0$.
</details>
</MathBox>

<MathBox title='Properties of Lie derivatives' boxType='corollary'>
Suppose $M$ is a smooth manifold with or without boundary, and $\mathbf{V},\mathbf{W},\mathbf{X}\in\mathfrak{X}(M)$
1. $\mathcal{L}_\mathbf{V} \mathbf{W} = -\mathcal{L}_\mathbf{W} \mathbf{V}$
2. $\mathcal{L}_\mathbf{V} [\mathbf{W},\mathbf{X}] = [\mathcal{L}\mathbf{W}, \mathbf{X}] + [\mathbf{W},\mathcal{L}_\mathbf{V} \mathbf{X}]$
3. $\mathcal{L}_{[\mathbf{V},\mathbf{W}]}\mathbf{X} = \mathcal{L}_\mathbf{V} \mathcal{L}_\mathbf{W} \mathbf{X} - \mathcal{L}_\mathbf{W} \mathcal{L}_\mathbf{V} \mathbf{X}$
4. If $g\in C^\infty (M)$, then $\mathcal{L}_\mathbf{V} (g\mathbf{W}) = (\mathbf{V}g)\mathbf{W} + g\mathcal{L}_\mathbf{V} \mathbf{W}$
5. If $F:M\to N$ is a diffeomorphism, then $F_* (\mathcal{L}_\mathbf{V} \mathbf{X}) = \mathcal{L}{F_* \mathbf{V}} \mathbf{F}_* \mathbf{X}$
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, and $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$. If $\partial M \neq\emptyset$, assume also that $\mathbf{V}$ is tangent to $\partial M$. Let $\theta$ be the flow of $\mathbf{V}$. For any $(t_0,\mathbf{p})$ in the domain of $\theta$,

$$
  \left.\frac{\d}{\d t}\right|_{t=t_0} \d(\theta_{-t})_{\theta_t (\mathbf{p})}(\mathbf{W}_{\theta_t (\mathbf{p})}) = \d(\theta_{-t_0})\left((\mathcal{L}_\mathbf{V} \mathbf{W})_{\theta_{t_0}(\mathbf{p})} \right)
$$

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary, let $\mathcal{D}^{(\mathbf{p})}\subseteq\R$ denote the domain of the integral curve $\theta^{(\mathbf{p})}$, and consider the map $X:\mathcal{D}^{(\mathbf{p})} \to T_\mathbf{p}M$ given by $X(t) = \d(\theta_{-t})_{\theta_t(\mathbf{p})}(W_{\theta_t(\mathbf{p})})$. The argument in the proof of the previous lemma shows that $\mathbf{X}$ is a smooth curve in the vector space $T_\mathbf{p}M$. Making the change of variables $t = t_0 + s$ we obtain

$$
\begin{align*}
  X'(t_0) =& \left.\frac{\d}{\d s}\right|_{s=0} X(t_0 + s) \\
  =& \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_{-t_0 - s})(\mathbf{W}_{\theta_{s + t_0}(\mathbf{p})}) \\
  =& \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_{-t})\circ\d(\theta_{-s})(W_{\theta_s(\theta_{t_0}(\mathbf{p}))}) \\
  =& \d(\theta_{-t_0})\left( \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_{-s})(W_{\theta_s(\theta_{t_0}(\mathbf{p}))}) \right)
\end{align*}
$$

The last equality follows because $\d(\theta_{-t_0}): T_{\theta_{t_0}(\mathbf{p})} M \to T_\mathbf{p}M$ is a linear map that is independent of $s$. By definition of the Lie derivative, this last expression is equal to the right-hand side of statement equation.
</details>
</MathBox>

## Commuting vector fields

<MathBox title='Commuting vector field' boxType='definition'>
Let $M$ be a smooth manifold. Two smooth vector fields $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$ *commute* if $\mathbf{VW}f = \mathbf{WV}f$ for every smooth function $f$, or equivalently if $[\mathbf{V},\mathbf{W}] \equiv 0$.
</MathBox>

<MathBox title='Invariant vector field' boxType='definition'>
Let $M$ be a smooth manifold and suppose $W\in\mathfrak{X}(M)$ is a smooth vector field on $M$. If $\theta$ is a smooth flow, a vector field $\mathbf{W}$ is *invariant* under $\theta$ if $\mathbf{W}$ is $\theta_t$-related to itself for each $t$. This mean that $\mathbf{W}|_{M_t}$ is $\theta_t$-related to $\mathbf{W}|_{M_{-t}}$ for each $t$, or equivalently that $\d(\theta_t)_\mathbf{p}(\mathbf{W}_\mathbf{p}) = \mathbf{W}_{\theta_t(\mathbf{p})}$ for all $(t,\mathbf{p})$ in the domain of $\theta$.
</MathBox>

<MathBox title='Equivalence of commutation and invariance of vector fields' boxType='theorem'>
For smooth vector fields $\mathbf{V}$ and $\mathbf{W}$ on a smooth manifold $M$, the following are equivalent:
1. $\mathbf{V}$ and $\mathbf{W}$ commute
2. $\mathbf{W}$ is invariant under the flow of $\mathbf{V}$
3. $\mathbf{V}$ is invariant under the flow of $\mathbf{W}$

<details>
<summary>Proof</summary>

Suppose $\mathbf{V},\mathbf{W}\in\mathfrak{X}(M)$, and let $\theta$ denote the flow of $\mathbf{V}$. If **(2)** holds, then $\mathbf{W}_{\theta_t(\mathbf{p})} = \d(\theta_t)_\mathbf{p}(\mathbf{W}_\mathbf{p})$ whenever $(t,\mathbf{p})$ is in the domain of $\theta$. Applying $\d(\theta_{-t})_{\theta_t(\mathbf{p})}$ to both sides, we conclude that $\d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})}) = \mathbf{W}_\mathbf{p}$, which obviously implies $[\mathbf{V},\mathbf{W}] = \mathcal{L}_\mathbf{V} \mathbf{W} = 0$ directly from the definition of the Lie derivative. The same argument shows that **(3)** implies **(1)**.

To prove that **(1)** implies **(2)**, assume $[\mathbf{V},\mathbf{W}] = \mathcal{L}_\mathbf{V} \mathbf{W} = 0$. Let $\mathbf{p}\in M$ be arbitrary, and let $X(t) = \d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})})$ for $t\in \mathcal{D}^{(\mathbf{p})}$. The previous proposition shows that $X'(t) \equiv 0$. Since $X(0) = \mathbf{W}_\mathbf{p}$, this implies that $X(t) = \mathbf{W}_\mathbf{p}$ for all $t\in \mathcal{D}^{(\mathbf{p})}$, and applying $\d(\theta_t)_\mathbf{p}$ to both sides yields the identity that says $\mathbf{W}$ is invariant under $\theta$. The same proof also shows that **(1)** implies **(2)**.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Every smooth vector field is invariant under its own flow.

<details>
<summary>Proof</summary>

The follows from the previous theorem and the fact that $[V,V]\equiv 0$.
</details>
</MathBox>

<MathBox title='Commuting flows' boxType='definition'>
If $\theta$ and $\psi$ are flows on a smooth manifold $M$, then $\theta$ and $\psi$ commute if the following conditions holds for every $\mathbf{p}\in M$: whenever $J$ and $K$ are open intervals containing $0$ such that one of the expressions $\theta_t \circ \psi_s(\mathbf{p})$ or $\psi_s \circ \theta_t (\mathbf{p})$ is defined for all $(s,t)\in J\times K$, both are defined and they are equal. For global flows, this is equivalent to $\theta_t \circ\psi_s = \psi_s \circ\theta_t$ for all $s$ and $t$.
</MathBox>

<MathBox title='' boxType='theorem'>
Smooth vector fields commute if and only if their flows commute.

<details>
<summary>Proof</summary>

Let $\mathbf{V}, \mathbf{W} \in\mathfrak{X}(M)$ be smooth vector fields on a smooth manifold $M$, and let $\theta$ and $\psi$ denote their respective flows. Assume first that $\mathbf{V}$ and $\mathbf{W}$ commute. Suppose $\mathbf{p}\in M$, and that $J$ and $K$ are open intervals containing $0$ such that $\psi_s \circ\theta_t (\mathbf{p})$ is defined for all $(s,t)\in J\times K$. (The same proof with $\mathbf{V}$ and $\mathbf{W}$ reversed works under the assumption that the other expression is defined on such a rectangle.) By equivalence of commutation and invariance, the hypothesis implies that $\mathbf{V}$ is invariant under $\psi$. Fix any $s\in J$, and consider the curve $\gamma: K\to M$ defined by $\gamma(t) = \psi_s \circ\theta_t (\mathbf{p}) = \psi_s (\theta^{(\mathbf{p})}(t))$. This curves satisfies $\gamma(0) = \psi(\mathbf{p})$, and its velocity at $t\in K$ is

$$
\begin{align*}
  \gamma'(t) =& \frac{\d}{\d}(\psi_s (\theta^{(\mathbf{p})}(t))) = \d(\psi_s)(\theta^{(\mathbf{p})'}(t)) \\
  =& \d(\psi_s)(\mathbf{V}_{\theta^{(\mathbf{p})}(t)}) = \mathbf{V}_{\gamma(t)}
\end{align*}
$$

Thus, $\gamma$ is an integral curve of $\mathbf{V}$ starting at $\psi_s(\mathbf{p})$. By uniqueness, it follows that

$$
  \gamma(t) = \theta^{\psi_s(\mathbf{p})}(t) = \theta_t (\psi_s (\mathbf{p}))
$$

showing that $\theta$ and $\psi$ commute.

Converesely, assume the flows commute, and let $\mathbf{p}\in M$. If $\varepsilon > 0$ is chosen small enough that $\psi_s \circ\theta_t (\mathbf{p})$ is defined whenever $|s| < \varepsilon$ and $|t| < \varepsilon$, the the hypothesis guarantees that $\psi_s \circ\theta_t(\mathbf{p}) = \theta_t \circ\psi_s (\mathbf{p})$ for all such $s$ and $t$. This can be rewritten in the form

$$
  \psi^{\theta_t(\mathbf{p})}(s) = \theta_t(\psi^{(\mathbf{p})}(s))
$$

Differentiating this relation with respect to $s$, we get

$$
\begin{align*}
  \mathbf{W}_{\theta_t(\mathbf{p})} =& \left.\frac{\d}{\mathbf{d}s}\right|_{s=0} \psi^{\theta_t(\mathbf{p})}(s) \\
  =& \left.\frac{\d}{\d s}\right|_{s=0}\theta_t (\psi^{(\mathbf{p})}(s)) \\
  =& \d(\theta_t)_\mathbf{p}(\mathbf{W}_\mathbf{p})
\end{align*}
$$

Applying $\d(\theta_{-t})_{\theta_t(\mathbf{p})}$ to both sides, we conclude that

$$
  \d(\theta_{-t})_{\theta_t(\mathbf{p})}(\mathbf{W}_{\theta_t(\mathbf{p})}) = \mathbf{W}_\mathbf{p}
$$

Differentiating with respect to $t$ and applying the definition of the Lie derivative shows that $(\mathcal{L}_\mathbf{V} \mathbf{W})_\mathbf{p} = 0$.
</details>
</MathBox>

### Commuting frames

<MathBox title='Commuting frames' boxType='definition'>
Suppose $M$ is a smooth $n$-manifold. A small local frame $(\mathbf{E}_i)_{i=1}^n$ for $M$ is called a *commuting frame* if $[\mathbf{E}_i, \mathbf{E}_j] = 0$ for all $i$ and $j$. Commuting frames are also known as *holonomic frames*.
</MathBox>

<MathBox title='Canonical form for commuting vector fields' boxType='theorem'>
Let $M$ be a smooth $n$-manifold, and let $(\mathbf{V}_i)_{i=1}^k$ be a linearly independent $k$-tuple of smooth commuting vector fields on an open subset $W\subseteq M$. For each $\mathbf{p}\in W$, there exists a smooth coordinate chart $(U, (\mathbb{S}^i))$ centered at $\mathbf{p}$ such that $\mathbf{V}_i = \frac{\partial}{\partial \mathbb{S}^i}$ for $i = 1,\dots,k$. If $S\subseteq W$ is an embedded codimension-$k$ submanifold and $\mathbf{p}$ is a point of $S$ such that $T_\mathbf{p}S$ is complementary to the span of $(\mathbf{V}_i|_\mathbf{p})_{i=1}^k$, then the coordinates can also be chosen such that $S\cap U$ is the slice defined by $\mathbb{S}^1 =\cdots=\mathbb{S}^k = 0$.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in W$ be arbitrary. If no submanifold $S$ is given, just let $S$ be any smooth embedded codimension-$k$ submanifold $S$ whose tangent space at $\mathbf{p}$ is complementary to the span of $(\mathbf{V}_i|_\mathbf{p})_{i=1}^k$. Let $(U,(x^i))$ be a slice chart for $S$ centered at $\mathbf{p}$, with $U\subseteq W$, and with $S\cap U$ equal to the slice $\Set{\mathbf{x}\in U | x^1 =\cdots=x^k = 0}$. 

Our assumptions ensure that the vectors $\Set{\mathbf{V}_1|_\mathbf{p},\dots,\mathbf{V}_k|_\mathbf{p},\left.\frac{\partial}{\partial x^{k+1}}\right|_\mathbf{p},\dots,\left.\frac{\partial}{\partial x^n}\right|_\mathbf{p}}$ span $T_\mathbf{p} M$. Since the theorem is purely local, we may as well consider $\mathbf{V}_i$ as vector fields on $U\subseteq\R^n$, and consider $S$ to be the subset of $U$ where the first $k$ coordinates vanish. The basic idea of this proof is similar to that of the flowout theorem, except that we have to do a bit of extra work to make use of the hypothesis that the vector fields commute.

Let $\theta_i$ denote the flow of $\mathbf{V}_i$ for $i=1,\dots,k$. There exist $\varepsilon > 0$ and a neighbourhood $Y$ of $\mathbf{p}$ in $U$ such that the composition $(\theta_1)_{t_1} \circ (\theta_2)_{t_2}\circ\dots\circ(\theta_k)_{t_k}$ is defined on $Y$ and maps $Y$ into $U$ whenever $|t_1|,\dots,|t_k|$ are all less than $\varepsilon$. (To see this, just choose $\varepsilon_k > 0$ and $U_k \subseteq U$ such that $\theta_k$ maps $(-\varepsilon_k,\varepsilon_k)\times U_k$ into U and then inductively choose $\varepsilon_i$ and $U_i$ such that $\theta_i$ maps $(-\varepsilon_i, \varepsilon_i)\times U_i$ into $U_{i+1}$. Taking $\varepsilon = \min\Set{\varepsilon_i}$ and $Y = U$ does the trick.)

Define $\Omega\subseteq\R^{n-k}$ by

$$
  \Omega = \Set{(\mathbb{S}^{k+1},\dots,\mathbb{S}^n)\in\R^{n-k} | (0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n)\in Y}
$$

and define $\Phi:(-\varepsilon,\varepsilon)^k \times\Omega\to U$ by

$$
\begin{align*}
  &\Phi(\mathbb{S}^1,\dots,\mathbb{S}^k,\mathbb{S}^{k+1},\dots,\mathbb{S}^n) \\
  =& (\theta_1)_{\mathbb{S}^1} \circ\cdots\circ (\theta_k)_{\mathbb{S}^k}(0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n)
\end{align*}
$$

By construction, $\Phi(\Set{0}\times\Omega) = S\cap Y$.

We show next that $\frac{\partial}{\partial \mathbb{S}^i}$ is $\varphi$-related to $V_i$ for $i=1,\dots,k$. Because the flows $\theta_i$ commute, for any $i\in\Set{1,\dots,k}$ and any $s_0\in(-\varepsilon,\varepsilon)^k \times\Omega$ we have

$$
\begin{align*}
  \d\Phi_{s_0}\left(\left.\frac{\partial}{\partial \mathbb{S}^i}\right|_{s_0}\right) =& \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_{s_0} f(\Phi(\mathbb{S}^1,\dots,\mathbb{S}^n)) \\
  =& \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_{s_0} f\left((\theta_1)_{\mathbb{S}^1} \circ\cdots\circ (\theta_k)_{\mathbb{S}^k} (0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n) \right) \\
  =& \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_{s_0} f\left((\theta_i)_{s_i} \circ (\theta_1)_{\mathbb{S}^1} \circ\cdots\circ (\theta_{i-1})_{\mathbb{S}^{i-1}} \circ (\theta_{i+1})_{\mathbb{S}^{i+1}} \right. \\
  &\left.\circ\cdots\circ (\theta_k)_{\mathbb{S}^k} (0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n)\right)
\end{align*}
$$

For any $q\in M$, then $t\mapsto (\theta_i)(\mathbf{q})$ is an integral curve of $\mathbf{V}_i$, so this last expression is equal to $\mathbf{V}_i|_{\Phi(s_0)}f$, which proves the claim.

Next, we show that $\d\Phi_0$ is invertible. The computation above shows that

$$
  \d\Phi_0 \left( \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_0 \right) = \mathbf{V}_i|_\mathbf{p},\; i=1,\dots,k
$$

On the other hand, since $\Phi(0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n) = (0,\dots,0,\mathbb{S}^{k+1},\dots,\mathbb{S}^n)$, it follows immediately that

$$
  \d\Phi_0 \left( \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_0 \right) = \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p},\; i=k+1,\dots,n
$$

It follows that $\d\Phi_0$ takes the basis $\left( \left.\frac{\partial}{\partial \mathbb{S}^i}\right|_0 \right)_{i=1}^n$ for $T_\mathbf{0}\R^n$ to the basis $\left(\mathbf{V}_1|_\mathbf{p},\dots, \mathbf{V}_k|_\mathbf{p}, \left.\frac{\partial}{\partial^{k+1}}\right|_\mathbf{p},\dots,\left.\frac{\partial}{\partial^n}\right|_\mathbf{p}, \right)$ for $T_\mathbf{p}M$. By the inverse function theorem, $\Phi$ is a diffeomorphism in a neighbourhood of $0$, and $\varphi = \Phi^{-1}$ is a smooth coordinate map that takes $\frac{\partial}{\partial \mathbb{S}^i}$ to $V_i$ for $i=1,\dots,k$, and takes $S$ to the slice $\mathbb{S}^1 =\cdots= \mathbb{S}^k = 0$.
</details>
</MathBox>

## Time-dependent vector fields

<MathBox title='Time-dependent vector field' boxType='theorem'>
Let $M$ be a smooth manifold. A *time-dependent vector field* on $M$ is a continuous map $V: I \times M$, where $I \subseteq\R$ is an interval, such that $V(t,\mathbf{p})\in T_\mathbf{p}M$ for each $(t,\mathbf{p})\in I\times M$. This means that for each $t\in I$, the map $V_t: M\to TM$ defined by $V_t(\mathbf{p}) = V(t,\mathbf{p})$ is a vector field on $M$. If $V$ is a time-dependent vector field on $M$, an *integral curve* of $V$ is a differentiable curve $\gamma: I_0 \to M$, where $I_0\subseteq I$, such that

$$
  \gamma'(t) = V(t,\gamma(t)),; \forall t\in I_0
$$
</MathBox>

<MathBox title='Fundamental theorem on time-dependent flows' boxType='theorem'>
Let $M$ be a smooth manifold, let $I\subseteq\R$ be an open interval, and let $V:I\times M\to TM$ be a smooth time-dependent vector field on $M$. There exist an open subset $\mathcal{E} \subseteq I \times I \times M$ and a smooth map $\psi:\mathcal{E} \to M$ called the *time-dependent flow* of $V$, with the following properties:
1. For each $t_0 \in I$ and $\mathbf{p}\in M$, the set $\mathcal{E}^{(t_0,\mathbf{p})} = \Set{t\in I | (t, t_0, \mathbf{p})\in\mathcal{E}}$ is an open interval containing $t_0$, and the smooth curve $\psi^{(t_0,\mathbf{p})}: \mathcal{E}^{(t_0,\mathbf{p})} \to M$ defined by $\psi^{(t_0, \mathbf{p})}(t) = \psi(t,t_0,\mathbf{p})$ is the unique maximal integral curve of $V$ with initial condition $\psi^{(t_0,\mathbf{p})}(t_0) = \mathbf{p}$.
2. If $t_1 \in\mathcal{E}^{(t_0,\mathbf{p})}$ and $\mathbf{q} = \psi^{(t_0,\mathbf{p})}(t_1)$, then $\mathcal{E}^{(t_1,\mathbf{q})} = \mathcal{E}^{(t_0,\mathbf{p})}$ and $\psi^{(t_1, \mathbf{q})} = \psi^{(t_0,\mathbf{p})}$.
3. For each $(t_1,t_0)\in I\times I$, the set $M_{t_1,t_0} = \Set{\mathbf{p}\in M | (t_1,t_0,\mathbf{p})\in\mathcal{E}}$ is open in $M$, and the map $\psi_{t_1,t_0}: M_{t_1,t_0} \to M$ defined by $\psi_{t_1,t_0}(\mathbf{p}) = \psi(t_1,t_0,\mathbf{p})$ is a diffeomorphism from $M_{t_1,t_0}$ onto $M_{t_0,t_1}$ with inverse $\psi_{t_0,t_1}$.
4. If $\mathbf{p}\in M_{t_1, t_0}$ and $\psi_{t_1, t_0}(\mathbf{p}) \in M_{t_2,t_1}$, then $\mathbf{p}\in M_{t_2,t_0}$ and

$$
  \psi_{t_2,t_1}\circ\psi_{t_1,t_0}(\mathbf{p}) = \psi_{t_2,t_0}(\mathbf{p})
$$

<details>
<summary>Proof</summary>

Consider the smooth vector field $\tilde{V}$ on $I\times M$ defined by

$$
  \tilde{V}_{(s,\mathbf{p})} = \left(\left.\frac{\partial}{\partial s}\right|_s, V(s,\mathbf{p}) \right)
$$

where $s$ is the standard coordinate on $I\subseteq\R$, and we identify $T_{(s,\mathbf{p})}(I\times M)$ with $T_s I \otimes T_\mathbf{p} M$ as usual. Let $\tilde{\theta}:\tilde{\mathcal{D}} \to I\times M$ denote the flow of $\tilde{V}$. If we write the component function of $\tilde{\theta}$ as

$$
  \tilde{\theta}(t,(s,\mathbf{p})) = (\alpha(t,(s,\mathbf{p})), \beta(t,(s,\mathbf{p})))
$$

then $\alpha:\tilde{D}\to I$ and $\beta:\tilde{D}\to M$ satisfy

$$
\begin{align*}
  \frac{\partial\alpha}{\partial t}(t,(s,\mathbf{p})) =& 1,\; \alpha(0,(s,\mathbf{p})) = s \\
  \frac{\partial\beta}{\partial t}(t,(s,\mathbf{p})) =& V(\alpha(t,(s,\mathbf{p})), \beta(t,(s,\mathbf{p}))),\; \beta(0,(s,\mathbf{p})) = \mathbf{p}
\end{align*}
$$

It follows immediately that $\alpha(t,(s,\mathbf{p})) = t + s$, and therefore $\beta$ satisfies

$$
  \frac{\partial\beta}{\partial t}(t,(s,\mathbf{p})) = V(t + s,\beta(t(s,\mathbf{p})))
$$

Let $\mathcal{E}$ be the subset of $\R\times I\times M$ defined by

$$
  \mathcal{E} = \Set{(t,t_0,\mathbf{p}) | (t-t_0, (t_0,\mathbf{p}))\in\tilde{D}}
$$

Clearly, $\mathcal{E}$ is open in $\R\times I\times M$ because $\tilde{D}$ is. Moreover, since $\alpha$ maps $\tilde{D}$ into $I$, if $(t,t_0,\mathbf{p})\in\mathcal{E}$, then $t = \alpha(t-t_0,(t_0,\mathbf{p}))\in I$, which implies that $\mathcal{E}\subseteq I\times I\times M$.

The fact that each set $M_{t_1,t_0} = \Set{\mathbf{p}\in M | (t_1,t_0,\mathbf{p})\in\mathcal{E}}$ is open in $M$ follow immediately from the fact that $\mathcal{E}$ is open.

Defined $\psi:\mathcal{E}\to M$ by

$$
  \psi(t,t_0,\mathbf{p}) = \beta(t-t_0,(t_0,\mathbf{p}))
$$

Then $\psi$ is smooth because $\beta$ is, and it follows from the differential condition on $\beta$ that $\psi^{(t_0,\mathbf{p})}(t) = \psi(t,t_0,\mathbf{p})$ is an integral curve of $V$ with initial condition $\psi^{(t_0,\mathbf{p})} = \mathbf{p}$.

To prove uniqueness, suppose $t_0\in I$, and that $\gamma:I_0\to M$ is any integral curve of $V$ defined on some open interval $I_0\subseteq I$ containing $t_0$ and satisfying $\gamma(t_0) = \mathbf{p}$. Define a smooth curve $\tilde{\gamma}:I_0 \to I\times M$ by $\tilde{\gamma}(t) = (t,\gamma(t))$. Then $\tilde{\gamma}$ is easily seen to be an integral curve of $\tilde{V}$ with initial condition $\tilde{\gamma}(t) = \tilde{\theta}(t-t_0, (t_0,\mathbf{p}))$ on its whole domain, which implies that the domain of $\gamma$ is contained in that of $\psi^{(t_0,\mathbf{p})}$, and $\gamma=\psi^{(t_0,\mathbf{p})}$ on that domain. It follows that $\psi^{(t_0,\mathbf{p})}$ is the unique maximal integral curve of $V$ passing through $\mathbf{p}$ at $t=t_0$. This completes the proof of **(1)**.

To prove **(2)**, suppose $t_1\in\mathcal{E}^{(t_0,\mathbf{p})}$ and $\mathbf{q} = \psi^{(t_0,\mathbf{p})}(t_1)$. Then both $\psi^{(t_1,\mathbf{q})}$, and $\psi^{(t_0,\mathbf{p})}$ are integral curves of $V$ that pass through $\mathbf{q}$ when $t = t_1$, so by the uniqueness and maximality they must have the same domain and be equal on that domain.

Next, we prove **(4)**. Suppose $\mathbf{p}\in M_{t_1,t_0}$ and $\psi_{t_1,t_0}(\mathbf{p})\in M_{t_2, t_1}$, and set $\mathbf{q} = \psi_{t_1,t_0}(\mathbf{p}) = \psi^{(t_0,\mathbf{p})}(t_1)$. Then **(2)** implies that $\psi^{(t_1,\mathbf{q})}(t_2) = \psi^{(t_0,\mathbf{p})}(t_2)$. Unwinding the definitions yields

$$
  \psi_{t_2,t_1}\circ\psi_{t_1,t_0}(\mathbf{p}) = \psi_{t_2,t_0}(\mathbf{p})
$$

Finally, we prove **(3)**. Suppose $(t_1,t_0)\in I\times I$. We have already noted that $M_{t_1,t_0}$ is open in $M$. To show that $\psi_{t_1,t_0}(M_{t_1,t_0})\subseteq M_{t_0,t_1}$, let $\mathbf{p}$ be a pint of $M_{t_1,t_0}$, and set $\mathbf{q} = \psi_{t_1,t_0}(\mathbf{p})$. Part **(2)** implies that $\mathcal{E}^{(t_0, \mathbf{q})} = \mathcal{E}^{(t_1,\mathbf{q})}$, and thus $t_0\in\mathcal{E}^{(t_0,\mathbf{p})} = \mathcal{E}^{(t_1,\mathbf{q})}$. This is equivalent to $(t_0,t_1,\mathbf{q})\in\mathcal{E}$, which in turn means $\mathbf{q}\in M_{t_0,t_1}$ as claimed. To shet $\psi_{t_1,t_0}: M_{t_1,t_0} \to M_{t_0,t_1}$ is a diffeomorphism, just note that the same argument as above implies that $\psi_{t_0,t_1}(M_{t_0,t_1})\subseteq M_{t_1,t_0}$, and then **(4)** implies that $\psi_{t_1, t_0}\circ\psi_{t_0,t_1}(\mathbf{p}) = \psi_{t_1,t_1}(\mathbf{p}) =\mathbf{p}$ for all $\mathbf{p}\in M_{t_0,t_1}$, and similarly that $\psi_{t_0,t_1}\circ\psi_{t_1,t_0}(\mathbf{q}) = \mathbf{q}$ for $\mathbf{q}\in M_{t_1,t_0}$.
</details>
</MathBox>

## First-order partial differential equations

In coordinates, any first order partial differential differential equation (PDE) can be written

$$
  F\left( x^1,\dots, x^n, u(x), \frac{\partial u}{\partial x^1}(x),\dots,\frac{\partial u}{\partial x^n}(x) \right) = 0
$$

where $u$ is an unknown function of $n$ variables, and $F$ is a given smooth (not strictly necessary) function of $2n+1$ variables. In the following theory, both $u$ and $F$ are assumed to be real-valued. Most PDEs have a multitude of solutions, and in order to get a unique solution one generally stipulates that the solution should satisfy some extra conditions. For first-order equations, the appropriate condition is to specify "initial value" on a hypersurface: given a smooth hypersurface $S\subseteq\R^n$ and a smooth function $\varphi:S\to\R$, we seek a smooth function $u$ that solves the PDE and also satisfies the initial condition

$$
  u|_S = \varphi
$$

The problem of finding a solution to a PDE given an initial condition is called a *Cauchy problem*.

### Linear equations

A linear first-order PDE depends linearly or affinely on the unknown function and its derivatives. In coordinate form, the most general linear PDE takes the form

$$
  b(\mathbf{x})u(\mathbf{x}) + \sum_{i=1}^n a^i(\mathbf{x})\frac{\partial u}{\partial x^i}(x) = f(\mathbf{x})
$$

where $a^i$, $b$ and $f$ are smooth, real-valued functions defined on some open subset $\Omega\subseteq\R^n$ and $u$ is an unknown smooth function on $\Omega$. The partial derivatives represent the action on $u$ of a smooth vector field $A\in\mathfrak{X}(\Omega)$

$$
  A_\mathbf{x} = \sum_{i=1}^n a^i(\mathbf{x}) \left.\frac{\partial}{\partial x^i}\right|_\mathbf{x}
$$

In terms of $A$, the linear first order PDE takes the simple form $Au + bu = f$. The Cauchy problem for $Au + bu = f$ with initial hypersurface $S$ is called *noncharacteristic* if $A$ is nowhere tangent to $S$.

<MathBox title='The linear first-order Cauchy problem' boxType='theorem'>
Let $M$ be a smooth manifold. Suppose $S\subseteq M$ is an embedded hypersurface, and that $A\in\mathfrak{X}(M)$ is a smooth vector field that is nowhere tangent to $S$. Given functions $b,f\in C^\infty (M)$ and $\varphi\in C^\infty (S)$, then for some neighbourhood $U$ of $S$ in $M$, there exists a unique solution $u\in C^\infty (U)$ to the noncharacteristic Cauchy problem

$$
\begin{align*}
  Au + bu =& f \\
  u|_S =& \varphi
\end{align*}
$$

<details>
<summary>Proof</summary>

The flowout theorem gives us a neighbourhood $\mathcal{O}_\delta$ of $\Set{0}\times S$ in $\R\times S$, a neighbourhood $U$ of $S$ in $M$, and a diffeomorphism $\Phi:\mathcal{O}_\delta\to U$ that satisfies $\Phi(0,\mathbf{p}) = \mathbf{p}$ for $\mathbf{p}\in S$ and $\Phi_* \left(\frac{\partial}{\partial x}\right) = A$. Let us write $\hat{u} = u\circ\Phi$, $\hat{f} = f\circ\Phi$, and $\hat{b} = b\circ\Phi$. Since $\frac{\partial}{\partial t}$ and $A$ are $\Phi$-related it follows that $\frac{\partial\hat{u}}{\partial t} = (Au)\circ\Phi$. Thus, $u\in C^\infty (U)$ satisfies the Cauchy problem if and only if

$$
\begin{align*}
  \frac{\partial\hat{u}}{\partial t}(t,\mathbf{p}) =& \hat{f}(t,\mathbf{p}) - \hat{b}(t,\mathbf{p})\hat{u}(t,\mathbf{p}),\; (t,\mathbf{p})\in\mathcal{O}_\delta \\
  \hat{u}(0,\mathbf{p}) = \varphi(\mathbf{p})
\end{align*}
$$

For each fixed $\mathbf{p}\in S$, this is a linear first-order ODE initial value problem for $\hat{u}$ on the interval $-\delta(\mathbf{p}) < t \delta(\mathbf{p})$. Such a probelm always has a unique solution on the whole interval, given by

$$
\begin{align*}
  \hat{u}(t,\mathbf{p}) =& e^{-B(t,\mathbf{p})} \left(\varphi(\mathbf{p}) + \int_0^t \hat{f}(\tau,\mathbf{p})e^{B(\tau,\mathbf{p})}\;\d\tau \right) \\
  B(\tau,\mathbf{p}) =& \int_0^\tau \hat{b}(\sigma,\mathbf{p})\;\d\sigma
\end{align*}
$$

The solution $\hat{u}$ is a smooth function of $(t,\mathbf{p})$. Thus, $u = \hat{u}\circ\Phi^{-1}$ is the unique solution on $U$.
</details>
</MathBox>

### Quasilinear equations

A *quasilinear* PDE can be written as an affine equation in the highest-order derivatives of the unknown function, with coefficients that may depend on the function itself and its derivatives of lower order. In coordinates, a *quasilinear* first-order PDE takes the form

$$
  \sum_{i=1}^n a^i (\mathbf{x}, u(\mathbf{x})) \frac{\partial u}{\partial x^i} = f(\mathbf{x}, u(\mathbf{x}))
$$

for an unknown function $u(x^1,\dots,x^n)$, where $a^i$ and $f$ are smooth real-valued functions defined on some open subset $W\subseteq\R^{n+1}$. Let $S\subseteq\R^n$ be a smooth, embedded hypersurface, and $\varphi:S\to\R$ a smooth function whose graphi is contained in $W$. A quasilinear Cauchy problem with initial condition $u|_S = \varphi$, is noncharacteristic if the vector field $A^\varphi$ along $S$ defined by

$$
  A^\varphi|_\mathbf{x} = \sum_{i=1}^n a^i (\mathbf{x}, \varphi(\mathbf{x})) \left.\frac{\partial}{\partial x^i}\right|_\mathbf{x} 
$$

is nowhere tangent to $S$.

<MathBox title='The quasilinear Cauchy problem' boxType='theorem'>
Let $M$ be a smooth manifold. Suppose $S\subseteq M$ is an embedded hypersurface, and that $A\in\mathfrak{X}(M)$ is a smooth vector field that is nowhere tangent to $S$. Given functions $b,f\in C^\infty (M)$ and $\varphi\in C^\infty (S)$, then for some neighbourhood $U$ of $S$ in $M$, there exists a unique solution $u\in C^\infty (U)$ to the noncharacteristic Cauchy problem

$$
\begin{align*}
  \sum_{i=1}^n a^i (\mathbf{x}, u(\mathbf{x})) \frac{\partial u}{\partial x^i} =& f(\mathbf{x}, u(\mathbf{x})) \\
  u|_S =& \varphi
\end{align*}
$$

<details>
<summary>Proof</summary>

The key is to conver the dependent variable $u$ to an additional independent variable. Define the characteristic vector field for the quasilinear PDE to be the vector field $\xi$ on $W\subseteq\R^{n+1}$ given by

$$
  \xi_{\mathbf{x},z} = f(\mathbf{x}, z) \left.\frac{\partial}{\partial z}\right|_{(\mathbf{x}, z)} + \sum_{i=1}^n a^i(\mathbf{x},z) \left.\frac{\partial}{\partial x^i}\right|_{(\mathbf{x},z)}
$$

Suppose $u$ is a smooth function defined on an open subset $V\subseteq\R^n$ whose graph $\Gamma(u) = \Set{(\mathbf{x}, u(\mathbf{x})) | \mathbf{x}\in V}$ is contained in $W$. Then the quasilinear PDE hold if and only if $\xi(z - u(\mathbf{x})) = 0$ at all points of $\Gamma(u)$. Since $z - u(\mathbf{x})$ is a defining function for $\Gamma(u)$ it follows that $u$ solves the quasilinear PDE if and only if $\xi$ is tangent to $\Gamma(u)$. The idea is to construct the graph of $u$ as the flowout by $\xi$ from a suitable initial submanifold.

Let $\Gamma(\varphi) = \Set{(\mathbf{x}, \varphi(\mathbf{x})) | \mathbf{x}\in S}$ denote the graph of $\varphi$, which is an $(n-1)$-dimensional embedded submanifold of $W$. The projection $\pi: W\to\R^n$ onto the first $n$ variables maps $\Gamma(\varphi)$ diffeomorphically onto $S$, so if $\xi$ were tangent to $\Gamma(\varphi)$ at some point $(\mathbf{x},\varphi(\mathbf{x}))$, then $\d\phi(\xi_{(\mathbf{x}, \varphi(x))})$ would be tangent to $S$ at $\mathbf{x}$. However, a direct computation shows that

$$
  \d\phi(\xi_{(\mathbf{x}, \varphi(x))}) = A^\varphi|_\mathbf{x}
$$

so the noncharacteristic assumption guarantees that $\xi$ is nowhere tangent to $\Gamma(\varphi)$.

Applying the flowout theorem to the vector field $\xi$ starting on $\Gamma(\varphi)\subseteq W$, we obtain an immersed $n$-dimensional submanifold $\mathcal{R}\subseteq W$ containing $\Gamma(\varphi)$, such that $\xi$ is everywhere tangent to $\mathcal{R}$. If we can show that $\mathcal{R}$ is the graph of a smooth function $u$, at least locally near $\Gamma(\varphi)$, then $u$ will be a solution to the Cauchy problem.

Let $\mathbf{p}\in S$ be arbitrary. At $(\mathbf{p},\varphi(\mathbf{p}))\in\Gamma(\varphi)\subseteq \mathcal{R}$, the tangent space to $\mathcal{R}$ is spanned by the vector $\xi_{(\mathbf{p}, \varphi(\mathbf{p}))}$ together with $T_{(\mathbf{p}, \varphi(\mathbf{p}))} \Gamma(\varphi)$. The restriction of $\pi$ to $\Gamma(\varphi)$ is a diffeomorphism onto $S$, so $\d\pi$ maps $T_{(\mathbf{p}, \varphi(\mathbf{p}))}\Gamma(\varphi)$ isomorphically onto $T_\mathbf{p}S$. On the other hand, $\d\pi$ takes $\xi_{(\mathbf{p},\varphi(\mathbf{p}))}$ to $A^\varphi|_\mathbf{p}$. By the noncharacteristic assumption, $A^\varphi|_\mathbf{p} \notin T_\mathbf{p} S$, so $\mathbf{d}\pi$ is injective on $T_{(\mathbf{p}, \varphi(\mathbf{p}))} \mathcal{R}$, and thus for dimensional reasons $T_{(\mathbf{p},\varphi(\mathbf{p}))}\R^{n+1} = T_{(\mathbf{p}, \varphi(\mathbf{p}))} \mathcal{R} \otimes \ker\left(\d\pi_{(\mathbf{p}, \varphi(\mathbf{p}))} \right)$. Because $\ker\left(\d\pi_{(\mathbf{p}, \varphi(\mathbf{p}))} \right)$ is the tangent space to $\Set{\mathbf{p}}\times\R$, it follows that $\mathcal{R}$ intersects $\Set{\mathbf{p}}\times\R$ transversely at $(\mathbf{p},\varphi(\mathbf{p}))$. By local characterization of graphs, there exists a neighbourhood $V$ of $(\mathbf{p},\varphi(\mathbf{p}))$ in $\mathcal{R}$ and a neighbourhood $U$ of $\mathbf{p}\in\R^n$ such that $V$ is the graph of a smooth function $u: U\to\R$. This function solves the Cauchy problem in $U$.

To prove uniqueness, we might need to shrink $U$. Because $\mathcal{R}$ is a flowout, it is the image of some open subset $\mathcal{O}_\delta \subseteq\R\times\Gamma(\varphi(\mathbf{p}))$ under the flow of $\xi$. Choose $V$ small enough that it is the image under flow of a set of the form $(-\varepsilon,\varepsilon)\times Y\subseteq \mathcal{O}_\delta$, for some $\varepsilon > 0$ and some neighbourhood $\mathbf{Y}$ of $(\mathbf{p},\varphi(\mathbf{p}))$ in $\Gamma(\varphi)$. With this assumption, $\Gamma(u)$ is exactly the union of the images of the integral curves of $\xi$ starting at points of $\mathbf{Y}$ and flowing for time $|t| < \varepsilon$. 

Suppose $\tilde{u}$ is any other solution to the same Cauchy problem on the same open subset $U$. As noted above, this means that $\xi$ is tangent to the graph of $\tilde{u}$, and the initial condition ensures that $Y = \Gamma(\varphi) \cap U \subseteq \Gamma(\tilde{u})$. Since the graph of $\tilde{u}$ is a properly embedded submanifold of $U\times\R$, then each integral curve of $\xi$ in $U\times\R$ starting at a point of $\mathbf{Y}$ must lie entirely in the graph of $\tilde{u}$. Thus $\Gamma(\tilde{u}) \subseteq \Gamma(u)$. However, then $\Gamma(\tilde{u})$ cannot contain any point that are not in $\Gamma(u)$ and still be graph of a function, so $\tilde{u} = u$ on $U$.
</details>
</MathBox>

To find an explicit solution to a quasilinear Cauchy problem, we begin by choosin a smooth local parametrization of $S$, written as $\mathbf{s}\mapsto X(\mathbf{s})$ for $\mathbf{s} = (\mathbb{S}^2,\dots,\mathbb{S}^n)\in \Omega\subseteq\R^{n-1}$. Then the map $\tilde{X}:\Omega\to\R^{n+1}$ given by $\tilde{X}(\mathbf{s}) = (X(\mathbf{s}),\varphi(X(\mathbf{s})))$ is a local parametrization of $\Gamma(\varphi)$, and a local parametrization of $\mathcal{R}$ is given by

$$
  \Psi(t,\mathbf{s}) = \theta_t (\tilde{X}(\mathbf{s}))
$$

where $\theta$ is the flow of $\xi$. To rewrite $\mathcal{R}$ as a graph, just invert the map $\pi\circ\Psi:\Omega\to\R^n$ locally by solving for $(x^1,\dots,x^n)$ in terms of $(t,\mathbb{S}^2,\dots,\mathbb{S}^n)$. Then the $z$-component of $\Psi$, written as a function of $(x^1,\dots,x^n)$, is a solution to the Cauchy problem.

# Vector bundles

<MathBox title='Vector bundle' boxType='definition'>
Let $M$ be an $m$-dimensional topological space. A *(real) vector bundle* of rank $n$ over $M$ is a topological space $E \subseteq M\times\R^k$ with dimension $m + n$ together with a surjective continuous map $\pi:E\to M$ satisfying:
1. For each $\mathbf{p}\in M$, the fiber $E_\mathbf{p} = \pi^{-1}(\mathbf{p}) := \Set{\mathbf{v}\in \R^k | (\mathbf{p},\mathbf{v})\in E}$ over $\mathbf{p}$ is endowed with the structure of an $n$-dimensional real vector space.
2. For each $\mathbf{p}\in M$, there exist a neighbourhood $U$ of $\mathbf{p}$ in $M$ and a homomorphism $\Phi: \pi^{-1}(U) \to U\times\R^k$, called a *local trivialization* of $E$ over $U$, satisfying the following conditions:
    - $\pi_U \circ\Phi = \pi$, where $\pi_U: U\times\R^k \to U$ is the projection
    - for each $\mathbf{q}\in U$, the restriction of $\Phi$ to $E_\mathbf{q}$ is a vector space isomorphism from $E_\mathbf{q}$ to $\Set{\mathbf{q}}\times\R^k \cong \R^k$

The space $E$ is called the *total space of the bundle*, $M$ is called its *base*, and $\pi$ is its projection. If $M$ and $E$ are smooth manifolds with or without boundary, $\pi$ is a smooth map, and the local trivialization can be chosen to be diffeomorphisms, then $E$ is a *smooth vector bundle*. In this case, we call any local trivialization that is a diffeomorphism onto its image a *smooth local trivialization*. 

If there exists a local trivialization of $E$ over all of $M$, called a *global trivialization* of $E$, then $E$ is said to be a *trivial bundle*. In this case, $E$ itself is homeomorphic to the product space $M\times\R^k$. If $E\to M$ is a smooth bundle that admits a smooth global trivialization, then $E$ is *smoothly trivial*. In this case $E$ is diffeomorphic to $M\times\R^k$.

A rank-$1$ vector bundle is often called a *line bundle*.
</MathBox>

<MathBox title='The tangent bundle as a vector bundle' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary, and let $TM$ be its tangent bundle. With its standard projection map, its natural vector space structure on each fiber, and the topology and smooth structure, $TM$ is a smooth vector bundle of rank $n$ over $M$.

<details>
<summary>Proof</summary>

Given any smooth chart $(U,\varphi)$ for $M$ with coordinate functions $(x^j)$, define a map $\Phi:\pi^{-1} (U)\to U\times\R^n$ by

$$
  \Phi\left(v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right) = (\mathbf{p}, (v^1,\dots,v^n))
$$

This is linear on fibers and satisfies $\pi_1 \circ\Phi = \pi$. The composite map

$$
  \pi^{-1}(U) \xrightarrow{\Phi} U\times\R^n \xrightarrow{\varphi\times\operatorname{id}_{\R^n}} \varphi(U)\times\R^n
$$

is equal to the coordinate map $\tilde{\varphi}: \pi^{-1}(U) \to\R^{2n}$ given by

$$
  \tilde{\varphi}\left(v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) = (x^1(\mathbf{p}),\dots,x^n(\mathbf{p}), v^1,\dots,v^n)
$$

Since both $\tilde{\varphi}$ and $\varphi\times\operatorname{id}_{\R^n}$ are diffeomorphisms, so is $\Phi$. Thus, $\Phi$ satisfies all the conditions for a smooth local trivialization.
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Let $\pi:E\to M$ be a smooth vector bundle of rank $k$ over a smooth manifold $M$. Suppose $\Phi:\pi^{-1}(U)\to U\times\R^k$ and $\Psi:\pi^{-1}(V)\to V\times\R^k$ are two smooth local trivializations of $E$ with $U\cap V \neq\emptyset$. There exists a smooth map $\tau: U\cap V \to\mathrm{GL}(k, \R)$ such that the composition $\Phi\circ\Psi^{-1}: (U\cap V)\times\R^k \to (U\cap V)\times\R^k$ has the form

$$
  \Phi\circ\Psi^{-1}(\mathbf{p}, \mathbf{v}) = (\mathbf{p}, \tau(\mathbf{p})\mathbf{v})
$$

where $\tau(\mathbf{p})\mathbf{v}$ denotes the usual action of the $k\times k$ matrix $\tau(\mathbf{p})$ on the vector $\mathbf{v}\in\R^k$.

<details>
<summary>Proof</summary>

The following diagram commutes:

$$
\begin{CD}
  (U\cap V)\times\R^k @<{\Psi^{-1}}<< \pi^{-1}(U\cap V) @>{\Phi}>> (U\cap V)\times\R^k \\
  @V{\pi_1}VV @V{\pi}VV @VV{\pi_1}V \\
  U\cap V @= U\cap V @= U\cap V
\end{CD}
$$

where the maps on top are to be interpreted as the restrictions of $\Psi$ and $\Phi$ to $\pi^{-1}(U\cap V)$. It follows that $\pi_1 \circ(\Phi\circ\Psi^{-1}) = \pi_1$, which means That

$$
  \Phi\circ\Psi^{-1}(\mathbf{p},\mathbf{v}) = (\mathbf{p}, \sigma(\mathbf{p},\mathbf{v}))
$$
for some smooth map $\sigma: (U\cap V)\times\R^k \to\R^k$. Moreover, for each fixed $\mathbf{p}\in U\cap V$, the map $\mathbf{v}\mapsto\sigma(\mathbf{p},\mathbf{v})$ from $\R^k$ to itself is an invertible linear map, so there is a nonsingular $k\times k$ matrix $\tau(\mathbf{p})$ such that $\sigma(\mathbf{p},\mathbf{v}) = \tau(\mathbf{p})\mathbf{v}$. It remains to show that the transition map $\tau: U\cap V\to\mathrm{GL}(k,\R)$ is smooth.
</details>
</MathBox>

<MathBox title='Vector bundle chart lemma' boxType='lemma'>
Let $M$ be a smooth $n$-manifold with or without boundary, and suppose for each $\mathbf{p}\in M$, we are given a real vector space $E_\mathbf{p}$ of some fixed dimension $k$. Let $E = \bigsqcup_{\mathbf{p}\in M} E_\mathbf{p}$, and let $\pi:E\to M$ be the map that takes each element of $E_\mathbf{p}$ to the point $\mathbf{p}$. Suppose furthermore that we are given the following data:
1. an open cover $\Set{U_\alpha}_{\alpha\in A}$ of $M$
2. for each $\alpha\in A$, a bijective map $\Phi_\alpha:\pi^{-1}(U_\alpha)\to U_\alpha\times\R^k$ whose restriction to each $E_\mathbf{p}$ is a vector space isomorphism from $E_\mathbf{p}$ to $\Set{\mathbf{p}}\times\R^k \cong\R^k$
3. for each $\alpha,\beta\in A$ with $U_\alpha \cap U_\beta \neq\emptyset$, a smooth map $\tau_{\alpha\beta}: U_\alpha \cap U_\beta \to \mathrm{GL}(k,\R)$ such that the map $\Phi_\alpha \circ\Phi_\beta^{-1}$ from $(U_\alpha \cap U_\beta)\times\R^k$ to itself has the form

$$
  \Phi_\alpha \circ \Phi_\beta^{-1} (\mathbf{p}, \mathbf{v}) = (\mathbf{p}, \tau_{\alpha\beta}(\mathbf{p})\mathbf{v})
$$

Then $E$ has a unique topology and smooth structure making it into a smooth manifold with or without boundary and a smooth rank-$k$ vector bundle over $M$, with $\pi$ as projection and $\Set{(U_\alpha, \Phi_\alpha)}$ as smooth local trivializations.

<details>
<summary>Proof</summary>

For each point $\mathbf{p}\in M$, choose some $U_\alpha$ containing $\mathbf{p}$; choose a smooth chart $(V_\mathbf{p}, \varphi_\mathbf{p})$ for $M$ such that $\mathbf{p}\in V_\mathbf{p}\subseteq U_\alpha$, and let $\hat{V}_\mathbf{p} = \varphi_\mathbf{p}(V_\mathbf{p}) \subseteq\R^n$ or $\mathbb{H}^n$. Define a map $\tilde{\varphi}_\mathbf{p} = \pi^{-1}(V_\mathbf{p}) \to\hat{V}_\mathbf{p} \times\R^k$ by $\tilde{\varphi}_\mathbf{p} = (\varphi_\mathbf{p} \times\operatorname{id}_{\R^k})\circ\Phi_\alpha$ such that

$$
  \pi^{-1}(V_\mathbf{p}) \xrightarrow{\Phi_\alpha} V_\mathbf{p}\times\R^k \xrightarrow{\varphi_\mathbf{p}\times\operatorname{id}_{\R^k}} \hat{V}_\mathbf{p}\times\R^k
$$

We will show that the collection of all such charts $\Set{(\pi^{-1}(V_\mathbf{p}), \tilde{\varphi}) | \mathbf{p}\in M}$ satisfies the conditions of the smooth manifold chart lemma, and therefore give $E$ the strcuture of a smooth manifold with or without boundary.

As a composition of bijective maps, $\tilde{\varphi}_\mathbf{p}$ is bijective onto an open subset of either $\R^n \times\R^k = \R^{n+k}$ or $\mathbb{H}^n \times\R^n \approx H^{n+k}$. For any $\mathbf{p},\mathbf{q}\in M$, it is easy to check that

$$
  \tilde{\varphi}_\mathbf{p}(\pi^{-1}(V_\mathbf{p}) \cap \pi^{-1}(V_\mathbf{q})) = \varphi_\mathbf{p}(V_\mathbf{p} \cap V_\mathbf{q}) \times\R^k
$$

which is open because $\varphi_\mathbf{p}$ is a homeomorphism onto an open subset of $\R^n$ or $\mathbb{H}^n$. Wherever two such charts overlap, we have

$$
  \tilde{\varphi}_\mathbf{p} \circ\tilde{\varphi}_\mathbf{q}^{-1} = (\varphi_\mathbf{p} \times\operatorname{id}_{\R^k}) \circ \Phi_\alpha \circ\Phi_\beta^{-1}\circ(\varphi_\mathbf{q} \times \operatorname{id}_{\R^k})^{-1}
$$

Since $\varpho_\mathbf{p} \times \operatorname{id}_{\R^k}, \varphi_\mathbf{q}\times\operatorname{id}_{\R^k}$ and $\Phi_\alpha \circ \Phi_\beta^{-1}$ are diffeomorphisms, the compositions is a diffeomorphism. Thus, the first three conditions of the smooth manifold lemma chart are satisfied. Because the open cover $\Set{V_\mathbf{p} | \mathbf{p}\in M}$ has a countable subcover, the fourt condition of the lemma is satisfied as well.

To check the Hausdorff condition, note that any two points in the same space $E_\mathbf{p}$ lie in one of the charts we have constructed, whiel if $\xi\in E_\mathbf{p}$, and $\eta\in E_\mathbf{q}$ with $\mathbf{p}\neq\mathbf{q}$ we can choose $V_\mathbf{p}$ and $V_\mathbf{q}$ to be disjoint neighbourhood of $\mathbf{p}$ and $\mathbf{q}$, so that the sets $\pi^{-1}(V_\mathbf{p})$ and $\pi^{-1}(V_\mathbf{q})$ are disjoint coordinate neighbourhoods containing $\xi$ and $\eta$, respectively. Thus, we have given $E$ the structure of a smooth manifold with or without boundary.

With respect to this structure, each of the maps $\Phi_\alpha$ is a diffeomorphism, because in terms of the coordinate charts $(\pi^{-1}(V_\mathbf{p}), \tilde{\varphi}_\mathbf{p})$ for $E$ and $(V_\mathbf{p}\times\R^k, \varphi_\mathbf{p} \times\operatorname{id}_{\R^k})$ for $V_\mathbf{p}\times\R^k$, the coordinate representation of $\Phi_\alpha$ is the identity map. The coordinate representation of $\pi$, with respect to the same chart for $E$ and the chart $(V_\mathbf{p}, \varphi_\mathbf{p})$ for $M$, is $\pi(\mathbf{x},\mathbf{v}) = \mathbf{x}$, so $\pi$ is smooth as well. Because each $\Phi_\alpha$ maps $E_\mathbf{p}$ to $\Set{\mathbf{p}}\times\R^k$, it is immediate that $\pi_1 \circ\Phi_\alpha = \pi$, and $\Phi_\alpha$ is linear on fibers by hypothesis. Thus, $\Phi_\alpha$ satisfies all the conditions for a smooth local trivialization.

The fact that this is the uniqe smooth structure follows easily from the requirement that the maps $\Phi_\alpha$ be diffeomorphisms onto their images: any smooth structure satisfying the same conditions must include all of the charts we constructed, so it is equal to this one.
</details>
</MathBox>

## Local and global sections of vector bundles

<MathBox title='Vector bundle section' boxType='definition'>
Let $\pi:E\to M$ be a vector bundle. A *(cross) section* of $E$ is a section of the map $\pi$, i.e. a continuous map $\sigma:M\to E$ satisfying $\pi\circ\sigma = \operatorname{id}_M$. This means that $\sigma(\mathbf{p})$ is an element of the fiber $E_\mathbf{p}$ for each $\mathbf{p}\in M$. If $\sigma$ is not necessarily continuous, it is called a *rough section*. 

More generally, a *local section* of $E$ is a continuous map $\sigma:U\to E$ defined on some open subset $U\subseteq M$ and satisfying $\pi\circ\sigma = \operatorname{id}_U$. To emphasize the distinction, a section deifned on all of $M$ is sometimes called a *global section*. Note that the local section of $E$ over $U\subseteq M$ is the same as a global section of the restricted bundle $E|_U$. If $M$ is a smooth manifold with or without boundary and $E$ is a smooth vector bundle, a *smooth section* of $E$ is one that is a smooth map from its domain to $E$.

The *zero section* of $E$ is the global section $\zeta:M\to E$ defined by

$$
  \zeta(\mathbf{p}) = 0\in E_\mathbf{p},\; \forall \mathbf{p}\in M
$$

The *support* of a section $\sigma$ is the set

$$
  \operatorname{supp}(\sigma) = \overline{\Set{\mathbf{p}\in M | \sigma(\mathbf{p}) \neq 0}}
$$

If $E\to M$ is a smooth vector bundle, the set of all smooth global sections of $E$ is a vector space under point addition and scalar multiplication

$$
  (c_1 \sigma_1 + c_2 \sigma_2)(\mathbf{p}) = c_1 \sigma_1 (\mathbf{p}) + c_2 \sigma_2 (\mathbf{p}) 
$$

This vector space is usually denoted by $\Gamma(E)$. Just like smooth vector fields, smooth sections of a smooth bundle can be multiplied by smooth real-valued functions: if $f\in C^\infty(M)$ and $\sigma\in\Gamma(E)$, we obtain a new section $f\sigma$ defined by

$$
  (f\sigma)(\mathbf{p}) = f(\mathbf{p})\sigma(\mathbf{p})
$$
</MathBox>

<MathBox title='Extension lemma for vector bundles' boxType='lemma'>
Let $\pi:E\to M$ be a smooth vector bundle over a smooth manifold $M$ with or without boundary. Suppose $A$ is a closed subset of $M$, and that $\sigma: A\to E$ is a section of $E|_A$ that is smooth in the sense that $\sigma$ extends to a smooth local section of $E$ is a neighbourhood of each point. For each open subset $U\subseteq M$ containing $A$, there exists a global smooth section $\tilde{\varphi}\in\Gamma(E)$ such that $\tilde{\varphi}|_A = \sigma$ and $\operatorname{supp}(\tilde{\varphi})\subseteq U$.
</MathBox>

### Local and global frames

<MathBox title='Linear independence of sections' boxType='definition'>
Let $E\to M$ be a vector bundle on a manifold $M$. If $U\subseteq M$ is a an open subset, a $k$-tuple of local sections $(\sigma_i)_{i=1}^k$ of $E$ over $U$ is *linearly independent* if their values $(\sigma_i(\mathbf{p}))$ form a linearly independent $k$-tuple in $E_\mathbf{p}$ for each $\mathbf{p}\in U$. Similarly, they *span* $E$ if their values span $E_\mathbf{p}$ for each $\mathbf{p}\in U$.
</MathBox>

<MathBox title='Local and global frames for vector bundles' boxType='definition'>
Let $E\to M$ be a vector bundle on a manifold $M$. If $U\subseteq M$ is a an open subset, a *local frame* for $E$ over $U$ is an ordered $k$-tuple $(\sigma_i)_{i=1}^k$ of linearly independent local sections over $U$ that span $E$. In this case, $(\sigma_i(\mathbf{p}))_{i=1}^k$ is a basis for the fiber $E_\mathbf{p}$ for each $\mathbf{p}\in U$. It is called a *global frame* if $U = M$. If $E\to M$ is a smooth vector bundle, a local or global frame is a *smooth frame* if each $\sigma_i$ is a smooth section.
</MathBox>

<MathBox title='Completion of local frames for vector bundles' boxType='proposition'>
Suppose $\pi:E\to M$ is a smooth vector bundle of rank $k$.
1. If $(\sigma_i)_{i=1}^m$ is a linearly independent $m$-tuple of smooth local sections of $E$ over an open subset $U\subseteq M$, with $1\leq m < k$, then for each $\mathbf{p}\in U$ there exist smooth sectinos $\sigma_{m+1},\dots,\sigma_k$ defined on some neighbourhood $V$ of $\mathbf{p}$ such that $(\sigma_i)_{i=1}^k$ is a smooth local frame for $E$ over $U \cap V$.
2. If $(\mathbf{v}_i)_{i=1}$ is a linearly independent $m$-tuple of elements of $E_\mathbf{p}$ for some $\mathbf{p}\in M$, with $1\leq m < k$, then there exists a smooth local frame $(\sigma_i)_{i=1}^m$ for $E$ over some neighbourhood of $\mathbf{p}$ such that $\sigma_i(\mathbf{p}) = \mathbf{v}_i$ for $i=1,\dots,m$.
3. If $A\subseteq M$ is a closed subset and $(\tau_i)_{i=1}^k$ is a linearly independent $k$-tuple of sections of $E|_A$ that are smooth in the sense from the extension lemma, then there exists a smooth local frame $(\sigma_i)_{i=1}^k$ for $E$ over some neighbourhood of $A$ such that $\sigma_i|_A = \tau_i$ for $i=1,\dots,k$.
</MathBox>

<MathBox title='' boxType='proposition'>
Every smooth local frame for a smooth vector bundle is associated with a smooth local trivialization.

<details>
<summary>Proof</summary>

Suppose $E\to M$ is a smooth vector bundle, and that $(\sigma_i)$ is a smooth local frame for $E$ over an open subset $U\subseteq M$. We define a map $\Psi:U\times\R^k \to\pi^{-1}(U)$ by

$$
  \Psi(\mathbf{p}, (\mathbf{v}^1,\dots,\mathbf{v}^k)) = v^i \sigma_i (\mathbf{p})
$$

The fact that $(\sigma_i(\mathbf{p}))$ forms a basis for $E_\mathbf{p}$ at each $\mathbf{p}\in U$ implies that $\Psi$ is bijective, and an easy computation shows that $\sigma_i = \Psi\circ\tilde{e}_i$. Thus, if we can show that $\Psi$ is a diffeomorphism, then $\Psi^{-1}$ will be a smooth local trivialization whose associated local frame is $(\sigma_i)$.

Since $\Psi$ is bijective, to show that it is a diffeomorphism it suffices to show that it is a local diffeomorphism. Given $\mathbf{q}\in U$, we can choose a neighbourhood $V$ of $\mathbf{q}$ in $M$ over which there exists a smooth local trivialization $\Phi: \pi^{-1}(V) \to V\times\R^k$, and by shrinking $V$ if necessary we may assume $V\subseteq U$. Since $\Phi$ is a diffeomorphism, if we can show that $\Phi\circ\Psi|_{V\times\R^k}$ is a diffeomorphism from $V\times\R^k$ to itself, it follows that $\Psi$ restricts to a diffeomorphism from $V\times\R^k$ to $\pi^{-1}(V)$

$$
\begin{CD}
  V\times\R^k @>{\Psi|_{V\times\R^k}}>> \pi^{-1}(V) @>{\Phi}>> V\times\R^k \\
  @V{\pi_1}VV @V{\pi}VV @VV{\pi_1}V \\
  V @= V @= V
\end{CD}
$$

For each of our smooth sections $\sigma_i$, the composite map $\Phi\circ\sigma_i|_V:V\to V\times\R^k$ is smooth, and thus there are smooth functions $\sigma_i^1,\dots,\sigma_i^k : V\to\R$ such that

$$
  \Phi\circ\sigma_i (\mathbf{p}) = (\mathbf{p}, (\sigma_i^1 (\mathbf{p}),\dots,\sigma_i^k(\mathbf{p})))
$$

On $V\times\R^k$, therefore

$$
  \Phi\circ\Psi(\mathbf{p}, (v^1,\dots,v^k)) = (\mathbf{p}, (v^i\sigma_i^1(\mathbf{p}),\dots,v^i \sigma_i^k(\mathbf{p})))
$$

which is clearly smooth.

To show that $(\Phi\circ\Psi)^{-1}$ is smooth, note that the matrix $(\sigma_i^j (\mathbf{p}))$ is invertible for each $\mathbf{p}$, because $(\sigma_i(\mathbf{p}))$ is a basis for $E_\mathbf{p}$. Let $(\tau_i^j(\mathbf{p}))$ denote the inverse matrix. Because matrix inversion is a smooth map from $\mathrm{GL}(k,\R)$ to itself, the functions $\tau_i^j$ are smooth. It follows from the computations above that

$$
  (\Phi\circ\Psi)^{-1}(\mathbf{p}, (w^1,\dots,w^k)) = (\mathbf{p}, (w^i \tau_i^1(\mathbf{p}),\dots,w^i \tau_i^k(\mathbf{p})))
$$

which is also smooth.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
A smooth vector bundle is smoothly trivial if and only if it admits a smooth global frame.

<details>
<summary>Proof</summary>

The previous proposition shoe that there is a smooth local trivialization over an open subset $U\subseteq M$ if and only if there is a smooth local frame over $U$. The corollary is just a special case of this statement when $U = M$.

When applied to the tangent bundle of a smooth manifold $M$, this corollary says that $TM$ is trivial if and only if $M$ is parallelizable.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Let $\pi:E\to M$ be a smooth vector bundle of rank $k$ on a smooth manifold $M$, let $(V,\varphi)$ be a smooth chart on $M$ with coordinate functions $x^i$, and suppose there exists a smooth local frame $(\sigma_i)$ for $E$ over $V$. Define $\tilde{\varphi}:\pi^{-1}(V) \to \varphi(V)\times\R^k$ by

$$
  \tilde{\varphi}(v^i \sigma_i(\mathbf{p})) = (x^1(\mathbf{p}),\dots,x^n(\mathbf{p}),v^1,\dots,v^k)
$$

Then $(\pi^{-1}(V),\tilde{\varphi})$ is a smooth coordinate chart for $E$.

<details>
<summary>Proof</summary>

Just check that $\tilde{\varphi}$ is equal to the composition $(\varphi\times\operatorname{id}_{\R^k})\circ\Phi$, where $\Phi$ is the local trivialization associated with $(\sigma_i)$. As a composition of diffeomorphisms, it is a diffeomorphism.
</details>
</MathBox>

<MathBox title='Local frame criterion for smoothness' boxType='proposition'>
Let $\pi:E\to M$ be a smooth vector bundle of rank $k$ on a smooth manifold $M$, and let $\tau:M\to E$ be a rough section. If $(\sigma_i)$ is a smooth local frame for $E$ over an open subset $U\subseteq M$, then $\tau$ is smooth on $U$ if and only if its component functions with respect to $(\sigma_i)$ are smooth.

<details>
<summary>Proof</summary>

Let $\Phi:\pi^{-1}(U) \to U\times\R^k$ be the local trivialization associated with the local frame $(\sigma_i)$. Because $\Phi$ is a diffeomorphism, $\tau$ is smooth on $U$ if and only if the composite map $\Phi\circ\tau$ is smooth on $U$. It is straightforward to check that $\Phi\circ\tau(\mathbf{p}) = (\mathbf{p}, (\tau^1(\mathbf{p}),\dots,\tau^k(\mathbf{p}))$, where $(\tau^i)_{i=1}^k$ are the component functions of $\tau$ with respect to $(\sigma_i)$, so $\Phi\circ\tau$ is smooth if and only if the component functions $\tau^i$ are smooth.
</details>
</MathBox>

<MathBox title='Uniqueness of the smooth structure on $TM$' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary. The tangent bundle $TM$ has a unique topology and smooth structure to which $\pi:TM\to M$ is a smooth vector bundle with the given vector space structure on the fibers, and such that all coordinate vector fields are smooth local sections.

<details>
<summary>Proof</summary>

Suppose $TM$ is endowed with some topology and smooth structure making it into a smooth vector bundle with the given properties. If $(U,\varphi)$ is any smooth chart for $M$, the corresponding coordinate frame $\left(\frac{\partial}{\partial x^i}\right)$ is a smooth local frame over $U$, such that there is a smooth local trivialization $\Phi:\pi^{-1}(U)\to U\times\R^n$ associated with this local frame. This local trivialization is the map $\Phi:\pi^{-1}(U)\to U\times\R^n$ given by

$$
  \Phi\left( v^i \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) = (\mathbf{p}, (v^1,\dots,v^n))
$$

It follows from the previous corollary that the natural coordinate chart $\tilde{\varphi} = (\varphi\times\operatorname{id}_{\R^n})\circ\Phi$ belong to the given smooth structure. Thus, the given smooth structure is equal to one constructed in the proposition for the existence smooth structures on tangent bundles.
</details>
</MathBox>

## Bundle homomorphisms

<MathBox title='Bundle homomorphism' boxType='definition'>
If $\pi:E\to M$ and $\pi': E'\to M'$ are vector bundles, a continuous map $F:E\to E'$ is a *bundle homomorphism* if there exists a map $f:M\to M'$ satisfying $\pi'\circ F = f\circ \pi$

$$
\begin{CD}
  E @>{F}>> E' \\
  @V{\pi}VV @VV{\pi'}V \\
  M @>>{f}> M'
\end{CD}
$$

with the property that for each $\mathbf{p}\in M$, the restricted map $F|_{E_\mathbf{p}}: E_\mathbf{p}\to E'_{f(\mathbf{p})}$ is linear. In this case $F$ is said to *cover* f.

A bijective bundle homomorphism $F:E\to E'$ whose inverse is also a bundle homomorphism, is called a *bundle isomorphism*. If $F$ is also a diffeomorphism, it is a *smooth bundle isomorphism*. If there exists a (smooth) bundle isomorphism between $E$ and $E'$, the two bundles *(smoothly) isomorphic*.

In the special case in which both $E$ and $E'$ are vector bundles over the same base space $M$, a bundle homomorphism over $M$ covers the identity map of $M$ in the form of a continuous map $F:E\to E'$ such that $\pi' \circ F = \pi$

$$
\begin{CD}
  E @>{F}>> E' \\
  @V{\pi}VV @VV{\pi'}V \\
  M @= M
\end{CD}
$$

and whose restriction to each fiber is linear. If there exists a bundle homomorphism $F:E\to E'$ over $M$ that is also a (smooth) bundle isomorphism, then we say that $E$ and $E'$ are smoothly isomorphic over $M$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $\pi:E\to M$ and $\pi': E\to M'$ are vector bundles, and that $F:E\to E'$ is a bundle homomorphism covering $f:M\to M'$. Then $f$ is continuous and is uniquely determined by $F$. If the bundles and $F$ are all smooth, then $f$ is smooth as well.

<details>
<summary>Proof</summary>

All of the conclusion follow from the easily verified fact that $f = \pi' \circ F \circ\zeta$ where $\zeta:M\to E$ is the zero section.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $E$ and $E'$ are smooth vector bundles over a smooth manifold $M$ with or without boundary, and $F:E\to E'$ is a bijective smooth bundle homomorphism over $M$. Then $F$ is a smooth bundle isomorphism.
</MathBox>

Suppose $E\to M$ and $E' \to M$ are smooth vector bundles over a smooth manifold $M$ with or without boundary, and let $\Gamma(E)$, $\Gamma(E')$ denote their spaces of smooth global sections. If $F: E\to E'$ is a smooth bundle homomorphism over $M$, then the composition with $F$ induces a map $\tilde{F}:\Gamma(E) \to\Gamma(E')$ as follows

$$
  \tilde{F}(\sigma)(\mathbf{p}) = (F\circ\sigma)(\mathbf{p}) = F(\sigma(\mathbf{p}))
$$

It is easy to check that $\tilde{F}(\sigma)$ is a section of $E'$, and it is smooth by composition. Because a bundle homomorphism is linear on fibers, the resulting map $\tilde{F}$ on sections is linear over $\R$. In fact, it satisfies a stronger linearity property. A map $\mathcal{F}: \Gamma(E)\to\Gamma(E')$ is *linear* over $C^\infty (M)$ if for any smooth functions $u_1, u_2 \in C^\infty (M)$ and smooth sections $\sigma_1, \sigma_2 \in\Gamma(E)$,

$$
  \mathcal{F}(u_1 \sigma_1 + u_2 \sigma_2) = u_1 \mathcal{F}(\sigma_1) + u_2 \mathcal{F}(\sigma_2)
$$

If follows from that the map on sections induced by a smooth bundle homomorphism is linear over $C^\infty (M)$.

<MathBox title='Bundle homomorphism characterization lemma' boxType='lemma'>
Let $\pi:E\to M$ and $\pi':E' \to M$ be smooth vector bundles over a smooth manifold $M$ with or without boundary, and let $\Gamma(E)$, $\Gamma(E')$ denote their spaces of smooth sections. A map $\mathcal{F}: \Gamma(E)\to\Gamma(E')$ is linear over $C^\infty (M)$ if and only if there is a smooth bundle homomorphism $F:E\to E'$ over $M$ such that $\mathcal{F}(\sigma) = F\circ\sigma$ for all $\sigma\in\Gamma(E)$.

<details>
<summary>Proof</summary>

Note that the map on sections induced by a smooth bundle homomorphism is linear over $C^\infty (M)$. Conversely, suppose $\mathcal{F}:\Gamma(E)\to\Gamma(E')$ is linear over $C^\infty (M)$. First, we show that $\mathcal{F}$ acts locally: if $\sigma_1 \equiv \sigma_2$ in some open subset $U\subseteq M$, then $\mathcal{F}(\sigma_1) \equiv \mathcal{F}(\sigma_2)$ in $U$. Write $\tau = \sigma_1 - \sigma_2$; then by linearity of $\mathcal{F}$, it suffice to assume $\tau$ vanishes in $U$ and show that $\mathcal{F}(\tau)$ does to. Given $\mathbf{p}\in U$, let $\psi\in C^\infty(M)$ be a smooth bunp function supported in $U$ and equal to $\mathbf{p}$. Because $\psi\tau$ is identically zero on $M$, the fact that $\mathcal{F}$ is linear over $C^\infty (M)$ implies

$$
  0 = \mathcal{F}(\psi\tau) = \psi\mathcal{F}(\tau)
$$

Evaluating at $\mathbf{p}$ shows that $\mathcal{F}(\tau)(\mathbf{p}) = \psi(\mathbf{p})\mathcal{F}(\tau)(\mathbf{p}) = 0$. Since the same is true for every $\mathbf{p}\in U$, the claim follows.

Next, we show that $\mathcal{F}$ actually acts pointwise: if $\sigma_1(\mathbf{p}) = \sigma_2(\mathbf{p})$, then $\mathcal{F}(\sigma_1)(\mathbf{p}) = \mathcal{F}(\sigma_2)(\mathbf{p})$. Once again, it suffices to assume $\tau(\mathbf{p}) = 0$ and show that $\mathcal{F}(\tau)(\mathbf{p}) = 0$. Let $(\sigma_i)_{i=1}^k$ be a smooth local frame for $E$ in some neighbourhood $U$ of $\mathbf{p}$, and write $\tau$ in terms of this fram as $\tau = u^i \sigma_i$ for some smooth functions $u^i$ defined in $U$. The fact that $\tau(\mathbf{p}) = 0$ means that $u^1 (\mathbf{p}) =\cdots= u^k(\mathbf{p}) = 0$. By the extension lemmas for vector bundles and for functions, there exist smooth global sections $\tilde{\sigma_i}\in\Gamma(E)$ that agree with $\sigma_i$ in a neighbourhood of $\mathbf{p}$, and smooth functions $\tilde{u}^i \in C^\infty(M)$ that agree with $u^i$ in some neighbourhood of $\mathbf{p}$. Then since $\tau = \tilde{u}^i \tilde{\sigma}_i$ of a neighbourhood of $\mathbf{p}$, we have

$$
\begin{align*}
  \mathcal{F}(\tau)(\mathbf{p}) =& \mathcal{F}(\tilde{u}^i \tilde{\sigma}_i) \\
  =& \tilde{u}^i (\mathbf{p}) \mathcal{F}(\tilde{\sigma}_i)(\mathbf{p}) = 0
\end{align*}
$$

Define a bundle homomorphism $F:E\to E'$ as follows. For any $\mathbf{p}\in M$ and $\mathbf{v}\in E_\mathbf{p}$, let $F(\mathbf{v}) = \mathcal{F}(\tilde{v})(\mathbf{p})\in E'_\mathbf{p}$, where $\tilde{v}$ is any global smooth section of $E$ such that $\tilde{v}(\mathbf{p}) = \mathbf{v}$. The discussion above shows that the resulting element of $E'_\mathbf{p}$ is independent of the choice of section. The map $F$ clearly satisfies $\pi\circ F = \pi$, and it is linear on each fibre because of the linearity of $\mathcal{F}$. It also satisfies $F\circ\sigma(\mathbf{p}) = \mathcal{F}(\sigma)(\mathbf{p})$ for each $\sigma\in\Gamma(E)$ by definition. It remains only to show that $F$ is smooth. It suffices to show that it is smooth in a neighbourhood of each point.

Given $\mathbf{p}\in M$, let $(\sigma_i)$ be a smooth local frame for $E$ on some neighbourhood of $\mathbf{p}$. By the extension lemma, there are global sections $\tilde{\sigma}_i$ that agree with $\sigma_i$ in a (smaller) neighbourhood $U$ of $\mathbf{p}$. Shrinking $U$ if necessary, we may also assume there exists a smooth local frame $(\sigma'_j)$ for $E'$ over $U$. Because $\mathcal{F}$ maps smooth global sections of $E$ to smooth global sections of $E'$, there are smooth functions $A_i^j \in C^\infty(U)$ such that $\mathcal{F}(\tilde{\sigma}_i)|_U = A_i^j \sigma'_j$.

For any $\mathbf{q}\in U$ and $\mathbf{v}\in E_\mathbf{p}$ we can write $\mathbf{v} = v^i \sigma_i (\mathbf{q})$ for some real numbers $(v^1,\dots,v^k)$, and Then

$$
\begin{align*}
  F(v^i \sigma_i(\mathbf{q})) =& \mathcal{F}(v^i \tilde{\sigma}_i)(\mathbf{q}) \\
  =& v^i \mathcal{F}(\tilde{\sigma}_i)(\mathbf{q}) \\
  =& v^i A_i^j (\mathbf{q}) \sigma'_j (\mathbf{q})
\end{align*}
$$

because $v^i \tilde{\sigma}_i$ is a global smooth section of $E$ whose value at $\mathbf{q}$ is $\mathbf{v}$. If $\Phi$ and $\Phi'$ denote the local trivializations of $E$ and $E'$ associated with the frames $(\sigma_i)$ and $(\sigma'_i)$, respectively, it follows that the composite map $\Phi' \circ F \circ\Phi^{-1}: U\times\R^k \to U\times \R^m$ has the form

$$
  \Phi' \circ F\circ\Phi^{-1}(\mathbf{q}, (v^1,\dots,v^k)) = (\mathbf{q}, A_i^1 (\mathbf{q})v^i, \dots, A_i^m (\mathbf{q})v^i)
$$

which is smooth. Because $\Phi$ and $\Phi'$ are diffeomorphisms, this shows that $F$ is smooth on $\pi^{-1}(U)$.
</details>
</MathBox>

## Subbundles

<MathBox title='Subbundle' boxType='definition'>
Give a vector bundle $\pi_E: E\to M$, a *subbundle* of $E$ is a vector bundle $\pi_D: D\to M$, in which $D$ is a topological subspace of $E$ and $\pi_D$ is the restriction of $\pi_E$ to $D$, i.e. $\pi_D = \pi_E|_D$, such that for each $\mathbf{p}\in M$, the subset $D_\mathbf{p} = D \cap E_\mathbf{p}$ is a linear subspace of $E_\mathbf{p}$, and the vector space structure on $D_\mathbf{p}$ is the one inherited from $E_\mathbf{p}$. If $\pi_E$ is a smooth bundle, then $\pi_D$ is a *smooth subbundle*.

Note that the condition that $D$ be a vector bundle over $M$ implies that all of the fibers $D_\mathbf{p}$ must be nonempty and have the same dimension.
</MathBox>

<MathBox title='Local frame criterion for subbundles' boxType='lemma'>
Let $\pi:E\to M$ be a smooth vector bundle, and suppose for each $\mathbf{p}\in M$ we are given an $m$-dimensional linear subspace $D_\mathbf{p}\subseteq E_\mathbf{p}$. Then $D = \bigcup_{\mathbf{p}\in M} D_\mathbf{p} \subseteq E$ is a smooth subbundle of $E$ if and only if the followin condition is satisfied: Each poin of $M$ has a neighbourhood $U$ on  which there exist smooth local sections $\sigma_1,\dots,\sigma_m:U\to E$ with the property that $\sigma_1(\mathbf{q}),\dots,\sigma_m(\mathbf{q})$ form a basis for $D_\mathbf{q}$ at each $\mathbf{q}\in U$.

<details>
<summary>Proof</summary>

If $D$ is a smooth subbundle, then by definition each $\mathbf{p}\in M$ has a neighbourhood $U$ over which there exists a smooth local trivialization of $D$. Thus, there exists a smooth local frame for $D$ over each set $U$. Such a local frame is by definition a collection of smooth sections $\tau_1,\dots,\tau_m :U\to D$ whose images form a basis for $D_\mathbf{p}$ at each point $\mathbf{p}\in U$. The smooth sections of $E$ that we seek are obtained by composing with the inclusion map $\iota: D\to E$, i.e. $\sigma_j = \iota \circ\tau_j$.

Conversely, suppose $E\to M$ is a smooth bundle of rank $k$, and that $D\subseteq E$ satisfies the local frame criterion. Each set $D\cap E_\mathbf{p}$ is a linear subspace of $E_\mathbf{p}$ by hypothesis, so we need to show that $D$ is an embedded submanifold with or without boundary in $E$ and that the restriction of $\pi$ makes it into a smooth vector bundle over $M$.

To prove that $D$ is an embedded submanifold with or without boundary, it suffices to show that each $\mathbf{p}\in M$ has a neighbourhood $U$ such that $D\cap\pi^{-1}(U)$ is an embedded submanifold (possibly with boundary) in $\pi^{-1}(U) \subseteq E$. Given $\mathbf{p}\in M$, let $(\sigma_i)_{i=1}^m$ be smooth local sections of $E$ satisfying the local frame criterion on a neighbourhood of $\mathbf{p}$. We can complete these to a smooth local frame $(\sigma_i)_{i=1}^k$ for $E$ over some neighbourhood $U$ of $\mathbf{p}$. This local frame is associated with a smooth local trivialization $\Phi:\pi^{-1}(U)\to U\times\R^k$, defined by

$$
  \Phi\left(\sum_{i=1}^k \mathbb{S}^i\sigma_i(\mathbf{q})\right) = (\mathbf{q}, (\mathbb{S}^1, \dots, \mathbb{S}^k))
$$

This map $\Phi$ takes $D\cap \pi^{-1}(U)$ to the subset $\Set{(\mathbf{q}, (\mathbb{S}^1,\dots,\mathbb{S}^m,0,\dot,0))}\subseteq U\times\R^k$, which is an embedded submanifold (with boundary if $U$ has a boundary). Moreover, the map $\Psi: D\cap\pi^{-1}(U)\to U\times\R^m$ defined by

$$
  \Psi(\sum_{i=1}^m \mathbb{S}^i \sigma_i(\mathbf{q})) = (\mathbf{q}, (\mathbb{S}^1,\dots,\mathbb{S}^m))
$$

is a smooth local trivialization of $D$, so $D$ is itself a smooth vector bundle.
</details>
</MathBox>

<MathBox title='Rank of bundle homomorphisms' boxType='definition'>
Suppose $E\to M$ and $E'\to M$ are vector bundles and $F:E\to E'$ is a bundle homomorphism over $M$. For each $\mathbf{p}\in M$, the rank of the linear $F|_{E_\mathbf{p}}$ is called the *rank* of $F$ at $\mathbf{p}$. We say that $F$ has constant rank if its rank is the same for all $\mathbf{p}\in M$.
</MathBox>

<MathBox title='' boxType='theorem'>
Let $E$ and $E'$ be smooth vector bundles over a smooth manifold $M$, and let $F:E\to E'$ be a smooth bundle homomorphism over $M$. Define subsets $\ker(F \subseteq E)$ and $\operatorname{ran}(F \subseteq E')$ by

$$
\begin{align*}
  \ker(F) =& \bigcup_{\mathbf{p}\in M} \ker(F|_{E_\mathbf{p}}) \\
  \operatorname{ran}(F) =& \bigcup_{\mathbf{p}\in M} \operatorname{ran}(F|_{E_\mathbf{p}})
\end{align*}
$$

Then $\ker(F)$ and $\operatorname{ran}(F)$ are smooth subbundles of $E$ and $E'$, respectively, if and only if $F$ has constant rank.

<details>
<summary>Proof</summary>

One direction is obvious: since the fibers of a bundle have the same dimension everywhere, the constant rank condition is certainly necessary for $\ker(F)$ and $\operatorname{ran}(F)$ to be subbundles. To prove sufficiency, suppose $F$ has constant rank $r$, and let $k$ and $k'$ be the ranks of the bundles $E$ and $E'$ respectively. Let $\mathbf{p}\in M$ be arbitrary, and choose a smooth local frame $(\sigma_i)_{i=1}^k$ for $E$ over a neighbourhood $U$ of $\mathbf{p}$. For each $i$, the map $F\circ\sigma_i U\to E'$ is a smooth local section of $E'$, and these sections span $\operatorname{ran}(F)|_U$. After rearranging the indices if necessary, we can assume the elements $\Set{F\circ\sigma_i (\mathbf{p})}_{i=1}^r$ for a basis for $\operatorname{ran}(F|_{E_\mathbf{p}}$, and by continuity they remain linearly independent in some neighbourhood $U_0$ of $\mathbf{p}$. Since $F$ ha constant rank, this means that $(F\circ\sigma_i (\mathbf{p}))_{i=1}^r$ forms a smooth local frame for $\operatorname{ran}(F)$ over $U_0$. Since we can do the same in a neighbourhood of each point, the local frame criterion shows that $\mathrm{im}(F)$ is a smooth subbundle of $E'$.

To prove that $\ker(F)$ is also a smooth subbundle, let $U_0$ and $(\sigma_i)_{i=1}^k$ be as above, and let $V\subseteq E|_{U_0}$ be the smooth subbundle spanned by $(\sigma_i)_{i=1}^r$. The smooth bundle homomorphism $F|_V: V\to \operatorname{ran}(F)|_{U_0}$ is bijective, and is thus a smooth bundle isomorphism. Define a smooth bundle homomorphism $\Psi:E|_{U_0} \to E|_{U_0}$ by $\Psi(\mathbf{v}) = \mathbf{v} - (F|_V)^{-1} \circ F(\mathbf{v})$. If $\mathbf{v}\in V$, then $F(\mathbf{v}) = (F|_V)(\mathbf{v})$, so $F(\Psi(\mathbf{v})) = F(\mathbf{v}) - F\circ (F|_V)^{-1} \circ (F|_V)(\mathbf{v}) = 0$. On the other hand, if $\mathbf{v}\in \ker(F)$, then $\Psi(\mathbf{v}) = \mathbf{v}$, so again $F(\Psi(\mathbf{v})) = F(\mathbf{v}) = 0$. Since $V$ and $\ker(F)|_{U_0}$ together span $E|_{U_0}$, it follows that $\Psi$ takes its values in $\ker(F)|_{U_0}$, and since it restricts to the identity on $\ker(F)|_{U_0}$, its image is exactly $\ker(F)|_{U_0}$. Thus $\Psi$ has constant rank, and by the argument above, $\ker(F)|_{U_0} = \operatorname{ran}(\Psi)$ is a smooth subbundle of $E|_{U_0}$. Since we can do the same thing in a neighbour of each point, $\ker(F)$ is a smooth subbundle of $E$.
</details>
</MathBox>

<MathBox title='Orthogonal complement bundles' boxType='lemma'>
Let $M$ be an immersed submanifold with or without boundary in $\R^n$, and $D$ be a smooth rank-$k$ subbundle of $T\R^n|_M$. For each $\mathbf{p}\in M$, let $D_\mathbf{p}^\perp$ denote the orthogonal complement of $D_\mathbf{p}$ in $T_\mathbf{p}\R^n$ with respect to the Euclidean inner product, and let $D^\perp \subseteq T\R^n|_M$ be the subset

$$
  D^\perp = \Set{(\mathbf{p}, \mathbf{v})\in T\R^n | \mathbf{p}\in M, \mathbf{v}\in D_\mathbf{p}^\perp}
$$

Then $D^\perp$ is a smooth rank-$(n-k)$ subbundle of $T\R^n|_M$. For each $\mathbf{p}\in M$, there is a smooth orthonormal frame for $D^\perp$ on a neighbourhood of $\mathbf{p}$.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary, and let $(\mathbf{X}_i)_{i=1}^k$ be a smooth local frame for $D$ over some neighbourhood $V$ of $\mathbf{p}$ in $M$. Because immersed submanifolds are locally embedded, by shrinking $V$ if necessary, we may assume it is a signle slice in some coordinate ball or half-ball $U\subseteq \R^n$. Since $V$ is closed in $U$, it follows that we can complete $(\mathbf{X}_i)_{i=1}^k$ to a smooth local frame $(\tilde{X}_i)_{i=1}^n$ for $T\R^n$ over $U$. By the Gram-Schmidt algorithm, there is a smooth orthonormal frame $(\mathbf{E}_j)_{j=1}^k$ over $U$ such that $\operatorname{span}(\mathbf{E}_i|_\mathbf{p})_{i=1}^k = \operatorname{span}(X_i|_\mathbf{p})_{i=1}^k = D_\mathbf{p}$ for each $\mathbf{p}\in U$. It follows that $(\mathbf{E}_j)_{k+1}^m$ restricts to a smooth orthonormal frame for $D^\perp$ over $V$. Thus $D^\perp$ satisfies the local frame criterion, and is therefore a smooth subbundle of $T\R^n|_M$
</details>
</MathBox>

<MathBox title='The normal bundle to a submanifold of $\R^n$' boxType='corollary'>
If $M\subseteq\R^n$ is an immersed $m$-dimensional submanifold with or without boundary, its normal bundle $NM$ is a smooth rank-$(n-m)$ subbundle of $T\R^n|_M$. For each $\mathbf{p}\in M$, there exists a smooth orthonormal frame for $NM$ on a neighbourhood of $\mathbf{p}$.

<details>
<summary>Proof</summary>

This follows by applying the orthogonal complement bundle lemma to the smooth subbundle $TM\subseteq T\R^n |_M$
</details>
</MathBox>

## Fibre bundles

<MathBox title='Fibre bundle' boxType='definition'>
Let $M$ and $F$ be topological spaces. A *fibre bundle* over $M$ with *model fibre* $F$ is a topolgical space $E$ together with a surjective continuous map $\pi: E\to M$ with the property that for each $\mathbf{x}\in M$, there exists a neighbourhood $U$ of $\mathbf{x}$ in $M$ and a homeomorphism $\Phi:\pi^{-1}(U)\to U\times F$ called a *local trivialization* of $E$ over $U$ such that the following diagram commutes

$$
\begin{CD}
  \pi^{-1}(U) @>{\Phi}>> U\times F \\
  @V{\pi}VV @VV{\pi_1}V \\
  U @= U
\end{CD}
$$

The space $E$ is called the *total space* of the bundle, $M$ is its *base*, and $\pi$ is its *projection*. If $E$, $M$ and $F$ are smooth manifolds with or without boundary, $\pi$ is a smooth map, and the local trivializations can be chosen to be diffeomorphisms, then it is called a *smooth fibre bundle*.

A *trivial fibre bundle* is one that admits a local trivialization over the entire base space (a *global trivialization*). It is said to be *smoothly trivial* if it is a smooth bundle and the global trivialization is a diffeomorphism.
</MathBox>

# The cotangent bundle

## Covector

<MathBox title='Covector' boxType='definition'>
Let $V$ be a finite-dimensional real vector space. A *covector* on $V$ is real-valued linear functional on $V$, i.e. a linear map $\omega: W\to\R$. The space of all covectors on $V$ is itself a real vector space called the *dual space* of $V$, denoted by $V^*$.
</MathBox>

<MathBox title='Dual basis' boxType='proposition'>
Let $V$ be a finite-dimensional real vector space. Given any basis $(\mathbf{e}_i)_{i=1}$ for $V$, let $(\varepsilon^i \in V^*)_{i=1}^n$ be the covectors defined by

$$
  \varepsilon^i (\mathbf{e}_j) = \delta_j^i = \begin{cases} 1,\quad& i = j \\ 0,\quad& i \neq j \end{cases}
$$

Then $(\varepsilon^i)$ is a basis for $V^*$, called the *dual basis* to $(\mathbf{e}_j)$. Thus, $\dim(V^*) = \dim(V)$
</MathBox>

In general, if $(\mathbf{e}_j)$ is a basis for $V$ and $(\varepsilon^i)$ is its dual basis, then for any vector $\mathbf{v} = v^j \mathbf{e}_j \in V$ we have

$$
  \varepsilon^i (\mathbf{v}) = v^j \varepsilon^i (\mathbf{e}_j) = v^j \delta_j^i = v^i
$$

In terms of the dual basis, any covector can be expressed as $\omega = \omega(\mathbf{e}_i) \varepsilon^i = \omega_i \varepsilon^i$. The action of $\omega$ on a vector $\mathbf{v}$ is

$$
  \omega(\mathbf{v}) = \omega_i \varepsilon^i (\mathbf{v}) = \omega_i v^i
$$

<MathBox title='Transpose' boxType='definition'>
Suppose $V$ and $W$ are vector spaces, and $A:V\to W$ is a linear map. The *transpose* (dual map) of $A$, is a map $A^* : W^* \to V^*$ defined by

$$
  (A^* \omega)(\mathbf{v}) = \omega(A\mathbf{v}),\; \omega\in W^*, \mathbf{v}\in V
$$
</MathBox>

<MathBox title='Properties of the transpose' boxType='proposition'>
The transpose satisfies the following properties
- $(A\circ B)^* = B^* \circ A^*$
- $(\operatorname{id}_V)^*: V^* \to V^*$ is the identity map of $V^*$
</MathBox>

<MathBox title='Properties of the transpose' boxType='proposition'>
The transpose satisfies the following properties
- $(A\circ B)^* = B^* \circ A^*$
- $(\operatorname{id}_V)^*: V^* \to V^*$ is the identity map of $V^*$
</MathBox>

<MathBox title='' boxType='corollary'>
The assignment that sends a vector space to its dual space and a linear map to its dual map is a contravariant functor from the category of real vector spaces to itself.
</MathBox>

<MathBox title='Second dual space' boxType='definition'>
Let $V$ be a real vector space. The *second dual space* of $V$, denoted $V^{**} = (V^*)^{*}$ is characterized by a basis-independent map $\xi: V\to V^{**}$ defined as follows. For each vector $\mathbf{v}\in V$, define a linear functional $\xi(\mathbf{v}): V^* \to\R$ by

$$
  \xi(\mathbf{v})(\omega) = \omega(\mathbf{v}),\; \omega\in V^*
$$
</MathBox>

<MathBox title='Vector dual space isomorphism' boxType='proposition'>
For any finite-dimensional real vector space $V$, the map $\xi: V\to V^{**}$ is an isomorphism.

<details>
<summary>Proof</summary>

Because $\dim(V) = \dim(V^{**})$, it suffices to verify that $\xi$ is injective. Suppose $\mathbf{v}\in V$ is not zero. Extend $\mathbf{v}$ to a basis $(\mathbf{v} = (\mathbf{e}_1,\dots,\mathbf{e}_n)$ for $V$, and lett $(\varepsilon)_{i=1}^n$ denote the dual basis for $V^*$. Then $\xi(\mathbf{v}) \neq 0$ because

$$
  \xi(\mathbf{v})(\varepsilon^1) = \varepsilon^1(\mathbf{v}) = \varepsilon^1 (\mathbf{e}_1) = 1
$$
</details>
</MathBox>

## Tangent covectors on manifolds

<MathBox title='Cotangent space' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. For each $\mathbf{p}\in M$, the *cotangent space* at $\mathbf{p}$, denoted by $T_\mathbf{p}^* M$, is defined as the dual space to $T_\mathbf{p}M$

$$
  T_\mathbf{p}^* M = (T_\mathbf{p} M)^*
$$

Elements of $T_\mathbf{p}^* M$ are called *tangent covectors* at $\mathbf{p}$.
</MathBox>

Given smooth local coordinates $(x^i)$ on an open subset $U\subseteq M$, for each $\mathbf{p}\in U$ for coordinate basis $\left(\left.\frac{\partial}{\partial x^i} \right|_\mathbf{p} \right)$ gives rise to a dual basis for $T_\mathbf{p}^* M$, denoted for the moment by $(\lambda^i|_\mathbf{p})$. Any covector $\omega\in T_\mathbf{p}^* M$ can thus be written uniquely as $\omega = \omega_i \lambda^i |_\mathbf{p}$, where

$$
  \omega_i = \omega\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right)
$$

Suppose $(\tilde{x}^j)$ is another set of smooth coordinates whose domain contains $\mathbf{p}$, and let $(\tilde{\lambda}^i |_\mathbf{p})$ denote the basis for $T_\mathbf{p}^* M$ dual to $\left(\left.\frac{\partial}{\partial \tilde{x}^i} \right|_\mathbf{p} \right)$. Note that the coordinate vector fields transform as follows

$$
  \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} = \frac{\partial \tilde{x}^j}{\partial x^i} (\mathbf{p}) \left.\frac{\partial}{\partial\tilde{x}^j}\right|_\mathbf{p}
$$

Writing $\omega$ in both systems as $\omega = \omega_i \lambda^i |_\mathbf{p} = \tilde{\omega}_j \tilde{\lambda}^j |_\mathbf{p}$, we can use the coordinate transformation to compute $\omega_i$ in terms of $\tilde{\omega}_j$:

$$
\begin{align*}
  \omega_i =& \omega\left( \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) \\
  =& \omega\left( \frac{\partial\tilde{x}^j}{\partial x^i} (\mathbf{p}) \left.\frac{\partial}{\partial\tilde{x}^j}\right|_\mathbf{p} \right) \\
  =& \frac{\partial\tilde{x}^j}{\partial x^i}(\mathbf{p})\tilde{\omega}_j
\end{align*}
$$

It is customary to call tangent covectors *covariant vectors* because their components transform in the same way as the coordinate partial derivatives, with the Jacobian matrix $\left(\frac{\partial\tilde{x}^j}{\partial x^i} \right)$ multiplying the objects associated with the transformed coordinates $(\tilde{x}^j)$ to obtain the original coordinates $(x^i)$. Analogously, tangent vectors are called *contravariant vectors* because their components transform in the opposite way.

## Covector fields

<MathBox title='Cotangent bundle' boxType='definition'>
For any smooth $n$-manifold $M$ with or without boundary, the disjoint union

$$
  T^* M = \bigsqcup_{\mathbf{p}\in M} T_\mathbf{p}^* M
$$

is the *cotangent bundle* of $M$. It has a natural projection map $\pi: T^* M \to M$ sending $\omega\in T_\mathbf{p}^* M$ to $\mathbf{p}\in M$. Given any smooth local coordinates $(x^i)$ on an open subset $U\subseteq M$, for each $\mathbf{p}\in U$ we denote the basis for $T_\mathbf{p}^* M$ dual to $\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right)$ by $(\lambda^i |_\mathbf{p})$. This defines $n$ maps $\lambda_i,\dots,\lambda^n:U\to T^* M$, called *coordinate covector fields*.
</MathBox>

<MathBox title='The cotangent bundle as a vector bundle' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary. With its standard projection map and the natural vector space structure on each fiber, the cotangent bundle $T^* M$ has a unique topology and smooth structure making it not a smooth rank-$n$ vector bundle over $M$, for which all coordinate covector field are smooth local sections.

<details>
<summary>Proof</summary>

The proof is analogous to the proof for the corresponding proposition for tangent bundles. Given a smooth chart $(U,\varphi)$ on $M$, with coordinate functions $(x^i)$, define $\Phi:\pi^{-1}(U) \to U\times\R^n$ by

$$
  \Phi(\xi_i \lambda^i |_\mathbf{p}) = (\mathbf{p}, (\xi_1,\dots,\xi_n))
$$

where $\lambda^i$ is the $i$th coordinate covector field associated with $(x^i)$. Suppose $(\tilde{U}, \tilde{\varphi})$ is another smooth chart with coordinate functions $(\tilde{x}^j)$, and let $\tilde{\Phi}: \pi^{-1}(\tilde{U}\to \tilde{U}\times\R^n$ be defined analogously. On $\pi^{-1}(U\cap\tilde{U})$, it follows from the covector transformation law that

$$
  \Phi\circ\tilde{\Phi}^{-1}(\mathbf{p}, (\tilde{\xi}_1,\dots,\tilde{\xi}_n)) = \left(\mathbf{p}, \left( \frac{\partial\tilde{x}^j}{\partial x^1}(\mathbf{p})\tilde{\xi}_j,\dots, \frac{\partial\tilde{x}^j}{\partial x^n}(\mathbf{p}) \tilde{\xi}_j \right) \right)
$$

The $\mathrm{GL}(n,\R)$-valued function $\left(\frac{\partial\tilde{x}^j}{\partial x^i} \right)$ is smooth, so it follows from the vector bundle chart lemma that $T^* M$ has a smooth structure making it into a smooth vector bundle for which the maps $\Phi$ are smooth local trivialization. Uniqueness follows as in the corresponding proposition for tangent bundles.
</details>
</MathBox>

As in the case of the tangent bundle, smooth local coordinates for a smooth $n$-manifold $M$ yield smooth local coordinates for its cotangent bundle. If $(x^i)$ are smooth coordinates on an open subset $U\subseteq M$, then the map from $\pi^{-1}(U)$ to $\R^{2n}$ given by

$$
  \xi_i \lambda^i |_\mathbf{p} \mapsto (x^1(\mathbf{p}), \dots, x^n (\mathbf{p}), \xi_1, \dots, \xi_n)
$$

is a smooth coordinate chart for $T^* M$. We call $(x^i, \xi_i)$ the *natural coordinates* for $T^* M$ associated with $(x^i)$. 

A (local or global) section of $T^* M$ is called a *covector field* or a *(differential) 1-form*. Like sections of other bundles, covector fields without further qualification are assumed to be merely continuous. Otherwise, we use the terms *rough covector field* and *smooth vector field* with obvious meanings. In any smooth local coordinates on an open subset $U\subseteq M$, a (rough) covector field $\omega$ can be written in terms of the coordinate covector fields $(\lambda^i)$ as $\omega = \omega_i \lambda^i$ for $n$ functions $\omega_i:U\to\R$ called the *component functions* of $\omega$. They are characterized by

$$
  \omega_i (\mathbf{p}) = \omega_\mathbf{p}\left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p}\right)
$$

If $\omega$ is a (rough) covector field and $\mathbf{X}$ is a vector field on $M$, then we can form a function $\omega(X):M\to\R$ by

$$
  \omega(X)(\mathbf{p}) = \omega_\mathbf{p}(\mathbf{\mathbf{X_p}}),\quad \mathbf{p}\in M
$$

Writing $\omega = \omega_i \lambda^i$ and $X = X^j \frac{\partial}{\partial x^j}$ in terms of local coordinates, then $\omega(X)$ has the local coordinate representation $\omega(X) = \omega_i X^i$.

<MathBox title='Smoothness criteria for covector fields' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $\omega: M\to T^* M$ be a rough covector field. The following are equivalent:
1. $\omega$ is smooth
2. in every smooth coordinate chart, the component functions of $\omega$ are smooth
3. each point of $M$ is contained in some coordinate chart in which $\omega$ has smooth component functions
4. for every smooth vector field $\mathbf{X}\in\mathfrak{X}(M)$, the function $\omega(X)$ is smooth on $M$
5. for every open subset $U\subseteq M$ and every smooth vector field $\mathbf{X}$ on $U$, the function $\omega(X):U\to\R$ is smooth on $U$
</MathBox>

## Coframes

<MathBox title='Local and global coframe' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary, and let $U\subseteq M$ be an open subset. A *local coframe* for $M$ over $U$ is an ordered $n$-tuple of covector fields $(\varepsilon^1, \dots, \varepsilon^n)$ defined on $U$ such that $(\varepsilon^i |_\mathbf{p})$ forms a basis for $T_\mathbf{p}^* M$ at each point $\mathbf{p}\in U$. If $U = M$, it is called a *global coframe*.
</MathBox>

For any smooth chart $(U, (x^i))$, to coordinate covector fields $(\lambda^i)$ defined above constitute a local coframe over $U$, called a *coordinate coframe*. By the smoothness criteria for covector fields, every coordinate frame is smooth, because its component functions in the given chart are constants.

Given a local frame $(E_1,\dots,E_n)$ for $TM$ over an open subset $U\subseteq M$, there is a uniquely determined (rough) local coframe $(\varepsilon^1,\dots,\varepsilon^n)$ over $U$ such that $(\varepsilon^i |_\mathbf{p})$ is the dual basis to $(\mathbf{E}_i |_\mathbf{p})$ for each $\mathbf{p}\in U$, or equivalently $\varepsilon^i (E_j) = \delta_j^i$. This is called the *coframe* dual to $(\mathbf{E}_i)$. Conversely, if we start with a local coframe $(\varepsilon^i)$ over an open subset $U\subseteq M$, there is a uniquely determined local frame $(\mathbf{E}_i)$ called the *frame dual* to $(\varepsilon^i)$, determined by $\varepsilon^i (E_j) = \delta_j^i$.

<MathBox title='' boxType='lemma'>
Let $M$ be a smooth manifold with or without boundary. If $(\mathbf{E}_i)$ is a rough local frame over an open subset $U\subseteq M$ and $(\varepsilon^i)$ is its dual coframe, then $(\mathbf{E}_i)$ is smooth if and only if $(\varepsilon^i)$ is smooth.

<details>
<summary>Proof</summary>

It suffices to show that for each $\mathbf{p}\in U$, the frame $(\mathbf{E}_i)$ is smooth in a neighbourhood of $\mathbf{p}$ if and only if $(\varepsilon^i)$ is. Given $\mathbf{p}\in U$, let $(V,(x^i))$ be a smooth coordinate chart such that $\mathbf{p}\in V\subseteq U$. In $V$, we can write

$$
\begin{align*}
  \mathbf{E}_i =& a_i^k \frac{\partial}{\partial x^k} \\
  \varepsilon^j =& b_l^j \lambda^l
\end{align*}
$$

for some matrices of real-valued functions $(a_i^k)$ and $(b_l^j)$ defined on $V$. By the smoothness criteria, the vector fields $\mathbf{E}_i$ are smooth on $V$ if and only if the functions $a_i^k$ are smooth, and the covector fields $\varepsilon^j$ are smooth on $V$ if and only if the function $b_l^j$ are smooth. The fact that $\varepsilon^j (\mathbf{E}_i) = \delta_i^j$ implies that the matrices $(a_i^k)$ and $(b_l^j)$ are inverses of each other. Because matrix inversion is a smooth map from $\mathrm{GL}(n,\R)$ to itself, either one theses matrix-valued functions is smooth if and only if the other one is smooth.
</details>
</MathBox>

Given a local coframe $(\varepsilon^i)$ over an open subset $U\subseteq M$, every (rough) covector field $\omega$ on $U$ can be expressed in terms of the coframes as $\omega = \omega_i \varepsilon^i$ for some functions $\omega_1,\dots,\omega_n:U\to\R$, called the component functions of $\omega$ with respect to the given coframe. The component functions are determined by $\omega_i = \omega(\mathbf{e}_i)$, where $\mathbf{e}_i$ is the frame dual to $(\varepsilon^i)$.

<MathBox title='Coframe criterion for smoothness of covector fields' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $\omega$ be a rough covector field on $M$. If $(\varepsilon^i)$ is a smooth coframe on an open subset $U\subseteq M$, then $\omega$ is smooth on $U$ if and only if its component functions with respect to $(\varepsilon^i)$ are smooth.
</MathBox>

The real vector space of all smooth covector fields on a manifold $M$ is denoted by $\mathfrak{X}^* (M)$. As smooth sections of a vector bundle, elements of $\mathfrak{X}^* (M)$ can be multiplied by smooth real-valued functions: if $f\in C^\infty(M)$ and $\omega\in \mathfrak{X}^* (M)$, the covector field $f\omega$ is defined by

$$
  (f\omega)_\mathbf{p} = f(\mathbf{p})\omega_\mathbf{p}
$$

Because it is the space of smooth sections of a vector bundle, $\mathfrak{X}^* (M)$ is a module over $C^\infty (M)$.

A geometric picture of a coverfor field can be established from the fact that a nonzero linear functional $\omega_\mathbf{p}\in T_\mathbf{p}^* M$ is completely determined by two sets: its kernel, which is a linear hyperplane in $T_\mathbf{p}$ (a codimension-$1$ linear subspace), and the set of vectors $\Set{\mathbf{v} \in T_\mathbf{p} M | \omega_\mathbf{p}(\mathbf{v}) = 1}$, which is an affine hyperplane parallel to the kernel. The value $\omega_\mathbf{p}(\mathbf{v})$ for any other vector $\mathbf{v}$ is then obtained by linear interpolation or extrapolation. 

Thus, you can visualize a covector field as defining a pair of hyperplanes in each tangent space, one through the origin and another parallel to it, and varying continuously from point to point. Where the covector field is small, one of the hyperplanes becomes very far from the kernel, eventuall disappearing altogether at points where the covector field takes the value zero.

## The differential of a function

<MathBox title='Differential' boxType='definition'>
Let $f \in C^\infty (M)$ be a smooth real-valued function on a smooth manifold $M$ with or without boundary. The *differential* of $f$ is a covector $\d f$ defined by

$$
  \d f_\mathbf{p} := \mathbf{v}f,\; \mathbf{v}\in T_\mathbf{p} M
$$
</MathBox>

<MathBox title='' boxType='proposition'>
The differential of a smooth function is a smooth covector field.

<details>
<summary>Proof</summary>

It is straightforward to verify that at each point $\mathbf{p}\in M$, then $\d f_\mathbf{p}(\mathbf{v})$ depends linearly on $\mathbf{v}$, so that $\d f_\mathbf{p}$ is indeed a covector at $\mathbf{p}$. To see that $\d f$ is smooth, we apply the smoothness criteria for covector fields: for any smooth vector field $\mathbf{X}$ on $M$, the function $\d f(X)$ is smooth because it is equal to $Xf$.
</details>
</MathBox>

Let $f\in C^\infty (M)$ be a smooth real-value function on a smooth manifold $M$ with or without boundary. To compute the coordinate representation of a differential $\d f$, consider the smooth coordinates $(x^i)$ on an open subset $U\subseteq M$. Let $(\lambda^i)$ be the corresponding coordinate coframes on $U$. Write $\d f$ in coordinates as $\d f_\mathbf{p} = A_i (\mathbf{p})\lambda^i |_\mathbf{p}$ for some functions $A_i:U\to\R$. Then the definition of $\d f$ implies

$$
\begin{align*}
  A_i (\mathbf{p}) =& \d f_\mathbf{p} \left(\left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} \right) \\
  =& \left.\frac{\partial}{\partial x^i}\right|_\mathbf{p} f \\
  =& \frac{\partial}{\partial x^i}(\mathbf{p})
\end{align*}
$$

The yields the following formula for the coordinate representation of $\d f$

$$
  \d f_\mathbf{p} = \frac{\partial}{\partial x^i}(\mathbf{p})\lambda^i |_\mathbf{p}
$$

Thus, the component functions of $\d f$ in any smooth coordinate chart are the partial derivatives of $f$ with respect to those coordinates. Because of this, we can think of $\d f$ as an analogue of the classical gradient.

If $f$ is one of the coordinate functions we get that

$$
  \d x^j |_\mathbf{p} = \frac{\partial x^j}{\partial x^i}(\mathbf{p})\lambda^i |_\mathbf{p} = \delta_i^j \lambda^i|_\mathbf{p} = \lambda^j|_\mathbf{p}
$$

The formula for $\d f$ can thus be rewritten as

$$
  \d f_\mathbf{p} = \frac{\partial f}{\partial x^i}(\mathbf{p})\d x^i |_\mathbf{p}
$$

or as an equation between covector fields instead of vectors

$$
  \d f = \frac{\partial f}{\partial f}\d x_i
$$

Particularly, in the $1$-dimensional case, this reduces to

$$
  \d f = \frac{\mathrm{d f}}{\d x}\d x
$$

<MathBox title='Properties of the differential' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $f,g\in C^\infty (M)$.
1. $\d(\alpha f + \beta g)$ for $\alpha, \beta\in\R$
2. $\d(fg) = f\d g + g\d f$
3. $\d\left(\frac{f}{g}\right) = \frac{g\d f - f \d g}{g^2}$ where $g\neq 0$
4. if $J\subseteq\R$ is an interval containing the image of $f$, and $h:J\to\R$ is a smooth function, then $d(h\circ f) = (h' \circ f)\d f$
5. if $f$ is constant, then $\d f = 0$
</MathBox>

<MathBox title='Functions with vanishing differentials' boxType='proposition'>
If $f$ is a smooth real-valued function on a smooth manifold $M$ with or without boundary, then $\d f = 0$ if and only if $f$ is constant on each component of $M$.

<details>
<summary>Proof</summary>

It suffices to assume $M$ is connected and show that $\d f = 0$ if and only if $f$ is constant. One direction is immediately: if $f$ is constant, then $\d f = 0$ by properties of the differential. Conversely, suppose $\d f = 0$, let $\mathbf{p}\in M$ and let $\mathcal{C} = \Set{\mathbf{q} \in M: f(\mathbf{q}) = f(\mathbf{p})}$. If $\mathbf{q}$ is any point in $\mathcal{C}$, let $U$ be a smooth coordinate ball (or half-ball if $\mathbf{q}\in\partial M$) centered at $\mathbf{q}$. From $\d f = \frac{\partial f}{\partial f}\d x_i$, we see that $\frac{\partial f}{\partial x^i} \equiv 0$ in $U$ for each $i$, so by elementary calculus, $f$ is constant on $U$. This shows that $\mathcal{C}$ is open, and since it is closed by continuity, it must be all of $M$. Thus, $f$ is everywhere equal to the constant $f(\mathbf{p})$.
</details>
</MathBox>

Suppose $M$ is a smooth $n$-manifold. By choosing smooth coordinates on a neighbourhood of $\mathbf{p}\in M$, we can think of $f\in C^\infty (M)$ as a function on an open subset $U\subseteq\R^n$. Recall that $\d x^i |_\mathbf{p}$ is the linear functional that picks out the $i$th component of a tangent vector at $\mathbf{p}$. Writing $\Delta f = f(\mathbf{p}+ \mathbf{v}) - f(\mathbf{p})$ for $\mathbf{v}\in\R^n$, Taylor's theorem shows that $\Delta f$ is well approximated for small $\mathrm{v}$ by

$$
\begin{align*}
  \Delta \approx& \frac{\partial f}{\partial x^i}(\mathbf{p})v^i \\
  =& \frac{\partial f}{\partial x^i}(\mathbf{p})\d x^i|_\mathbf{p}(\mathbf{v}) = \d f_\mathbf{p}(\mathbf{v})
\end{align*}
$$

where we are now considering $\mathbf{v}$ as an element of $T_\mathbf{p}\R^n$ via the isomorphism $T_\mathbf{p}\R^n \cong \R^n$. In other words, $\d f_\mathbf{p}$ is the linear functional that best approximates $\Delta f$ near $\mathbf{p}$

<MathBox title='Derivative of a function along a curve' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, $\gamma: J\subseteq\R \to M$ is a smooth curve, and $f:M\to\R$ is a smooth function. Then the derivative of the real-valued function $f\circ\gamma: J\to\R$ is given by

$$
  (f\circ\gamma)'(t) = \d f_{\gamma(t)}(\gamma'(t))
$$

<details>
<summary>Proof</summary>

It follows directly from the definition that for any $t_0 \in J$

$$
\begin{align*}
  \d f_{\gamma(t_0)} (\gamma'(t_0)) =& \gamma'(t_0)f \\
  =& \d\gamma_{t_0} \left(\left.\frac{\d}{\d t}\right|_{t_0} \right)f \\
  =& \left.\frac{\d}{\d t}\right|_{t_0} (f\circ\gamma) \\
  =& (f\circ\gamma)'(t_0)
\end{align*}
$$
</details>
</MathBox>

## Pullbacks of covector fields

<MathBox title='Pullbacks' boxType='definition'>
Let $F:M\to N$ be a smooth map between smooth manifolds with or without boundary, and let $\mathbf{p}\in M$ be arbitrary. The differential $\d F_\mathbf{p}: T_\mathbf{p} M \to T_{F(\mathbf{p})} N$ yields a dual linear map

$$
  \d F_\mathbf{p}^* : T_{F(\mathbf{p})}^* N \to T_\mathbf{p}^* M
$$

called the *(pointwise) pullback* by $F$ at $\mathbf{p}$, or the *cotangent map* of $F$. Unraveling the definitions, we see that $\d F_\mathbf{p}^*$ is characterized by

$$
  \d F_\mathbf{p}^* (\omega)(\mathbf{v}) = \omega(\d F_\mathbf{p}(\mathbf{v})),\; \omega\in T_{F(\mathbf{p})}^* N, \mathbf{v}\in T_\mathbf{p}M
$$

If $\omega$ is a covector field in $M$, we define a rough vector field $F^* \omega$ on $M$, called the *pullback* of $\omega$ by $F$ by

$$
  (F^*\omega)_\mathbf{p} = \d F_\mathbf{p}^* (\omega_{F(\mathbf{p})})
$$

It acts on a vector $\mathbf{v}\in T_\mathbf{p}M$ by

$$
  (F^*\omega)_\mathbf{p} (\mathbf{v}) = \omega_{F(\mathbf{p})} (\d F_\mathbf{p}(\mathbf{v}))
$$
</MathBox>

Observe that the assignments $(M,\mathbf{p})\mapsto T_\mathbf{p}^* M$ and $F\mapsto \d F_\mathbf{p}^*$ yields a contravariant functor from the category of pointed smooth manifolds to the category of real vector spaces. This shows that the convention of calling covectors in $T^* M$ *covariant* is particularly unfortunate. 

<MathBox title='' boxType='proposition'>
Let $F:M\to N$ be a smooth map between smooth manifolds with or without boundary. Suppose $u$ is a continuous real-valued function on $N$, and $\omega$ is a covector field on $N$. Then

$$
  F^* (u\omega) = (u\circ F)F^* \omega
$$

If in addition $u$ is smooth, Then

$$
  F^* \mathbf{d}u = \d(u\circ F)
$$

<details>
<summary>Proof</summary>

To prove $F^* (u\omega) = (u\circ F)F^* \omega$ we compute

$$
\begin{align*}
  (F^*(u\omega))_\mathbf{p} =& \d F_\mathbf{p}^* ((u\omega)_{F(\mathbf{p})}) \\
  =& \d F_\mathbf{p}^* (u(F(\mathbf{p}))\omega_{F(\mathbf{p})}) \\
  =& u(F(\mathbf{p}))\d F_\mathbf{p}^* (\omega_{F(\mathbf{p})}) \\
  =& u(F(\mathbf{p}))(F^* \omega)_\mathbf{p} \\
  =& ((u\circ F)F^* \omega)_\mathbf{p}
\end{align*}
$$

To prove $F^* (u\omega) = (u\circ F)F^* \omega$ we let $\mathbf{v}\in T_\mathbf{p} M$ be arbitrary, and compute

$$
\begin{align*}
  (F^* \d u)_\mathbf{p} (\mathbf{v}) =& (\d F_\mathbf{p}^* (\d u_{F(\mathbf{p})})) \\
  =& \d u_{F(\mathbf{p})} (\d F_\mathbf{p} (\mathbf{v})) \\
  =& \d F_\mathbf{p} (\mathbf{v})u \\
  =& \mathbf{v}(u\circ F) \\
  =& \d(u\circ F)_\mathbf{p} (\mathbf{v})
\end{align*}
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $F:M\to N$ is a smooth map between smooth manifolds with or without boundary, and let $\omega$ be a covector field on $N$. Then $F^* \omega$ is a (continuous) covector field on $M$. If $\omega$ is smooth, then so is $F^* \omega$.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary, and choose smooth coordinates (y^j) for $N$ in a neighbourhood $V$ of $F(\mathbf{p})$. Let $U = F^{-1}(V)$, which is a neighbourhood of $\mathbf{p}$. Writing $\omega$ in coordinates as $\omega = \omega_j \d y^j$ for continuous functions $\omega_j$ on $V$ and using the previous proposition twice (applied to $F|_U$),, we have the following computation in $U$

$$
\begin{align*}
  F^* \omega =& F^* (\omega_j \d y^j) (\omega_j \circ F)F^* \d y^j \\
  =& (\omega_j \circ F)\d(y^j \circ F)
\end{align*}
$$

This expression is continuous, and is smooth if $\omega$ is smooth.
</details>
</MathBox>

The pullback formula for a covector field can also be written As

$$
  F^* \omega = (\omega_j \circ F)\d(y^i \circ F) = (\omega_j \circ F)\d F^j
$$

where $F^j$ is the $j$th component function of $F$ in these coordinates.

### Restricting covector fields to submanifolds

Suppose $M$ is a smooth manifold with or without boundary, $S\subseteq M$ is an immersed submanifold with or without boundary, and $\iota: S\hookrightarrow M$ is the inclusion map. If $\omega$ is any smooth covector field on $M$, the pullback by $\iota$ yields a smooth covector field $\iota^*\omega$ on $S$. To see what this means, let $\mathbf{v}\in T_\mathbf{p} S$ be arbitrary, and compute

$$
  (\iota^* \omega)_\mathbf{p} (\mathbf{v}) = \omega_\mathbf{p} (\d\iota_\mathbf{p}(\mathbf{v})) = \omega_\mathbf{p}(\mathbf{v})
$$

sinde $\d\iota_\mathbf{p}: T_\mathbf{p}S \to T_\mathbf{p}M$ is just the inclusion map, under our usual identificaion of $T_\mathbf{p} S$ with a subspace of $T_\mathbf{p} M$. Thus, $\iota^* \omega$ is just the restriction of $\omega$ to vectors tangent to $S$. For this reason $\iota^* \omega$ is often called the *restriction* of $\omega$ to $S$. Note that $\iota^* \omega$ might equal zero at a given point of $S$, although considered as covector field on $M$, $\omega$ migth not vanish there.

To distinguish the two ways in which we might interpret the statement "$\omega$ vanishes on $S$", one usually says that $\omega$ *vanishes along* $S$ or *vanishes at points* of $S$ if $\omega_\mathbf{p} = 0$ for for every point $\mathbf{p}\in S$. The weaker condition that $\iota^* \omega = 0$ is expressed by saying that the restriction of $\omega$ to $S$ vanishes, or the pullback of $\omega$ to $S$ vanishes.

## Line integrals

<MathBox title='Integral of covector fields' boxType='definition'>
Suppose $[a,b]\subseteq\R$ is a compact interval, and that $\omega$ is a smooth covector field on $[a,b]$. This means that the component function of $\omega$ admits a smooth extension to some neighbourhood of $[a,b]$. If we let $t$ denote the standard coordinate on $\R$, we can write $\omega$ as $\omega_t = f(t)\d t$ for some smooth function $f:[a,b]\to\R$. The integral of $\omega$ over $[a,b]$ is defined as

$$
  \int_{[a,b]} \omega = \int_a^b f(t)\;\mathbf{d}t
$$
</MathBox>

<MathBox title='Diffeomorphism invariance of the integral' boxType='proposition'>
Let $\omega$ be a smooth covector field on the compact interval $[a,b]\subseteq\R$. If $\varphi:[c,d] \to [a,b]$ is an increasing diffeomorphism, i.e. $t_1 < t_2 \implies \varphi(t_1) < \varphi(t_2)$, then

$$
  \int_{[c,d]} \varphi^* \omega = \int_{[a,b]} \omega
$$

<details>
<summary>Proof</summary>

If we let $s$ denote the standard coordinate on $[c,d]$ and $t$ on $[a,b]$, then the pullback formula shows that the pullback $\varphi^* \omega$ has the coordinate expression $(\varphi^* \omega)_s = f(\varphi(s))\varphi'(s)\d s$. Inserting this into the definition of the line integral and using the change of variables formula for ordinary integrals, we obtain

$$
\begin{align*}
  \int_{[c,d]} \varphi^* \omega =& \int_c^d f(\varphi(s))\varphi'(s)\;\d s \\
  =& \int_a^b f(t)\;\d t = \int_{[a,b]}\omega
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Curve segment' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. A *curve segment* in $M$ is a continuous curve $\gamma:[a,b] \to M$ whose domain is a compact interval. It is a *smooth curve segment* if it is smooth $[a,b]$ is considered as a manifold with boundary (or, equivalently, if $\gamma$ has an extension to a smooth curve defined in a neighbourhood of each endpoint). It is a *piecewise smooth curve segment* if there exists a finite partition $a = a_0 < a_1 < \cdots < a_k = b$ of $[a,b]$ such that $\gamma|_{[a_{i-1}, a_i]}$ is smooth for each $i$. If $\gamma(a) = \gamma(b)$, then $\gamma$ is a *closed curve segment*.

Continuity of $\gamma$ means that $\gamma(t)$ approaches the same value as $t$ approaches any of the points $a_i$ (other than $a_0$ or $a_k$) from the left or the right. Smoothness of $\gamma$ on each subinterval means that $\gamma$ has one-sided velocity vectors at each such $a_i$ when approaching from the left of the right, but these one-sided velocities need not be equal.  
</MathBox>

<MathBox title='' boxType='proposition'>
If $M$ is a connected smooth manifold with or without boundary, any two points of $M$ can be joined by a piecewise smooth curve segment.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary, and define a subset $\mathcal{C}\subseteq M$ by

$$
  \mathcal{C} = \Set{\mathbf{q}\in M | \text{there is a piecewise smooth curve segment in } M \text{ from } \mathbf{p} \text{ to } \mathbf{q}}
$$

Clearly, $\mathbf{p}\in \mathcal{C}$, so $\mathcal{C}$ is nonempty. To show that $\mathcal{C} = M$, we need to show that it is open and closed in $M$.

Let $\mathbf{q}\in\mathcal{C}$ be arbitrary, which means that there is a piecewise smooth curve segment $\gamma$ going from $\mathbf{p}$ to $\mathbf{q}$. Let $U$ be a smooth coordinate ball (or half-ball) centered at $\mathbf{q}$. If $\mathbf{q}'$ is any point in $U$, then it is easy to construct a piecewise smooth curve segment from $\mathbf{p}$ to $\mathbf{q}'$ by first following $\gamma$ from $\mathbf{p}$ to $\mathbf{q}$, and then following a straight-line path in coordinates from $\mathbf{q}$ to $\mathbf{q}'$. Thus $U\subseteq\mathcal{C}$, which shows that $\mathbf{C}$ is open in $M$.

On the other hand, if $\mathbf{q}\in \partial\mathcal{C}$, let $U$ be a smooth coordinate ball or half-ball around $\mathbf{q}$ as above. The fact that $\mathbf{q}$ is a boundary point of $\mathcal{C}$ means that there is some point $\mathbf{q}'\in \mathcal{C}\cap U$. In this case, we can construct a piecewise smooth curve from $\mathbf{p}$ to $\mathbf{q}$ by first following one from $\mathbf{p}$ to $\mathbf{q}'$ and then following a straight-line path in coordinates from $\mathbf{q}$ to $\mathbf{q}'$. This shows that $\mathbf{q}\in\mathcal{C}$, so $\mathcal{C}$ is also closed.
</details>
</MathBox>

<MathBox title='Line integral' boxType='definition'>
Suppose $M$ is smooth manifold with or without boundary. If $\gamma:[a,b]\to M$ is a smooth curve segment and $\omega$ is a smooth covector field on $M$, we define the *line integral* of $\omega$ over $\gamma$ to be the real number

$$
  \int_\gamma \omega = \int_[a,b] \gamma^* \omega
$$

Because, $\gamma^* \omega$ is a smooth covector field on $[a,b]$, this definition makes sense. More generally, if $\gamma$ is piecewise smooth, we define

$$
  \int_\gamma \omega = \sum_{i=1}^k \int_{[a_{i-1}, a_i]} \gamma^* \omega
$$

where $[a_{i-1}, a_i]$ for $i=1,\dots,k$, are subintervals on which $\gamma$ is smooth.
</MathBox>

<MathBox title='Properties of line integrals' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary. Suppose $\gamma:[a,b]\to M$ is a piecewise smooth curve segment, and $\omega, \omega_1, \omega_2 \in \mathfrak{X}^*(M)$.
1. For any $c_1, c_2\in\R$
$$
  \int_\gamma (c_1 \omega_1 + c_2 \omega_2) = c_1 \int_\gamma \omega_1 + c_2 \int_\gamma \omega_2
$$
2. If $\gamma$ is a constant map, then $\int_\gamma \omega = 0$
3. If $\gamma_1 = \gamma|_{[a,c]}$ and $\gamma_2 = \gamma|_{[c,b]}$ with $a < c < b$, then
$$
  \int_\gamma \omega = \int_{\gamma_1} \omega + \int_{\gamma_2} \omega
$$
4. If $F:M\to N$ is any smooth map and $\eta\in\mathfrak{X}^* (N)$, then
$$
  \int_\gamma F^* \eta = \int_{F\circ\gamma} \eta
$$
</MathBox>

<MathBox title='Reparametrization' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. If $\gamma:[a,b]\to M$ and $\tilde{\gamma}:[c,d]\to M$ are piecewise smooth curve segments, we say that $\tilde{\gamma}$ is a *reparametrization* of $\gamma$ if $\tilde{\gamma} = \gamma\circ\varphi$ for some diffeomorphism $\varphi:[c,d]\to [a,b]$. If $\varphi$ is an increasing function, $\tilde{\gamma}$ is a *forward reparametrization*, and if $\varphi$ is decreasing, it is a *backward reparametrization*. 
</MathBox>

<MathBox title='Parameter independence of line integral' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, $\omega\in\mathfrak{X}^* (M)$, and $\gamma$ is a piecewise smooth curve segment in $M$. For any reparametrization $\tilde{\gamma}$ of $\gamma$ we have

$$
  \int_{\tilde{\gamma}} \omega = \begin{cases}
    \int_\gamma \omega,&\quad \quad\text{ if }\tilde{\gamma} \text{ is a forward reparametrization} \\
    -\int_\gamma \omega,&\quad\text{ if }\tilde{\gamma} \text{ is a backward reparametrization}
  \end{cases}
$$

<details>
<summary>Proof</summary>

First assume $\gamma:[a,b]\to M$ is smooth, and suppose $\tilde{\gamma} = \gamma\circ\varphi$, where $\varphi:[c,d]\to [a,b]$ is an increasing diffeomorphism. Then the diffeomorphism invariance implies

$$
\begin{align*}
  \int_\tilde{\gamma} \omega =& \int_{[c,d]} (\gamma\circ\varphi)^* \omega \\
  =& \int_{[c,d]} \varphi^* \gamma^* \omega = \int_{[a,b]} \gamma^* \omega \\
  =& \int_\gamma \omega
\end{align*}
$$

The proof for when $\varphi$ is decreasing is analogous.

If $\gamma$ is only piecewise smooth, the result follows simply by applying the preceding argument on each subinterval where $\gamma$ is smooth.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary. If $\gamma:[a,b]\to M$ is a piecewise smooth curve segment, the line integral of $\omega$ over $\gamma$ can also be expressed as the ordinary integral

$$
  \int_\gamma \omega = \int_a^b \omega_{\gamma(t)} (\gamma' (t))\;\d t
$$

<details>
<summary>Proof</summary>

Fir suppose $\gamma$ is smooth and that its image is contained in the domain of a single smooth chart. Writing the coordinate representations of $\gamma$ and $\omega$ as $(\gamma^i(t))_{i=1}^n$ and $\omega_i \d x^i$, respectively, we have

$$
\begin{align*}
  \omega_{\gamma(t)} (\gamma'(t)) =& \omega_i (\gamma(t))\d x^i (\gamma'(t)) \\
  =& \omega_i (\gamma(t))\dot{\gamma}^i (t)
\end{align*}
$$

Combining this with the pullback formula for covector fields, we obtain

$$
\begin{align*}
  (\gamma^* \omega)_t =& (\omega_i \circ\gamma)(t)\d(\gamma^i)_t \\
  =& \omega_i (\gamma(t))\dot{\gamma}^i (t)\d t \\
  =& \omega_{\gamma(t)}(\gamma'(t))\d t
\end{align*}
$$

Thus, by the definition of the line integral

$$
  \int_\gamma \omega = \int_{[a,b]} \gamma^* \omega = \int_a^b \omega_{\gamma(t)} (\gamma'(t))\d t
$$

If $\gamma$ is an arbitrary smooth curve segment, by compactness there exists a finite partition $a = a_0 < a_1 < \cdots < a_k = b$ of $[a,b]$ such that $\gamma([a_{i-1}, a_i])$ is contained in the domain of a single smooth chart for each $i=1,\dots,k$, so we can apply the computation above on each such subinterval. Finally, if $\gamma$ is only piecewise smooth, we simply apply the same argument on each subinterval on which $\gamma$ is smooth.
</details>
</MathBox>

<MathBox title='Fundamental theorem for line integrals' boxType='theorem'>
Let $M$ be a smooth manifold with or without boundary. Suppose $f\in C^\infty (M)$ is a smooth real-valued function on $M$ and that $\gamma:[a,b]\to M$ is a piecewise smooth curve segment in $M$. Then

$$
  \int_\gamma \d f = f(\gamma(b)) - f(\gamma(a))
$$

<details>
<summary>Proof</summary>

Suppose first that $\gamma$ is smooth. Then

$$
\begin{align*}
  \int_\gamma =& \int_a^b \d f_{\gamma(t)}(\gamma'(t)) \\
  =& \int_a^b (f \circ\gamma)'(t)\;\d t
\end{align*}
$$

By the fundamental theorem of calculus, this is equal to $f\circ\gamma(b) - f\circ\gamma(a)$.

If $\gamma$ is merely piecewise smooth, let $a = a_0 < a_1 < \cdots < a_k = b$ be the endpoints of the subintervals on which $\gamma$ is smooth. Applying the above argument on each subinterval and summing, we find that

$$
\begin{align*}
  \int_\gamma \d f =& \sum_{i=1}^k (f(\gamma(a_i)) - f(\gamma(a_{i-1}))) \\
  =& f(\gamma(b)) - f(\gamma(a))
\end{align*}
$$

because the contributions from all the interior points cancel.
</details>
</MathBox>

## Conservative covector fields

<MathBox title='Exact differential and potential' boxType='definition'>
A smooth covector field $\omega$ on a smooth manifold $M$ with or without boundary is an *exact differential* on $M$ if there is a function $f\in C^\infty(M)$ such that $\omega = \d f$. In this case, the function $f$ is called a *potential* for $\omega$. The potential is not uniquely determined, but by properties of the line integral, difference between any two potentials for $\omega$ must be constant on each component of $M$. 
</MathBox>

<MathBox title='Conservative vector field' boxType='definition'>
A smooth covector field $\omega$ on a smooth manifold $M$ with or without boundary is *conservative* if the line integral of $\omega$ for every piecewise smooth closed curve segment is zero.

<details>
<summary>Details</summary>

This terminology comes from physics, where a force field is called conservative if the change in energy caused by the force acting along any closed path is zero, meaning that energy is conserved.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
A smooth covector field $\omega$ is conservative if and only if its line integrals are path-independent, in the sense that $\int_\gamma \omega = \int_{\tilde{\gamma}}\omega$ whenever $\gamma$ and $\tilde{\gamma}$ are piecewise smooth curve segments with the same starting and ending points.
</MathBox>

<MathBox title='' boxType='theorem'>
Let $M$ be a smooth $n$-manifold with or without boundary. A smooth covector field on $M$ is conservative if and only if it is exact.

<details>
<summary>Proof</summary>

If $\omega\in\mathfrak{X}^* (M)$ is exact, the fundamental theorem for line integrals shows that it is conservative, so we need only to prove the converse. Suppose $\omega$ is conservative, and assume for the moment that $M$ is connected. Because the line integrals of $\omega$ are path-independent, we can adopt the following notation: for any points $\mathbf{p},\mathbf{q}\in M$, we use the notation $\int_\mathbf{p}^\mathbf{q} \omega$ to denote the value of any integral of the form $\int_\gamma \omega$, where $\gamma$ is a piecewise smooth curve segment from $\mathbf{p}$ to $\mathbf{q}$. Because a backward representation of a path from $\mathbf{p}$ to $\mathbf{q}$ is path from $\mathbf{q}$ to $\mathbf{p}$, then by parameter independence it follows that $\int_\mathbf{q}^\mathbf{p} \omega = -\int_\mathbf{p}^\mathbf{q \omega}$. For any three points $\mathbf{p}_1, \mathbf{p}_2, \mathbf{p}_3\in M$, then by properties of the line integral

$$
  \int_{\mathbf{p}_1}^{\mathbf{p}_2} \omega + \int_{\mathbf{p}_2}^{\mathbf{p}_3} \omega = \int_{\mathbf{p}_1}^{\mathbf{p}_3} \omega
$$

Choose any base point $\mathbf{p}_0 \in M$, and define a function $f:M\to\R$ by $f(\mathbf{q}) = \int_{\mathbf{p}_0}^\mathbf{q} \omega$. We need to show that $f$ is smooth and $\d f = \omega$. To accomplish this, let $\mathbf{q}_0 \in M$ be arbitrary, let $(U, (x^i))$ be a smooth chart centered at $\mathbf{q}_0$, and write the coordinate representation of $\omega$ in $U$ as $\omega = \omega_i \d x^i$. We need to show that

$$
  \frac{\partial f}{\partial x^j} (\mathbf{q}_0) = \omega_j (\mathbf{q}_0),\; j=1,\dots,\n
$$

which implies that $\d f_{\mathbf{q}_0} = \omega_{\mathbf{q}_0}$.

First suppose $\mathbf{q}_0 \in \mathrm{int}(M)$. Fix $j$, and let $\gamma:[-\varepsilon,\varepsilon]\to U$ be the smooth curve segment defined in coordinates by $\gamma(t) = (0,\dots,t,\dots,0)$ with $t$ in the $j$th place, and with $\varepsilon$ chose small enough that $\gamma[-\varepsilon, \varepsilon]\subseteq U$. Let $\mathbf{p}_1 = \gamma(-\varepsilon)$, and define a new function $\tilde{f}: M\to \R$ by $\tilde{f}(\mathbf{q}) = \int_{\mathbf{p}_1}^\mathbf{q} \omega$. Then

$$
\begin{align*}
  f(\mathbf{q}) - \tilde{f}(\mathbf{q}) =& \int_{\mathbf{p}_0}^\mathbf{q} \omega - \int_{\mathbf{p}_1}^\mathbf{q} \omega \\
  =& \int_{\mathbf{p}_0}^\mathbf{q} \omega + \int_\mathbf{q}^{\mathbf{p}_1} \omega \\
  =& \int_{\mathbf{p}_0}^{\mathbf{p}_1} \omega
\end{align*}
$$

which does not depend on $\mathbf{q}$. Thus $\tilde{f}$ and $f$ differ by a constant, so it suffices to show that $\frac{\partial\tilde{f}}{\partial x^j}(\mathbf{q_0}) = \omega_j (\mathbf{q}_0)$.

Now $\gamma'(t) = \left.\frac{\partial}{\partial x^j}\right|_{\gamma(t)}$ by construction, so

$$
\begin{align*}
  \omega_{\gamma(t)}(\gamma'(t)) =& \omega_i (\gamma(t))\d x^i \left(\left.\frac{\partial}{\partial x^j}\right|_{\gamma(t)} \right) = \gamma_j (\gamma(t))
\end{align*}
$$

Since the restriction of $\gamma$ to $[-\epsilon, t]$ is a smooth curve from $\mathbf{p}_1$ to $\gamma(t)$ we have

$$
\begin{align*}
  \tilde{f}\circ\gamma(t) =& \int_{\mathbf{p}_1}^{\gamma(t)} \omega = \int_{-\varepsilon}^t \omega_{\gamma(s)}(\gamma'(s))\;\d s \\
  =& \int_{-\varepsilon}^t \omega_j (\gamma(s))\;\d s
\end{align*}
$$

Thus, by the fundamental theorem of calculus

$$
\begin{align*}
  \frac{\partial\tilde{f}}{\partial x^j} (\mathbf{q}_0) =& \gamma'(0)\tilde{f} = \left.\frac{\d}{\d t}_{t=0} \tilde{f}\circ\gamma(t) \\
  =& \left.\frac{\d}{\d t}_{t=0} \int_{-\varepsilon}^t \omega_j (\gamma(s))\;\d s \\
  =& \omega_j (\gamma(0)) = \gamma_j (\mathbf{q}_0)
\end{align*}
$$

This shows that $\d f_{\mathbf{q}_0} = \omega_{\mathbf{q}_0}$ when $\mathbf{q}_0 \in \mathrm{int}(M)$.

For $\mathbf{q}_0 \in \partial M$, the chart $(U, (x^i))$ is a boundary chart centered at $\mathbf{q}_0$. The proof above shows that $\frac{\partial f}{\partial x^j}(\mathbf{q}_0) = \omega_j (\mathbf{q}_0)$ except in the case $j = n$. That case requires a special argument because $x^n$ takes on only nonnegative values in a boundary chart. In that case we simply set $\mathbf{p}_1 = \gamma(0)$ instead of $\mathbf{p}_1 = \gamma(-\varepsilon)$, and proceed as before. Then the same argument shows that $\d f_{\mathbf{q}_0} = \omega_{\mathbf{q}_0}$ in this case as well. This completes the proof that $\d f = \omega$ when $M$ is connected. Since the component functions of $\omega$ are smooth and equal to the partial derivatives of $f$ in coordinates, this also shows that $f$ is smooth.

Finally, if $M$ is not connected, let $\Set{M_i}$ be the components of $M$. The argument above shows that for each $i$ there is a function $f_i \in C^\infty (M_i)$ such that $\d f_i = \omega$ on $M_i$. Letting $f:M\to\R$ be the function that is equal to $f_i$ on $M$ for each $i$, we have $\d f = \omega$, thus completing the proof.
</details>
</MathBox>

<MathBox title='Closed covector field' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. A smooth covector field $\omega$ on $M$ is *closed* if its components in every smooth chart satisfy

$$
  \frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}
$$
</MathBox>

<MathBox title='Every exact covector field is closed' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and suppose $\omega\in\mathfrak{X}^* (M)$ is an exact covector field. Then $\omega$ is closed.

<details>
<summary>Proof</summary>

Let $f$ by any potential for $\omega$, and let $(U,(x^i))$ be any smooth chart on $M$. Because $f$ is smooth, its mixed partials are equal, giving

$$
  \frac{\partial^2 f}{\partial x^i \partial x^j} = \frac{\partial^2 f}{\partial x^j \partial x^i}
$$

Writing $\omega = \omega \d x^i$ in coordinates, we see that $\omega = \d f$ is equivalent to $\omega_i = \frac{\partial f}{\partial x^i}$. Substituting this into the mixed partials identity, we find that the component functions of $\omega$ satisfy the following identity for pair of indices $i$ and $j$:

$$
  \frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $\omega$ be a smooth covector field on a smooth manifold $M$ with or without boundary. The following are equivalent:
1. $\omega$ is closed
2. $\omega$ satisfies $\frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}$ in some smooth chart around every point
3. for any open subset $U\subseteq M$ and smooth vector fields $X, Y\in \mathfrak{X}(U)$
$$
  X(\omega(Y)) - Y(\omega(X)) = \omega([\mathbf{X},\mathbf{Y}])
$$

<details>
<summary>Proof</summary>

We will prove that **(1)** $\implies$ **(2)** $\implies$ **(3)** $\implies$ **(1)**. The implication **(1)** $\implies$ **(2)** is immediate from the definition of closed covector fields.

To prove **(2)** $\implies$ **(3)**, assume **(2)** holds, and suppose $U\subseteq M$ and $X,Y\in\mathfrak{X}(U)$ as in the statement of **(3)**. It suffices to verify that $X(\omega(Y)) - Y(\omega(X)) = \omega([\mathbf{X},\mathbf{Y}])$ holds in a neighbourhood of each point of $U$. In any coordinate chart $(V, (x^i))$ with $V\subseteq U$, we can write $\omega = \omega_i \d x^i$, $X = X^j \frac{\partial}{\partial x^j}$ and $Y = Y^k \frac{\partial}{\partial x^k}$, and compute

$$
\begin{align*}
  X(\omega(Y)) =& X(\omega_i Y^i) = Y^i X\omega_i + \omega_i XY^i \\
  =& Y^i X^j \frac{\partial \omega_i}{\partial x^j} + \omega_i XY^i
\end{align*}
$$

Also

$$
\begin{align*}
  Y(\omega(X)) =& Y(\omega_i X^i) = X^i Y\omega_i + \omega_i YX^i \\
  =& X^i Y^j \frac{\partial \omega_i}{\partial x^j} + \omega_i YX^i
\end{align*}
$$

such that

$$
\begin{align*}
  X(\omega(Y)) - Y(\omega(X)) =& Y^i X^j \frac{\partial \omega_i}{\partial x^j} + \omega_i XY^i \\
  &- X^j Y^i \frac{\partial \omega_j}{\partial x^i} + \omega_i YX^i \\
  =& \omega_i (XY^i - YX^i)
\end{align*}
$$

The coordinate formula for the Lie bracket shows that this last expression is equal to $\omega([\mathbf{X},\mathbf{Y}])$.

Finally, if $\omega$ satisfies **(3)**, in any coordinate chart we can apply $X(\omega(Y)) - Y(\omega(X)) = \omega([\mathbf{X},\mathbf{Y}])$ with $X = \frac{\partial}{\partial x^i}$ and $Y = \frac{\partial}{\partial x^j}$, noting that $[\mathbf{X},\mathbf{Y}] = 0$ in that case, to obtain $\frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}$.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
Suppose $F:M\to N$ is a local diffeomorphism. Then the pullback $F^*: \mathfrak{X}^* (N) \to\mathfrak{X}^* (M)$ takes closed covector fields to closed covector fields, and exact ones to exact ones.

<details>
<summary>Proof</summary>

The result for exact covectors fields follows immediately from $F*\d u = \d(u\circ F)$. For closed vector fields, if $(U,\varphi)$ is any smooth chart for $N$, then $\varphi\circ F$ is a smooth chart for $M$ in a neighbourhood of each point of $F^{-1}(U)$. In these coordinates, the coordinate representation of $F$ is the identity, so if $\omega$ satisfies $\frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}$ in $U$, then $F^* \omega$ satisfies $\frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}$ in $F^{-1}(U)$.
</details>
</MathBox>

<MathBox title='Star-shaped subset' boxType='definition'>
If $V$ is a finite-dimensional vector space, a subset $U\subseteq V$ is *star-shaped* if there is a point $\mathbf{c}\in U$ such that for every $\mathbf{x}\in U$, the line segment from $\mathbf{c}\to \mathcal{x}$ is entirely contained in $U$. In particular, every convex subset is star-shaped.
</MathBox>

<MathBox title='Pointar lemma for covector fields' boxType='theorem'>
If $U$ is a star-shaped open subset of $\R^n$ or $\mathbb{H}^n$, then every closed covector field on $U$ is exact.

<details>
<summary>Proof</summary>

Suppose $U$ is star-shaped with respect to $\mathbf{c}\in U$ and let $\omega = \omega_i \d x^i$ be a closed covector field on $U$. We will construct a potential function for $\omega$ by integrating along smooth curve segments from $\mathbf{c}$. However, we dot not know a priori that the line integrals are path-independent, so we must integrate along specific paths.

Because diffeomorphisms take closed forms to closed forms and exact one to exact one, we can apply a translation to $U$ to arrange that $\mathbf{c} = \mathbf{0}$. For any point $\mathbf{x}\in U$, let $\gamma_\mathbf{x}: [0,1]\to U$ denote the line segment from $\mathbf{0}$ to $\mathbf{x}$, parametrized as $\gamma_x (t) = t\mathbf{x}$. The hypothesis guarantees that the image of $\gamma_\mathbf{x}$ lies entirely in $U$ for each $\mathbf{x}\in U$. Define a function $f:U\to\R$ by

$$
  f(\mathbf{x}) = \int_{\gamma_\mathbf{x}} \omega
$$

We need to show that $f$ is a potential for $\omega$, or equivalently that $\frac{\partial f}{\partial x^j} = omega^j$ for $j=1,dots,n$. To begin, we compute

$$
\begin{align*}
  f(\mathbf{x}) =& \int_0^1 \omega_{\gamma_\mathbf{x} (t)}(\gamma'_\mathbf{x}(t))\;\d t \\
  =& \int_0^1 \omega_i (t\mathbf{x}) x^i \;\d t
\end{align*}
$$

To compute the partial derivative of $f$, we note that the integrand is smooth in all variables, so it is permissible to differentiate under the integral sign to obtain

$$
  frac{\partial f}{\partial x^j}(\mathbf{x}) = \int_0^1 \left( t\frac{\partial\omega_i}{\partial x^j}(t\mathbf{x})x^i + \omega_j (t\mathbf{x}) \right)\d t
$$

Because $\omega$ is close this reduces to

$$
\begin{align*}
  \frac{\partial f}{\partial x^j}(\mathbf{x}) =& \int_0^1 \left( t\frac{\partial\omega_i}{\partial x^i} (t\mathbf{x})x^i + \omega_j (t\mathbf{x}) \right)\d t \\
  =& \int_0^1 \frac{\d}{\d t} (t\omega_j (t\mathbf{x}))\;\d t = [t\omega_j(t\mathbf{x})]_{t=0}^{t=1} \\
  =& \omega_j (\mathbf{x})
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Local exactness of closed covector fields' boxType='corollary'>
Let $\omega$ be a closed covector field on a smooth manifold $M$ with or without boundary. Then every point of $M$ has a neighbourhood on which $\omega$ is exact.

<details>
<summary>Proof</summary>

Let $\mathbf{p}\in M$ be arbitrary. The hypothesis implies that $\omega$ satisfies $\frac{\partial\omega_j}{\partial x^i} = \frac{\partial\omega_i}{\partial x^j}$ in some smooth coordinate ball or half-ball $(U,\varphi)$ containing $\mathbf{p}$. Because balls and half-balls are convex, we can apply the Pointar lemma to the coordinate representation of $\omega$ and conclude that there is a function $f\in C^\infty (U)$ such that $\omega|_U = \d f$.
</details>
</MathBox>

# Tensors

## Multilinear algebra
<MathBox title='Multilinear map' boxType='definition'>
Suppose $V_1,\dots, V_k$ and $W$ are vector spaces. A map $F:V_1 \times\cdots\times V_k \to W$ is multilinear if it is linear as a function of variable separately when the others are held fixed, i.e. for each $i=1,\dots,k$ and $\alpha, \alpha'\in\R$

$$
\begin{align*}
  F(\mathbf{v}_1,\dots,\alpha\mathbf{v}_i + \alpha' \mathbf{v}'_i,\dots,\mathbf{v}_k) =& \alpha F(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  &+ \alpha' F(\mathbf{v}_1,\dots,\mathbf{v}'_i,\dots,\mathbf{v}_k)
\end{align*}
$$

The set of all multilinear maps from $V_1\times\cdots\times V_k$ to $W$ is denoted $\mathrm{L}(V_1,\dots,V_k;W)$. This is a vector space under the usual operations of pointwise addition and scalar multiplication

$$
\begin{align*}
  (F + F')(\mathbf{v}_1,\dots,\mathbf{v}_k) =& F(\mathbf{v}_1,\dots,\mathbf{v}_k) + F'(\mathbf{v}_1,\dots,\mathbf{v}_k) \\
  (\alpha F)(\mathbf{v}_1,\dots,\mathbf{v}_k) =& \alpha (F(\mathbf{v}_1,\dots,\mathbf{v}_k))
\end{align*}
$$
</MathBox>

<MathBox title='Tensor product' boxType='definition'>
Suppose $V_1,\dots, V_k, W_1,\dots W_l$ are vector spaces and suppose $F \in\mathrm{L}(V_1,\dots,V_k;\R)$ and $G\in\mathrm{L}(W_1,\dots,W_l;\R)$. Define a function

$$
  F \otimes G: V_1\times\cdots\times V_k \times W_1 \times\cdots\times W_l \to \R
$$

by

$$
  F\otimes G (\mathbf{v}_1,\dots,\mathbf{v}_k,\mathbf{w}_1,\dots,\mathbf{w}_k) = F(\mathbf{v}_1,\dots,\mathbf{v}_k)G(\mathbf{w}_1,\dots,\mathbf{w}_l)
$$

If follows from the multilinearity of $F$ and $G$ that $F\otimes G(\mathbf{v}_1,\dots,\mathbf{v}_k,\mathbf{w}_1,\dots,\mathbf{w}_l)$ depends linearly on each argument $\mathbf{v}_i$ or $\mathbf{w}_j$ separately, so $F\otimes G \in L(V_1,\dots,V_k,W_1,\dots,W_l;\R)$ called. This is called the *tensor product* of $F$ and $G$.

If $\omega^j \in V_j^*$ for $j=1,\dots,k$, then $\omega^1 \otimes\cdots\otimes\omega^k \in\mathrm{L}(V_1,\dots,V_k;\R)$ is the multilinear function given by

$$
  \omega^1 \otimes\cdots\omega^k (\mathbf{v}_1,\dots,\mathbf{v}_k) = \omega^1 (\mathbf{v}_1)\cdots\omega^k (\mathbf{v}_k)
$$
</MathBox>

<MathBox title='A basis for the space of multilinear functions' boxType='proposition'>
Let $V_1,\dots,V_k$ be real vector spaces of dimensions $n_1,\dots,n_k$, respectively. For each $j\in\Set{1,\dots,k}$, let $(\mathbf{e}_i^{(j)},\dots, \mathbf{e}_{n_j}^{(j)})$ be a basis for $V_j$, and let $(\varepsilon_{(j)}^1,\dots,\varepsilon_{(j)}^{n_j})$ be the corresponding dual basis for $V_j^*$. Then the set

$$
  B = \Set{\varepsilon_{(1)}^{i_1} \otimes\cdots\otimes\varepsilon_{(k)}^{i_k} | 1\leq i_1 \leq n_1, \dots, 1 \leq i_k \leq n_k}
$$

is a basis for $\mathbf{L}(V_1,\dots,V_k;\R)$, which therefore has dimension equal to $\prod_{j=1}^k n_j$.

<details>
<summary>Proof</summary>

We need to show that $B$ is linearly independent and spans $\mathrm{L}(V_1,\dots,V_k;\R)$. Suppose $F\in\mathrm{L}(V_1,\dots,V_k;\R)$ is arbitrary. For each ordered $k$-tuple $(i_1,\dots,i_k)$ of integers with $1 \leq i_j \leq n_j$, define a number $F_{i_k\dots i_k}$ by

$$
  F_{i_k\dots i_k} = F\left( \mathbf{e}_{i_1}^{(1)},\dots,\mathbf{e}_{i_k}^{(k)} \right)
$$

we will show that

$$
  F = F_{i_1\dots i_k} \varepsilon_{(1)}^{i_1} \otimes\cdots\otimes\varepsilon_{(k)}^{i_k}
$$

from which it follows that $B$ spans $\mathrm{L}(V_1,\dots,V_k;\R)$. For any $k$-tuple of vectors $(\mathbf{v}_j)_{j=1}^k \in \prod_{j=1}^k V_j$, write $\mathbf{v}_j = v_j^{i_j} \mathbf{e}_{i_j}^{(j)}$ and compute

$$
\begin{align*}
  F_{i_1\dots i_k} \varepsilon_{(1)}^{i_1} \otimes\cdots\otimes \varepsilon_{(k)}^{i_k} (\mathbf{v}_1,\dots, \mathbf{v}_k) =& F_{i_1\dots i_k} \varepsilon_{(1)}^{i_1} (\mathbf{v}_1)\cdots \varepsilon_{(k)}^{i_k}(\mathbf{v}_k) \\
  =& F_{i_1\dots i_k} v_{1}^{(i_1)} \cdots v_k^{i_k}
\end{align*}
$$

while $F(\mathbf{v}_1,\dots,\mathbf{v}_k)$ is equal to the same by multilinearity. This proves the claim.

To show that $B$ is linearly indpendent, suppose some linear combination equals zero:

$$
  F_{i_1\dots i_k} \varepsilon_{(1)}^{i_1} \otimes\cdots\otimes\varepsilon_{(k)}^{i_k} = 0
$$

Apply this to any ordered $k$-tuple of basis vectors, $(\mathbf{e}_{j_i}^{(i)})_{i=1}^{k}$. By the same computation as above, this implies that each coefficient $F_{j_1\dots j_k}$ is zero. Thus, the only linear combination of elements of $B$ that sums to zero is the trivial one.
</details>
</MathBox>

### Abstract tensor products of vector spaces

<MathBox title='Free vector space' boxType='definition'>
For any set $S$, a *formal linear combination* of elements of $S$ is a function $f: S\to\R$ such that $f(s) = 0$ for all but finitely many $s\in S$. The *free vector space* on $S$, denoted $\mathcal{F}(S)$, is the set of all formal linear combination of elements of $S$. Under pointwise addition and scalar multiplication, $\mathcal{F}(S)$ becomes a vector space over $\R$.

<details>
<summary>Details</summary>

For each $x\in S$, there is a function $\delta_x \in \mathcal{F}(S)$ defined by

$$
  \delta_x(s) = \begin{cases}
    1,\quad& s = x \\
    0,\quad& s \neq x
  \end{cases}
$$

Typically we identify this function with $x$, and therefore think of $S$ as a subset of $\mathcal{F}(S)$. Every element $f\in \mathcal{F}(S)$ can then be uniquely written in the form $f = \sum_{i=1}^m a_i x_i$, where $x_1,\dots, x_m$ are the elements of $S$ for which $f(x_i) \neq = 0$, and $a_i = f(x_i)$. Thus, $S$ is a basis for $\mathcal{F}(S)$, which is therefore finite-dimensional if and only if $S$ is a finite set.
</details>
</MathBox>

<MathBox title='Characteristic property of the free vector space' boxType='definition'>
For any set $S$ and any vector space $W$, every map $A: S\to W$ has a uniqe extension to a linear map $\overline{A}:\mathcal{F}(S) \to W$.
</MathBox>

<MathBox title='Tensor product space' boxType='definition'>
Let $V_1,\dots,V_k$ be real vector spaces and let $\mathcal{F}(V_1\times\cdots\times V_k)$ be the set of all finite formal linear combinations of $k$-tuples $(\mathbf{v}_i \in V_i)_{i=1}^k$. Let $\mathcal{R}$ be the subspace of $\mathcal{F}(V_1 \times\cdots\times V_k)$ spanned by all elements of the following forms

$$
\begin{gather}
  (\mathbf{v}_1,\dots,\alpha\mathbf{v}_i,\dots,\mathbf{v}_k) - \alpha(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k),\; \alpha\in\R \\
  (\mathbf{v}_1,\dots,\mathbf{v}_i + \mathbf{v}'_i,\dots,\mathbf{v}_k) - (\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) - (\mathbf{v}_1,\dots,\mathbf{v}'_i,\dots,\mathbf{v}_k),\; \mathbf{v}_j, \mathbf{v}_j \in V_j
\end{gather}
$$

The *tensor product space* of $V_1,\dots, V_k$ is defined as the quotient vectors space

$$
  \bigotimes_{i=1}^k V_i = \mathcal{F}\left(\prod_{i=1}^k V_i \right)/\mathcal{R}
$$

Let $\Pi: \mathcal{F}\left(\prod_{i=1}^k V_i \right) \to \bigotimes_{i=1}^k V_i$ be the natural projection. The equivalence class of an element $(\mathbf{v}_i)_{i=1}^k \in \bigotimes_{i=1}^k V_i$ is denoted by

$$
  \mathbf{v}_1 \otimes\cdots\mathbf{v}_k = \Pi(\mathbf{v}_1,\dots,\mathbf{v}_k)
$$

and is called the *(abstract) tensor product* of $\mathbf{v}_1,\dots,\mathbf{v}_k$. It follows from the definition that the tensor product satisfies

$$
\begin{align*}
  \mathbf{v}_1 \otimes\cdots\otimes \alpha\mathbf{v}_i \otimes\cdots\otimes \mathbf{v}_k =& \alpha(\mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}_i \otimes\cdots\otimes \mathbf{v}_k) \\
  \mathbf{v}_1 \otimes\cdots\otimes (\mathbf{v}_i + \mathbf{v}'_i) \otimes\cdots\otimes \mathbf{v}_k =& (\mathbf{v}_1 \otimes\cdots\otimes\mathbf{v}_i \otimes\cdots\otimes \mathbf{v}_k) \\
  &+ (\mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}'_i \otimes\cdots\otimes \mathbf{v}_k) 
\end{align*}
$$
</MathBox>

<MathBox title='Characteristic property of the tensor product space' boxType='proposition'>
Let $V_1,\dots, V_k$ be finite-dimensional real vector spaces. If $A: V_1 \times\cdots V_k \to X$ is any multilinear map into a vector space $\mathbf{X}$, then there is a unique linear map $\tilde{A}: V_1 \otimes\cdots\otimes V_k$ such that the following diagram commutes

$$
\begin{CD}
  \prod_{i=1}^k V_i @>{A}>> X \\
  @V{\pi}VV @AA{\tilde{A}}A \\
  \bigotimes_{i=1}^k V_i @= \bigotimes_{i=1}^k V_i
\end{CD}
$$

where $\pi$ is the map $\pi(\mathbf{v}_1,\dots,\mathbf{v}_k) = \mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}_k$.

<details>
<summary>Proof</summary>

Note that any map $A:\prod_{i=1}^k V_i \to X$ extends uniquely to a linear map $\overline{A}:\mathcal{F}\left(\prod_{i=1}^k V_i \right)\to X$ by the characteristic property of the free vector space. This map is characterized by the fact that $\overline{A}(\mathbf{v}_1,\dots,\mathbf{v}_k) = A(\mathbf{v}_1,\dots,\mathbf{v}_k)$ whenever $(\mathbf{v}_1,\dots,\mathbf{v}_k)\in \prod_{i=1}^k V_i \subseteq \mathcal{F}\left(\prod_{i=1}^k V_i \right)$. The fact that $A$ is multilinear means precisely that the subspace $\mathcal{R}$ is contained in the kernel of $\overline{A}$, because

$$
\begin{align*}
  \overline{A}(\mathbf{v}_1,\dots,\alpha\mathbf{v}_i\,dots,\mathbf{v}_k) =& A(\mathbf{v}_1,\dots,\alpha\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  =& \alpha A(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  =& a\overline{A}(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  =& \overline{A}(\alpha(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k))
\end{align*}
$$

and

$$
\begin{align*}
  \overline{A}(\mathbf{v}_1,\dots,\mathbf{v}_i + \mathbf{v}'_i \,dots,\mathbf{v}_k) =& A(\mathbf{v}_1,\dots,\mathbf{v}_i + \mathbf{v}'_i \,dots,\mathbf{v}_k) \\
  =& A(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  &+ A(\mathbf{v}_1,\dots,\mathbf{v}'_i,\dots,\mathbf{v}_k)
  =& \overline{A}(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  &+ \overline{A}(\mathbf{v}_1,\dots,\mathbf{v}'_i,\dots,\mathbf{v}_k) \\
  =& \overline{A}((\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) + (\mathbf{v}_1,\dots,\mathbf{v}'_i,\dots,\mathbf{v}_k))
\end{align*}
$$

Thus, $\overline{A}$ descends to a linear map $\tilde{A}: \bigotimes_{i=1}^k V_i  = \mathcal{F}\left(\prod_{i=1}^k V_i \right)/\mathcal{R}$ satisfying $\tilde{A}\circ\Pi = \overline{A}$. Since $\pi$ is equal to the inclusion $\prod_{i=1}^k V_i \hookrightarrow \mathcal{F}\left(\prod_{i=1}^k V_i \right)$ followed by $\Pi$, this implies $\tilde{A}\circ\pi = A$, which is in accordance with the stated commutative diagram. Uniqueness follows from the fact that every element of $V_1 \otimes\cdots\otimes V_k$ can be written as a linear combination of elements of the form $\mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}_k$, and $\tilde{A}$ is uniquely determined on such elements by

$$
\begin{align*}
  \tilde{A}(\mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}_k) =& \overline{A}(\mathbf{v}_1,\dots,\mathbf{v}_k) \\
  =& A(\mathbf{v}_1,\dots,\mathbf{v}_k)
\end{align*}
$$
</details>
</MathBox>

<MathBox title='A basis for the tensor product space' boxType='proposition'>
Let $V_1,\dots,V_k$ be real vector spaces of dimensions $n_1,\dots,n_k$, respectively. For each $j\in\Set{1,\dots,k}$, let $(\mathbf{e}_i^{(j)},\dots, \mathbf{e}_{n_j}^{(j)})$ be a basis for $V_j$. Then the set

$$
  B = \Set{\mathbf{e}_{(1)}^{i_1} \otimes\cdots\otimes\mathbf{e}_{(k)}^{i_k} | 1\leq i_1 \leq n_1, \dots, 1 \leq i_k \leq n_k}
$$

is a basis for $\bigotimes_{i=1}^k V_i$, which therefore has dimension equal to $\prod_{j=1}^k n_j$.

<details>
<summary>Proof</summary>

Elements of the form $\mathbf{v}_1 \otimes\cdots\otimes \mathbf{v}_k$ span the tensor product space by definition. Expanding each $\mathbf{v}_i$ in such an expression in terms of its basis representation shows that $B$ spans $\bigotimes_{i=1}^k V_i$.

To prove that $B$ is linearly independent, assume some linear combination of elements of $B$ is equal to zero:

$$
  a^{i_1\dots i_k} \mathbf{e}_{i_1}^{(1)}\otimes\cdots\otimes \mathbf{e}_{i_k}^{(k)} = \mathbf{0}
$$

For each ordered $k$-tuple of indices $(m_1,\dots,m_k)$, define a multilinear function $\tau^{m_1\dots m_k}: \prod_{i=1}^k V_i \to\R$ by

$$
  \tau^{m_1\dots m_k} (\mathbf{v}_1,\dots,\mathbf{v}_k) = \varepsilon_{(1)}^{m_1}(\mathbf{v}_1)\cdots\varepsilon_{(k)}^{m_k}(\mathbf{v}_k)
$$

where $\left( \varepsilon_{(j)}^i \right)$ is the basis for $V_j^*$ dual to $(\mathbf{e}_i^{(j)})$. Because $\tau^{m_1\dots m_k}$ is multilinear, it descends to a linear to a linear function $\tilde{\tau}^{m_1\dots m_k}: \bigotimes_{i=1}^k V_k \to\R$ by the characteristic property of the tensor product. It follows That

$$
\begin{align*}
  0 =& \tilde{\tau}^{m_1\dots m_k} ( a^{i_1\dots i_k} \mathbf{e}_{i_1}^{(1)} \otimes\cdots\otimes \mathbf{e}_{i_k}^{(k)}) \\
  =& a^{i_i \dots i_k} \tau^{m_1 \dots m_k} (\mathbf{e}_{i_1}^{(1)} \otimes\cdots\otimes \mathbf{e}_{i_k}^{(k)}) \\
  =& a^{m_1\dots m_k} 
\end{align*}
$$

which shows that $B$ is linearly independent.
</details>
</MathBox>

<MathBox title='Associativity of tensor product spaces' boxType='proposition'>
Let $V_1$, $V_2$ and $V_3$ be finite-dimensional real vector spaces. There are unique isomorphisms

$$
  V_1 \otimes (V_2 \otimes V_3) \cong V_1 \otimes V_2 \otimes V_3 \cong (V_1 \otimes V_2) \otimes V_3
$$

under which elements of the forms $\mathbf{v}_1 \otimes (\mathbf{v}_2 \otimes \mathbf{v}_3)$, $\mathbf{v}_1 \otimes \mathbf{v}_2 \otimes \mathbf{v}_3$ and $(\mathbf{v}_1 \otimes \mathbf{v}_2) \otimes \mathbf{v}_3$ all correspond.

<details>
<summary>Proof</summary>

We construct the isomorphism $V_1 \otimes V_2 \otimes V_3 \cong (V_1 \otimes V_2) \cong V_3$; the other one is constructed similarly. The map $\alpha: V_1\times V_2 \times V_3 \to (V_1 \otimes V_2) \otimes V_3$ defined by

$$
  \alpha(\mathbf{v}_1,\mathbf{v}_2,\mathbf{v}_3) = (\mathbf{v}_1 \otimes\mathbf{v}_2)\otimes\mathbf{v}_3
$$

is obviously multilinear, and thus by the characteristic property of the tensor product it descends uniquely to a linear map $\tilde{\alpha}: V_1\otimes V_2\otimes V_3 \to (V_1 \otimes V_2)\otimes V_3$ satisfying $\tilde{\alpha}(\mathbf{v}_1 \otimes \mathbf{v}_2 \otimes \mathbf{v}_3) = (\mathbf{v}_1 \otimes \mathbf{v}_2) \otimes \mathbf{v}_3$ for all $\mathbf{v}_i \in V_i$, where $i = 1,2,3$. Because $(V_1 \otimes V_2) \otimes V_3$ is spanned by elements of the form $(\mathbf{v}_1 \otimes \mathbf{v}_2)\otimes \mathbf{v}_3$, it follows that $\tilde{\alpha}$ is surjective, and therefore it is an isomorphism for dimensional reasons. It is clearly the unique such isomorphism, because any other would have to agree with $\tilde{\alpha}$ on the set of all elements of the form $\mathbf{v}_1 \otimes\mathbf{v}_2 \otimes\mathbf{v}_3$, which spans $V_1 \otimes V_2 \otimes V_3$.
</details>
</MathBox>

<MathBox title='Relation between abstract and concrete vector products' boxType='proposition'>
If $V_1,\dots,V_k$ are finite-dimensional vector spaces, there is a canonical isomorphism

$$
  \bigotimes_{i=1}^k V_i^* \cong \mathrm{L}(V_1,\dots, V_k;\R)
$$

under which the abstract tensor product corresponds to the product of covectors.

<details>
<summary>Proof</summary>

First define a map $\Phi: \prod_{i=1}^k V_i^* \to\mathrm{L}(V_i,\dots,V_k;\R)$ by

$$
  \Phi(\omega^1,\dots,\omega^k)(\mathbf{v}_1,\dots,\mathbf{v}_k) = \prod_{i=1}^k \omega^i (\mathbf{v}_i)
$$

The expression on the right depends linearly on each $\mathbf{v}_i$ so $\Phi(\omega^1,\dots,\omega^k)$ is indeed an element of the space $\mathrm{L}(V_1,\dots,V_k;\R)$. It is easy to check that $\Phi$ is multilinear as a function of $\omega^1,\dots,\omega^k$, so by the characteristic property it descends uniquely to a linear map $\tilde{\Phi}$ from $\bigotimes_{i=1}^k V_i^*$ to $\mathrm{L}(V_1,\dots,V_k;\R)$, which satisfies

$$
  \tilde{\Phi}\left(\bigotimes_{i=1}^k \omega^i \right)(\mathbf{v}_1,\dots,\mathbf{v}_k) = \prod_{i=1}^k \omega_i (\mathbf{v}_i)
$$

It follows immediately from the definition that $\tilde{Phi}$ takes abstract tensor products to tensor products of covectors. It also thakes the basis of $\bigotimes_{i=1}^k V_1^*$ to the basis for $\mathrm{L}(V_1,\dots,V_k;\R)$, so it is an isomorphism.
</details>
</MathBox>

If $V_1,\dots,V_k$ are finite-dimensional vector spaces, we can also identify each $V_j$ with its second dual space $V_j^**$, and thereby obtain another canonical identification

$$
  \bigotimes_{i=1}^k V_i \cong \mathrm{L}(V_1^*,\dots,V_k^*;\R)
$$

### Covariant and contravariant tensors on a vector space

<MathBox title='Covariant tensor' boxType='definition'>
Let $V$ be an $n$-dimensional real vector space. If $k\in\N^+$, a *covariant* $k$-tensor on $V$ is an element of the $k$-fold tensor product $\bigotimes_{i=1}^k V^*$, which can be represented as a multilinear functional $T: \prod_{i=1}^k V \to\R$, called a $k$-form. If $(\mathbf{e}_i)_{i=1}^n$ is basis for $V$ with dual basis $(\varepsilon^i)_{i=1}^n$ for $V^*$, the $T$ takes the form

$$
  T = T_{i_1\dots i_k} \varepsilon^{i_1} \otimes\cdots\otimes \varepsilon^{i_k},\; 1\leq j_1,\dots,j_k \leq n
$$

where the $n^k$ components $T_{i_1\dots i_k}$ are given by

$$
  T_{i_1\dots i_k} = T(\mathbf{e}_{j_1},\dots,\mathbf{e}_{j_k})
$$

The number $k$ is called the *covariant rank* of $T$. The vector space of all covariant $k$-tensors on $V$ is denoted

$$
  T_k (V^*) = \bigotimes_{i=1}^k V^*
$$
</MathBox>

<MathBox title='Contravariant tensor' boxType='definition'>
Let $V$ be an $n$-dimensional real vector space. If $k\in\N^+$, a *contravariant* $k$-tensor on $V$ is an element of the $k$-fold tensor product $\bigotimes_{i=1}^k V$, which can be represented as a multilinear operator $T: \prod_{i=1}^k V^* \to\R
$. If $(\mathbf{e}_i)_{i=1}^n$ is basis for $V$ with dual basis $(\varepsilon^i)_{i=1}^n$ for $V^*$, then $T$ takes the form

$$
  T = T^{i_1\dots i_k} \mathbf{e}_{i_1} \otimes\cdots\otimes \mathbf{e}_{i_k},\; 1\leq i_1,\dots,i_k \leq n
$$

where the $n^k$ components $T^{i_1\dots i_k}$ are given by

$$
  T^{i_1\dots i_k} = T(\varepsilon^{i_1},\dots, \varepsilon^{i_k})
$$

The number $k$ is called the *contravariant rank* of $T$. The vector space of all contravariant $k$-tensors on $V$ is denoted

$$
  T^k (V) = \bigotimes_{i=1}^k V
$$
</MathBox>

<MathBox title='Mixed tensor' boxType='definition'>
Let $V$ be an $n$-dimensional real vector space. A tensor with contravariant rank $k$ and covariant rank $l$, denoted $\binom{k}{l}$-rank tensor, is an element of the $(k+l)$-fold tensor product $\left(\bigotimes_{i=1}^k V\right)\otimes\left(\bigotimes_{i=1}^l V^*\right)$, which can be represented as a multilinear operator 

$$
  T: \left(\prod_{i=1}^l V^*\right)\times\left(\prod_{i=1}^k V\right)\to\R
$$

If $(\mathbf{e}_i)_{i=1}^n$ is a basis for $V$ and $(\varepsilon^i)_{i=1}^n$ is the corresponding dual basis for $V^*$, the $\binom{k}{l}$-tensor $T$ takes the form

$$
  T = T_{j_1\dots j_k}^{i_1\dots i_l} \mathbf{e}_{j_1} \otimes\cdots\otimes \mathbf{e}_{j_k} \otimes \varepsilon^{j_1} \otimes\cdots\otimes \varepsilon^{j_k}
$$

where the components of $T_{j_1\dots j_k}^{i_1\dots i_l}$ are given by

$$
  T_{j_1\dots j_k}^{i_1\dots i_l} = T(\varepsilon^{j_1},\dots,\varepsilon^{j_q}, \mathbf{e}_{k_1},\dots,\mathbf{e}_{k_p})
$$

The vector space all $\binom{k}{l}$-tensors on $V$ is denoted

$$
  T_l^k (V) = \left(\bigotimes_{i=1}^l V^*\right) \otimes \left(\bigotimes_{i=1}^k V\right)
$$
</MathBox>

Note the following particular cases of tensors
- $0$-rank tensors are scalars, i.e. $T_0^0 (V) = T_0 (V^*) = T^0 (V) = \R$
- $1$-rank covariant tensors are covectors, i.e. $T_1^0 (V) = T_1 (V^*) = V^*$
- $1$-rank contravariant tensors are vectors, i.e. $T_0^1 (V) = T^1 (V) = V$

<MathBox title='Bases for tensor spaces' boxType='proposition'>
Let $V$ be an $n$-dimensional real vector space. Suppose $(\mathbf{e}_j)_{j=1}^n$ is any basis for $V$, and $(\varepsilon^j)_{j=1}^n$ is the corresponding dual basis for $V^*$. Then the following sets constitute bases for the tensor spaces over $V$

- $k$-rank covariant tensor space $T_k (V^*)$
$$
  \Set{\bigotimes_{j=1}^k \varepsilon^{i_j} | 1\leq i_1,\dots i_k \leq n }
$$
- $k$-rank contravariant tensor space $T^k (V)$
$$
  \Set{\bigotimes_{j=1}^k \mathbf{e}_{i_j} | 1\leq i_1,\dots i_k \leq n }
$$
- $(p,q)$-rank tensor space $T_q^p (V)$
$$
  \Set{\left( \bigotimes_{k=1}^p \mathbf{e}_{i_j} \right) \otimes \left(\bigotimes_{k=1}^q \varepsilon_{j_k} \right) | 1 \leq i_1,\dots,i_p, j_1,\dots,j_q \leq n}
$$

Thus, $\dim(T^k (V^*)) = \dim(T_k(V)) = n^k$ and $\dim(T_q^p (V)) = n^{p+q}$.
</MathBox>

## Symmetric tensors

<MathBox title='Symmetric tensor' boxType='definition'>
Let $V$ be a finite-dimensional vector space. A covariant $k$-tensor $T$ on $V$ is *symmetric* if its values is unchanged by interchanging any pair of arguments, i.e.

$$
  T(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_j,\dots,\mathbf{v}_k) = T(\mathbf{v}_1,\dots,\mathbf{v}_j,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k)
$$

whenever $1 \leq i < j \leq k$.

The set of symmetric covariant $k$-tensors, denoted $\sigma_k (V^*)$, is a linear subpace of the space of $T_k (V^*)$ of all covariant $k$-tensors on $V$, i.e. $\Sigma_k (V^*) \subseteq T_k (V^*)$. There is a natural projection from $T_k (V^*)$ to $\Sigma_k (V^*)$ defined as follows. Let $S_k$ denote the *symmetric group* on $k$ elements. That is, the group of permutations of the set $\Set{1,\dots,k}$. Given a $k$-tensor $\alpha$ and a permutation $\sigma\in S_k$, we define a new $k$-tensor $^\sigma \alpha$ by

$$
  ^\sigma \alpha(\mathbf{v}_1,\dots,\mathbf{v}_k) = \alpha(\mathbf{v}_{\sigma(1)},\dots,\mathbf{v}_{\sigma(k)})
$$

Note that $^\tau(^\tau \alpha) = ^{\tau\sigma}\alpha$, where $\tau\sigma$ represents the composition of $\tau$ and $\alpha$, i.e. $\tau\sigma(i) = \tau(\sigma(i))$. We define a projection $\mathrm{sym}: T_k (V^*) \to\sigma_k (V^*)$ called *symmetrization* by

$$
  \mathrm{sym}(\alpha) = \frac{1}{k!}\sum_{\sigma\in S_k} ^\sigma \alpha
$$

More explicitly, this means that

$$
  (\mathrm{sym}(\alpha))(\mathbf{v}_1,\dots,\mathbf{v}_k) = \frac{1}{k!}\sum_{\sigma\in S_k} \alpha(\mathbf{v}_{\sigma(1)},\dots,\mathbf{v}_{\sigma(k)})
$$
</MathBox>

<MathBox title='Properties of symmetrization' boxType='proposition'>
Let $\alpha$ be a covariant tensor on a finite-dimensional vector space.
1. $\mathrm{sym}(\alpha)$ is symmetric
2. $\mathrm{sym}(\alpha) = \alpha$ if and only if $\alpha$ is symmetric

<details>
<summary>Proof</summary>

**(1):** Suppose $\alpha\in T_k (V^*)$. If $\tau\in S_k$ is any permutation, then

$$
\begin{align*}
  (\mathrm{sym}(\alpha))(\mathbf{v}_{\tau(1)},\dots,\mathbf{v}_{\tau(k)}) =& \frac{1}{k!}\sum_{\sigma\in S_k} ^\sigma \alpha (\mathbf{v}_{\tau}(1),\dots,\mathbf{v}_{\tau(k)}) \\
  =& \frac{1}{k!}\sum_{\sigma\in S_k} ^{\tau\sigma} \alpha(\mathbf{v}_1,\dots,\mathbf{v}_k) \\
  =& \frac{1}{k!}\sun_{\eta\in S_k} ^\eta \alpha(\mathbf{v}_1,\dots,\mathbf{v}_k) \\
  =& (\mathrm{sym}(\alpha))(\mathbf{v}_1,\dots,\mathbf{v}_k)
\end{align*}
$$

where we have substituted $\eta = \tau\sigma$ and used the fact that $\eta$ runs over all of $S_k$ as $\sigma$ does. This shows that $\mathrm{sym}(\alpha)$ is symmetric.

**(2):** If $\alpha$ is symmetric, then it follows that $^\sigma \alpha = \alpha$ for every $\alpha\in S_k$. It follows immediately that $\mathrm{sym}(\alpha) = \alpha$. On the other hand, if $\mathrm{sym}(\alpha) = \alpha$, then $\alpha$ is symmetric because **(1)** shows that $\mathrm{sym}(\alpha)$ is.
</details>
</MathBox>

<MathBox title='Symmetric product' boxType='definition'>
Let $V$ be a finite-dimensional real vector space. If $\alpha\in\Sigma_k (V^*)$ and $\beta\in\Sigma_l (V^*)$, their *symmetric product* is the $(k+l)$-tensor $\alpha\beta$ defined by

$$
  \alpha\beta := \mathrm{sym}(\alpha\otimes\beta)
$$

More explicitly, the action of $\alpha\beta$ on vectors $\mathbf{v}_1,\dots,\mathbf{v}_{k+l}$ isolated

$$
  \alpha\beta(\mathbf{v}_1,\dots,\mathbf{v}_{k+l}) = \frac{1}{(k+l)!}\sum_{\sigma\in S_{k+l}} \alpha(\mathbf{v}_{\sigma(1)},\dots,\mathbf{v}_{\sigma(k)})\beta(\mathbf{v}_{\sigma(k+1)},\dots,\mathbf{v}_{\sigma(k+l)})
$$
</MathBox>

<MathBox title='Properties of the symmetric product' boxType='proposition'>
1. The symmetric product is symmetric and bilinear: for all symmetric tensors $\alpha, \beta, \gamma$ and all $a,b\in\R$
    - $\alpha\beta = \beta\alpha$
    - $(a\alpha + b\beta)\gamma = a\alpha\gamma + b\beta\gamma = \gamma(a\alpha + b\beta)$
2. If $\alpha$ and $\beta$ are covectors, then $\alpha\beta = \frac{1}{2}(\alpha\otimes\beta + \beta\otimes\alpha)$
</MathBox>

## Alternating tensors

<MathBox title='Alternating tensor' boxType='definition'>
Let $V$ be a finite-dimensional real vector space. A covariant $k$-tensor $T$ is *alternating* (or *antisymmetric* or *skew-symmetric*) if it changes sign whenever two of its agruments are interchanged. This means that for all vectors $\mathbf{v}_1,\dots,\mathbf{v}_k \in V$ and every distring indices $i, j$ it satisfies

$$
  T(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_j),\dots,\mathbf{v}_k) = -T(\mathbf{v}_1,\dots,\mathbf{v}_j,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k)
$$

Alternating tensors are also variously called *exterior forms*, *multicovectors* or *k-covectors*. The subspace of all alternating covariant $k$-tensors on $V$ is denoted by $\Lambda_k (V^*) \subseteq T_k (V^*)$.
</MathBox>

<MathBox title='Sign' boxType='definition'>
For any permutation $\sigma\in S_k$, the *sign* of $\sigma$, denoted $\operatorname{sgn}(\sigma)$, is defined As

$$
  \operatorname{sgn}(\sigma) = \begin{cases}
    +1,\quad& \sigma\text{ is even} \\
    -1,\quad& \sigma\text{ is odd}
  \end{cases}
$$
</MathBox>

Every $0$-tensor, which is a scalar, is both symmetric and alternating, because there no arguments to interchange. Similarly, every $1$-form is both symmetric and alternating. Every $2$-form is a skew-symmetric bilinear form. Note that every *2*-form $\beta$ can be expressed as a sum of an alternating tensor and symmetric one, because

$$
\begin{align*}
  \beta(\mathbf{v},\mathbf{w}) =& \frac{1}{2}(\beta(\mathbf{v},\mathbf{w}) - \beta(\mathbf{w}, \mathbf{v})) + \frac{1}{2}(\beta(\mathbf{v},\mathbf{w}) + \beta(\mathbf{w},\mathbf{v})) \\
  =& \alpha (\mathbf{v},\mathbf{w}) + \sigma(\mathbf{v},\mathbf{w}) 
\end{align*}
$$

where $\alpha(\mathbf{v},\mathbf{w}) = \frac{1}{2}(\beta(\mathbf{v},\mathbf{w}) - \beta(\mathbf{w},\mathbf{v}))$ is an alternating tensor and $\sigma(\mathbf{v},\mathbf{w}) = \frac{1}{2}(\mathbf{\beta}(\mathbf{v},\mathbf{w}) - \beta(\mathbf{w},\mathbf{v}))$ is symmetric.

## Tensors and tensor fields on manifolds

<MathBox title='Tensor bundle' boxType='definition'>
Let $M$ be a smooth manifold with or without boundary. The bundle of covariant $k$-tensors on $M$ is defined as

$$
  T_k T^* M = \bigsqcup_{\mathbf{p}\in M} T_k (T_\mathbf{p}^* M)
$$

Analogously, the bundle of contravariant $k$-tensors is defined as

$$
  T^k TM = \bigsqcup_{\mathbf{p}\in M} T^k (T_\mathbf{p} M)
$$

The bundle of mixed $(p,q)$-rank tensors is defined as

$$
  T_q^p TM = \bigsqcup_{\mathbf{p}\in M} T_q^p (T_\mathbf{p} M)
$$

A section of a tensor bundle is called a *tensor field* on $M$. A *smooth tensor field* is a section that is smooth in the usual sense of smooth section of vector bundles.
</MathBox>

Note the following natural identitities of tensor bundles
- $T_0^0 TM = T_0 M^* M = T^0 TM = M\times\R$
- $T_1^0 TM = T_1 T^* M = T^* M$, i.e. covariant $1$-tensors are covector fields
- $T_0^1 TM = T^1 TM = TM$, i.e. contravariant $1$-tensors are vector fields
- $T_k^0 TM = T_k T^* M$
- $T_0^k TM = T^k TM$

The spaces of smooth sections of tensor bundles, denoted
- $\Gamma(T_k T^* M) = \mathcal{T}_k (M)$
- $\Gamma(T^k TM) = \mathcal{T}^k (M)$
- $\Gamma(T_l^k TM) = \mathcal{T}_l^k$

are infinite-dimensional vector spaces over $\R$, and modules over $C^\infty (M)$. In any smooth local coordinates $(x^i)$, sections of these bundles can be written as

$$
  A = \begin{cases}
    A_{i_1 \dots i_q} \bigotimes_{j=1}^q \d x^{i_j},\quad& A\in\Gamma(T_q T^* M) \\
    A^{i_1 \dots i_p} \bigotimes_{j=1}^p \partial/\partial x^{i_j},\quad& A\in\Gamma(T^p TM) \\
    A_{j_l \dots j_q}^{i_k \dots i_p} \left( \bigotimes_{k=1}^p \frac{\partial}{\partial x^{i_j}} \right) \otimes \left( \bigotimes_{l=1}^q \d x^{j_l} \right),\quad& A\in \Gamma(T_q^p TM)
  \end{cases}
$$

The functions $A_{i_1 \dots i_q}$, $A^{i_1 \dots i_p}$ and $A_{j_l \dots j_q}^{i_k \dots i_p}$ are called the *component functions* of $A$ in the choosen coordinates.

<MathBox title='Smoothness criteria for tensor fields' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $A:M\to T_k T^* M$ be a rough section. Then the following are equivalent.
1. $A$ is smooth
2. In every smooth coordinate chart, the component functions of $A$ are smooth
3. Each point of $M$ is contained in some coordinate chart in which $A$ has smooth component functions.
4. If $X_1,\dots,X_k \in\mathfrak{X}(M)$, then the function $A(X_1,\dots,X_k):M\to\R$, defined by
$$
  A(X_1,\dots,X_k)(\mathbf{p}) = A_\mathbf{p}(X_1|_\mathbf{p},\dots,\mathbf{X}_k|_\mathbf{p})
$$
is smooth.
5. Whenever $X_1,\dots,X_k$ are smooth vector fields defined on some open subset $U\subseteq M$, the function $A(X_1,\dots,X_k)$ is smooth on $U$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary, $A\in\mathcal{T}_k (M)$, $B\in\mathcal{T}_l (M)$ and that $f\in C^\infty(M)$. Then $fA$ and $A\otimes B$ are also smooth tensor fields, whose components in any smooth local coordinate chart are

$$
\begin{align*}
  (fA)_{i_1 \dots i_k} =& fA_{i_1 \dots i_k} \\
  (A\otimes B)_{i_1 \dots i_{k+l}} =& A_{i_1 \dots i_k} B_{i_{k+1} \dots i_{k+l}}
\end{align*}
$$
</MathBox>

If $A$ is a smooth covariant $k$-tensor field on a smooth manifold $M$, and $X_1,\dots,X_k$ are smooth vector fields, then by the by the smoothness criteria, then $A(X_1,\dots,X_k)$ is a smooth real-valued function on $M$. Thus $A$ induces a map $ \prod_{i=1}^k \mathfrak{X}(M) \to C^\infty (M)$. It is easy to see that this map is multilinear over $\R$. In fact, it is actually multilinear over $C^\infty (M)$, which means that for $f, g \in C^\infty(M)$ an $X_i, Y_i \in\mathfrak{X}(M)$ we have

$$
\begin{align*}
  &A(X_1,\dots, f\mathbf{X}_i + g Y_i, \dots, X_k) \\
  &= fA(X_1,\dots,X_i,\dots,X_k) + gA(X_1,\dots,Y_i,\dots,Y_k)
\end{align*}
$$

<MathBox title='Tensor characterization lemma' boxType='lemma'>
A map

$$
  \mathrm{T}: \left(\prod_{i=1}^l \Lambda^1 (M) \right)\times \left(\prod_{i=1}^k \mathfrak{X}(M)\right) \to C^\infty (M)
$$

is induced by a $\binom{k}{l}$-tensor field if and only if $\mathrm{T}$ is multilinear over $C^\infty(M)$. Similarly a map

$$
  \mathrm{T}: \left(\prod_{i=1}^{l+1} \Lambda^1 (M) \right)\times \left(\prod_{i=1}^k \mathfrak{X}(M)\right) \to \mathfrak{X}(M)
$$

is induced by a $\binom{k}{l+1}$-tensor field if and only if $\mathrm{T}$ is multilinear over $C^\infty(M)$.

<details>
<summary>Proof</summary>

Note that if $T$ is a smooth covariant $k$-tensor field, then the map $(X_1,\dots,X_k)\mapsto A(X_1,\dots,X_k)$ is multilinear over $C^\infty (M)$. To prove the converse, we proceed as in the proof of the bundle homomorphism characterization lemma.

Suppose $\mathcal{A}$ is multilinear over $C^\infty (M)$. We show first that $\mathcal{A}$ acts locally. If $X_i$ is a smooth vector field that vanishes on a neighbourhood $U$ of $\mathbf{p}$, we can choose a bump function $\psi$ supported in $U$ such that $\psi(\mathbf{p}) = 1$, then because $\psi X_i \equiv 0$, we have

$$
\begin{align*}
  0 =& \mathcal{A}(X_1,\dots, \psi X_i, \dots, X_k)(\mathbf{p}) \\
  =& \psi(\mathbf{p})\mathcal{A}(X_1,\dots,X_i,\dots,X_k)(\mathbf{p})
\end{align*}
$$

It follows that the value of $\mathcal{A}(X_1,\dots,X_k)$ at $\mathbf{p}$ depends only on the values of $X_1,\dots,X_k$ in a neighbourhood of $\mathbf{p}$.

Next we show that $\mathcal{A}$ actually acts pointwise. If $X_i|_\mathbf{p} = 0$, then in any coordinate chart centered at $\mathbf{p}$ we can write $X_i = X_i^j \frac{\partial}{\partial x^j}$, where the component functions $X_i^j$ all vanish at $\mathbf{p}$. By the extension lemma for vector fields, we can find global smooth vector fields $E_j$ on $M$ such that $E_j = \frac{\partial}{\partial x^j}$ in some neighbourhood of $\mathbf{p}$. Similarly, the locally defined functions $X_i^j$ can be extended to global smooth functions $f_i^j$ on $M$ that agree with $X_i^j$ in a neighbourhood of $\mathbf{p}$. It follows from the multilinearity of $\mathcal{A}$ over $C^\infty (M)$, and the fact that $f_i^j E_j = X_i$ in a neighbourhood of $\mathbf{p}$ that

$$
\begin{align*}
  \mathcal{A}(X_1,\dots,X_i,\dots,X_k)(\mathbf{p}) =& \mathcal{A}(X_1,\dots,f_i^j E_j,\dots, X_k)(\mathbf{p}) \\
  =& f_i^j (\mathbf{p})\mathcal{A}(X_1,\dots,E_j,\dots,X_k)(\mathbf{p}) = 0
\end{align*}
$$

It follows by linearity that $\mathcal{A}(X_1,\dots,X_k)$ depends only on the value of $X_i$ at $\mathbf{p}$.

We define a rough tensor field $A:M\to T_k T^* M$ by

$$
  A_\mathbf{p}(\mathbf{v}_1,\dots,\mathbf{v}_k) = \mathcal{A}(V_1,\dots,V_k)(\mathbf{p}),\; \mathbf{p}\in M, \mathbf{v}_1,\dots,\mathbf{v}_k \in T_\mathbf{p}M
$$

where $V_1,\dots,V_k$ are any extension of $\mathbf{v}_1,\dots,\mathbf{v}_k$ to smooth global vector fields on $M$. The discussion abouve shows that this is independent of the choices of extension, and the resulting tensor field is smooth by the smoothness criteria.
</details>
</MathBox>

A *symmetric tensor field* on a manifold (with or without boundary) is simply a covariant tensor field whose value at each point is a symmetric tensor. The symmetric product of two or more tensor fields is defined pointwise, just like the tensor product. Thus, if $A$ and $B$ are smooth covector fields, their symmetric product is the smooth $2$-tensor field $AB$, which is given by

$$
  AB = \frac{1}{2}(A\otimes B + B\otimes A)
$$

Alternating tensor fields are called *differential forms*.

### Pullbacks of tensor fields

<MathBox title='Tensor field pullback' boxType='definition'>
Let $M$ and $N$ be smooth manifolds with or without boundary, and suppose $F:M\to N$ is a smooth map. For any point $\mathbf{p}\in M$, we define a tensor $\d F_\mathbf{p}^* (\alpha) \in T_k (T_\mathbf{p}^* M)$, called the *pointwise pullback* of $\alpha$ by $F$ at $\mathbf{p}$ by

$$
  \d F_\mathbf{p}^* (\alpha)(\mathbf{v}_1,\dots,\mathbf{v}_k) = \alpha(\d F_\mathbf{p}(\mathbf{v}_1), \dots,\d F_\mathbf{p}(\mathbf{v}_k)),\; \mathbf{v}_1,\dots,\mathbf{v}_k \in T_\mathbf{p}M
$$

If $A$ is a covariant $k$-tensor field on $N$, we define a rough $k$-tensor field $F^* A$ on $M$, called the *pullback* of $A$ by $F$, by

$$
  (F^* A)_\mathbf{p} = \d F_\mathbf{p}^* (A_{F(\mathbf{p})})
$$

This tensor field acts on vectors $\mathbf{v}_1,\dots,\mathbf{v}_k \in T_\mathbf{p} M$ by

$$
  (F^* A)_\mathbf{p}(\mathbf{v}_1,\dots,\mathbf{v}_k) = A_{F(\mathbf{p})}(\d F_\mathbf{p}(\mathbf{v}_1),\dots,\d F_\mathbf{p}(\mathbf{v}_k))
$$
</MathBox>

<MathBox title='Properties of tensor pullbacks' boxType='proposition'>
Suppose $F:M\to N$ and $G:N\to P$ are smooth maps, $A$ and $B$ are covariant tensor fields on $N$, and $f:N\to\R$ is a real-valued function on $f$.
1. $F^* (fB) = (f\circ F) F^* B$
2. $F*(A\otimes B) = F^* = F^* A \otimes F^* B$
3. $F^* (A+B) =F^* A + F^* B$
4. $F^* B$ is a (continuous) tensor field, and is smooth if $B$ is smooth
5. $(G\circ F)^* B = F^* (G^* B)$
6. $(\operatorname{id}_N)^* B = B$
</MathBox>

<MathBox title='' boxType='corollary'>
Let $F:M\to N$ be smooth, and let $B$ be a covariant $k$-tensor field on $N$. If $\mathbf{p}\in M$ and $(y^i)$ are smooth coordinates for $N$ on a neighbourhood of $F(\mathbf{p})$, then $F^* B$ has the following expression in a neighbourhood of $\mathbf{p}$

$$
  F^* (B_{i_1 \dots i_k} \bigotimes_{j=1}^k \d y^{i_j}) = (B_{i_1 \dots i_k} \circ F) \left(\bigotimes_{j=1}^k \d(y^{i_j} \circ F) \right)
$$
</MathBox>

In general, there is neither a pushforwar nor a pullback operation for mixed tensor fields. However, in the special case of a diffeomorphism, tensor fields of any variance can be pushed forward and pulled back at will.

### Lie derivatives of tensor fields

<MathBox title='Lie derivative of a tensor field' boxType='definition'>
Suppose $M$ is a smooth manifold, $V$ is a smooth vector field on $M$, and that $\theta$ is its flow. For any $\mathbf{p}\in M$, if $t$ is sufficiently close to zero, then $\theta_t$ is a diffeomorphism from a neighbourhood of $\mathbf{p}$ to a neighbourhood of $\theta_t (\mathbf{p})$, so $\d(\theta_t)_\mathbf{p}^*$ pulls back tensors at $\theta_t (\mathbf{p})$ to ones at $\mathbf{p}$ by the formula

$$
  \d(\theta_t)_\mathbf{p}^* (A_{\theta_t (\mathbf{p})})(\mathbf{v}_1,\dots,\mathbf{v}_k) = A_{\theta_t (\mathbf{p})}(\d(\theta_t)_\mathbf{p}(\mathbf{v}_1),\dots,\d(\theta_t)_\mathbf{p}(\mathbf{v}_k))
$$

Note that $\d(\theta_t)_\mathbf{p}^* (A_{\theta_t (\mathbf{p})})$ is just the value of the pullback tensor field $\theta_t^* A$ at $\mathbf{p}$.

Given a smooth covariant tensor field $A$ on $M$, the *Lie derivative* of $A$ with respect to $V$, denoted $\mathcal{L}_V A$, is defined by

$$
\begin{align*}
  (\mathcal{L}_V A)_\mathbf{p} =& \left.\frac{\d}{\d t}\right|_{t=0} (\theta_t^* A)_\mathbf{p} \\
  =& \lim_{t\to 0} \frac{\d(\theta_t)_\mathbf{p}^* (A_{\theta_t(\mathbf{p})}) - A_\mathbf{p}}{t}
\end{align*}
$$

provided that the derivative exists. Because the expression being differentiated lies in $T_k (T_\mathbf{p}^* M)$ for all $t$, then $(\mathcal{L}_V A)_\mathbf{p}$ makes sense as an element of $T_k (T_\mathbf{p}^* M$.
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $M$ is a smooth manifold, $V$ is a smooth vector field on $M$, and that $\theta$ is its flow. The Lie derivative exists for every $\mathbf{p}\in M$ and defines $\mathcal{L}_V A$ as a smooth tensor field on $M$.
</MathBox>

<MathBox title='Properties of Lie derivatives of tensor fields' boxType='proposition'>
Let $M$ be a smooth manifold and let $\mathbf{V}\in\mathfrak{X}(M)$. Suppose $f$ is a smooth real-valued function on $0$, and that $A$ and $B$ are smooth covariant tensor fields on $M$.
1. $\mathcal{L}_\mathbf{V} f = \mathbf{V}f$
2. $\mathcal{L}_\mathbf{V} (fA) = (\mathcal{L}_\mathbf{V} f)A + f\mathcal{L}_\mathbf{V} A$
3. $\mathcal{L}_\mathbf{V} (A\otimes B) = (\mathcal{L}_\mathbf{V} A)\otimes B + A \otimes \mathcal{L}_\mathbf{V} B$
4. If $\mathbf{X}_1,\dots,\mathbf{X}_k \in\mathfrak{X}(M)$ and $A$ is a smooth $k$-tensor field,
$$
\begin{align*}
  \mathcal{L}_\mathbf{V} (A(X_1,\dots,X_k)) =& (\mathcal{L}_\mathbf{V} A)(X_1,\dots,X_k) \\
  &+ A(\mathcal{L}_\mathbf{V} \mathbf{X}_1,\dots,\mathbf{X}_k) + \cdots + A(\mathbf{X}_1,\dots, \mathcal{L}_\mathbf{V} X_k)
\end{align*}
$$

<details>
<summary>Proof</summary>

**(1):** Let $\theta$ be the flow of $V$. For a real-valued function $f$ we can write

$$
  \theta_t^* f(\mathbf{p}) = f(\theta_t (\mathbf{p})) = f\circ\theta^{(\mathbf{p})}(t)
$$

Thus, the definition of $\mathcal{L}_V f$ reduces to the ordinary derivative with respect to $t$ of the composite function $f\circ\theta^{(\mathbf{p})}$. Because $\theta^{(\mathbf{p})}$ is an integral curve of $V$, it follows that

$$
\begin{align*}
  (\mathcal{L}_V f)(\mathbf{p}) =& \left.\frac{\d}{\d t}\right|_{t=0} f\circ\theta^{(\mathbf{p})} \\
  =& \d f_\mathbf{p} (\theta^{(\mathbf{p})'} (0)) = \d f_\mathbf{p}(V_\mathbf{p}) \\
  =& Vf(\mathbf{p})
\end{align*}
$$

This proves **(1)**.

The other assertions can be proved by the techniques used in the theorem for the equivalnce of the Lie derivative with the Lie bracket. In a neighbourhood of a regular point for $V$, if $(u^i)$ are coordinates in which $V = \frac{\partial}{\partial u^1}$, then it follows immediately from the definition that $\mathcal{L}_V$ acts on a tensor field simply by taking the partial derivative of its coefficients with respect to $u^1$, and **(2)**-**(4)** all follow from the ordinary product rule. The same relations hold on the support of $V$ by continuity, and on the complement of the support because the flow of $V$ is trivial here.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
If $V$ is a smooth vector field and $A$ is a smooth covariant $k$-tensor field, then for any smooth vector fields $X_1,\dots,X_k$,

$$
\begin{align*}
  (\mathcal{L}_V A)(X_1,\dots,X_k) =& V(A(X_1,\dots,X_k)) \\
  &- A([V,X_1],X_2,\dots, X_k) - \cdots - A(X_1,\dots,X_{k-1},[V,X_k]) 
\end{align*}
$$

<details>
<summary>Proof</summary>

Recall that

$$
\begin{align*}
  \mathcal{L}_V (A(X_1,\dots,X_k)) =& (\mathcal{L}_V A)(X_1,\dots,X_k) \\
  &+ A(\mathcal{L}_V X_1,\dots,X_k) + \cdots + A(X_1,\dots, \mathcal{L}_V X_k)
\end{align*}
$$

Solving for $(\mathcal{L}_V A)(X_1,\dots,X_k)$, and replacing $\mathrm{L}_V f$ by $V f$ and $\mathcal{L}_V X_i$ by $[V, X_i]$ gives the desired result.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
If $f\in C^\infty (M)$, then $\mathcal{L}_V (\d f) = \d(\mathcal{L}_V f)$.

<details>
<summary>Proof</summary>

By the previous corollary, we compute for any $X\in \mathfrak{X}(M)$

$$
\begin{align*}
  (\mathcal{L}_V \d f) =& V(\d f(X)) - \d f([V,X]) \\
  =& VXf - [V,X]f = VXf - (VXf - XVf) \\
  =& XVf = \d(Vf)(X) = \d(\mathcal{L}_V f)(X)
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Invariant tensor field' boxType='proposition'>
If $A$ is a smooth tensor field, $A$ is *invariant* under $\theta$ if for each $t$, the map $\theta_t$ pulls $A$ back to itself wherever it is defined, i.e.

$$
  \d(\theta_t)_\mathbf{p}^* (A_{\theta_t (\mathbf{p})}) = A_\mathbf{p}
$$

for all $(t,\mathbf{p})$ in the domain of $\theta$. If $\theta$ is a global flow, this is equivalent to $\theta_t^* A = A$ for all $t\in\R$.
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold with or without boundary and $\mathbf{V}\in\mathfrak{X}(M)$. If $\partial M \neq\emptyset$, assume in addition that $V$ is tangent to $\partial M$. Let $\theta$ be the flow of $V$. For any smooth covariant tensor field $A$ and any $(t_0, \mathbf{p})$ in the domain of $\theta$

$$
  \left.\frac{\d}{\d t}\right|_\mathbf{t=t_0} (\theta_t^* A)_\mathbf{p} = (\theta_{t_0}^* (\mathcal{L}_V A))
$$

<details>
<summary>Proof</summary>

After expanding the definition of the pullback in the statement, we see that we have to prove

$$
  \left.\frac{\d}{\d t}\right|_{t=t_0} \d(\theta_t)_\mathbf{p}^* (A_{\theta_t (\mathbf{p})}) =& \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_{s+ t_0})_\mathbf{p}^* (A_{\theta_{s+t_0}(\mathbf{p})}) \\
  =& \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_{t_0})_\mathbf{p}^* \d(\theta_s)_{\theta_{t_0}(\mathbf{p})}^*  (A_{\theta_s (\theta_{t_0}(\mathbf{p}))}) \\
  =& \d(\theta_{t_0})_\mathbf{p}^* \left.\frac{\d}{\d s}\right|_{s=0} \d(\theta_s)_{\theta_{t_0}(\mathbf{p})}^* (A_{\theta_s(\theta_{t_0}(\mathbf{p}))}) \\
  =& \d(\theta_{t_0})_\mathbf{p}^* ((\mathcal{L}_V A)_{\theta_{t_0}(\mathbf{p})})
$$
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Let $M$ be a smooth manifold and let $\mathbf{V}\in\mathfrak{X}(M)$. A smooth covariant tensor field $A$ is invariant under the flow of $V$ if and only if $\mathcal{L}_V A = 0$.
</MathBox>

# Riemannian metrics

## Riemannian manifold
<MathBox title='Riemannian metric' boxType='definition'>
A Riemannian metric on a smooth manifold $M$ is a smooth symmetric covariant $2$-tensor field $g$ on $M$ that is positive definite at each point. For each $\mathbf{p}\in M$, the 2-form $g_\mathbf{p}$ is an inner product on $T_\mathbf{p} M$, usually denoted

$$
  \langle \mathbf{v}, \mathbf{w} \rangle_g = g_\mathbf{p} (\mathbf{v}, \mathbf{w}),\; \mathbf{v},\mathbf{w}\in T_\mathbf{p} M
$$

In any smooth local coordinates $(x^i)$, a Riemannian metric can be written

$$
  g = g_{ij}\;\d x^i \otimes \d x^j
$$

where $(g_{ij})$ is a symmetric positive definite matrix of smooth functions, i.e. $g_{ij} = g_{ji}$. The symmetry of $g$ allows us to write $g$ in terms of symmetric products

$$
\begin{align*}
  g =& g_{ij}\;\d x^i \otimes \d x^j \\
  =& \frac{1}{2}(g_{ij}\;\d x^i \otimes \d x^j + g_{ji}\;\d x^i \otimes \d x^j) \\
  =& \frac{1}{2}(g_{ij}\;\d x^i \otimes \d x^j + g_{ij}\;\d x^j \otimes \d x^i) \\
  =& g_{ij} \;\d x^i\;\d x^j
\end{align*}
$$
</MathBox>

Note that a Riemannian metric is not the same thing as a metric in the sense of metric spaces, although the two concepts are related. To avoid this ambiguity, we will use the term "distance function" for a metic in the metric space sense.

<MathBox title='Riemannian manifold' boxType='definition'>
A *Riemannian manifold* is a pair $(M, g)$, where $M$ is smoth manifold and $g$ is a Riemannian metric. It is common to state that "M is a Riemannian manifold" if $M$ understood to be endowed with a Riemannian metric.
</MathBox>

<MathBox title='Euclidean metric' boxType='example'>
The simple example of a Riemannian metric is the *Euclidean metric* $\overline{g}$ on $\R^n$, given in standard coordinates by

$$
  \overline{g} = \delta_{ij}\;\d x^i \;\d x^j
$$

where $\delta_{ij}$ is the Kronecker delta. Applied to vectors $\mathbf{v}, \mathbf{w}\in T_\mathbf{p}\R^n$, this yields

$$
  \overline{g}_\mathbf{p}(\mathbf{v}, \mathbf{w}) = \delta_{ij} \mathbf{v}^i \mathbf{w}^j = \sum_{i=1}^n v^i w^i = \mathbf{v}\cdot \mathbf{w}
$$

which shows that $\overline{g}$ is the covariant $2$-tensor field whose value at each point is the Euclidean dot product.
</MathBox>

The following geometric construction can be defined on a Riemannian manifold $(M, g)$ with or without boundary
- The *length* or *norm* of tangent vector $\mathbf{v}\in T_\mathbf{p}M$:
$$
  |\mathbf{v}|_g = \sqrt{\langle \mathbf{v},\mathbf{v}\rangle_g} = \sqrt{g_\mathbf{p}(\mathbf{v}, \mathbf{w})}
$$
- The *angle* between two nonzero tangent vectors $\mathbf{v},\mathbf{w}\in T_\mathbf{p} M$ is the the unique $\theta\in[0,\pi]$ satisfying
$$
  \cos(\theta) = \frac{\langle \mathbf{v}, \mathbf{w} \rangle_g}{|\mathbf{v}|_g |\mathbf{w}|_g}
$$

Tangent vector $\mathbf{v},\mathbf{w}\in T_\mathbf{p} M$ are *orthogonal* if $\langle \mathbf{v}, \mathbf{w} \rangle_g = 0$. This means either on or both vectors are zero, or the angle between them is $\frac{\pi}{2}$.

<MathBox title='Existence of Riemannian metrics' boxType='proposition'>
Every smooth manifold with or without boundary admits a Riemannian metric.

<details>
<summary>Proof</summary>

Let $M$ be a smooth manifold with or without boundary, and choose a covering of $M$ by smooth coordinate charts $(U_\alpha, \varphi_\alpha)$. In each coordinate domain, there is a Riemannian metric $g_\alpha = \varphi_\alpha^* \overline{g}$, whose coordinate expression is $\delta_{ij}\;\d x^i\;\d x^j$. Let $\Set{\psi_\alpha}$ be a smooth partition on unity subordinate to the cover $\Set{U_\alpha}$, and define

$$
  g = \sum_\alpha \psi_\alpha g_\alpha
$$

with each term interpreted to be zero outside $\operatorname{supp}(\mathbf{psi}_\alpha)$. By local finiteness, there are only finitely many nonzero terms in a neighbourhood of each point, so this expression defines a smooth tensor field. It is obviously symmetric, so only positivity needs to be checked. If $\mathbf{v}\in T_\mathbf{p} M$ is any nonzero vector, then

$$
  g_\mathbf{p}(\mathbf{v},\mathbf{v}) = \sum_\alpha \psi_\alpha (\mathbf{p}) g_\alpha |_\mathbf{p} (\mathbf{v}, \mathbf{v})
$$

This sum is nonnegative, because each term is nonnegative. At least one of the functions $\psi_\alpha$ is strictly positive at $\mathbf{p}$, because they sum to $1$. because $g_\alpha|_\mathbf{p}(\mathbf{v},\mathbf{v}) > 0$, it follows that $g_\mathbf{p}(\mathbf{v},\mathbf{v}) > 0$
</details>
</MathBox>

<MathBox title='Orthonormal frame' boxType='definition'>
Let $(M, g)$ be an $n$-dimensional Riemannian manifold with or without boundary. A local frame $(\mathbf{E}_i)_{i=1}^n$ for $M$ on an open subset $U\subseteq M$ is an *orthonormal frame* if the vectors $(\mathbf{E}_i|_\mathbf{p})_{i=1}^n$ form an orthonormal basis for $T_\mathbf{p} M$ at each point $\mathbf{p}\in U$, or equivalently if $\langle \mathbf{E}_i, E_j \rangle_g = \delta_{ij}$
</MathBox>

<MathBox title='' boxType='proposition'>
Let $(M, g)$ be an $n$-dimensional Riemannian manifold with or without boundary, and suppose $(\mathbf{X}_i)$ is a smooth local frme for $M$ over an open subset $U\subseteq M$. Then there is a smooth orthonormal frame $(E_j)$ over $U$ such that $\operatorname{span}(E_1|_\mathbf{p},\dots,E_j|_\mathbf{p}) = \operatorname{span}(X_1|_\mathbf{p},\dots,X_j|_\mathbf{p})$ for each $j = 1,\dots,n$ and each $\mathbf{p}\in U$. 
</MathBox>

<MathBox title='Existence of local orthonormal frames' boxType='corollary'>
Let $(M, g)$ be an $n$-dimensional Riemannian manifold with or without boundary. For each $\mathbf{p}\in M$, there is a smooth orthonormal frame on a neighbourhood of $\mathbf{p}$.
</MathBox>

### Pullback metrics

<MathBox title='Pullback metric' boxType='definition'>
Suppose $M$, $N$ are smooth manifold with or without boundary, $g$ is a Riemannian metric on $N$, and that $F:M\to N$ is smooth. The pullback $F^* g$ is a smooth $2$-tensor field on $M$. If it is positive definite, it is a Riemannian metric on $M$, called the *pullback metric* determined by $F$.
</MathBox>

<MathBox title='Pullback metric criterion' boxType='proposition'>
Suppose $F:M\to N$ is a smooth map between smooth manifolds $M$ and $N$, and that $g$ is a Riemannian metric on $N$. Then $F^* g$ is a Riemannian metric on $M$ if and only if $F$ is a smooth immersion.
</MathBox>

<MathBox title='Riemannian isometry' boxType='definition'>
If $(M,g)$ and $(\tilde{M},\tilde{g})$ are both Riemannian manifolds, a smooth map $F:M\to\tilde{M}$ is called a *(Riemannian) isometry* if it is a diffeomorphism that satisfies $F^*\tilde{g} = g$. More generally, $F$ is a *local isometry* if every point $\mathbf{p}\in M$ has a neighbourhood $U$ such that $F|_U$ is an isometry of $U$ onto an open subset of $\tilde{M}$; or equivalently, if $F$ is a local diffeomorphism satisfying $F^* \tilde{g} = g$.

If there exists a Riemannian isometry between $(M,g)$ and $(\tilde{M},\tilde{g})$, we say that they are *isometric* as Riemannian manifolds. If each point of $M$ has a neighbourhood that is isometric ot an open subset of $(\tilde{M},\tilde{g})$, we say that $(M,g)$ is *locally isometric* to $(\tilde{M},\tilde{g})$.
</MathBox>

<MathBox title='Flatness' boxType='definition'>
A Riemannian $n$-manifold $(M,g)$ is *a flat Riemannian manifold*, and $g$ is *flat metric*, if $(M,g)$ is locally isometric to $(\R^n, \overline{g})$.
</MathBox>

<MathBox title='' boxType='theorem'>
For a Riemannian manifold $(M, g)$, the following are equivalent:
1. $g$ is flat
2. Each point of $M$ is contained in the domain of a smooth coordinate chart in which $g$ has the coordinate representation $g = \delta_{ij}\;\d x^i \;\d x^j$.
3. Each point of $M$ is contained in the domain of a smooth local coordinatee chart in which the coordinate frame is orthonormal.
4. Each point of $M$ is contained in the domain of a commuting orthonormal frame.

<details>
<summary>Proof</summary>

The implications **(1)** $\implies$ **(2)** $\implies$ **(3)** $\implies$ **(4)** are easy consequences of the definitions. The remaining implication **(4)** $\implies$ **(1)** follows from the canonical form theorem for commuting frames: if $(\mathbf{E}_i)$ is a commuting orthonormal frame for $g$ on an open subset $U\subseteq M$, then each $\mathbf{p}\in V$ is contained in the domain of a smooth chart $(U,\varphi)$ in which the coordinate frame is equal to $(\mathbf{E}_i)$. This means $\varphi_* \mathbf{E}_i = \frac{\partial}{\partial x^i}$, so the diffeomorphism $\varphi: U\to\varphi(U)$ satisfies

$$
\begin{align*}
  \varphi^* \overline{g}(\mathbf{E}_i, E_j) =& \oveline{g}(\varphi_* \mathbf{E}_i, \varphi_* E_j) \\
  =& \overline{g}\left( \frac{\partial}{\partial x^i}, \frac{\partial}{\partial x^j} \right) \\
  =& \delta_{ij} = g(\mathbf{E}_i, E_j)
\end{align*}
$$

Bilinearity then shows that $\varphi^* \overline{g} = g$, so $\varphi$ is an isometry between $(U, g|_U)$ and $\varphi(U)$ with the Euclidean metric. This shows that $g$ is flat.
</details>
</MathBox>

### Riemannian submanifolds

<MathBox title='Riemannian submanifold' boxType='definition'>
If $(M, g)$ is a Riemannian manifold with or without boundary, every submanifold $S\subseteq M$ (immersed or embedded, with or without boundary) automatically inherits a pullback metric $\iota^* g$, where $\iota: S\hookrightarrow M$ is inclusion. In this setting, the pullback metric is called the *induced metric* on $S$. By definition, this mean that for $\mathbf{v}, \mathbf{w}\in T_\mathbf{p} S$ That

$$
\begin{align*}
  (\iota^* g)(\mathbf{v}, \mathbf{w}) =& g(\d\iota_\mathbf{p}(\mathbf{v}), \d\iota_\mathbf{p}(\mathbf{w})) \\
  =& g(\mathbf{v}, \mathbf{w})
\end{align*}
$$

because $\d\iota_\mathbf{p}: T_\mathbf{p}S \to T_\mathbf{p}M$ is the usual identification of $T_\mathbf{p} S$ as a subspace of $T_\mathbf{p} M$. This $\iota^* g$ is just the restriction of $g$ to pairs of vectors tangent to $S$. With this metric $S$ is a *Riemannian submanifold* of $M$.
</MathBox>

<MathBox title='Flatness criterion for surfaces of revolution' boxType='proposition'>
Let $C\subseteq H$ be a connected embedded $1$-dimensional submanifold of the half-plane $H = \Set{(r,z): r > 0}$, and let $S_C$ be the surface of revolution generated by $C$. The induced metric on $S_C$ is flat if and only if $C$ is part of a straight line.

<details>
<summary>Proof</summary>

To compute the induced metric on $S_C$, choose any smooth local parametrization $\gamma(t) = (a(t), b(t))$ for $C$, and note that the map $X(t,\theta) = (a(t)\cos\theta, a(t)\sin\theta, b(t))$ yields a smooth local parametrization of $S_C$, provided that $(t,\theta)$ is restricted to a sufficiently small open subset of the plane. Thus, we can compute

$$
\begin{align*}
  X^* \overline{g} =& \d(a(t)\cos\theta)^2 + \d(a(t)\sin\theta)^2 + \d(b(t))^2 \\
  =& (a'(t)\cos\theta\;\d t - a(t) \sin\theta \;\d\theta)^2 \\
  &+ (a'(t)\sin\theta \;\d t + a(t)\cos\theta \;\d\theta)^2 + (b'(t)\d t)^2 \\
  =& (a'(t)^2 + b'(t)^2)\d t^2 + a(t)^2 \d\theta^2
\end{align*}
$$

In particular if $\gamma$ is a unit-speed curve, meaning that $|\gamma'(t)|^2 = a'(t)^2 + b'(t)^2 = 1$, this reduces to

$$
  X^* \overline{g} =& \d t^2 + a(t)^2 \d\theta^2
$$

First assume $C$ is part of a straight line. Then it has a parametrization of the form $\gamma(t) = (Pt + K, Qt + L)$ for some constants $P$, $Q$, $K$ and $L$ with $P$ and $Q$ not both zero. By rescaling $t$, we may assume $\gamma$ is unit speed, i.e. $|\gamma'(t)|^2 = 1$. If $Q = 1$, then $S_C$ is an open subset of the plane $z = L$ and is therefore flat. If $P = 0$, then $S_C$ is an opne subset of the plane $z = L$ and is therefore flat. If $P = 0$, then $S_C$ is part of the cylinder $x^2 + y^2 = K^2$. Dividing by $K^2$ and writing $\tilde{x} = x/K$ and $\tilde{y} = y/K$, we get the unit cylinder $\tilde{x}^2 + \tilde{y}^2 = 1$. The induced metric becomes $\d t^2 + \d\theta^2$, which is the Euclidean metric on the $(t,\theta)$-plane and is therefore flat.

If neither $P$ nor $Q$ is zero, then $S_C$ is part of a cone with induced metric $\d^2 (Pt + K)^2 \d\theta^2$. In an neighbourhood of any point, the change of coordinates $(u, v) = ((t + K/P)\cos(P\theta), (t + K/P)\sin(P\theta))$ pulls the Euclidean metric $\d u^2 + \d v^2$ back to $\d^t + (Pt + K)^2 \d\theta^2$, so this metric is flat.

Conversely, assuming that $S_C$ is flat, we will show that $C$ is part of a straight line. Let $\gamma(t) = (a(t), b(t))$ be a local parametrization of $C$. Assuming that $\gamma$ is unit-speed, i.e. $a'(t)^2 + b'(t)^2 = 1$, the induced metric is $\d t^2 + a^2 \d\theta^2$. Thus, the local frame $(E_1,E_2)$ is given by

$$
  E_1 = \frac{\partial}{\partial t}\quad E_2 = \frac{1}{a}\frac{\partial}{\partial\theta}
$$

is orthonormal. Any orthonormal fram $(\tilde{E}_1,\tilde{E}_2)$ can be written in the form

$$
\begin{align*}
  \tilde{E}_1 =& uE_1 + vE_2 = u\frac{\partial}{\partial t} + \frac{v}{a}\frac{\partial}{\partial\theta} \\
  \pm\tilde{E}_2 =& vE_1 - uE_2 = v\frac{\partial}{\partial t} - \frac{u}{a}\frac{\partial}{\partial\theta} 
\end{align*}
$$

for some functions $u$ and $v$ depending smoothly on $(t,\theta)$ and satisfying $u^2 + v^2 = 1$. Because the metric is flat, it is possible to choose $u$ and $v$ such that $(\tilde{E}_1, \tilde{E}_2)$ is a commuting orthonormal frame. Expressing in terms of Lie brackets, we get

$$
\begin{align*}
  0 = \pm [\tilde{E}_1, \tilde{E}_2] =& \left(u\frac{\partial v}{\partial t} + \frac{v}{a}\frac{\partial v}{\partial\theta} \right)\frac{\partial}{\partial t} \\
  &- \left( u\frac{\partial}{\partial t}(\frac{u}{a}) + \frac{v}{a}\frac{\partial}{\partial\theta}(\frac{u}{a}) \right)\frac{\partial}{\partial\theta} \\
  &- \left(v\frac{\partial u}{\partial t} - \frac{u}{a}\frac{\partial u}{\partial\theta} \right)\frac{\partial}{\partial t} \\
  &- \left( v\frac{\partial}{\partial t}(\frac{v}{a}) - \frac{u}{a}\frac{\partial}{\partial\theta}(\frac{v}{a}) \right)\frac{\partial}{\partial\theta}
\end{align*}
$$

To simplify notation, we write $f_\theta = \frac{\partial}{\partial \theta}$ and $f_t = \frac{\partial}{\partial t}$ for any function $f$. Note that $u^2 + v^2 = 1$ implies that $uu_\theta + vv_\theta = uu_t + vv_t = 0$, and the fact that $a$ only depend on $t$ implies $a_\theta = 0$ and $a_t = a'$. Inserting these relations and simplifying gives

$$
  0 = (uv_t - vu_t)\frac{\partial}{\partial t} + \left(\frac{a' - vu_\theta + uv_\theta}{a^2} \right)\frac{\partial}{\partial\theta}
$$

which implies That

$$
\begin{align*}
  uv_t - vu_t =& 0 \\
  vu_\theta - uv_\theta = a'
\end{align*}
$$

Because $u^2 + v^2 \equiv 1$, each point has a neighbourhood on which either $u$ or $v$ is nonzero. On any open subset where $v\neq 0$, then the $t$-derivative of $u/v$ zero. This we can write $u = fv$, where $f$ is some function of $\theta$ alone. Then $u^2 + v^2 = 1$ implies that $v^2 (f^2 + 1) = 1$, so $v = \pm 1 / \sqrt{f^2 + 1}$ is also a function of $\theta$ alone, and so is $u = \pm\sqrt{1 - v^2}$. A similar argument applies where $u \neq 0$. Then it follows that $a'$ is independent of $t$, making it a constant, and consequently so is $b' = \pm\sqrt{1 - (a')^2}$. It follows that $a$ and $b$ are affine functions of $t$, so each point of $C$ has a neighbourhood contained in a straight line. Since we are assuming that $C$ is connected, it follows that all of $C$ is contained in a single straight line.
</details>
</MathBox>

### The normal bundle

<MathBox title='The normal bundle to a Riemannian submanifold' boxType='proposition'>
Suppose $(M,g)$ is a Riemannian $n$-manifold with or without boundary, and that $S\subseteq M$ is Riemannian $k$-submanifold. For any $\mathbf{p}\in S$, a vector $\mathbf{v}\in T_\mathbf{p} S$ is *normal* to $S$ if $\mathbf{v}$ is orthogonal to every vector in $T_\mathbf{p} S$ with respect to the inner product $\langle\cdot,\cdot\rangle_g$. The *normal space* to $S$ at $\mathbf{p}$ is the subsapce $N_\mathbf{p} S \subseteq T_\mathbf{p} M$ consisting of all vectors that are normal to $S$ at $\mathbf{p}$, and the *normal bundle* of $S$ is the subset $NS \subseteq TM$ consisting of the union of all normal spaces at points of $S$. The projection $\pi_{NS}:NS \to S$ is defined as the restriction to $NS$ of $\pi:TM\to M$.
</MathBox>

<MathBox title='The normal bundle to a Riemannian submanifold' boxType='proposition'>
Let $(M, g)$ be a Riemannian $n$-manifold with or without boundary. For any immersed $k$-dimensional submanifold $S\subseteq M$ with or without boundary, the normal bundle $NS$ is a smooth rank-$(n-k)$ subbundle of $TM|_S$. For each $\mathbf{p}\in S$, there is a smooth frame for $NS$ on a neighbourhood of $\mathbf{p}$ that is orthonormal with respect to $g$.
</MathBox>

## The Riemannian distance function

<MathBox title='Curve length' boxType='definition'>
Let $(M, g)$ be a Riemannian $n$-manifold with or without boundary. If $\gamma:[a,b] \to M$ is a piecewise smooth curve segment, the length of $\gamma$ is

$$
  L_g (\gamma) = \int_a^b |\gamma'(t)|_g \;\d t
$$

Because $|\gamma'(t)|_g$ is continuous at all but finitely many values of $t$, and has well-defined limits from the left and right at those points, the integral is well-defined.
</MathBox>

<MathBox title='Parameter independence of length' boxType='proposition'>
Let $(M, g)$ be a Riemannian $n$-manifold with or without boundary, and let $\gamma:[a,b]\to M$ be a piecewise smooth curve segment. If $\tilde{\gamma}$ is a reparametrization of $\gamma$, then $L_g(\tilde{\gamma}) = L_g (\gamma)$.

<details>
<summary>Proof</summary>

First suppose $\gamma$ is smooth, and that $\varphi:[c,d] \to [a,b]$ is a diffeomorphism such that $\tilde{\gamma} = \gamma\circ\varphi$. The fact that $\varphi$ is a diffeomorphism implies that either $\varphi' > 0$ or $\varphi' < 0$ everywhere. Assuming that $\varphi' > 0$, then

$$
\begin{align*}
  L_g (\tilde{\gamma}) =& \int_c^d |\tilde{\gamma}'(t)|_g = \int_c^d \left| \frac{\d}{\d t} (\gamma\circ\varphi)(t) \right|_g \;\d t \\
  =& \int_c^d |\varphi'(t)\gamma'(\varphi(t))|_g \;\d t = \int_c^d |\gamma'(\varphi(t))|_g \varphi'(t)\;\d t \\
  =& \int_a^b |\gamma(t)|_g \;\d s = L_g (\gamma)
\end{align*}
$$

where we have used the substitution $s = \varphi(t)$ and $\d s = \varphi'(t) \d t$.

The case $\varphi' < 0$ introduces two sign changes to the calculation above. The sign changes once when $\varphi'(t)$ is moved outside the absolute value, because $|\varphi'(t)| = -\varphi'(t)$. Then it changes again when we change variables, because $\varphi$ reverses the direction of the integral. The two sign chances cancel each other, giving the same result.

If $\gamma$ is only piecewise smooth, we apply the same argument on each subinterval on which it is smooth.
</details>
</MathBox>

<MathBox title='Riemannian distance' boxType='definition'>
Suppose $(M,g)$ is a connected Riemannian manifold and assume $\partial M = \emptyset$. For any $\mathbf{p},\mathbf{q}\in M$ the *(Riemannian) distance* from $\mathbf{p}$ to $\mathbf{q}$, denoted $d_g (\mathbf{p},\mathbf{q})$, is defined to be the infimum of $L_g = (\gamma)$ over all piecewise smooth curve segment $\gamma$ from $\mathbf{p}$ to $\mathbf{q}$. Because any pair of points in $M$ can be joined by a piecewise smooth curve segment, this is well defined.
</MathBox>

<MathBox title='' boxType='lemma'>
Let $g$ be a Riemannian metric on an open subset $U\subseteq\R^n$. Given a compact subset $K\subseteq U$, there exists positive constants $c$ and $C$ such that for all $\mathbf{x}\in K$ and all $\mathbf{v}\in T_\mathbf{x} \R^n$

$$
  c|\mathbf{v}|_g \leq |\mathbf{v}|_g \leq C|\mathbf{v}|_{\overline{g}}
$$

<details>
<summary>Proof</summary>

For any compact subset $K\subseteq U$, let $L\subseteq T\R^n$ be the set

$$
  L = \Set{(\mathbf{x}, \mathbf{v})\in T\R^n | \mathbf{x}\in K, |\mathbf{v}|_{\overline{g}} = 1}
$$

Under the canonical identification of $T\R^n$ with $\R^n \times\R^n$, then $L$ is just the produc set $K\times \mathbb{S}^{n-1}$ and therefore is compact. Because the norm $|\mathbf{v}|_g$ is compact. Because the norm $|\mathbf{v}|_g$ is continuous and strictly positive on $L$, there are positive constants $c$ and $C$ such that $c\leq|\mathbf{v}|_g \leq C$ whenever $(\mathbf{x},\mathbf{v}) \in L$. If $\mathbf{x}\in K$ and $\mathbf{v}$ is a nonzero vector in $T_\mathbf{x}\R^n$, let $\lambda = |\mathbf{v}|_{\overline{g}}$. Then $(\mathbf{x}, \lambda^{-1} \mathbf{v}) \in L$, so by homogeneity of the norm

$$
  |\mathbf{v}|_g = \lambda|\lambda^{-1}\mathbf{v}|_g \leq \lambda C = C |\mathbf{v}|_{\overline{g}}
$$

A similar computation shows that $|\mathbf{v}|_g \geq c|\mathbf{v}|_\overline{c}$. The same inequalities are trivially true when $\mathbf{v} = 0$.
</details>
</MathBox>

<MathBox title='Riemannian manifolds as metric spaces' boxType='theorem'>
Let $(M, g)$ be a connected Riemannian manifold. With the Riemannian distance function, $M$ is a metric space whose metric topology is the same as the original manifold topology.

<details>
<summary>Proof</summary>

It is immediate from the definition that $d_g (\mathbf{p}, \mathbf{q}) \geq 0$. Because every constant curve segment has length zero, it follows that $d_g (\mathbf{p}, \mathbf{p}) = 0$. Furthermore, $\d_g (\mathbf{p}, \mathbf{q}) = d_g (\mathbf{q}, \mathbf{p})$ follows from the fact that any curve segment from $\mathbf{p}$ to $\mathbf{q}$ can be reparametrized to go from $\mathbf{q}$ to $\mathbf{p}$. Suppose $\gamma_1$ and $\gamma_2$ are piecewise smooth curve segments from $\mathbf{p}$ to $\mathbf{q}$ and $\mathbf{q}$ to $\mathbf{r}$, respectively, and let $\gamma$ be a piecewise smooth curve segment that first follows $\gamma_1$ and then follows $\gamma_2$. Then

$$
  d_g (\mathbf{p}, \mathbf{r}) \leq L_g (\gamma) = L_g (\gamma_1) + L_g (\gamma_2)
$$

Taking the infimum over all such $\gamma_1$ and $\gamma_2$ we find that $d_g (\mathbf{p},\mathbf{r}) \leq d_g(\mathbf{p}, \mathbf{q}) + d_g (\mathbf{q}, \mathbf{r})$.

To complete the proof that $(M, d_g)$ is a metric space, we need to show that $d_g (\mathbf{p}, \mathbf{q}) > 0$ if $\mathbf{p} \leq \mathbf{q}$. Let $\mathbf{p},\mathbf{q}\in M$ be distinct points, and let $U$ be a smooth coordinate domain containing $\mathbf{p}$ but not $\mathbf{q}$. Use the coordinate map as usual to identify $U$ with an open subset in $\R^n$, and let $\overline{g}$ denote the Euclidean metric in these coordinates. If $V$ is a regular coordinate ball of radius $\varepsilon$, centered at $\mathbf{p}$ such that $\overline{V}\subseteq U$, the previous lemma shows that there are positive constants $c$ and $C$ such that $c|\mathbf{v}|_g \leq |\mathbf{v}|_g \leq C|\mathbf{v}|_{\overline{g}}$ whenever $\mathbf{x}\in \overline{V}$ and $\mathbf{v}\in T_\mathbf{x} M$. Then for any piecewise smooth curve segment $\gamma$ lying entirely in $\overline{V}$, it follows that

$$
  cL_{\overline{g}} (\gamma) \leq L_g (\gamma) \leq C L_g (\gamma)
$$

Suppose $\gamma: [a,b]\to M$ is a piecewise smooth curve segment from $\mathbf{p}$ to $\mathbf{q}$. Let $t_0$ be the infimum of all $t\in [a, b]$ such that $\gamma(t) \notin \overline{V}$. It follows that $\gamma(t_0)\in\partial V$ by continuity, and $\gamma(t)\in\overline{V}$ for $a \leq t \leq t_0$. Thus

$$
\begin{align*}
  L_g (\gamma) \geq& L_g (\gamma|_{[a,t_0]}) \geq cL_{\overline{g}} (\gamma|_{[a,t_0]}) \\
  \geq& cd_{\overline{g}}(\mathbf{p}, \gamma(t_0)) = c\varepsilon
\end{align*}
$$

Taking the infimum over all such $\gamma$, we conclude that $d_g (\mathbf{p}, \mathbf{q}) \geq c\varepsilon > 0$.

Finally, to show that metric topology generated by $d_g$ is the same as the given manifold topology on $M$, we need to show that the open subsets in the manofld topology are open in the metric topology, and vice versa. Suppose first that $U\subseteq M$ is open in the manifold topology. Let $\mathbf{p}\in U$, and let $V$ be a regular coordinate ball of radius $\varepsilon$ around $\mathbf{p}$ such that $\overline{V}\subseteq U$ as above. The argument in the previous paragraph shows that $d_g (\mathbf{p}, \mathbf{q}) \geq c\varepsilon$ whenever $\mathbf{q}\notin \overline{V}$. The contrapositive of this statement is that $d_g (\mathbf{p}, \mathbf{q}) < c\varepsilon$ implies $\mathbf{q}\in\overline{V}\subseteq U$, or in other words, the metric ball of radius $c\varepsilon$ around $\mathbf{p}$ is contained in $U$. This shows that $U$ is open in the metric topology.

Conversely, suppose $W$ is open in the metric topology, and let $\mathbf{p}\in W$. Let $V$ be a regular coordinate ball of radius $r$ aroun $\mathbf{p}$, let $\overline{g}$ be the Euclidean metric on $\overline{V}$ determined by the given coordiates, and let $c$ and $C$ be positive constants such that $c|\mathbf{v}|_g \leq |\mathbf{v}|_g \leq C|\mathbf{v}|_{\overline{g}}$ is satisfied for $\mathbf{v}\in T_\mathbf{q}M$ and $\mathbf{q}\in \overline{V}$. Let $\varepsilon < r$ be a positive number small enough that the metric ball around $\mathbf{p}$ of radius $C\varepsilon$ is contained in $W$, and let $V_\varepsilon$ be the set of points in $\overline{V}$ whose Euclidean distance from $\mathbf{p}$ is less than $\varepsilon$. If $\mathbf{q}\in V_\varepsilon$, let $\gamma$ be the straight-line segment in coordinates from $\mathbf{p}$ to $\mathbf{q}$. By the previous lemma, we conclude that

$$
  d_g (\mathbf{p}, \mathbf{q}) \leq L_g (\gamma) \leq CL_{\overline{g}} (\gamma) < C\varepsilon
$$

This shows that $V_\varepsilon$ is contained in the metric ball of radius $C\varepsilon$ around $\mathbf{p}$, and therefore in $W$. Since $V_\varepsilon$ is a neighbourhood of $\mathbf{p}$ in the manifold topology, this shows that $W$ is open in the manifold topology as well.
</details>
</MathBox>

<MathBox title='Complete Riemannian manifold' boxType='definition'>
A connected Riemannian manifold $(M,g)$ is *complete*, and $g$ is a *complete Riemannian metric*, if $(M,d_g)$ is a complete metric space. This means that every Cauchy sequence in $M$ coverges to a point in $M$. 
</MathBox>

<MathBox title='' boxType='corollary'>
Every smooth manifold with or without boundary is metrizable.

<details>
<summary>Proof</summary>

First suppose $M$ is a smooth manifold without boundary, and choose any Riemannian metric $g$ on $M$. If $M$ is connected, the previous theorem shows that $M$ is metrizable. More generally, let $\Set{M_i}$ be the connected components of $M$, and choose a point $\mathbf{p}_i \in M_i$ for each $i$. For $\mathbf{x}\in M_i$ and $y\in M_j$, define $d_g (\mathbf{x}, \mathbf{y})$ as in the previous theorem when $i = j$ and otherwise

$$
  d_g (\mathbf{x}, \mathbf{y}) = d_g (\mathbf{x}, \mathbf{p}_i) + 1 + d_g (\mathbf{p}_j, \mathbf{y})
$$

It is straightforward to check that this is a distance function that induces the given topology on $M$. Finally, if $\partial M = \emptyset$, just embed $M$ into its double and note that a subspace of a metrizable topological space is always metrizable. 
</details>
</MathBox>

## The tangent-cotangent isomorphism

Riemannian metrics provide a natural isomorphism between the tangent and cotangent bundles. Given a Riemannian metric $g$ on a smooth manifold $M$ with or without boundary, we define a bundle homomorphism $\hat{g}:TM \to T^* M$ as follows. For each $\mathbf{p}\in M$ and each $\mathbf{v}\in T_\mathbf{p} M$, we let $\tilde{g}(\mathbf{v}) \in T_\mathbf{p}^* M$ be the covector defined by

$$
  \hat{g}(\mathbf{v})(\mathbf{w}) = g_\mathbf{p}(\mathbf{v}, \mathbf{w}),\; \forall \mathbf{w}\in T_\mathbf{p} M
$$

To see that it is a smooth bundle homomorphism, it is easiest to consider its action on smooth vector fields

$$
  \hat{g}(\mathbf{X})(\mathbf{Y}) = g(\mathbf{X}, \mathbf{Y}), \; X, \mathbf{Y}\in\mathfrak{X}(M)
$$

Because $\hat{g}(\mathbf{X})(\mathbf{Y})$ is linear over $C^\infty (M)$ as a function of $\mathbf{Y}$, it follows from the tensor characterization lemma that $\hat{g}(X)$ is a smooth covector field. Because $\hat{g}(X)$ is linear over $C^\infty (M)$ as a function of $\mathbf{X}$, this defines $\hat{g}$ as a smooth bundle homomorphism by the bundle homomorphism characterization lemma. As usual, we use the same symbol for both the pointwise bundle homomorphism $\hat{g}: TM\to T^M$ and the linear map on sections $\hat{g}:\mathfrak{X}(M) \to \mathfrak{X}^* (M)$.

Note that $\hat{g}$ is injective at each point, because $\hat{g}(\mathbf{v}) = 0$ for some $\mathbf{v}\in T_\mathbf{p} M$ implies

$$
  0 = \hat{g}(\mathbf{v})(\mathbf{v}) = \langle\mathbf{v},\mathbf{v}\rangle_g
$$

which in turn implies that $\mathbf{v} = 0$. For dimensional reasons, $\hat{g}$ is therefore bijective, making it a bundle isomorphism.

In any smooth coordinate $(x^i)$, we can write $g = g_{ij}\;\d x^i \;\d x^j$. Thus, if $\mathbf{X}$ and $\mathbf{Y}$ are smooth vector fields, we have

$$
  \hat{g}(\mathbf{X})(\mathbf{Y}) = g_{ij} X^i Y^j
$$

which implies that the covector field $\hat{g}(X)$ has the coordinate expression

$$
  \hat{g}(X) = g_{ij} X^i \;\d x^j
$$

In other words, $\hat{g}$ is the bundle homomorphism whose matrix with respect to coordinate frames for $TM$ and $T^* M$ is the same as the matrix of $g$ itself (or rather its transpose, which is the same since $g_{ij}$).

It is customary to denote the components of the covector field $\hat{g}(X)$ by

$$
  \hat{g}(X) = X_j \mathbf{d}x^j,\quad X_j = g_{ij} X^i
$$

We use the notation $\mathbf{X}^\flat = \hat{g}(X)$ to indicate that $\hat{g}(X)$ is obtained from $\mathbf{X}$ by lowering an index. This is in analogy to the musical "flat" symbol $\flat$ which signifies lowering of a tone.

The matrix of the inverse map $\hat{g}^{-1}: T_\mathbf{p}^* M \to T_\mathbf{p}M$ is thus the inverse of $(g_{ij})$. We let $(g^{ij})$ denote the matrix-valued function whose value at $\mathbf{p}\in M$ is the inverse of the matrix $(g_{ij}(\mathbf{p}))$, giving

$$
  g^{ij}g_{jk} = g_{kj} g^{ji} = \delta_k^i
$$

Because $g_{ij}$ is a symmetric matrix, so is $g^{ij}$. Thus, for a covector field $\omega\in\mathfrak{X}^* (M)$, the vector field $\hat{g}^{-1}(\omega)$ has the coordinate representation

$$
  \hat{g}^{-1}(\omega) = \omega^i \frac{\partial}{\partial x^i},\; \omega^i = g^{ij}\omega_j
$$

We use the notation $\omega^\sharp = \hat{g}^{-1}(\omega)$ to indicate that $\hat{g}^{-1}(\omega)$ is obtained from $\omega$ by lowering an index. This is in analogy to the musical "sharp" symbol $\sharp$ which signifies raising of a tone.

Because the symbols $\flat$ and $\sharp$ are borrowed from musical notation, these two isomorphisms are frequently called the *musical isomorphisms*.

The most important use of the sharp operation is to reinstate the gradient as a vector field on Riemannian manifolds. For any smooth real-valued function $f$ on a Riemannian manofld $(M,g)$ with or without boundary, we define a vector field called the *gradient* of $f$ by

$$
  \operatorname{grad}(f) = \mathrm{grad}(f) = (\d f)^\sharp = \hat{g}^{-1}(\d f)
$$

Unraveling the definitions, we see that for any $\mathbf{X}\in\mathfrak{X}(M)$, the gradient satisfies

$$
\begin{align*}
  \langle \operatorname{grad}(f), X\rangle_g = \hat{g}(\operatorname{grad}(f))(X) \\
  =& \d f(X) = Xf
\end{align*}
$$

Thus $\operatorname{grad}(f)$ is the unique vector field that satisfies $\langle\operatorname{grad}(f), X\rangle_g = Xf$ for every vector field $\mathbf{X}$, or equivalently 

$$
  \langle \operatorname{grad}(f), \cdot \rangle_g = \d f
$$

In smooth coordinates, $\operatorname{grad}(f)$ has the expression

$$
  \operatorname{grad}(f) = g^{ij}\frac{\partial f}{\partial x^i} \frac{\partial}{\partial x^j}
$$

In particular, this shows that $\operatorname{grad}(f)$ is smooth. On $\R^n$ with the Euclidean metric, this reduces to

$$
  \operatorname{grad}(f) = \delta^{ij}\frac{\partial f}{\partial x^i}\frac{\partial}{\partial x^j} = \sum_{i=1}^n \frac{\partial f}{\partial x^i}\frac{\partial}{\partial x^i}
$$

## Pseudo-Riemannian metrics

An important generalization of Riemannian metrics is obtained by relaxing the positivity requirement. A symmetric $2$-tensor $g$ on a vector space $V$ is *nondegenerate* if the linear map $\hat{g}:V\to V^*$ defined by $\hat{g}(\mathbf{v})(\mathbf{w}) = g(\mathbf{v},\mathbf{w})$ is an isomorphism, or equivalently if for every nonzero $\mathbf{v}\in V$ there exists $\mathbf{w}\in V$ such that $g(\mathbf{v},\mathbf{w}) \neq 0$. Just as any inner product can be transformed to the Euclidean one by switching to an orthonormal basis, every nondegenerate symmetric $2$-tensor can be transformed by a change of basis to one whose matrix is diagonal with all entries equal to $\pm 1$. The numbers $r$ and $s$ of positive and negative diagonal entries, respectively, are independent of the choice of a basis (a fact known as Sylvester's law of inertia). Thus the ordered pair $(r,s)$, called the *signature* of $g$, is an invariant of $g$.

A *pseudo-Riemannian metric* on a smooth manifold $M$ is a smooth symmetric $2$-tensor field whose value is nondegenerate at each point, with the same signature everywhere on $M$. Pseudo-Riemannian metrics with signature $(n-1, 1)$, or $(1, n-1)$ depending on the convention used, are called *Lorentz metrics*.

Note that the proposition of the existence of Riemannian does not carry over to the pseudo-Riemannian case, since it is not generally true that a linear combination of nondegenerate $2$-tensors with positive coefficients is necessarily nondegenerate.

# Differential forms

## The algebra of alternating tensors
<MathBox title='Characteristics of alternating tensors' boxType='lemma'>
Let $\alpha$ be a covariant $k$-tensor on a finite-dimensional vector space $V$. The following are equivalent:
1. $\alpha$ is alternating
2. $\alpha(\mathbf{v}_1,\dots,\mathbf{v}_k) = 0$ whenever the $k$-tuple $(\mathbf{v}_1,\dots,\mathbf{v}_k)$ is linearly independent.
3. $\alpha$ give the values zero whenevers two of its arguments are equal, i.e.
$$
  \alpha(\mathbf{v}_1,\dots,\mathbf{w},\dots,\mathbf{w},\dots,\mathbf{v}_k) = 0
$$

<details>
<summary>Proof</summary>

The implications **(1)** $\implies$ **(3)** and **(2)** $\implies$ **(3)** are immediate. We complete the proof by showing that **(3)** implies both **(1)** and **(2)**.

Assume $\alpha$ satisfies **(3)**. For any vectors $(\mathbf{v}_i)_{i=1}^k$, the hypothesis implies

$$
\begin{align*}
  0 =& \alpha(\mathbf{v}_1,\dots, \mathbf{v}_i + \mathbf{v}_j, \dots, \mathbf{v}_i + \mathbf{v}_j, \dots, \mathbf{v_k}) \\
  =& \alpha(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  &+ \alpha(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_j,\dots,\mathbf{v}_k) \\
  &+ \alpha(\mathbf{v}_1,\dots,\mathbf{v}_j,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k) \\
  &+ \alpha(\mathbf{v}_1,\dots,\mathbf{v}_j,\dots,\mathbf{v}_j,\dots,\mathbf{v}_k) \\
  =& \alpha(\mathbf{v}_1,\dots,\mathbf{v}_i,\dots,\mathbf{v}_j,\dots,\mathbf{v}_k) \\
  &+ \alpha(\mathbf{v}_1,\dots,\mathbf{v}_j,\dots,\mathbf{v}_i,\dots,\mathbf{v}_k)
\end{align*}
$$

Thus, $\alpha$ is alternating. On the other hand, if $(\mathbf{v}_i)_{i=1}^k$ is a linearly dependent $k$-tuple, then one of the $\mathbf{v}_i$ can be written as a linear combination of the others. For simplicity, assume $\mathbf{v}_k = \sum_{j=1}^{k-1} a^j \mathbf{v}_j$. Then multilinearity of $\alpha$ implies

$$
  \alpha(\mathbf{v}_1,\dots,\mathbf{v}_k) = \sum_{j=1}^{k-1} a^j \alpha(\mathbf{v}_1,\dots,\mathbf{v}_{k-1},\mathbf{v}_j)
$$

In each of these terms, $\alpha$ has two identical arguments, so every term is zero.
</details>
</MathBox>

<MathBox title='Alternation' boxType='definition'>
The *alternation* of a tensor $\alpha$ on a finite-dimensional vector space is a map $\mathrm{alt}:T^k (V^*) \to \Lambda_k (V^*)$ defined by

$$
  \mathrm{alt}(\alpha) = \frac{1}{k!}\sum_{\sigma\in S_k} \operatorname{sgn}(\sigma) (^\sigma \alpha)
$$

where $S_k$ is the symmetric group on $k$ elements. More explicitly, this means

$$
  (\mathrm{alt}(\alpha))(\mathbf{v}_1,\dots,\mathbf{v}_k) = \frac{1}{k!}\sum_{\sigma\in S_k} \operatorname{sgn}(\sigma) \alpha(\mathbf{v}_{\sigma(1)},\dots,\mathbf{v}_{\sigma(k)})
$$
</MathBox>

<MathBox title='Properties of alternation' boxType='proposition'>
Let $\alpha$ be a covariant tensor on a finite-dimensional vector space.
1. $\mathrm{alt}(\alpha)$ is alternating
2. $\mathrm{alt}(\alpha) = \alpha$ if and only if $\alpha$ is alternating
</MathBox>

### Elementary alternating tensors

<MathBox title='Multi-index' boxType='definition'>
Given a positive integer $k\in\N_+$, an ordered $k$-tuple $I = (i_1,\dots,i_k)$ of positive integers is called a *multi-index* of length $k$. If $I$ is such a multi-index and $\sigma\in S_k$ is a permutation of $\Set{1,\dots,k}$, we write $I_\sigma$ for the following multi-index:

$$
  I_\sigma = (i_{\sigma(1)},\dots,i_{\sigma(k)})
$$

Note that $I_{\sigma\tau} = (I_\sigma)_\tau$ for $\sigma,\tau \in S_k$.

A multi-index is increasing if $i_1 < \cdots < i_k$. It is useful to use a primed summation sign to denote a sum over only increasing multi-indices, e.g.

$$
  \sum'_{I} \alpha_I \varepsilon^I \alpha_I \varepsilon^I = \sum_{I: i_1 < \cdots < i_k} \alpha_I \varepsilon^I
$$
</MathBox>

<MathBox title='Elementary alternating tensor' boxType='definition'>
Let $V$ be an $n$-dimensional vector space, and suppose $(\varepsilon^i)_{i=1}^n$ is any basis for $V^*$. For each multi-index $I = (i_1,\dots,i_k)$ of length $k$ such that $1 \leq i_1, \dots, i_k \leq n$, define a covariant $k$-tensor $\varepsilon^I = \varepsilon^{i_1 \dots i_k}$ by

$$
\begin{align*}
  \varepsilon^I (\mathbf{v}_1,\dots,\mathbf{v}_k) =& \mathrm{det}\begin{bmatrix} 
    \varepsilon^{i_1}(\mathbf{v}_1) & \cdots & \varepsilon^{i_1}(\mathbf{v}_k) \\
    \vdots & \ddots & \vdots \\
    \varepsilon^{i_k}(\mathbf{v}_1) & \cdots & \varepsilon^{i_k}(\mathbf{v}_k)
  \end{bmatrix} \\
  =& \mathrm{det}\begin{bmatrix} 
    \mathbf{v}_1^{i_1} & \cdots & \mathbf{v}_k^{i_1} \\
    \vdots & \ddots & \vdots \\
    \mathbf{v}_1^{i_k} & \cdots & \mathbf{v}_k^{i_k} 
  \end{bmatrix}
\end{align*}
$$

In other words, if $\mathbf{V}$ denotes the $n\times k$ matrix whose columns are the components of the vectors $\mathbf{v}_1,\dots,\mathbf{v}_k$ with respect to the basis $(\mathbf{e}_i)$ dual to $(\varepsilon^i)$, then $\varepsilon^I (\mathbf{v}_1,\dots,\mathbf{v}_k)$ is the determinant of the $k\times k$ submatrix consisting of rows $i_1,\dots,i_k$ of $\mathbf{V}$. Because the determinant changes sign whenever two columns are interchanged, it is clear that $\varepsilon^I$ is an alternating $k$-tensor, called an *elementary alternating tensor* or *elementary $k$-vector*.
</MathBox>

In order to streamline computations with elementary $k$-covectors, it is useful to extend the Kronecker delta notation in the following way. If $I$ and $J$ are multi-indices of length $k$, we define

$$
  \delta_J^I = \mathrm{det}\begin{bmatrix} 
    \delta_{j_1}^{i_1} & \cdots & \delta_{j_k}^{i_1} \\
    \vdots & \ddots & \vdots \\
    \delta_{j_1}^{i_k} & \cdots & \delta_{j_k}^{i_k}
  \end{bmatrix}
$$

<MathBox title='Properties of elementary alternating tensors' boxType='lemma'>
Suppose $V$ is a finite-dimensional vector space. Let $(\mathbf{e}_i)$ be a basis for $V$, let $(\varepsilon^i)$ be the dual basis $V^*$, and let $\varepsilon^I$ be an elementary alternating tensor.
1. If $I$ has a repeated index, then $\varepsilon^I = 0$
2. If $J = I_\sigma$ for some $\sigma\in S_k$, then $\varepsilon^I = \operatorname{sgn}(\sigma) \varepsilon^J$
3. The result of evaluating $\varepsilon^I$ on a sequence of basis vectors is
$$
  \varepsilon^I (\mathbf{e}_{j_1},\dots,\mathbf{e}_{j_k}) = \sigma_J^I
$$

<details>
<summary>Proof</summary>

If $I$ has a repeated index, then for any vectors $\mathbf{v}_1,\dots,\mathbf{v}_k$, the determinant equal to $\varepsilon^I (\mathbf{v}_1,\dots,\mathbf{v}_k)$ has two identical rows and this is equal to zero, which proves **(1)**. On the other hand, if $J$ is obtained from $I$ by interchanging two indices, then the corresponding determinants have opposite sign, implying **(2)**. Finally, **(3)** follows immediately from the definition of $\varepsilon^I$.
</details>
</MathBox>

<MathBox title='A basis for $\Lambda_k (V^*)$' boxType='proposition'>
Let $V$ be an $n$-dimensional vector space. If $(\varepsilon^i)$ is any basis for $V^*$, then for each positive integer $k \leq n$, the collection of $k$-covectors

$$
  \mathcal{E} = \Set{\varepsilon^I | I \text{ is an increasing multi-index of length } k}
$$

is a basis for $\Lambda_k (V^*)$. Thus,

$$
  \dim(\Lambda_k (V^*)) = \binom{n}{k} = \frac{n!}{k!(n-k)!}
$$

If $k > n$, then $  \dim(\Lambda_k (V^*)) = 0$.

<details>
<summary>Proof</summary>

The fact that $\Lambda_k (V^*)$ is the trivial vector space when $k > n$ follows immediately from characteristics of alternating tensors, since every $k$-tuple of vectors is linearly dependent in that case. For the case $k \leq n$, we need to show that $\mathcal{E}$ spans $\Lambda_k (V^*)$ and is linearly independent. Let $(\mathbf{e}_i)$ be the basis for $V$ dual to (\varepsilon^i).

To shows that $\operatorname{span}(\mathcal{E}) = \Lambda_k (V^*)$, let $\alpha\in\Lambda_k (V^*)$ be arbitrary. For each multi-index $I = (i_1,\dots,i_k)$, define a real number $\alpha_I$ by

$$
  \alpha_I = \alpha(\mathbf{e}_{i_1},\dots,\mathbf{e}_{i_k})
$$

The fact that $\alpha$ is alternating implies $\alpha_I = 0$ if $I$ contains a repeated index, and $\alpha_J = \operatorname{sgn}(\sigma)\alpha_I$ if $J = I_\sigma$ for $\sigma\in S_k$. For any multi-index $J$, therefore, by the properties of elementary alternating tensors

$$
\begin{align*}
  \sum'_I \alpha_I \varepsilon^I (\mathbf{e}_{j_1},\dots,\mathbf{e}_{j_k}) = \sum'_I \alpha_I \delta_J^I \\
  =& a_J = \alpha(\mathbf{e}_{j_1},\dots,\mathbf{e}_{j_k})
\end{align*}
$$

Thus, $\sum'_I \alpha_I \varepsilon^I = \alpha$, implying that $\operatorname{span}(\mathcal{E}) = \Lambda_k (V^*)$.

To show that $\mathcal{E}$ is a linearly independent set, supposet that the identity $\sum'_I \alpha_I \varepsilon^I = 0$ holds for some coefficients $\alpha_I$. Let $J$ be any increasing multi-index. Applying both sides of the identity to the vectors $(\mathbf{e}_{j_1}, \dots, \mathbf{e}_{j_k})$ and using the properties of elementary alternating tensors we get

$$
  0 = \sum'_I \alpha_I \varepsilon^I (\mathbf{e}_{j_1},\dots,\mathbf{e}_{j_k}) = \alpha_J
$$

Thus each coefficient $\alpha_J$ is zero.
</details>
</MathBox>

<MathBox title='Determinant property of multicovectors' boxType='proposition'>
Suppose $V$ is an $n$-dimensional vector space and $\omega\in\Lambda_n (V^*)$. If $T:V\to V$ is any linear operator and $\mathbf{v}_1,\dots,\mathbf{v}_n$ are arbitrary vectors in $V$, then

$$
  \omega(T\mathbf{v}_1,\dots,T\mathbf{v}_n) = \det(T) \omega(\mathbf{v}_1,\dots,\mathbf{v}_n)
$$

<details>
<summary>Proof</summary>

Let $(\mathbf{e}_i)$ be any basis for $V$ and let $(\varepsilon^i)$ be its dual basis. Let $(T_i^j)$ denote the matrix of $T$ with respect to this basis, and let $T_i = T\mathbf{e}_i = T_^j \mathbf{e}_j$. By the previous proposition, we can write $\omega = c\varepsilon^{1\dots n}$ for some real number $c$.

Since both sides of the stated identity are multilinear functions of $\mathbf{v}_1,\dots,\mathbf{v}_n$, it suffices to verify the identity when the $\mathbf{v}_i$ are basis vectors. Furthermore, since both sides are alternating, we only need to check the case $(\mathbf{v}_1,\dots,\mathbf{v}_n) = (\mathbf{e}_i,\dots,\mathbf{e}_n)$. In this case, the right hand side is

$$
  \det(T)c\varepsilon^{1\dots n} (\mathbf{e}_1,\dots,\mathbf{e}_n) = c \det(T)
$$

On the other hand, the left-hand side reduces to

$$
\begin{align*}
  \omega(T\mathbf{e}_1,\dots, T\mathbf{e}_n) =& c\varepsilon^{1\dots n} (T_1,\dots, T_n) \\
  =& c\det(\varepsilon^j (T_i)) = c\det(T_i^j)
\end{align*}
$$
</details>
</MathBox>

### The wedge product

<MathBox title='Wedge/extorior product' boxType='definition'>
Suppose $V$ is a finite-dimensional vector space. If $\omega\in\Lambda_k (V^*)$ and $\eta\in\Lambda_l (V^*)$, their *wedge product* or *exterior product* is defined as a $(k+l)$-covector defined As

$$
  \omega\wedge\eta = \frac{(k + l)!}{k!l!}\mathrm{alt}(\omega\otimes\eta)
$$
</MathBox>

<MathBox title='' boxType='lemma'>
Let $V$ be an $n$-dimensional vector space and let $(\varepsilon^i)$ be a basis for $V^*$. For any multi-indices $I = (i_1,\dots,i_k)$ and $J = (j_1,\dots,j_l)$,

$$
  \varepsilon^I \wedge \varepsilon^J = \varepsilon^{IJ}
$$

<details>
<summary>Proof</summary>

By multilinearity, it suffice to thow that

$$
  \varepsilon^I \wedge \varepsilon^J (\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}}) = \varepsilon^{IJ} (\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}})
$$

for any sequence of $(\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}})$ of basis vectors. We consider several cases for $P = (p_1,\dots,p_{k+l})$.

**Case 1:** $P$ has a repeated index<br/>
In this case, both sides of the equation above are zero by the properties of elementary alternating tensors

**Case 2:** $P$ contains an index that does not appear in either $I$ or $J$<br/>
In this case, the right-hand size is zero by the properties of elementary alternating tensors. Similarly, each term in the expansion of the lef-hand side involves either $\varepsilon^I$ or $\varepsilon^J$ evaluated on a sequence of basis vectors that is not a permutation of $I$ or $J$, respectively, so the left-hand side is also zero.

**Case 3:** $P = IJ$ and $P$ has no repeated indices<br/>
In this case, the right hand side is equal to $1$ by the properties of elementary alternating tensors, so we need to show that the left-hand side is also equal to $1$. By definition

$$
\begin{align*}
  &\varepsilon^I \wedge \varepsilon^J (\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}}) \\
  =& \frac{(k+l)!}{k!l!} \mathrm{alt}(\varepsilon^I \otimes \varepsilon^J)(\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}}) \\
  =& \frac{1}{k!l!} \sum_{\sigma\in S_{k+l}} \operatorname{sgn}(\sigma) \varepsilon^I (\mathbf{e}_{p}_{\sigma(1)},\dots,\mathbf{e}_{p_{\sigma(k)}})\varepsilon^J (\mathbf{e}_{p_{\sigma(k+1)}},\dots,\mathbf{e}_{p_{\sigma(k+l)}})
\end{align*}
$$

By the properties of elementary alternating tensors, the only terms in the sum above that give nonzero values are those in which $\sigma$ permutes the first $k$ indices and the last $l$ indesc of $P$ separately. In other words, $\sigma$ must be of the form $\sigma = \tau\eta$, where $\tau\in S_k$ act by permuting $\Set{1,\dots,k}$ and $\eta\in S_l$ acts by permuting $\Set{k+1,\dots,k+l}$. Since $\operatorname{sgn}(\tau\eta) = \operatorname{sgn}(\tau)\operatorname{sgn}(\eta)$, we have

$$
\begin{align*}
  &\varepsilon^I \wedge \varepsilon^J (\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_{k+l}}) \\
  =& \frac{1}{k!l!} \sum_{\substack{\tau\in S_k \\ \eta\in S_l}} \operatorname{sgn}(\tau)\operatorname{sgn}(\eta) \varepsilon^I (\mathbf{e}_{p}_{\sigma(1)},\dots,\mathbf{e}_{p_{\sigma(k)}})\varepsilon^J (\mathbf{e}_{p_{\sigma(k+1)}},\dots,\mathbf{e}_{p_{\sigma(k+l)}}) \\
  =& \left(\frac{1}{k!}\sum_{\tau\in S_k} \operatorname{sgn}(\tau)\varepsilon^I (\mathbf{e}_{p_{\tau(1)}},\dots,\mathbf{e}_{p_{\tau(k)}}) \right) \\
  &\times \left(\frac{1}{l!}\sum_{\eta\in S_l} \operatorname{sgn}(\eta)\varepsilon^J (\mathbf{e}_{p_{k + \eta(1)}},\dots,\mathbf{e}_{p_{k + \eta(l)}}) \right) \\
  =& \mathrm{alt}(\varepsilon^I)(\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_k})\mathrm{alt}(\varepsilon^J)(\mathbf{e}_{p_{k+1}},\dots,\mathbf{e}_{p_{k+l}}) \\
  =& \varepsilon^I (\mathbf{e}_{p_1},\dots,\mathbf{e}_{p_k})\varepsilon^J (\mathbf{e}_{p_{k+1}},\dots,\mathbf{e}_{p_{k+l}}) = 1
\end{align*}
$$

**Case 4:** $P$ is a permutation of $IJ$ and has no repeated indices<br/>
In this case, applying a permutation to $P$ bring us back to case $1$. Since the effect of the permutation is to multiply both sides of the equation by the same sign, the result holds in this case as well.
</details>
</MathBox>

<MathBox title='Properties of the wedge product' boxType='proposition'>
Suppose $\omega$, $\omega'$, $\eta$, $\eta'$ and $\xi$ are multicovectors on a finite-dimensional vector space $V$.
1. **Bilinearity:** For $a,a'\in\R$
$$
\begin{align*}
  (a\omega + a'\omega)\wedge\eta =& a(\omega\wedge\eta) + a'(\omega' \wedge\eta) \\
  \eta\wedge(a\omega + a'\omega') =& a(\eta\wedge\omega) + a'(\eta\wedge\omega')
\end{align*}
$$
2. **Associativity:**
$$
  \omega\wedge(\eta\wedge\xi) = (\omega\wedge\eta)\wedge\xi
$$
3. For $\omega\in\Lambda_k (V^*)$ and $\eta\in\Lambda_l (V^*)$
$$
  \omega\wedge\eta = (-1)^{kl} \eta\wedge\omega
$$
4. If $(\varepsilon^i)$ is any basis for $V^*$ and $I = (i_1,\dots,i_k)$ is any multi-index, then
$$
  \varepsilon^{i_1} \wedge\cdots\wedge\varepsilon^{i_k} = \varepsilon^I
$$
5. For any covectors $\omega^1,\dots,\omega^k$ and vectors $\mathbf{v}_1,\dots,\mathbf{v}_k$
$$
  \omega^1 \wedge\cdots\wedge \omega^k (\mathbf{v}_1,\dots,\mathbf{v}_k) = \det(\omega^j (\mathbf{v}_i))
$$

<details>
<summary>Proof</summary>

Bilinearity follows immediately from the definition, because the tensor product is bilinear and the alternation is linear. To prove associativity note that from the previous lemma

$$
\begin{align*}
  (\varepsilon^I \wedge\varepsilon^J)\wedge\varepsilon^K =& \varepsilon^{IJ} \wedge\varepsilon^k = \varepsilon^{IJK} \\
  =& \varepsilon^I \wedge \varepsilon^{JK} = \varepsilon^I \wedge (\varepsilon^J \wedge\varepsilon^K)
\end{align*}
$$

The general case follows from bilinearity. Similarly, using the previous lemma, we get

$$
\begin{align*}
  \varepsilon^I \wedge\varepsilon^J =& \varepsilon^{IJ} = \operatorname{sgn}(\tau)\varepsilon^{JI} \\
  =& \operatorname{sgn}(\tau)\varepsilon^J \wedge \varepsilon^I 
\end{align*}
$$

where $\tau$ is the permutation that sends $IJ$ to $JI$. It is easy to check that $\operatorname{sgn}(\tau) = (-1)^{kl}$, because $\tau$ can be decomposed as a composition of $kl$ transposition (each index of $I$ must be moved past each of the indices of $J$). Anticommutativity then follows from bilinearity.

Part **(1)** is an immediate consequence of the previous lemma and induction. To prove **(5)**, note that the special case in which each $\omega^j$ is one of the basis covectors $\varepsilon^{i_j}$ reduces to $\varepsilon^{i_1}\wedge\cdots\wedge\varepsilon^{i_k} = \varepsilon^I$. Since both sides of the identity of **(5)** are multilinear in $(\omega^1,\dots,\omega^k)$ this suffices.
</details>
</MathBox>

<MathBox title='Decombosable alternating tensor' boxType='definition'>
A $k$-covector $\eta$ is *decomposable* if it can be expressed in the form $\eta = \omega^1 \wedge\cdots\wedge\omega^k$, where $\omega^1,\dots,\omega^k$ are covectors.
</MathBox>

For any $n$-dimensional vector space $V$, define a vector space $\Lambda (V^*)$ by

$$
  \Lambda(V^*) = \bigoplus_{k=0}^n \Lambda_k (V^*)
$$

It follows from the basis proposition that $\dim(\Lambda(V^*)) = 2^n$. By its properties, the wedge product turn $\Lambda(V^*)$ into an associative algebra, called the *exterior algebra* or *Grassmann algebra* of $V$. This algebra is not commutative, bu it has a closely related property. An algebra $A$ is *graded* if it has a direct sum decomposition $A = \bigoplus_{k\in\Z} A^k$ such that the product satisfies $(A^k)(A^l) \subseteq A^{k+l}$ for each $k$ and $l$. A graded algebra is *anticommutative* if the product satisfies $ab = (-1)^{kl}ba$ for $a\in A^k$ and $b\in A^l$. By anticommutativity of the wedge product, $\Lambda(V^*)$ is an anticommutative graded algebra, where we interpret $A^k = \Lambda_k (V^*)$ for $0 \leq k \leq n$, and $A^k = \Set{0}$ otherwise.

The definition of the wedge product as is alternatively defined without a coefficient as

$$
  \omega\wedge\eta = \frac{(k + l)!}{k!l!}\mathrm{alt}(\omega\otimes\eta)
$$

is known as the *deteminant convention*. Alternatively, the wedge product can be defined without a coefficient as

$$
  \omega \overline{\wedge} \eta = \mathrm{alt}(\omega\otimes\eta)
$$

which is known as the *alternation convention*. In terms of the latter convention, we can write

$$
  \varepsilon^I \overline{\wedge} \varepsilon^J = \frac{k!l!}{(k+l)!}\varepsilon^{IJ}
$$

and

$$
  \omega^1 \overline{\wedge}\cdots\overline{\wedge} (\mathbf{v}_1,\dots,\mathbf{v}_k) = \frac{1}{k!}\mathrm{det}(\omega^i (\mathbf{v}_j))
$$

### Interior multiplication

<MathBox title='Interior multiplication' boxType='definition'>
Let $V$ be a finite-dimensional vector space. For each $\mathbf{v}\in V$, we define a linear map $i_\mathbf{v}:\Lambda_k (V^*) \to \Lambda_{k-1}(V^*)$, called the *interior multiplication* by $\mathbf{v}$ as follows

$$
  i_\mathbf{v}\omega (\omega_1,\dots,\omega_{k-1}) = \omega(\mathbf{v},\omega_1,\dots,\omega_{k-1})
$$

In other words, $i_\mathbf{v}\omega$ is obtained from $\omega$ by inserting $\mathbf{v}$ into the first slot. By convention, we interpret $i_\mathbf{v}\omega$ to be zero when $\omega$ is $0$-covector, i.e. a number. Another common notation is

$$
  \mathbf{v} \lrcorner \omega = i_\mathbf{v}\omega
$$

which is read "$\mathbf{v}$ into $\omega$".
</MathBox>

<MathBox title='' boxType='lemma'>
Let $V$ be a finite-dimensional vector space and let $\mathbf{v}\in V$.
1. $i_\mathbf{v} \circ i_\mathbf{v} = 0$
2. If $\omega\in\Lambda_k (V^*)$ and $\eta\in\Lambda_l (V^*)$
$$
  i_\mathbf{v}(\omega\wedge\eta) = (i_\mathbf{v}\omega) \wedge\eta + (-1)^k \omega\wedge(i_\mathbf{v}\eta)
$$

<details>
<summary>Proof</summary>

On $k$-covectors for $k\geq 2$, part **(1)** is immediate from the definition, because any alternating tensor gives zero when two of its arguments are identical. On $1$-covectors and $0$-covectors, it follows from the fact that $i_\mathbf{v} \equiv 0$ on $0$-covectors.

To prove **(2)**, it suffices to consider the case in which both $\omega$ and $\eta$ are decomposable, since every alternating tensor of positive rank can be written as a linear combination of decomposable ones. It is straightforward to verify that **(2)** follows in this special case from the following general formula for covectors $\omega^1,\dots,\omega^k$

$$
  \mathbf{v}\lrcorner (\omega^1 \wedge\cdots\wedge\omega^k) = \sign_{i=1}^k (-1)^{i-1} \omega^i (\mathbf{v}) \omega^1 \wedge\omega\cdots\wedge \hat{\omega}^i \wedge\cdots\wedge \omega^k
$$

where the hat indicates that $\omega^i$ is omitted. To prove this equation, write $\mathbf{v}_1 = \mathbf{v}$ and apply both sides to an arbitrary $(k-1)$-tuple of vectors $(\mathbf{v}_2,\dots,\mathbf{v}_k)$. The we have to prove that

$$
\begin{align*}
  (\omega^1 \wedge\cdots\wedge \omega^k)(\mathbf{v}_1,\dots,\mathbf{v}_k) \\
  &= \sum_{i=1}^k (-1)^{i-1} \omega^i (\mathbf{v}_1)(\omega^1 \wedge\cdots\wedge\hat{\omega}^i \wedge\cdots\wedge\omega^k)(\mathbf{v}_2,\dots,\mathbf{v}_k)
\end{align*}
$$

The left-hand side is the determinant of the matrix $\mathbf{V}$ with entries $\mathbf{V}_j^i = \omega^i (\mathbf{v}_j)$. To simplify the right-hand side, let $\hat{\mathbf{V}}_j^i$ denote the $(k-1)\times(k-1)$ submatrix of $\mathbf{V}$ obtained by deleting the $i$th row and $j$th column. Then the right-hand side becomes

$$
  \sum_{i=1}^k (-1)^{i-1}\omega^i (\mathbf{v}_1) \det(\mathbf{V}_1^i)
$$

This is just the expansion of $\det(\mathbf{V})$ by minors along the first column, and therefore is equal to $\det(\mathbf{V})$.
</details>
</MathBox>

In terms of the alternation convention, interior multiplication of a vector with a $k$-form has to be defined with an extra factor of $k$

$$
  \overline{i}_\mathbf{v}\omega(\omega_1,\dots,\omega_{k-1}) = k\omega(\mathbf{v},\omega_1,\dots,\omega_{k-1})
$$

## Differential forms on manifolds

<MathBox title='Differential form' boxType='definition'>
Suppose $M$ is a smooth $n$-manifold and let $T_k T^*M$ be a bundle of covariant $k$-tensors on $M$. The subset of $T_k T^* M$ consisting of alternating tensors is denoted by $\Lambda_k T^* M$:

$$
  \Lambda_k T^* M = \bigsqcup_{\mathbf{p}\in M} \Lambda_k (T_\mathbf{p}^* M)
$$

A section of $\Lambda_k T^* M$ is called a *(differential) $k$-form*, which is a (continuous) tensor field whose value at each point is an alternating tensor. The integer $k$ is called the *degree* of the form. The vector space of smooth $k$-form is denoted

$$
  \Omega^k (M) = \Gamma (\Lambda_k T^* M)
$$

The wedge product of two differential forms is defined pointwise: $(\omega\wedge\eta)_\mathbf{p} = \omega_\mathbf{p}\wedge\eta_\mathbf{p}$. Thus, the wedge product of a $k$-form with and $l$-form is a $(k+l)$-form. If $f$ is a $0$-form and $\eta$ is a $k$-form, we interpret the wedge product $f\wedge\eta$ to mean the ordinary product $f\eta$.

If we define

$$
  \Omega^* (M) = \bigoplus_{k=0}^n \Omega^k (M)
$$

then the wedge product turn $\Omega^* (M)$ into an associative, anticommutative graded algebra.
</MathBox>

In smooth chart, a $k$-form $\omega$ can be written locally as

$$
  \omega = \sum'_{I} \omega_I \;\d x^{i_1} \wedge\cdots\wedge\d x^{i_k} = \sum'_I \omega_I \d x^I
$$

where the coefficients $\omega_I$ are continuous functions defined on the coordinate domain. By properties of elementary alternating tensors we can write

$$
  \d x^{i_1} \wedge\cdots\wedge \d x^{i_k} \left( \frac{\partial}{\partial x^{j_i}},\dots,\frac{\partial}{\partial x^{j_k}} \right) = \delta_J^I
$$

Thus, the component functions $\omega_I$ of $\omega$ are determined by

$$
  \omega_I = \omega\left( \frac{\partial}{\partial x^{i_1}},\dots,\frac{\partial}{\partial x^{i_k}} \right)
$$

If $F: M\to N$ is a smooth map and $\omega$ is a differential form on $N$, the pullback $F^* \omega$ is a differential form on $M$, defined as for any covariant tensor field

$$
  (F^* \omega)_\mathbf{p} (\mathbf{v}_1,\dots,\mathbf{v}_k) = \omega_{F(\mathbf{p})} (\d F_\mathbf{p}(\mathbf{v}_1),\dots,\d F_\mathbf{p}(\mathbf{v}_k))
$$

<MathBox title='Properties of pullbacks of differential forms' boxType='lemma'>
Let $M$ and $N$ be smooth manifolds and suppose $F:M\to N$ is smooth
1. $F^*: \Omega^k (N) \to \Omega^k (M)$ is linear over $\R$
2. $F^* (\omega\wedge\eta) = (F^* \omega)\wedge(F^* \eta)$
3. In any smooth chart
$$
  F^* \left( \sum'_I \omega_I \d y^{i_1} \wedge\cdots\wedge \d y^{i_k} \right) = \sum'_I (\omega_I \circ F) \d(y^{i_1}\circ F) \wedge\cdots\wedge \d(y^{i_k} \circ F)
$$
</MathBox>

<MathBox title='Pullback formula for top-degree forms' boxType='proposition' tag='proposition-158'>
Let $F:M\to N$ be a smooth map between $n$-manifold with or without boundary. If $(x^i)$ and $(y^j)$ are smooth coordinates on open subsets $U\subseteq M$ and $V\subseteq N$, respectively, and $u$ is a continuous real-valued function on $V$, then the following holds on $U \cap F^{-1} (V)$

$$
  F^* (u \;\d y^1 \bigwedge_{i=1}^n \d y^i) = (u\circ F)\det(\D F) \bigwedge_{i=1}^n \d x^i
$$

where $\D F$ represents the Jacobian matrix of $F$ in these coordinates. 

<details>
<summary>Proof</summary>

Because the fibre of $\Lambda_n T^* M$ is spanned by $\d x^1 \wedge\cdots\wedge \d x^n$ at each point, it suffices to show that both sides of the stated equation give the same result when evaluated on $\left(\frac{\partial}{\partial x^1},\dots,\frac{\partial}{\partial x^n} \right)$. From properties of pullbacks of differential form, we get

$$
  F^* (u\d y^1 \wedge\cdots\wedge \d y^n) = (u\circ F)\d F^1 \wedge\cdots\wedge \d F^n
$$

By properties of the wedge product, we get

$$
\begin{align*}
  \d F^1 \wedge\cdots\wedge \d F^n \left( \frac{\partial}{\partial x^1},\dots,\frac{\partial}{\partial x^n} \right) =& \det\left(\d F^j \left(\frac{\partial}{\partial x^i}\right) \right) \\
  =& \det\left(\frac{\partial F^j}{\partial x^i}\right)
\end{align*}
$$

Thus, the left hand side of the stated equation gives $(u\circ F)\det(\D F)$ when applied to $\left(\frac{\partial}{\partial x^n},\dots,\frac{\partial}{\partial x^n} \right)$. On the other hand, the right-hand side gives the same thing because

$$
  \d x^1 \wedge\cdots\wedge \d x^n \left(\frac{\partial}{\partial x^1},\dots,\frac{\partial}{\partial x^n} \right) = 1
$$
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
If $(U, (x^i))$ and $(\tilde{U}, (\tilde{x}^j))$ are overlapping smooth coordinate charts on a smooth manifold $M$, then the following identity holds on $U\cap\tilde{U}$

$$
  \d\tilde{x}^1 \wedge\cdots\wedge \d\tilde{x}^n = \det\left(\frac{\partial\tilde{x}^j}{\partial x^i}\right)\d x^1 \wedge\cdots\wedge\d x^n
$$

<details>
<summary>Proof</summary>

Apply proposition $\ref{proposition-158}$ with $F$ equal to the identity map of $U\cap\tilde{U}$, but using coordinates $(x^i)$ in the domain and $(\tilde{x}^j)$ in the codomain.
</details>
</MathBox>

Interior multiplication also extends naturally to vector fields and differential form, by letting it act pointwise: if $\mathbf{X}\in\mathfrak{X}(M)$ and $\omega\in\Omega^k (M)$, define a $(k-1)$-form $X \lrcorner\,\omega = i_X \omega$ by

$$
  (\mathbf{X} \lrcorner\,\omega)_\mathbf{p} = \mathbf{X}_\mathbf{p} \lrcorner\,\omega_\mathbf{p}
$$

## Exterior derivatives

Recall that given a smooth $1$-form $\omega$, a necessary condition for the existence of a smooth function $f$ such that $\omega = \d f$ is that $\omega$ is *closed*, satisfying

$$
  \frac{\partial\omega_j}{\partial x^i} - \frac{\partial\omega_i}{\partial x^j} = 0
$$

in every smooth coordinate chart. Since the left-hand side is antisymmetric in the indices $i$ and $j$, it can be interpreted as the $ij$-component of an alternating tensor field, i.e. a $2$-form. We can define a $2$-form $\d\omega$ locally in each smooth chart by

$$
  \d\omega = \sum_{i<j} \left( \frac{\partial\omega_j}{\partial x^i} - \frac{\partial\omega_i}{\partial x^j} \right) \d x^i \wedge \d x^j
$$

It follows that $\omega$ is closed if and only if $\d\omega = 0$ in each chart. It turns out that $\d\omega$ is well defined globally, independently of the choice of coordinate chart, and this definition has a significant generalization to differential forms of all degrees.

For each smooth manifold $M$ with or without boundary, we can show that there is a differential operator $\d:\Omega^k (M) \to\Omega^{k+1}(M)$ satisfying $\d(\mathbf{d}\omega) = 0$ for all $\omega$. Thus, it will follow that a necessary condition for a smooth $k$-form $\omega$ to be equal to $\d\eta$ for some $(k-1)$-form $\eta$ is that $\d\omega = 0$.

<MathBox title='Exterior derivative on Euclidean space' boxType='definition'>
If $\omega = \sum'_J \omega_J \d x^J$ is a smooth $k$-form on an open subset $U\subseteq\R^n$ or $\mathbf{H}^n$, we define its *exterior derivative* $\d\omega$ to be the following $(k+l)$-form

$$
  \d\left( \sum'_J \omega_J \d x^J \right) = \sum'_J \d\omega_J \wedge \d x^J
$$

where $\d\omega_J$ is the differential of the function $\omega_J$. In more detail, this is

$$
  \d\left( \sum'_J \omega_J \bigwedge_{h=1}^k \d x^{j_h} \right) = \sum'_J \sum_i \frac{\partial\omega_J}{\partial x^i} \d x^i \wedge \left(\bigwedge_{h=1}^k \d x^{j_h} \right)
$$

<details>
<summary>Proof</summary>

Note that for a smooth $0$-form, the exterior derivative reduces To

$$
  \d f = \frac{\partial f}{\partial x^i} \d x^i
$$

which is the differential of $f$.

Note that when $\omega$ is a $1$-form, the exterior derivative becomes

$$
\begin{align*}
  \d(\omega_j \d x^j) =& \sum_{i,j} \frac{\partial\omega_j}{\partial x^i} \d x^i \wedge\d x^j \\
  =& \sum_{i<j} \frac{\partial\omega_j}{\partial x^i} \d x^i \wedge\d x^j + \sum_{i>j} \frac{\partial\omega_j}{\partial x^i} \d x^i \wedge\d x^j \\
  =& \sum_{i < j} \left(\frac{\partial\omega_j}{\partial x^i} - \frac{\partial\omega_i}{\partial x^j} \right) \d x^i \wedge \d x^j
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Properties of the exterior derivative on $\R^n$' boxType='proposition'>
1. $\d$ is linear over $\R$
2. If $\omega$ is a smooth $k$-form and $\eta$ is a smooth $l$-form on an open subset $U\subseteq\R^n$ or $\mathbb{H}^n$, then
$$
  \d(\omega\wedge\eta) = \d\omega \wedge\eta + (-1)^k \omega \wedge \d\eta
$$
3. $\d\circ\d\equiv 0$
4. $d$ commutes with pullbacks: if $U$ is an open subset of $\R^n$ or $\mathbf{H}^n$, $V$ is an open subset of $\R^m$ or $\mathbb{H}^m$, $F:U\to V$ is a smooth map, and $\omega\in\Omega^k (V)$, then

$$
  F^* (\d\omega) = \d(F^* \omega)
$$

<details>
<summary>Proof</summary>

**(1):** Linearity of $d$ is an immediate consequence of the definition.

**(2):** It suffices to consider terms of the form $\omega = u\d x^I \in\Omega^k (U)$ and $\eta = v\d x^J \in \Omega^l (U)$ for smooth real-valued functions $u$ and $v$. First we need to know that $\d$ satisfies $\d(u\d x^I) = \d u \wedge \d x^I$ for any multi-index $I$, not just increasing ones. If $I$ has repeated indices, then clearly $\d(u\;\d x^I) = 0 = \d u \wedge \d x^I$. If not, let $\sigma$ be the permutation sending $I$ to an increasin multi-index $J$. Then

$$
\begin{align*}
  \d(u\;\d x^I) = \operatorname{sgn}(\sigma)\d(u\;\d x^J) \\
  =& \operatorname{sgn}(\sigma) \d u \wedge \d x^J = \d u \wedge \d x^I
\end{align*}
$$

Using this, we compute

$$
  \d(\omega\wedge\eta) =& \d((u\;\d x^I) \wedge (v\;\d x^J)) \\
  =& \d(uv\;\d x^I \wedge \d x^J) \\
  =& (v\;\d u + u\;\d v) \wedge \d x^I \wedge \d x^J \\
  =& (\d u \wedge \d x^I) \wedge (v\;\d x^J) + (-1)^k (u\;\d x^I) \wedge (\d v \wedge \d x^J) \\
  =& \d\omega \wedge\eta + (-1)^k \omega\wedge\d\eta
$$

where the $(-1)^k$ comes from the fact that $\d v \wedge\d x^I = (-1)^k \;\d x^I \wedge\d v$ because $\d v$ is a $1$-form and $\d x^I$ is a $k$-form.

**(3):** In the case of a $0$-form, which is just a real-valued function, we get

$$
\begin{align*}
  \d(\d u) =& \d\left(\frac{\partial u}{\partial x^j} \d x^j \right) = \frac{\partial^2 u}{\partial x^i \partial x^j}\d x^i \wedge \d x^j \\
  =& \sum_{i < j} \left( \underbrace{\frac{\partial^2 u}{\partial x^i x^j} - \frac{\partial^2 u}{\partial x^j x^i}}{=0} \right) \d x^i \wedge \d x^j = 0
\end{align*}
$$

For the general case, we use the $k = 0$ case together **(2)** to compute

$$
\begin{align*}
  \d(\d\omega) =& \d\left( \sum'_J \d\omega_J \wedge \d x^{j_1} \wedge\cdots\wedge \d x^{j_k} \right) \\
  =& \sum'_J \d(\d\omega_J) \wedge \d x^{j_1} \wedge\cdots\wedge \d x^{j_k} \\
  &+ \sum'_J \sum_{i=1}^k (-1)^i \d\omega_J \wedge\d x^{j_1} \wedge\cdots\wedge \d(\d x^{j_i}) \wedge\cdots\wedge \d x^{j_k} \\
  =& 0
\end{align*}
$$

**(4):** It suffices to consider $\omega = u \;\d x^{i_1} \wedge\cdots\wedge \d x^{i_k}$. For such a form, the left-hand side of $F^* (\d\omega) = \d(F^* \omega)$ is

$$
\begin{align*}
  F^* (\d(u \d x^{i_1} \wedge\cdots\wedge \d x^{i_k})) =& F^* (\d u \wedge \d x^{i_1} \wedge\cdots\wedge \d x^{i_k}) \\
  =& \d(u\circ F)\wedge \d(x^{i_1} \circ F) \wedge\cdots\wedge \d(x^{i_k} \circ F)
\end{align*}
$$

and the right-hand side is

$$
  \d(F^* (u\;\d x^{i_1} \wedge\cdots\wedge\d x^{i_k})) =& \d((u\circ F)\d(x^{i_1}\circ F)\wedge\cdots\wedge\d(x^{ik}\circ F)) \\
  =& \d(u\circ F) \wedge \d(x^{i_1} \circ F)\wedge\cdots\wedge \d(x^{i_k}\circ F)
$$
</details>
</MathBox>

<MathBox title='Existence and uniqueness of exterior differentiation' boxType='theorem'>
Suppose $M$ is a smooth manifold with or without boundary. There are unique operators $\d:\Omega^k (M) \to\Omega^{k+1}(M)$ for all $k\in\N_+$, called *exterior differentiation*, satisfying the following properties
1. $d$ is linear over $\R$
2. If $\omega\in\Omega^{k}(M)$ and $\eta\in\Omega^l (M)$, then
$$
  \d(\omega\wedge\eta) = \d\omega \wedge\eta + (-1)^k \omega\wedge\d\eta
$$
3. $\d\circ\d \equiv 0$
4. For $f\in\Omega^0 (M) = C^\infty(M)$, $\d f$ is the differential of $f$, given by $\d f(X) = Xf$

<details>
<summary>Proof</summary>

First, we prove existence. Suppose $\omega\in\Omega^k (M)$. We seek to define $\d\omega$ by means of the coordinate formula $\d\left( \sum'_J \omega_J \d x^J \right) = \sum'_J \d\omega_J \wedge \d x^J$ in each chart. More precisely, this means that for each smooth chart $(U,\varphi)$ for $M$, we seek to set

$$
  \d\omega = \varphi^* \d(\varphi^{-1}* \omega)
$$

To see that this is well-defined, we note that for any smooth chart $(V,\psi)$, the map $\varphi\circ\psi^{-1}$ is a diffeomorphism between open subsets of $\R^n$ or $\mathbb{H}^n$, the pullpack commutativity property of the exterior derivative implies

$$
  (\varphi\circ\psi^{-1})^* \d(\varphi^{-1*}\omega) = \d((\varphi\circ\psi^{-1})^* \varphi^{-1*}\omega)
$$

Together with the fact that $(\varphi\circ\psi^{-1}) = \psi^{-1*}\circ\varphi^*$, this implies that $\varphi^* \d(\varphi^{-1*}\omega) = \psi^* \d(\psi^{-1*}\omega)$, so $\d\omega$ is well defined. It satisfies **(1)**-**(4)** by virtue of the properties for Euclidean exteriori derivative.

To prove uniqueness, suppose $\d$ is any operator satisfying **(1)**-**(4)**. First, we need to show that $\d\omega$ is determined locally: if $\omega_1$ and $\omega_2$ are $k$-forms that agree on an open subset $U\subseteq M$, the $\d\omega_1 = \d\omega_2$ on $U$. To see this, let $\mathbf{p}\in U$ be arbitrary, let $\eta = \omega_1 - \omega_2$, and let $\psi\in C^\infty (M)$ be a bump function with $\psi\equiv 1$ on some neighbourhood of $\mathbf{p}$ and supported in $U$. Then $\psi\eta\equiv 0$, so **(1)**-**(4)** imply $0 = \d(\psi\eta) = \d\psi\wedge\eta + \psi\d\eta$. Evaluating this at $\mathbf{p}$ and using the facts that $\psi(\mathbf{p}) = 1$ and $\d\psi_\mathbf{p} = 0$, we conclude that $\d\omega_1|_\mathbf{p} - \d\omega_2|_\mathbf{p} = \d\eta_\mathbf{p} = 0$.

Let $\omega\in\Omega^k (M)$ be arbitrary, and let $(U,\varphi)$ be any smooth coordinate chart on $M$. We can write $\omega$ in coordinates as $\sum'_I \omega_I \d x^I$ on $U$. For any $\mathbf{p}\in U$, by means of a bump function we can construct global smooth functions $\tilde{omega}_I$ and $\tilde{x}^i$ on $M$ that agree with $\omega_I$ and $x^i$ in a neighbourhood of $\mathbf{p}$. By virtue of **(1)**-**(4)** together with the observation in the preceding paragraph, it follows that $\d\left( \sum'_J \omega_J \d x^J \right) = \sum'_J \d\omega_J \wedge \d x^J$ holds at $\mathbf{p}$. Since $\mathbf{p}$ was arbitrary, this $\d$ must be equal to the one we defined above.
</details>
</MathBox>

If $A = \bigoplus_k A^k$ is a graded algebra, a linear map $T:A\to A$ is a map of degree $m$ if $T(A^K) \subseteq A^{k+m}$ for each $k\in\N$. It is an *antiderivation* if it satisfies $T(xy) = (TX)y + (-1)^k x(Ty)$ whenever $x\in A^k$ and $y\in A^l$. In this sense, the preceding theorem tells that the differential on functions extends uniquely ot an antiderivation of $\Omega^* (M)$ of degree $+1$ whose square is zero.

<MathBox title='Naturality of the exterior derivative' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifolds. If $F:M\to N$ is a smooth map, then for each $k$ the pullback map $F^*: \Omega^k (N) \to\Omega^k (M)$ commutes with $d$, i.e.

$$
  F^* (\d\omega) = \d(F^* \omega),\; \forall\omega\in\Omega^k (N)
$$

<details>
<summary>Proof</summary>

If $(U,\varphi)$ and $(V,\psi)$ are smooth charts for $M$ and $N$, respectively, we can apply the null property of the wedge product to the cordinate representation $\psi\circ F\circ\varphi^{-1}$. Using $\d\omega = \varphi^* \d(\varphi^{-1*}\omega)$ twice, we compute as follows on $U\cap F^{-1}(V)$

$$
\begin{align*}
  F^* (\d\omega) =& F^* \psi^* \d(\psi^{-1*}\omega) \\
  =& \varphi^* \circ (\psi\circ F\circ\varphi^{-1})^* \d(\psi^{-1*}\omega) \\
  =& \varphi^* \d((\psi\circ F \circ\varphi^{-1})^* \psi^{-1*}\omega) \\
  =& \varphi^* \d(\varphi^{-1*} F^* \omega) \\
  =& \d(F^* \omega)
\end{align*}
$$
</details>
</MathBox>

A smooth differential form $\omega\in\Omega^k (M)$ is closed if $\d\omega$ and exact if there exists a smooth $(k-1)$-form $\eta$ on $M$ such that $\omega = \d\eta$. The fact that $\d\circ\d\equiv 0$ implies that every exact form is closed.

### Exterior derivatives and vector calculus in $\R^3$

In $\R^3$ any smooth $1$-form takes the formal

$$
  \omega = P\;\d x + Q\;\d y + R\;\d z
$$

for some smooth functions $P, Q, R$. Using $\d\left( \sum'_J \omega_J \d x^J \right) = \sum'_J \d\omega_J \wedge \d x^J$ and the fact that any $1$-form with itself is zero, we compute

$$
\begin{align*}
  \d\omega =& \d P\wedge\d x + \d Q\wedge\d y + \d R\wedge\d z \\
  =& \left(\frac{\partial P}{\partial x}\d x + \frac{\partial P}{\partial y}\d y + \frac{\partial P}{\partial z}\d z \right)\wedge\d x \\
  &+ \left(\frac{\partial Q}{\partial x}\d x + \frac{\partial Q}{\partial y}\d y + \frac{\partial Q}{\partial z}\d z \right)\wedge\d y \\
  &+ \left(\frac{\partial R}{\partial x}\d x + \frac{\partial R}{\partial y}\d y + \frac{\partial R}{\partial z}\d z \right)\wedge\d y \\
  =& \left(\frac{\partial Q}{\partial x} - \frac{\partial P}{\partial y}\right)\d x \wedge\d y + \left( \frac{\partial R}{\partial x} - \frac{\partial P}{\partial z} \right)\d x \wedge\d z \\
  &+ \left( \frac{\partial R}{\partial y} - \frac{\partial Q}{\partial z} \right)\d y \wedge\mathbf{d}z
\end{align*}
$$

An arbitrary $2$-form on $\R^3$ can be written

$$
  \eta = u\;\d x\wedge\d y + v\;\d x\wedge\d z + w\;\d y\wedge\d z
$$

A similar computation shows that

$$
  \d\eta = \left(\frac{\partial u}{\partial z} - \frac{\partial v}{\partial y} + \frac{\partial w}{\partial x} \right)\d x\wedge\d y\wedge\d z
$$

Recall that the vector calculus operatior on $\R^n$, the gradient of function $f\in C^\infty (\R^n)$ and the divergence of a vector field $X\in\mathfrak{X}(\R^n)$, are defined by

$$
\begin{align*}
  \mathrm{grad}(f) =& \sum_{i=1}^n \frac{\partial f}{\partial x^i}\frac{\partial}{\partial x^i} \\
  \mathrm{div}(X) =& \sum_{i=1}^n \frac{\partial X^i}{\partial x^i}
\end{align*}
$$

In the case $n=3$, the curl of a vector field $X\in\mathfrak{X}(\R^3)$ is defined by

$$
\begin{align*}
  \mathrm{curl}(X) =& \left( \frac{\partial X^3}{\partial y} - \frac{\partial X^2}{\partial z} \right)\frac{\partial}{\partial x} \\
  &+ \left( \frac{\partial X^1}{\partial z} - \frac{\partial X^3}{\partial x} \right)\frac{\partial}{\partial y}
  &+ \left( \frac{\partial X^2}{\partial x} - \frac{\partial X^1}{\partial y} \right)\frac{\partial}{\partial z}
\end{align*}
$$

Note that the components of the $2$-form $\d\omega$ corresponds (execpt in ordering and sign) with the curl of a vector field with components $(P,Q,R)$. Similarly, there is a strong correspondence between the $3$-form $\d\eta$ and the divergence of a vector field. These analogies can be justified by defining the following maps.

The Euclidean metrid on $\R^3$ yields an index-lowering isomorphism $\flat:\mathfrak{X}(\R^3) \to\Omega^1 (\R^3)$. Interior multiplication yields another map $\beta:\mathfrak{X}(\R^3) \to\omega^2(\R^3)$ by

$$
  \beta(X) = X \lrcorner (\d x\wedge\d y\wedge\d y)
$$

It is easy to check that $\beta$ is linear over $C^\infty (\R^3)$, so it corresponds to a smooth bundle isomorphism from $TM$ to $\Lambda_2 T^* \R^3$. It is a bundle isomorphism because it is injective and both $TM$ and $\Lambda_2 T^* \R^3$ are bundles of rank $3$. Similarly, we define a smooth bundle isomorphism $*:C^\infty (\R^3) \to\Omega^3 (\R^3)$ by

$$
  *(f) = f\;\d x\wedge\d y\wedge\d z
$$

These operators commute according to the following diagram.
$$
\begin{CD}
  C^\infty (\R^3) @>{\mathrm{grad}}>> \mathfrak{X}(\R^3) @>{\mathrm{curl}}>> \mathfrak{X}(\R^3) @>{\mathrm{div}}>> C^\infty (\R^3) \\
  @VV{\operatorname{id}}V @VV{\flat}V @VV{\beta}V @VV{*}V \\
  \Omega^0 (\R^3) @>>{\d}> \Omega^1 (\R^3) @>>{\d}> \Omega^2 (\R^3) @>>{\d}> \Omega^3 (\R^3)
\end{CD}
$$

### An invariant formula for the exterior derivative

<MathBox title='Exterior derivative of a 1-form' boxType='proposition'>
For any smooth $1$-form $\omega$ and smooth vector fields $\mathbf{X}$ and $\mathbf{Y}$

$$
  \d\omega(\mathbf{X},\mathbf{Y}) = \mathbf{X}(\omega(\mathbf{Y})) - \mathbf{Y}(\omega(\mathbf{X})) - \omega([\mathbf{X},\mathbf{Y}])
$$

<details>
<summary>Proof</summary>

Since any smooth $1$-form can be expressed locally as a sum of terms of the form $u\;\d v$ for smooth functions $u$ and $v$, it suffices to consider that case. Suppose $\omega = u\;\d v$, and that $\mathbf{X}$ and $\mathbf{Y}$ are smooth vector fields. Then the left-hand side of the formula is

$$
\begin{align*}
  \d(u\;\d v)(\mathbf{X}, \mathbf{Y}) =& \d u \wedge \d v(\mathbf{X}, \mathbf{Y}) \\
  =& \d u(X) \d v(Y) - \d v(X)\d u(Y) \\
  =& XuYv - XvYu
\end{align*}
$$

The right-hand side is

$$
\begin{align*}
  &X(u\;\d v(Y)) - Y(u\;\d v(X)) - u\;\d v([\mathbf{X},\mathbf{Y}]) \\
  =& X(uYv) - Y(uXv) - u[\mathbf{X},\mathbf{Y}]v \\
  =& (XuYv - uXYv) - (YuXv + uYXv) - u(XYv - YXv)
  =& XuYv - XvYu
\end{align*}
$$
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary, let $(\mathbf{E}_i)$ be a smooth local frame for $M$, and let $(\varepsilon^i)$ be the dual coframe. For each $i$, let $b_{jk}^i$ denote the component functions of the exterior derivative of $\varepsilon^i$ in this frame, and for each $j,k$, let $c_{jk}^i$ be the component functions of the Lie bracket $[\mathbf{E}_j,\mathbf{E}_k]$

$$
  \d\varepsilon^i = \sum_{j < k} b_{jk}^i \varepsilon^j \wedge\varepsilon^k,\; [E_j, E_k] = c_{jk}^i \mathbf{E}_i
$$

Then $b_{jk}^i = -c_{jk}^i$.
</MathBox>

<MathBox title='Invariant formula for the exterior derivative' boxType='proposition'>
Let $M$ be a smooth manifold with or without boundary, and let $\omega\in\Omega^k (M)$. For any smooth vector fields $X_1,\dots,X_{k+1}$ on $M$

$$
\begin{align*}
  &\d\omega(X_1,\dots,X_{k+1}) \\
  =& \sum_{1\leq i \leq k+1} (-1)^{i-1} X_i (\omega(X_1,\dots,\hat{X}_i,\dots,X_{k+1})) \\
  &+ \sum_{1\leq i < j \leq k+1} (-1)^{i+j} \omega([X_i,X_j], X_1,\dots,\hat{X}_i,\dots,\hat{X}_j,\dots,X_{k+1})
\end{align*}
$$

where the hats indicate omitted arguments.

<details>
<summary>Proof</summary>

For simpler notation, we write the formula As

$$
  \D\omega(X_1,\dots,X_{k+1}) = I(X_1,\dots,X_{k+1}) + II(X_1,\dots,X_{k+1})
$$

where $I$ and $II$ denote the two sum on the right-hand side. Note that $\D\omega$ is obviously multilinear over $\R$. We begin by showing that it is actually multilinear over $C^\infty (M)$, which is to say that for $1\leq p \leq k+1$ and $f\in C^\infty (M)$

$$
\begin{align*}
  &\D\omega(X_1,\dots,f\mathbf{\mathbf{X_p}},\dots,X_{k+1}) \\
  =& f\D\omega(X_1,\dots,\mathbf{X_p},\dots, X_{k+1})
\end{align*}
$$

In the expansion of $I(X_1,\dots,f\mathbf{X_p},\dots,X_{k+1})$, $f$ obviously factors out of the $i = p$ term. The other terms expand as follows

$$
\begin{align*}
  &\sum_{i\neq p} (-1)^{i-1} X_i(f\omega(X_1,\dots,\hat{X}_i,\dots,X_{k+1})) \\
  =& \sum_{i\neq p} (-1)^{i-1} (f\mathbf{X}_i (\omega(X_1,\dots,\hat{X}_i,\dots,X_{k+1}))) \\
  &+ (X_i f)\omega(X_1,\dots,\hat{X}_i,\dots,X_{k+1})
\end{align*}
$$

Thus

$$
\begin{align*}
  &I(X_1,\dots,f\mathbf{X_p},\dots,X_{k+1}) \\
  =& fI(X_1,\dots,\mathbf{X_p},\dots,X_{k+1}) \\
  &+ \sum_{i\neq p} (-1)^{i-1} (X_i f)\omega (X_1,\dots,hat{X}_i,\dots,X_{k+1})
\end{align*}
$$

Consider next the expansion of $II$. Again, $f$ factors out of all the terms in which $i\neq p$ and $j\neq p$. To expand the other terms, we use the Lie bracket formula to obtain

$$
\begin{align*}
  [f\mathbf{X_p}, X_j] =& f[\mathbf{X_p}, X_j] - (X_j f)\mathbf{X_p} \\
  [X_i, f\mathbf{X_p}] =& f[X_i, \mathbf{X_p}] + (X_i f)\mathbf{X_p}
\end{align*}
$$

Inserting these formulas into the $i = p$ and $j = p$ terms, we obtain

$$
\begin{align*}
  &II(X_1,\dots,f\mathbf{X_p},\dots,X_{k+1}) \\
  =& fII(X_1,\dots,\mathbf{X_p},\dots,X_{k+1}) \\
  &+ \sum_{p < j} (-1)^{p+j+1} (X_j f)\omega (\mathbf{X_p}, X_1,\dots,\hat{X}_p,\dots,\hat{X}_j,\dots,X_{k+1}) \\
  &+ \sum_{i < p} (-1)^{i + p} (X_i f)\omega (\mathbf{X_p}, X_1,\dots,\hat{X}_i,\dots,\hat{X}_p,\dots,X_{k+1})
\end{align*}
$$

Rearranging the arguments in these two sums so as put $\mathbf{X_p}$ into its original position, we see that they exactly cancel the sum $I$. This completes the proof that $\D\omega$ is multilinear over $C^\infty (M)$, so it defines a smooth $(k+1)$-tensor field.

Since both $\D\omega$ and $\d\omega$ are smooth tensor fields, we can verify the equation $\D\omega = \d\omega$ in any frame that is convenient. By multilinearity, it suffices to show that both sides give the same result when applied to an arbitrary sequence of basis vectors in some chosen local frame in a neighbourhood of each point. The computations are greatly simplified by working in a coordinate frame, for which all the Lie brackset vanish. Thus, let $(U,(x^i))$ be an arbitrary smooth chart on $M$. Because both $\d\omega$ and $\D\omega$ depend linearly on $\omega$, we may assume $\omega = u\;\d x^I$ for some smooth function $u$ and some increasing multi-index $I = (i_1,\dots,i_k)$ so

$$
\begin{align*}
  \d\omega =& \d u\wedge\d x^I \\
  =& \sum_m \frac{\partial u}{\partial x^m}\d x^m \wedge\d x^I
\end{align*}
$$

If $J = (j_1,\dots,d_{k+1})$ is any multi-index of length $k+1$, it follows that

$$
  \d\omega\left(\frac{\partial}{\partial x^{j_1}},\dots,\frac{\partial}{\partial x^{j_k + 1}} \right) = \sum_m \frac{\partial u}{\partial x^m} \delta_J^{mI}
$$

The only terms in this sum that can possibly be nonzero are those for which $m$ is equal to one of the indices in $J$, say $m = j_p$. In this case, it is easy to check that $\delta_J^{mI} = (-1)^{p-1} \delta_{\hat{J}_p}^I$, where $\hat{J}_p = (j_1,\dots,\hat{j}_p,\dots,j_{k+1})$, so

$$
  \d\omega\left(\frac{\partial}{\partial x^{j_1}},\dots,\frac{\partial}{\partial x^{j_k +1}} \right) = \sum_{1\leq p\leq k + 1} (-1)^{p-1}\frac{\partial u}{\partial x^{j_p}} \delta_{\hat{J}_p}^I
$$

On the other hand, because all the Lie brackets are zero, we have

$$
\begin{align*}
  &\D\omega\left(\frac{\partial}{\partial x^{j_1}},\dots,\frac{\partial}{\partial x^{j_k + 1}}\right) \\
  =& \sum_{1\leq p \leq k+1} (-1)^{p-1} \frac{\partial}{\partial x^{j_p}}\left(u\;\d x^I \left(\frac{\partial}{\partial x^{j_1}},\dots,\hat{\frac{\partial}{\partial x^{j_p}}},\dots,\frac{\partial}{\partial x^{j_{k+1}}} \right) \right) \\
  =& \sum_{1\leq p \leq k+1} (-1)^{p-1} \frac{\partial u}{\partial x^{j^p}}\delta_{\hat{J}_p}^I
\end{align*}
$$
</details>
</MathBox>

### Lie derivatives of differential forms

<MathBox title='' boxType='proposition'>
Suppose $M$ is a smooth manifold, $\mathbf{V}\in\mathfrak{X}(M)$, and that $\omega,\eta\in\Omega^* (M)$. Then

$$
  \mathcal{L}_V (\omega\wedge\eta) = (\mathcal{L}_V \omega) \wedge\eta + \omega\wedge(\mathcal{L}_V \eta)
$$
</MathBox>

<MathBox title="Cartan's magic formula" boxType='theorem'>
On a smooth manifold $M$, for any smooth vector field $V$ and any smooth differential form $\omega$

$$
  \mathcal{L}_V \omega = V\lrcorner (\d\omega) + \d(V\lrcorner\omega)
$$

<details>
<summary>Proof</summary>

We prove that Cartan's magick formula hold for smooth $k$-forms by induction on $k$. We begin with a smooth $0$-form $f$, in which case

$$
\begin{align*}
  V\lrcorner (\d f) + \d(V\lrcorner f) =& V\lrcorner\d f \\
  =& \d f(V) = Vf = \mathcal{L}_V f
\end{align*}
$$

which agrees with the formula.

Let $k\geq 1$, and suppose Cartan's magic formula holds for forms of degrees less than $k$. Let $\omega$ be an arbitrary smooth $k$-form, written in smooth local coordinates as

$$
  \omega = \sum'_I \omega_I \;\d x^{i_1} \wedge\cdots\wedge \d x^{i_k}
$$

Writing $u = x^{i_1}$ and $\beta = \omega_I \d x^{i^2} \wedge\cdots\wedge \d x^{i_k}$, we see that each term in this sum can be written in the form $\d u \wedge\beta$, where $u$ is a smooth function and $\beta$ is a smooth $(k-1)$-form. Because $\mathcal{L}_V \d u = \d(\mathcal{L}_V u) = \d(Vu)$, the Lie product rule and the induction hypothesis imply

$$
\begin{align*}
  \mathcal{L}_V (\d u \wedge\beta) =& (\mathcal{L}_V \d u)\wedge\beta + \d u\wedge (\mathcal{L}_V \beta) \\
  =& \d(Vu)\wedge\beta + \d u\wedge (V\lrcorner \d\beta + \d(V \lrcorner \beta))
\end{align*}
$$

On the other hand, using the facts that both $\d$ and interior multiplication by $V$ are antiderivatives, and $V \lrcorner\d u = \d u(V) = Vu$, we get

$$
\begin{align*}
  &V\lrcorner \d(\d u\wedge\beta) + \d(V\lrcorner (\d u\wedge\beta)) \\
  =& V \lrcorner (-\d u \wedge \d\beta) + \d((Vu)\beta - \d u \wedge (V\lrcorner\beta)) \\
  =& -(Vu)\d\beta + \d u\wedge (V\lrcorner\d\beta) + \d(Vu)\wedge\beta \\
  &+ (Vu)\d\beta + \d u \wedge\d(V \lrcorner\beta) \\
  =& \d(Vu)\wedge\beta + \d u\wedge (V\lrcorner \d\beta + \d(V \lrcorner \beta))
\end{align*}
$$
</details>
</MathBox>

<MathBox title='The Lie derivative commutes with $\d$' boxType='corollary'>
If $V$ is smooth vector field and $\omega$ is a smooth differential form, then

$$
  \mathcal{L}_V (\d\omega) = \d(\mathcal{L}_V \omega)
$$

<details>
<summary>Proof</summary>

This follows from Cartan's formula and the fact that $\d\circ\d = 0$:

$$
\begin{align*}
  \mathcal{L}_V (\d\omega) =& V\lrcorner \d(\d\omega) + \d(V\lrcorner \d\omega) = \d(V\lrcorner\d\omega) \\
  \d(\mathcal{L}_V \omega) =& \d(V\lrcorner\d\omega) + \d(\d(V\lrcorner\omega)) = \d(V\lrcorner\d\omega)
\end{align*}
$$
</details>
</MathBox>

# Orientations

## Orientations of vector spaces

<MathBox title='Orientation of a vector space' boxType='definition'>
Let $V$ be a real vector space of dimension $n\geq 1$. Two ordered bases $(\mathbf{e}_i)_{i=1}^n$ and $(\tilde{\mathbf{e}}_i)_{i=1}^n$ for $V$ are *consistently oriented* if the transition matrix $B_i^j$ defined by

$$
  \mathbf{e}_i = B_i^j \tilde{\mathbf{e}}_j
$$

has positive determinant. An *orientation* for $V$ is defined as an equivalence class of ordered bases. If $(\mathbf{e}_i)_{i=1}^n$ is any ordered basis for $V$, we denote the orientation that it determines by $[\mathbf{e}_i]_{i=1}^n$, and the oposite orientation by $-[\mathbf{e}_i]_{i=1}^n$. A vector space together with a choice of orientation is called an *oriented vector space*. If $V$ is oriented, then any ordered basis $(\mathbf{e}_i)_{i=1}^n$ that is in the given orientation is called *(positively) oriented*. Any basis that is not in the given orientation is *negatively oriented*.

If $\dim(V) = 0$, the orientation of $V$ is defined as one of the numbers $\pm 1$.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $V$ be a vector space of dimension $n$. Each nonzero $n$-covector $\omega\in\Lambda_n (V^*)$ determines an orientation $\mathcal{O}_\omega$ of $V$ as follows: if $n\geq 1$, then $\mathcal{O}_\omega$ is the set of ordered bases $(\mathbf{e}_i)_{i=1}^n$ such that $\omega(\mathbf{e}_1,\dots,\mathbf{e}_n) > 0$; while if $n = 0$, then $\mathcal{O}_\omega$ is $+1$ if $\omega > 0$, and $-1$ if $\omega < 0$. Two nonzero $n$-covectors determine the same orientation if and only if each is a positive multiple of the other.

<details>
<summary>Proof</summary>

The $0$-dimensional case is immediate, since a nonzero element of $\Lambda_0 (V^*)$ is just a nonzero real number. Thus, we may assume $n\geq 1$. Let $\omega\in\Lambda_n (V^*)$ be nonzero, and let $\mathcal{O}_\omega$ denote the set of ordered bases on which $\omega$ gives positive values. We need to show that $\mathcal{O}_\omega$ is exactly one equivalence class.

Suppose $(\mathbf{e}_i)$ and $(\tilde{\mathbf{e}}_i)$ are any two ordered bases for $V$, and let $B:V\to V$ be the linear map sending $\mathbf{e}_j$ to $\tilde{\mathbf{e}}_j$. This means that $\tilde{\mathbf{e}}_j = B\mathbf{e}_j = B_j^i \mathbf{e}_i$, so $B$ is the transition matrix between the two bases such that

$$
\begin{align*}
  \omega(\tilde{\mathbf{e}}_1,\dots,\tilde{\mathbf{e}}_n) =& \omega(B\mathbf{e}_1,\dots,B\mathbf{e}_n) \\
  =& \det(B)\omega(\mathbf{e}_1,\dots,\mathbf{e}_n)
\end{align*}
$$

It follows that the basis $(\tilde{\mathbf{e}}_j)$ is consistently oriented with $(\mathbf{e}_i)$ if and only if $\omega(\mathbf{e}_1,\dots,\mathbf{e}_n)$ and $\omega(\tilde{\mathbf{e}}_i,\dots,\tilde{\mathbf{e}}_n)$ have the same sign, which is the same as saying that $\mathcal{O}_\omega$ is one equivalence class. The last statement then follows easily.
</details>
</MathBox>

Note that for any $n$-dimensional vector space $V$, the space $\Lambda_n (V^*)$ is $1$-dimensional. The previous proposition shows that choosing an orientation for $V$ is equivalent to choosing one of the two components of $\Lambda^n (V^*) \setminus\Set{0}$.

## Orientations of manifolds

<MathBox title='Orientation of a manifold' boxType='definition'>
Let $M$ be a smooth $n$-manifold with or without boundary. A *pointwise orientation* on $M$ is defined as a choise of orientation of each tangent space. If $(\mathbf{E}_i)_{i=1}^n$ is a local frame for the tangent bundle $TM$, then $(\mathbf{E}_i)_{i=1}^n$ is *(positively) oriented* if $(\mathbf{E}_i|_\mathbf{p})_{i=1}^n$ is a positively oriented basis for $T_\mathbf{p}M$ at each point $\mathbf{p}\in U$. A *negatively oriented* frame is defined analogously.

A pointwise orientation is *continuous* is every point of $M$ is in the domain of an oriented local frame. An *orientation* of $M$ is a continuous pointwise orientation. We say that $M$ is *orientable* if there exists an orientation for it, and *nonorientable* if not. An *oriented manifold* is an ordered pair $(M,\mathcal{O})$, where $M$ is an orientable smooth manifold and $\mathcal{O}$ is a choice of orientation for $M$; an *oriented manifold with boundary* is defined similarly. For each $\mathbf{p}\in M$, the orientation of $T_\mathbf{p}M$ determined by $\mathcal{O}$ is denoted $\mathcal{O}_\mathbf{p}$.

If $n = 0$, this definition means that an orientation of $M$ is a choice of $\pm 1$ attached to each point. The continuity condition is vacuous in this case.
</MathBox>

<MathBox title='The orientation determined by an $n$-form' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with or without boundary. Any nonvanishing $n$-form $\omega$ on $M$ determines a unique orientation of $M$ for which $\omega$ is positively oriented at each point. Conversely, if $M$ is given an orientation, then there is a smooth nonvanishing $n$-form on $M$ that is positively oriented at each point.

<details>
<summary>Proof</summary>

If $\omega$ is a nonvanishing $n$-form on $M$, then $\omega$ defines a pointwise orientation; it remains to check that it is continuous. This is trivially true when $n=0$, so assume $n\geq 1$. Given $\mathbf{p}\in M$, let $(\mathbf{E}_i)$ be any local frame on a connected neighbourhood $U$ of $\mathbf{p}$, and let $(\varepsilon^i)$ be the dueal coframe. On $U$, the expression for $\omega$ in this frame is $\omega = f \bigwedge_{i=1}^n \varepsilon^i$ for some continuous function $f$. The fact thaht $\omega$ is nonvanishing means that $f$ is nonvanishing, and therefore

$$
  \omega(\mathbf{E}_1,\dots,\mathbf{E}_n) = f \neq 0
$$

at all points of $U$. Since $U$ is connected, it follows that this expression is either always positive of always negative on $U$, and therefore the given frame is either positively or negatively oriented. If negatively, we can replace $\mathbf{E}_1$ by $-\mathbf{E}_1$ to obtain a new frame that is positively oriented. Thus, the pointwise orientation determined by $\omega$ is continuous.

Conversely, suppose $M$ is oriented, and let $\Lambda_n^+ T^* M \subseteq \Lambda^n T^* M$ be the open subset consisting of positively oriented $n$-covectors at all points of $M$. At any point $\mathbf{p}\in M$, the intersection of $\Lambda_n^+ T^* M$ with the fibre $\Lambda_n (T_\mathbf{p}^* M)$ is an open half-line, and therefore convex. By the usual partition-of-unity argument, there exists a smooth global section of $\Lambda_n^+ T^* M$, i.e. a positively oriented smooth global $n$-form.
</details>
</MathBox>

Because of this proposition, if $M$ is a smooth $n$-manifold with or without boundary, any nonvanishing $n$-form on $M$ is called an *orientation form*. If $M$ is a oriented and $\omega$ is an orientation form determining the given orientation, we also say that $\omega$ is *(positively) oriented*. It is easy to check that if $\omega$ and $\tilde{\omega}$ are two positively oriented smooth forms on $M$, then $\tilde{\omega} = f\omega$ for some strictly positive smooth real-valued function $f$. If $M$ is a $0$-manifold, a nonvanishing $0$-form, i.e. a real-valued function, assigns the orientation $+1$ to points where it is positive and $-1$ to points where it is negative.

<MathBox title='Oriented chart' boxType='definition'>
A smooth coordinate chart on an oriented smooth manifold with or without boundary is *(positively) oriented* if the coordinate frame $\frac{\partial}{\partial x^i}$ is positively oriented, and *negatively oriented* if the coordinate frame is negatively oriented. A smooth atlasa $\Set{(U_\alpha, \varphi_\alpha)}$ is *consistently oriented* if for each $\alpha$ and $\beta$, the transition map $\varphi_\beta \circ\varphi_\alpha^{-1}$ has positive Jacobian determinant everywhere on $\varphi_\alpha (U_\alpha \cap U_\beta)$.
</MathBox>

<MathBox title='The orientation determined by a coordinate atlas' boxType='proposition'>
Let $M$ be a smooth positive-dimensional manifold with or without boundary. Given any consistently oriented smooth atlas for $M$, there is a unique orientation for $M$ with the property that each chart in the given atlas is positively oriented. Conversely, if $M$ is oriented and either $\partial M = \emptyset$ or $\dim(M) > 1$, then the collection of all oriented smooth charts is a consistently oriented atlas for $M$.

<details>
<summary>Proof</summary>

First, suppose $M$ has a consistently oriented smooth atlas. Each chart in the atlas determines a pointwise orientation at each point of its domain. Wherever two of the charts overlap, the transition matrix between their respective coordinate frames is the Jacobian matrix of the transition map, which has positive determinant by hypothesis, so they determine the same pointwise orientation at each point. The orientation thus determined is continuous because each point is in the domain of an oriented coordinate frame.

Conversely, assume $M$ is oriented and either $\partial M = \emptyset$ or $\dim(M) > 1$. Each point is in the domain of a smooth chart, and if the chart is negatively oriented, we can replace $x^1$ by $-x^1$ to obtain a new chart that is positively oriented. The fact that these charts are all positively oriented guarantees that their transition maps have positive Jacobian determinants, so they form a consistently oriented atlas. (This does not work for boundary charts when $\dim(M) = 1$ because of our convention that the last coordinate is nonnegative in a boundary chart).
</details>
</MathBox>

<MathBox title='Product orientations' boxType='proposition'>
Suppose $M_1,\dots,M_k$ are orientable smooth manifold. There is a unique orientation on $M_1\times\cdots\times M_k$, called the *product orientation*, with the following property: if $\omega_i$ is an orientation form for the given orientation on $M_i$ for each $i=1,\dots,k$, then $\pi_1^* \omega_1 \wedge\cdots\wedge\pi_k^* \omega_k$ is an orientation form for the product orientation.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be a connected, orientable, smooth manifold with or without boundary. Then $M$ has exactly two orientations. If two orientations of $M$ agree at one point, they equal.
</MathBox>

<MathBox title='Orientations of codimension-$0$ submanifolds' boxType='proposition'>
Suppose $M$ is an oriented smooth manifold with or without boundary, and that $D\subseteq M$ is a smooth codimension-$0$ submanifold with or without boundary. Then the orientation of $M$ restricts to an orientation of $D$. If $\omega$ is an orientation form for $M$, then $\iota_D^* \omega$ is an orientation form for $D$.
</MathBox>

<MathBox title='Orientation-preserving and orientation-reversing maps' boxType='definition'>
Let $M$ and $N$ be oriented smooth manifolds with or without boundary, and suppose $F:M\to N$ is a local diffeomorphism. If $M$ and $N$ are positive-dimensional, we say that $F$ is *orientation-preserving* if for each $\mathbf{p}\in M$, the isomorphism $\d F_\mathbf{p}$ takes oriented bases of $T_\mathbf{p}M$ to oriented bases of $T_{F(\mathbf{p})} N$, and *orientation-reversing* if it takes oriented bases of $T_\mathbf{p}M$ to negatively oriented bases of $T_{F(\mathbf{p})} N$. If $M$ and $N$ are $0$-manifolds, then $F$ is orientation-preserving if for every $\mathbf{p}\in M$, the points $\mathbf{p}$ and $F(\mathbf{p})$ have the same orientation; and it is orientation-reversing if they have the opposite orientation.
</MathBox>

<MathBox title='The pullback orientation' boxType='proposition'>
Suppose $M$ and $N$ are smooth manifold with or without boundary. If $F:M\to N$ is a local diffeomorphism and $N$ is oriented, then $M$ has a unique orientation, called the *pullback orientation* induced by $F$, such that $F$ is orientation-presevering.

If $\mathcal{O}$ denotes the given orientation on $N$, the pullback orientation on $M$ is denoted by $F^* \mathcal{O}$.

<details>
<summary>Proof</summary>

For each $\mathbf{p}\in M$, there is a unique orientation on $T_\mathbf{p}M$ that makes the isomorphism $\d F_\mathbf{p}:T_\mathbf{p}M \to T_{F(\mathbf{p})} N$ is orientation-preserving. This defines a pointwise orientation on $M$, and provided that it is continuous, it is the unique orientation on $M$ with respect to which $F$ is orientation-preserving. To see that it is continuous, just choose a smooth orientation form $\omega$ for $N$ and note that $F^* \omega$ is a smooth orientation form for $M$.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Every parallelizable smooth manifold is orientable.

<details>
<summary>Proof</summary>

Suppose $M$ is a parallelizable smooth $n$-manifold, and let $(\mathbf{E}_i)_{i=1}^n$ be a global smooth frame for $M$. Define a pointwise orientation on $M$ by declaring the basis $(\mathbf{E}_i|_\mathbf{p})$ to be positively oriented at each $\mathbf{p}\in M$. This pointwise orientation is continuous, because every point of $M$ is in the domain of the global oriented frame $(\mathbf{E}_i)$. 
</details>
</MathBox>

<MathBox title='Left-invariant Lie group' boxType='definition'>
If $G$ is a Lie group, an orientation of $G$ is *left-invariant* if $L_g$ is orientation-preserving for every $g\in G$.
</MathBox>

<MathBox title='' boxType='proposition'>
Every Lie group has precisely two left-invariant orientations, corresponding to the two orientations of the Lie algebra.
</MathBox>

### Orientations of hypersurfaces

<MathBox title='' boxType='proposition'>
Suppose $M$ is an oriented smooth $n$-manifold with or without boundary, $S$ is an immersed hypersurface with or without boundary in $M$, and $\mathbf{N}$ is a vector field along $S$ that is nowhere tangent to $S$. Then $S$ has a unique orientation such that for each $\mathbf{p}\in S$, then $(\mathbf{E}_i)_{i=1}^{n-1}$ is an oriented basis for $T_\mathbf{p}S$ if and only if $(\mathbf{N}_\mathbf{p}, \mathbf{E}_1,\dots,\mathbf{E}_{n-1})$ is an oriented basis for $T_\mathbf{p}M$. If $\omega$ is an orientation form for $M$, then $\iota_S^* (\mathbf{N}\lrcorner\,\omega)$ is an orientation form for $S$ with respect to this orientation,where $\iota_S:S\hookrightarrow M$ is inclusion.

<details>
<summary>Proof</summary>

Let $\omega$ be an orientation form form for $M$. Then $\sigma = \iota_S^* (N\lrcorner\omega)$ is an $(n-1)$-form on $S$. Note that the pullback $\iota_S^*$ is really just restriction to vectors tangent to $S$. It will follow that $\sigma$ is an orientation form for $S$ if we can show that it never vanishes. Given any basis $(\mathbf{E}_i)_{i=1}^{n-1}$ for $T_\mathbf{p} S$, the fact that $N$ is nowhere tangent to $S$ implies that $(\mathbf{n}_\mathbf{p}, \mathbf{E}_1,\dots,\mathbf{E}_{n-1})$ is a basis for $T_\mathbf{p}M$. The fact that $\omega$ is nonvanishing implies that

$$
  \sigma_\mathbf{p}(\mathbf{E}_1,\dots,\mathbf{E}_{n-1}) = \omega_\mathbf{p}(\mathbf{N}_\mathbf{p}, \mathbf{E}_1,\dots,\mathbf{E}_{n-1}) \neq 0
$$

Since $\sigma_\mathbf{p}(\mathbf{E}_1,\dots,\mathbf{E}_{n-1}) > 0$ if and only if $\omega_\mathbf{p}(\mathbf{n}_\mathbf{p},\mathbf{E}_1,\dots,\mathbf{E}_{n-1}) > 0$, the orientation determined by $\sigma$ is the one defined in the statement of the proposition.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be an oriented smooth manifold, and suppose $S\subseteq M$ is a regular level set of a smooth function $f:M\to\R$. Then $S$ is orientable.

<details>
<summary>Proof</summary>

Choose any Riemannian metric on $M$, and let $N = \operatorname{grad}(f|_S)$. The hypotheses imply that $N$ is a nowhere tangent vector field along $S$, so the result follows from the previous proposition.
</details>
</MathBox>

### Boundary orientations

<MathBox title='The induced orientation on a boundary' boxType='proposition'>
Let $M$ be an oriented smooth $n$-manifold with boundary, $n\geq 1$. Then $\partial M$ is orientable, and all outward-pointing vector fields along $\partial M$ determine the same orientation on $\partial M$.

<details>
<summary>Proof</summary>

Let $n = \dim(M)$, let $\omega$ be an orientation form for $M$, and let $N$ be a smooth outward-pointing vector field along $\partial M$. The $(n-1)$-form $\iota_{\partial M}^* (N\lrcorner\omega)$ is an orientation form for $\partial M$, so $\partial M$ is orientable.

To show that this orientation is independent of the choice of $N$, let $\mathbf{p}\in\partial M$ be arbitrary, and let $(x^i)$ be smooth boundary coordinates for $M$ on a neighbourhood of $\mathbf{p}$. If $N$ and $\tilde{N}$ are two different outward-pointing vector fields along $\partial M$, the last components $N^n (\mathbf{p})$ and $\tilde{N}^n (\mathbf{p})$ are both negative. Both $(N_\mathbf{p}, \left.\frac{\partial}{\partial x^1}\right|_\mathbf{p},\dots,\left.\frac{\partial}{\partial x^{n-1}}\right|_{\mathbf{p}})$ and $(\tilde{N}_\mathbf{p}, \left.\frac{\partial}{\partial x^1}\right|_\mathbf{p},\dots,\left.\frac{\partial}{\partial x^{n-1}}\right|_{\mathbf{p}})$ are bases for $T_\mathbf{p}M$, and the transition matrix between them has determinant equal to $\frac{N^n (\mathbf{p})}{\tilde{N}(\mathbf{p})} > 0$. Thus, both bases determine the same orientation for $T_\mathbf{p}M$, so $N$ and $\tilde{N}$ determine the same orientation for $T_\mathbf{p}\partial M$. (When $n=1$, the bases in question are just $(N_\mathbf{p})$ and $(\tilde{N}_\mathbf{p})$, which determine the same orientation because they are both negative multiples of $\left.\frac{\partial}{\partial x^1}\right|_\mathbf{p}$.)
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Let $M$ be an oriented smooth $n$-manifold with boundary. Suppose $U\subseteq\R^{n-1}$ is open, $a,b\in\R$ with $a< b$, and $F:(a,b]\times U\to M$ is a smooth embedding that restricts to an embedding of $\Set{b}\times U$ into $\partial M$. Then the parametrization $f:U\to\partial M$ given by $f(\mathbf{x}) = F(b,\mathbf{x})$ is orientation-preserving for $\partial M$ if and only if $F$ is orientation-preserving for $M$.

<details>
<summary>Proof</summary>

Let $\mathbf{x}\in U$ be arbitrary, and let $\mathbf{p} = f(\mathbf{x}) = F(b,\mathbf{x}) \in\partial M$. The hypothesis that $F$ is an embedding means that the linear map $\d F_{(b,\mathbf{x})}: (T_b \R \otimes T_\mathbf{x}\R^{n-1} \to T_\mathbf{p} M$ is bijective. Since the restriction of $\d F_{(b,\mathbf{x})}$ to $T_\mathbf{x}\R^{n-1}$ is equal to $\d f_\mathbf{x}: T_\mathbf{x}\R^{n-1} \to T_\mathbf{p}\partial M$, which is already injective, it follows that $\d F\left( \frac{\partial}{\partial s|_{(b,\mathbf{x})}} \right) \notin T_\mathbf{p}\partial M$ (where $s$ denoted the coordinate on $(a,b]$).

Define a smooth curve $\gamma:[0,\varepsilon)\to M$ by

$$
  \gamma(t) = F(b-t, \mathbf{x})
$$

This curve satisfies $\gamma(0) = \mathbf{p}$ and $\gamma'(0) = -\d F\left(\frac{\partial}{\partial s|_{(b,\mathbf{x})}}\right)\notin T_\mathbf{p}\partial M$. It follows that $-\d F\left(\frac{\partial}{\partial s|_{(b,\mathbf{x})}}\right)$ is inward-pointing, and therefore $\d F\left(\frac{\partial}{\partial s|_{(b,\mathbf{x})}}\right)$ is outward-pointing.

The definition of the induced orientation yields the following equivalences
1. $F$ is orientation-preserving for $M$
2. $\left(\d F\left(\frac{\partial}{\partial s}, \d F\left(\frac{\partial}{\partial x^1}\right),\dots,\d F\left(\frac{\partial}{\partial x^{n-1}}\right)\right)\right)$ is oriented for $TM$
3. $\left(\d F\left(\frac{\partial}{\partial x^1}\right),\dots,\d F\left(\frac{\partial}{\partial x^{n-1}}\right)\right)\right)$ is oriented for $T\partial M$
4. $\left(\d f\left(\frac{\partial}{\partial x^1}\right),\dots,\d f\left(\frac{\partial}{\partial x^{n-1}}\right)\right)\right)$
5. $f$ is orientation-preserving for $\partial M$
</details>
</MathBox>

## The Riemannian volume form

<MathBox title='' boxType='proposition'>
Suppose $(M,g)$ is an oriented Riemannian $n$-manifold with or without boundary, and $n\geq 1$. There is unique smooth orientation form $\omega_g \in \Omega^n (M)$, called the *Riemannian volume form*, that satisfies

$$
  \omega_g (\mathbf{E}_1,\dots,\mathbf{E}_n) = 1
$$

for every local oriented orthonormal frame $(\mathbf{E}_i)$ for $M$.

<details>
<summary>Proof</summary>

Suppose first that such a form $\omega_g$ exists. If $(\mathbf{E}_1,\dots,\mathbf{E}_n)$ is any local oriented orthonormal frame on an open subset $U\subseteq M$ and $(\varepsilon^1,\dots,\varepsilon^n)$ is the dual coframe, we can write $\omega_g = f \varepsilon^1 \wedge\cdots\wedge \varepsilon^n$ on $U$. The stated condition then reduces to $f = 1$, so $\omega_g = \bigwedge_{i=1}^n \varepsilon^i$. This proves that such a form is uniquely determined.

To prove existence, we would like to define $\omega_g$ in a neighbourhood of each point by $\omega_g = \bigwedge_{i=1}^n \varepsilon^i$, so we need to check that this definition is independent of the choice of oriented orthonormal. If $(\tilde{\mathbf{E}}_1,\dots,\tilde{\mathbf{E}}_n)$ is another oriented frame, with dual coframe $(\tilde{\varepsilon}^i)$ let $\tilde{\omega}_g = \bigwedge_{i=1}^n \tilde{\varepsilon}^i$. We can write $\tilde{\mathbf{E}}_i = A_i^j \mathbf{E}_j$ for some matrix $\mathbf{A}$ of smooth functions. The fact that both frames are orthonormal means that $(A_i^j (\mathbf{p}))\in O(n)$ for each $\mathbf{p}$, so $\det(A_i^j) = \pm 1$, and the fact that the two frames are consistently oriented forces the positive sign. We compute

$$
\begin{align*}
  \omega_g (\tilde{\mathbf{E}}_1,\dots,\tilde{\mathbf{E}}_n) =& \det(\varepsilon^j (\tilde{\mathbf{E}}_i)) \\
  =& \det(A_i^j) = 1 \\
  =& \omega_g (\tilde{\mathbf{E}}_1,\dots,\tilde{\mathbf{E}}_n)
\end{align*}
$$

Thus, $\omega_g = \tilde{\omega}_g$, so defining $\omega_g$ in neighbourhood of each point by $\omega_g = \bigwedge_{i=1}^n \varepsilon^i$ with respect to some smooth oriented orthonormal frame yields a global $n$-form. The resulting form is clearly smooth and satisfies the stated condition for every oriented orthonormal frame.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Let $(M,g)$ be an oriented Riemannian $n$-manifold with or without boundary, $n\geq 1$. In any oriented smooth coordinates $(x^i)$, the Riemannian volume form ha the local coordinate expression

$$
  \omega_g = \sqrt{\det(g_{ij})}\d x^1 \wedge\cdots\wedge \d x^n
$$

where $g_{ij}$ are the components of $g$ in these coordinates.

<details>
<summary>Proof</summary>

Let $(U,(x^i))$ be an oriented smooth chart, and let $\mathbf{p}\in M$. In these coordinates, $\omega_g = f\d x^1 \wedge\cdots\wedge \d x^n$ for some positive coefficient function $f$. To compute $f$, let $(\mathbf{E}_i)$ be any smooth oriented orthonormal frame defined on a neighbourhood of $\mathbf{p}$, and let $(\varepsilon^i)$ be the dual coframe. If we write the coordinate frame in terms of the orthonormal frame as

$$
  \frac{\partial}{\partial x^i} = A_i^j \mathbf{E}_j
$$

then we can compute

$$
  f =& \omega_g \left( \frac{\partial}{\partial x^1},\dots,\frac{\partial}{\partial x^n} \right) \\
  =& \varepsilon^1 \wedge\cdots\wedge \varepsilon^n \left( \frac{\partial}{\partial x^1},\dots,\frac{\partial}{\partial x^n} \right) \\
  \det\left(\varepsilon^j \left(\frac{\partial}{\partial x^i} \right) \right) \\ \det(A_i^j)
$$

On the other hand, observe that

$$
\begin{align*}
  g_{ij} =& \langle \frac{\partial}{\partial x^i}, \frac{\partial}{\partial x^j} \rangle_g \\
  =& \langle A_i^k \mathbf{E}_k, A_j^l \mathbf{E}_l \rangle_g \\
  =& A_i^k A_j^l \langle \mathbf{E}_k, \mathbf{E}_l \rangle_g = \sum_k A_i^k A_j^k
\end{align*}
$$

The last expression is the $(i,j)$-entry of the matrix product $\mathbf{A}^T \mathbf{A}$, where $\mathbf{A} = (A_i^j)$. thus

$$
\begin{align*}
  \det(g_{ij}) =& \det(\mathbf{A}^\top \mathbf{A}) = \det(\mathbf{A}^\top) \det(\mathbf{A}) \\
  \det(\mathbf{A})^2
\end{align*}
$$

from which it follows that $f = \det(\mathbf{A}) = \pm\sqrt{\det(g_{ij})}$. Since both frame $\left(\frac{\partial}{\partial x^i}\right)$ and $(\mathbf{E}_j)$ are oriented, the sign must be positive.
</details>
</MathBox>

### Hypersurface in Riemannian manifolds

<MathBox title='' boxType='proposition'>
Let $(M,g)$ be an oriented Riemannian manifold with or without boundary, let $S\subseteq M$ be an immersed hypersurface with or without boundary, and let $\tilde{g}$ denote the induced metric on $S$. Suppose $\mathbf{N}$ is a smooth unit normal vector field along $S$. With respect to the orientation of $S$ determined by $N$, the volume form of $(S,\tilde{g})$ is given

$$
  \omega_{\tilde{g}} = \iota_S^* (\mathbf{N}\lrcorner\,\omega_g)
$$

<details>
<summary>Proof</summary>

The $(n-1)$-form $\iota_S^* (N\lrcorner\omega_g)$ is an orientation form for $S$. To prove that it is the volume form for the induced Riemannian metric, we need only show that it gives the value $1$ whenever it is applied to an oriented orthonormal frame for $S$. Thus, let $(\mathbf{E}_i)_{i=1}^{n-1}$ be such a frame. At each point $\mathbf{p}\in S$, the basis $(\mathbf{n}_\mathbf{p}, \mathbf{E}_1|_\mathbf{p},\dots,\mathbf{E}_{n-1}|_\mathbf{p})$ is orthonormal, and is oriented for $T_\mathbf{p} M$. Thus

$$
  \iota_S^* (\mathbf{N}\lrcorner\omega_g) (\mathbf{E}_1,\dots,\mathbf{E}_{n-1}) = \omega_g (\mathbf{n}, \mathbf{E}_1,\dots,\mathbf{E}_{n-1}) =1
$$

which proves the result.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $M$ is any Riemannian manifold with boundary. There is a unique smooth outward-pointing unit normal vector field $N$ along $\partial M$.

<details>
<summary>Proof</summary>

First, we prove uniqueness. At any point $\mathbf{p}\in\partial M$, the supspace $(T_\mathbf{p}\partial M)^\perp \subseteq T_\mathbf{p}M$ is $1$-dimensional, so there are exactly two unit vectors at $\mathbf{p}$ that are normal to $\partial M$. Since any unit normal vector $\mathbf{n}$ is nowhere tangent to $\partial M$, it must have nonzero $x^n$-component in any smooth boundary chart. Thus, exactly one of the two choices of unit normal has negative $x^n$-component, which is equivalent to being outward-pointing.

To prove existence, let $f:M\to\R$ be a boundary defining function, and let $\mathbf{n}$ be the restriction to $\partial M$ of the unit vector field $-\frac{\operatorname{grad}(f)}{|\operatorname{grad}(f)|_g}$. Because $\d f \neq 0$ at points of $\partial M$, then $\mathbf{n}$ is well-defined and smooth on $\partial M$. Then $\mathbf{n}$ is normal to $\partial M$ and outward-pointing, because $\mathbf{n}f = -\frac{\langle \operatorname{grad}(f), \operatorname{grad}(f) \rangle_g}{|\operatorname{grad}(f)|_g} = - |\operatorname{grad}(f)|_g < 0$.
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
If $(M,g)$ is an oriented Riemannian manifold with boundary and $\tilde{g}$ is the induced Riemannian metric on $\partial M$, then the volume form of $\tilde{g}$ is

$$
  \omega_{\tilde{g}} = \iota_{\partial M}^* (N\lrcorner\omega_g)
$$

where $N$ is the outward unit normal vector along $\partial M$.
</MathBox>

## Orientations and covering maps

<MathBox title='' boxType='proposition'>
If $\pi:E\to M$ is a smooth covering map and $M$ is orientable, then $E$ is also orientable.

<details>
<summary>Proof</summary>

Because a covering map is a local diffeomorphism, this follows immediately the pullback orientation proposition.
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Suppose $M$ is a connected, oriented, smooth manifold with or without boundary, and $\pi:E\to M$ is a smooth normal covering map. THen $M$ is orientable if and only if the action of $\mathrm{aut}_\pi (E)$ on $E$ is orientation-preserving.

<details>
<summary>Proof</summary>

Let $\mathcal{O}_E$ denoted the given orientation on $E$. First suppose $M$ is orientable, and let $\mathbf{q}\in E$ be arbitrary. Because $M$ is connected, it has exactly two orientations, and one of them has the property that $\d\pi_\mathbf{q}: T_\mathbf{q}E \to T_{\pi(\mathbf{q})} M$ is orientation-preserving. Call that orientation $\mathcal{O}_M$. The pullback orientation $\pi^* \mathcal{O}_M$ agrees with the given orientation at $\mathbf{q}$, so it must be equal to $\mathcal{O}_E$. Suppose $\varphi\in\mathrm{aut}_\pi (E)$. The fact that $\pi\circ\varphi = \pi$ implies That

$$
\begin{align*}
  \varphi^* \mathcal{O}_E =& \varphi^* (\pi^* \mathcal{O}_M) \\
  =& (\pi\circ\varphi)^* \mathcal{O}_M \\
  =& \pi^* \mathcal{O}_M = \mathcal{O}_E
\end{align*}
$$

Thus, $\varphi$ is orientation-preserving.

Conversely, suppose the action of $\mathrm{aut}_\pi (E)$ is orientation-preserving, and let $\mathbf{p}\in M$. If $U\subseteq M$ is any evenly covered neighbourhood of $\mathbf{p}$, there is a smooth section $\sigma:U\to E$, which induces an orientation $\sigma^* \mathcal{O}_E$ on $U$. Suppose $\sigma_1:U\to E$ is any other smooth local section over $U$. Because $\pi$ is a normal covering, $\mathrm{aut}_\pi (E)$ acts transitively on each fibre of $\pi$, so there is covering automorphism $\varphi$ such that $\sigma_1 (\mathbf{p}) = \varphi(\sigma(\mathbf{p}))$. Then $\varphi\circ\sigma$ is a local section of $\pi$ that agrees with $\sigma_1$ at $\mathbf{p}$, and thus $\sigma_1 = \varphi\sigma$ on all of $U$. Because $\varphi$ is orientation-preserving, $\sigma_1^* \mathcal{O}_E = \sigma^* \varphi^* \mathcal{O}_E = \sigma^* \mathcal{O}_E$, so the orientation induced by $\sigma$ and $\sigma_1$ are equal. Thus, we can define a global orientation $\mathcal{O}_M$ on $M$ by defining it on each evenly covered open subset to be the pullback orientation induced by any local section; the argument above shows that the orientations so defined agree where they overlap.  
</details>
</MathBox>

### The orientation covering

<MathBox title='Generalized covering map' boxType='definition'>
If $N$ and $M$ are topological spaces, then $\pi:N\to M$ is a *generalized covering map* if it satisfies all of the requirements for a covering map except that $N$ might not be connected: this means that $N$ is locally path-connected, $\pi$ is surjective and continuous, and each point $\mathbf{p}\in M$ has a neighbourhood that is evenly covered by $\pi$. If in addition $N$ and $M$ are smooth manifolds with or without boundary and $\pi$ is a local diffeomorphism, then $\pi$ is a *generalized smooth covering map*.
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $N$ and $M$ are topological spaces and $\pi:N\to M$ is a generalized covering map. If $M$ is connected, then the restriction of $\pi$ to each component of $N$ is a covering map.

<details>
<summary>Proof</summary>

Suppose $W$ is a component of $N$. If $U$ is any open subset of $M$ that is evenly covered by $\pi$, then each component of $\pi^{-1}(U)$ is connected and therefore contained in a single component of $N$. It follows that $(\pi|_W)^{-1}(U) = \pi^{-1}(U) \cap W$ is either the empty set or a nonempty disjoint union of components of $\pi^{-1}(U)$, each of which is mapped homeomorphically onto $U$ by $\pi|_W$. In particular, this means that each point in $\pi(W)$ has a neighbourhood that is evenly covered by $\pi|_W$.

It remains to show that $\pi|_W$ is surjective. Because $\pi$ is a local homeomorphism, $\pi(W)$ is an open subset of $M$. On the other hand, if $\mathbf{p}\in M\setminus \pi(W)$ and $U$ is a neighbourhood of $\mathbf{p}$ the is evenly covered by $\pi$, then the discussion in the preceeding paragraphi shows that $(\pi|_W)^{-1}(U) = \emptyset$, which implies that $U\subseteq M\setminus(W)$. Therefore, $\pi(W)$ is closed in $M$. Because $W$ is not empty, $\pi(W)$ is all of $M$.
</details>
</MathBox>

<MathBox title='Orientation covering' boxType='definition'>
Let $M$ be a connected, smooth, positive-dimensional manifold with or without boundary, and let $\hat{M}$ denote the set of orientation of all tangent spaces to $M$, i.e.

$$
  \hat{M} = \Set{(\mathbf{p},\mathcal{O}_\mathbf{p}) | \mathbf{p}\in M \text{ and }\mathcal{O}_\mathbf{p} \text{ is an orientation of } T_\mathbf{p} M}
$$

Define the projection $\hat{\pi}:\hat{M}\to M$ by sending an orientation of $T_\mathbf{p}M$ to the point $\mathbf{p}$ itself, i.e. $\hat{\pi}(\mathbf{p},\mathcal{O}_\mathbf{p}) = \mathbf{p}$. Since each tangent space has exactly two orientations, each fibre of this map has cardinality $2$. The map $hat{\pi}:\hat{M}\to M$ is called the *orientation covering* of $M$.
</MathBox>

<MathBox title='Properties of the orientation covering' boxType='proposition'>
Suppose $M$ is a connected, smooth, positive-dimensional manifold with or without boundary, and let $\hat{\pi}:\hat{M}\to M$ be its orientation covering. Then $\hat{M}$ can be given the structure of a smooth, oriented manifold with or without boundary, with the following properties:
1. $\hat{\pi}:\hat{M}\to M$ is a generalized smooth covering map.
2. A connected open subset $U\subseteq M$ is evenly covered by $\hat{\pi}$ if and only if $U$ is the orientable.
3. If $U\subseteq M$ is an evenly covered open subset, then every orientation of $U$ is the pullback orientation induced by a local section of $\hat{\pi}$ over $U$.

<details>
<summary>Proof</summary>

We first topologize $\hat{M}$ by defining a basis for it. For each pair $(U,\mathcal{O})$, where $U$ is an open subset of $M$ and $\mathcal{O}$ is an orientation on $U$, define a subset $\hat{U}_\mathcal{O} \subseteq \hat{M}$ by

$$
\begin{align*}
  \hat{U}_\mathcal{O} =& \Set{(\mathbf{p},\mathcal{O}_\mathbf{p}) | \mathbf{p}\in U \\
  &\text{ and }\mathcal{O}_\mathbf{p}\text{ is the orientation for }T_\mathbf{p}M\text{determined by }\mathcal{O}  
}
\end{align*}
$$

We will show that the collection of all subsets of the form $\hat{U}_\mathcal{O}$ is a basis for a topology on $\hat{M}$. Given an arbitrary point $(\mathbf{p},\mathcal{O}_\mathbf{p})\in\hat{M}$, let $U$ be an orientable neighbourhood of $\mathbf{p}$ in $M$, and let $\mathcal{O}$ be an orientation on it. After replacing $\mathcal{O}$ by $-\mathcal{O}$ if necessary, we may assume the given orientation $\mathcal{O}_\mathbf{p}$ is the same as the orientation of $T_\mathbf{p}M$ determined by $\mathcal{O}$. It follows that $(\mathbf{p},\mathcal{O}_\mathbf{p})\in\hat{U}_\mathcal{O}$, so the collection of all sets of the form $\hat{U}_\mathcal{O}$ covers $\hat{M}$. If $\hat{U}_\mathcal{O}$ and $\hat{U}'_\mathcal{O}$ are two such sets and $(\mathbf{p},\mathcal{O}_\mathbf{p})$ is a point in their intersection, then $\mathcal{O}_\mathbf{p}$ is the orientation of $T_\mathbf{p}M$ determined by both $\mathcal{O}$ and $\mathcal{O}'$. If $V$ is the component of $U\cap U'$ containing $\mathbf{p}$, then the restricted orientations $\mathcal{O}|_V$ and $\mathcal{O}'|_V$ agree at $\mathbf{p}$ and therefore are identical, so it follows that $\hat{U}_\mathcal{O} \cap\hat{U}'_\mathcal{O}$ contains the basis set $\hat{V}_{\mathcal{O}|_V}$. Thus, we have defined a topology on $\hat{M}$. Note that for each orientable open subset $U\subseteq M$ and each orientation $\mathcal{O}$ of $U$, then $hat{\pi}$ maps the basis set $\hat{U}_\mathcal{O}$ bijectively onto $U$. Because the orientable open subsets form a basis for the topology of $M$, this implies that $\hat{\pi}$ restricts to a homeomorphism from $\hat{U}_\mathcal{O}$ to $U$. In particular, $\hat{\pi}$ is a local homeomorphism.

Next, we show that with this topology, $\hat{\pi}$ is a generalized covering map. Suppose $U\subseteq M$ is an orientable connected open subset and $\mathcal{O}$ is an orientation for $U$. Then $\hat{\pi}^{-1}(U)$ is the disjoint union of open subsets $\hat{U}_\mathcal{O}$ and $\hat{U}_{-\mathcal{O}}$, and $\hat{\pi}$ restricts to a homemorphism from each of these sets to $U$. Thus, each such set $U$ is evenly covered, and it follows that $\hat{\pi}$ is a generalized covering map. By the previous lemma, $\hat{\pi}$ restricts to an ordinary covering map on each component of $\hat{M}$; it follows that each such component is a topological $n$-manifold with or without boundary and has a unique smooth structure making $\hat{\pi}$ into a smooth covering map. These smooth structure combine to give a smooth structure on all of $\hat{M}$. This completes the proof of **(1)**.

Next, we give $\hat{M}$ an orientation. Let $\hat{\mathbf{p}} = (\mathbf{p},\mathcal{O}_\mathbf{p})$ be a point in $\hat{M}$. By definition, $\mathcal{O}_\mathbf{p}$ is an orientation of $T_\mathbf{p} M$, so we can give $T_{\hat{\mathbf{p}}} \hat{M}$ the unique orientation $\hat{\mathcal{O}}_{\hat{\mathbf{p}}}$ such that $\d\hat{\pi}_{\hat{\mathbf{p}}}: T_{\hat{\mathbf{p}}} \hat{M} \to T_\mathbf{p}M$ is orientation-preserving. This defines a pointwise orientation $\hat{O}$ on $\hat{M}$. On each basis open subset $\hat{U}_\mathcal{O}$, the orientation $\hat{\mathcal{O}}$ agrees with the pullback orientation induced from $(U,\mathcal{O})$ be (the restriction of) $\hat{\pi}$, so it is continuous.

Next, we prove **(2)**. We showed earlier that every orientable connected open subset of $M$ is evenly covered by $\hat{\pi}$. Conversely, if $U\subseteq M$ is any evenly covered open subset, then there is a smooth local section $\sigma:U\to\hat{M}$ of $\hat{\pi}$ which pulls $\hat{\mathcal{O}}$ back to an orientation on $U$.

Finally, to prove **(3)**, assume $U\subseteq M$ is evenly covered and therefore orientable. Given any orientation $\mathcal{O}$ of $U$, define a section $\sigma:U\to\hat{M}$ by setting $\sigma(\mathbf{p}) = (\mathbf{p},\mathcal{O}_\mathbf{p})$. To see that $\sigma$ is continuous, suppose $\hat{U}'_\mathcal{O}$ is any basis open subset of $\hat{M}$. Then for each component $V$ of $U\cap U'$, the restricted orientations $\mathcal{O}|_V$ and $\mathcal{O}'|_V$ must either agree or disagree on all of $V$, so $\sigma^{-1}(\hat{U}'_{\mathcal{O}'})$ is a union of such components and therefore open.
</details>
</MathBox>

<MathBox title='The orientation covering theorem' boxType='theorem'>
Suppose $M$ is a connected smooth manifold with or without boundary, and let $\hat{\pi}:\hat{M}\to M$ be its orientation covering.
1. If $M$ is orientable, then $\hat{M}$ has exactly two components, and the restriction of $\hat{\pi}$ to each component is a diffeomorphism onto $M$.
2. If $M$ is nonorientable, then $\hat{M}$ is connected, and $\hat{\pi}$ is a two-sheeted smooth covering map.

<details>
<summary>Proof</summary>

If $M$ is orientable, then by properties of covering maps, $M$ is evenly covered by $\hat{\pi}$, which means that $\hat{M}$ has two components, each mapped diffeomorphically onto $M$.

Assume $M$ is nonorientable. We show first that $\hat{M}$ is connected. Let $W$ be a component of $\hat{M}$. The previous lemma shows that $\hat{\pi}|_W$ is a covering map, so it fibers all have the same cardinality. Because the fibers of $\hat{\pi}$ have cardinality $2$ and $W$ is not empty, the fibers of $\hat{\pi}|_W$ must have cardinality $1$ or $2$. If the cardinality were $1$, then $\hat{\pi}|_W$ would be an injective smooth covering map and thus a diffeomorphism, and its inverse would be a smooth section of $\hat{\pi}$, which would induce an orientation on $M$. Thus, the cardinality must be $2$, which implies that $W = \hat{M}$. Because $\hat{M}$ is connected, $\hat{\pi}$ is a covering map, and because it is a locall diffeomorphism it is a smooth covering map.
</details>
</MathBox>

<MathBox title='Uniqueness of the orientation covering' boxType='theorem'>
Let $M$ be a nonorientable connected smooth manifold with or without boundary, and let $\hat{\pi}:\hat{M}\to M$ be its orientation covering. If $\tilde{M}$ is an oriented smooth manifold with or without boundary that admits a two-sheeted smooth covering map $\tilde{\pi}:\tilde{M}\to M$, then there exists a unique orientation-preserving diffeomorphism $\varphi:\tilde{M}\to \hat{M}$ such that $\hat{\pi}\circ\varphi = \tilde{\pi}$. 
</MathBox>

<MathBox title='Subgroup index' boxType='definition'>
If $G$ is a group and $H\subseteq G$ is a subgroup, the *index* of $H$ in $G$ is the cardinality of the set of left cosets of $H$ in $G$. If $H$ is a normal subgroup, it is just the cardinality of the quotient group $G/H$.
</MathBox>

<MathBox title='' boxType='theorem'>
Let $M$ be a connected smooth manifold with or without boundary, and suppose the fundamental group of $M$ has no subgroup of index $2$. Then $M$ is orientable. In particular, if $M$ is simply connected then it is orientable.

<details>
<summary>Proof</summary>

Suppose $M$ is not orientable, and let $\hat{\pi}:\hat{M}\to M$ be its orientation covering, which is an honest covering map in this case. Choose any point $\mathbf{q}\in\hat{M}$, and let $\mathbf{p} = \hat{\pi}(\mathbf{q})\in M$. Let $\alpha:\hat{M}\to\hat{M}$ be the map that interchanges the two points in each fibre of $\hat{\pi}$. To prove that $\alpha$ is smooth, suppose $U\subseteq M$ is any evenly covered open subset and $U_0, U_1\subseteq\hat{M}$ are the two components of $\hat{\pi}^{-1} (U)$. Since $\hat{\pi}$ restricts to a diffeomorphism from each component onto $U$, we can write $\alpha|_{U_0} = (\hat{\pi}|_{U_1})^{-1} \circ (\hat{\pi}|_{U_0})$, which is smooth. Similarly, $\alpha|_{U_1}$ is also smooth. Since the collection of all such sets $U_0, U_1$ is an open covering of $\hat{M}$, it follows that $\alpha$ is smooth, and it is a covering automorphism because it satisfies $\hat{\pi}\circ\alpha=\hat{\pi}$. In fact, since a covering automorphism is determined by what it does to one point, $\alpha$ is the unique nontrivial element of the automorphism group $\mathrm{aut}_{\hat{\pi}} (\hat{M})$, which is therefore equal to the two-element group $\Set{\operatorname{id}_{\hat{M}}, \alpha}$. Because the automorphism group acts transitively on fibers, $\hat{\pi}$ is a normal covering map. Let $H$ denote the subgroup $\hat{\pi}_* (\pi_1 (\hat{M},\mathbf{q}))$ of $\pi_1 (M,\mathbf{p})$. A fundamental result in the theory of covering spaces is that the quotient group $\pi_1 (M,\mathbf{p})/H$ is isomorphic to $\mathrm{aut}_{\hat{\pi}} (\hat{M})$. Therefore, $H$ has index $2$ in $\pi_1 (M,\mathbf{p})$.
</details>
</MathBox>

# Integration on manifolds

## Integration of differential forms

<MathBox title='Integral of differential forms' boxType='definition'>
Let $D\subseteq\R^n$ be a bounded subset whose boundary has measure zero, and let $\omega$ be a (continuous) $n$-form on $\overline{D}$. Any such form can be written $\omega = f \bigwedge_{i=1}^n \d x^i$ for some continuous function $f:\overline{D}\to\R$. We define the integral of $\omega$ over $D$ as

$$
\begin{align*}
  \int_D \omega =& \int_D f\;\d V \\
  \int_D f\;\d x^1 \wedge\cdots\wedge\d x^n =& \int_D f\;\d x^1\cdots\d x^n
\end{align*}
$$
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $D$ and $E$ are open domains of integration in $\R^n$ or $\mathbb{H}^n$, and that $G:\overline{D}\to\overline{E}$ is a smooth map that restricts to an orientation-preserving or orientation-reversing diffeomorphism from $D$ to $E$. If $\omega$ is an $n$-form on $\overline{E}$, then

$$
  \int_D G^* \omega = \begin{cases}
    \int_E \omega \quad& \text{if }G\text{ is orientation-preserving} \\
    -\int_E \omega \quad& \text{if }G\text{ is orientation-preserving}
  \end{cases}
$$

<details>
<summary>Proof</summary>

Let $(y^i)_{i=1}^n$ denote the standard coordinates on $E$, and $(x^i)_{i=1}^n$ denote those on $D$. Suppose first that $G$ is orientation-preserving. With $\omega = f \bigwedge_{i=1}^n \d y^i$, the change of variables formula together formula for pullback of $n$-form yields

$$
\begin{align*}
  \int_E \omega =& \int_E f\d V = \int_D (f\circ G)|\det(DG)|\;\d V \\
  =& \int_D (f\circ G)\det(DG)\;\d V \\
  =& \int_D (f\circ G)\det(DG)\; \d x^1 \wedge\cdots\wedge \d x^n \\
  =& \int_D G^* \omega
\end{align*}
$$

If $G$ is orientation-preserving, the same computation holds except that a negative sign is introduced when the absolute value signs are removed.
</details>
</MathBox>

<MathBox title='' boxType='lemma'>
Suppose $U$ is an open subset of $\R^n$ or $\mathbb{H}^n$, and that $K$ is a compact subset of $U$. Then there is an open domain of integration $D$ such that $K\subseteq D\subseteq\overline{D}\subseteq K$.

<details>
<summary>Proof</summary>

For each $\mathbf{p}\in K$, there is an open ball or half-ball containing $\mathbf{p}$ whose closure is contained in $U$. By compactness, finitely many such sets $B_1,\dots,B_m$ cover $K$. Since the boundary of an open ball is a codimension-$1$ submanifold, and the boundary of an open half-ball is contained in a union of two such submanifolds, the boundary of each has measure zero. The set $D = \bigcup_{i=1}^m B_i$ is the required domain of integration.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
Suppose $U, V$ are open subsets of $\R^n$ or $\mathbb{H}^n$, and the $G:U\to V$ is an orientation-preserving or orientation-reversing diffeomorphism. If $\omega$ is a compactly supported $n$-form on $V$, then

$$
  \int_V \omega = \pm \int_U G^* \omega
$$

with the positive sign if $G$ is orientation-preserving, and the negative sign otherwise.

<details>
<summary>Proof</summary>

Let $E$ be an open domain of integration such that $\operatorname{supp}(\omega) \subseteq E \subseteq\overline{E}\subseteq V$. Since diffeomorphism take interiors to interiors, boundaries to boundaries, and sets of measure zero to sets of measure zero, $D = G^{-1} (E) \subseteq U$ is an open domain of integration containing $\operatorname{supp}(G^* \omega)$. The result follows from the previous proposition.
</details>
</MathBox>

### Integration on oriented manifolds

<MathBox title='Integral of differential forms over oriented manifolds' boxType='definition'>
Let $M$ be an oriented smooth $n$-manifold with or without boundary, and let $\omega$ be an $n$-form on $M$. Suppose first that $\omega$ is compactly supported in the domain of a single smooth chart $(U,\varphi)$ that is either positively or negatively oriented. We define the integral of $\omega$ over $M$ to be

$$
  \int_M \omega = \pm \int_{\varphi(U)} (\varphi^{-1})^* \omega
$$

with the positive sign for a positively oriented chart, and the negative sign otherwise. Since $(\varphi^{-1})^* \omega$ is a compactly supported $n$-form on the open subset $\varphi(U)\subseteq\R^n$ or $\mathbb{H}^n$, its integral is defined as discussed above.
</MathBox>

<MathBox title='' boxType='proposition'>
Let $M$ be an oriented smooth $n$-manifold with or without boundary, and let $\omega$ be an $n$-form on $M$. Then $\int_M \omega$ does not depend on the choice of smooth chart whose domain contains $\operatorname{supp}(\omega)$.

<details>
<summary>Proof</summary>

Suppose $(U,\varphi)$ and $(\tilde{U},\tilde{\varphi})$ are two smooth charts such that $\operatorname{supp}(\omega)\subseteq U \cap \tilde{U}$. If both charts are positively oriented or both are negatively oriented, then $\tilde{\varphi}\circ\varphi^{-1}$ is an orientation-preserving diffeomorphism from $\varphi(U\cap\tilde{U})$ to $\tilde{\varphi}(U\cap\tilde{U})$, implying That

$$
\begin{align*}
  \int_{\tilde{\tilde{U}}} (\tilde{\varphi}^{-1})^* \omega =& \int_{\tilde{\varphi}(U\cap\tilde{U})} \\
  =& \int_{\tilde{\varphi}(U\cap\tilde{U})} (\tilde{\varphi}\circ\varphi^{-1})^* (\tilde{\varphi}^{-1})^* \omega \\
  =& \int_{\varphi(U\cap\tilde{U})} (\varphi^{-1})^* (\tilde{\varphi})^* (\tilde{\varphi}^{-1})^* \\
  =& \int_{\varphi(U)} (\varphi^{-1})^* \omega
\end{align*}
$$

If the charts are opposiely oriented, then the two definitions of the integral of $\omega$ over $M$ have opposite signs, but this is compensated by the fact that $\tilde{\varphi}\circ\varphi^{-1}$ is orientation-reversing, so the previous proposition introduces an extra negative sign into the computation above. In either case, the two definitions of $\int_M$ agree.
</details>
</MathBox>

<MathBox title='Integral of differential forms over entire oriented manifolds' boxType='definition'>
Let $M$ be an oriented smooth $n$-manifold with or without boundary, and let $\omega$ be a compactly supported $n$-form on $M$. Suppose $\Set{U_i}$ is a finite open cover of $\operatorname{supp}(\omega)$ by domains of positively or negatively oriented smooth charts, and let $\Set{\psi_i}$ be a subordinate smooth partition of unity. Define the integral of $\omega$ over $M$ to be

$$
  \int_M \omega = \sum_i \int_M \psi_i \omega
$$

If $\omega$ is a compactly supported $0$-form $f:M\to\R$, the integral of $\omega$ over an oriented $0$-manifold $M$ is defined as

$$
  \int_M f = \sum_{\mathbf{p}\in M} \pm f(\mathbf{p})
$$

where we take the positive sing at points where the orientation is positive and the negative sign at points where it is negative. The assumption that $f$ is compactly supported implies that there are only finitely many nonzero terms in this sum.

If $S\subseteq M$ is an oriented immersed $k$-dimensional submanifold with or without boundary, and $\omega$ is a $k$-form on $M$ whose restrictio to $S$ is compactly supported, we interpret $\int_S \omega$ to mean $\int_S \iota_S^* \omega$, where $\iota_S : S\hookrightarrow M$ is inclusion. In particular, if $M$ is a compact, oriented, smooth $n$-manifold with boundary and $\omega$ is an $(n-1)$-form on $M$, we can interpret $\int_{\partial M}$ unambiguously as the integral of $\iota_{\partial M}^* \omega$ over $\partial M$, where $\partial M$ is always understood to have the induced orientation.
</MathBox>

<MathBox title='Integral of differential forms over entire oriented manifolds' boxType='proposition'>
Let $M$ be an oriented smooth $n$-manifold with or without boundary, and let $\omega$ be a compactly supported $n$-form on $M$. Then $\int_M \omega$ does not depend on the choice of open cover or partition of unity.

<details>
<summary>Proof</summary>

Suppose $\Set{\tilde{U}_j}$ is another finite open cover of $\operatorname{supp}(\omega)$ by domains of positively or negatively oriented smooth charts, and $\Set{\tilde{\psi}_j}$ is a subordinate smooth partition of unity. For each $i$, we compute

$$
\begin{align*}
  \int_M \psi_i \omega =& \int_M \left( \tilde{\psi}_j \right)\psi_i \omega \\
  =& \sum_i \int_M \tilde{\psi}_j \psi_i \omega
\end{align*}
$$

Summing over $i$, we obtain

$$
  \sum_i \int_M \psi_i \omega = \sum_{i,j} \int_M \tilde{\psi}_j \psi_i \omega
$$

Thus, both definitions yield the same value for $\int_M \omega$.
</details>
</MathBox>

<MathBox title='Properties of integrals of forms' boxType='proposition'>
1. **Linearity:** If $a,b\in\R$ then
$$
  \int_M a\omega + b\eta = a\int_M \omega + b\int_M \eta
$$
2. **Orientation reversal:** If $-M$ denotes $M$ with the opposite orientation, Then
$$
  \int_{-M} \omega = -\int_M \omega
$$
3. **Positivity:** If $\omega$ is a positively oriented orientation form, then $\int_M \omega > 0$
4. **Diffeomorphism invariance:** If $F:N\to M$ is an orientation-preserving or orientation-reversing diffeomorphism, Then
$$
  \int_M \omega = \begin{cases}
    \int_N F^* \omega \quad \text{if }F\text{ is orientation-preserving} \\
    -\int_N F^* \omega \quad \text{if }F\text{ is orientation-reversing}
  \end{cases}
$$

<details>
<summary>Proof</summary>

**(3):** Suppose $\omega$ is a positively oriented orientation form for $M$. This means that if $(U,\varphi)$ is a positively oriented smooth chart, then $(\varphi^{-1})^* \omega$ is a positive function times $\d x^1 \wedge\cdots\wedge \d x^n$, and for a negatively oriented chart it is a negative functino times the same form. Thus, each term in the sum defining $\int_M$ is nonnegative, with at least one strictly positive term.

**(4):** It suffices to assume $\omega$ is compactly supported in a single positively or negatively oriented smooth chart, because any compactly supported $n$-form on $M$ can be written as a finite sum of such forms by means of a partition of unity. Thus, suppose $(U,\varphi)$ is a positively oriented smooth chart on $M$, whose domain contains the support of $\omega$. When $F$ is orientation-preserving, it is easy to check that $(F^{-1}(U), \varphi\circ F)$ is an oriented smooth chart no $N$ whose domain contains the support of $F^*\omega$, and the result follows. The cases in which the chart is negatively oriented or $F$ is orientation-reversing then follow from this result together with **(2)**.
</details>
</MathBox>

<MathBox title='Integration over parametrizations' boxType='proposition'>
Let $M$ be an oriented smooth $n$-manifold with or without boundary, and let $\omega$ be a compactly supported $n$-form on $M$. Suppose $D_1,\dots,D_k$ are open domains of integration in $\R^n$, and for $i=1,\dots,k$ we are given smooth maps $F_i : \overline{D}_i \to M$ satisfying
1. $F_i$ restricts to an orientation-preserving diffeomorphism from $D_i$ onto an open subset $W_i\subseteq M$
2. $W_i \cap W_j = \emptyset$ when $i\neq j$ 
3. $\operatorname{supp}(\omega) \subseteq \bigcup_{i=1}^k \overline{W}_i$

Then

$$
  \int_M \omega = \sum_{i=1}^k \int_{D_i} F_i^* \omega
$$

<details>
<summary>Proof</summary>

It suffices to assume $\omega$ is supported in the domain of a single oriented smooth chart $(U,\varphi)$. In fact, by restricting to sufficiently nice charts, we may assume $U$ is precompact, $Y = \varphi(U)$ is a domain of integration in $\R^n$ or $\mathbb{H}^n$, and $\varphi$ extends to a diffeomorphism from $\overline{U}$ to $\overline{Y}$.

For each $i$, define open subsets $A_i \subseteq D_i$, $B_i \subseteq W_i$ and $C_i \subseteq Y$ by

$$
\begin{gather*}
  A_i = F_i^{-1} (U\cap W_i) \\
  B_i = U\cap W = F_i (A_i) \\
  C_i = \varphi(B_i) = \varphi_i \circ F_i (A_i)
\end{gather*}
$$

Because $\overline{D}_i$ is compact, it is straightforward to check that $\partial W_i \subseteq F_i (\partial D_i)$, and therefore $\partial W_i$ has measure zero in $M$, and $\partial C_i = \varphi(\partial B_i)$ has measure zero in $\R^n$.

The support of $(\varphi^{-1})^* \omega$ is contained in $\bigcup_{i=1}^k \overline{C}_i$, and any two of these sets intersect only on their boundaries, which have measure zero. Thus

$$
\begin{align*}
  \int_M \omega =& \int_Y (\varphi^{-1})^* \omega \\
  =& \sum_{i=1}^k \int_{C_i} (\varphi^{-1})^* \omega
\end{align*}
$$

Using the diffemorphism $\varphi\circ F_i : A_i \to C_i$ we get

$$
\begin{align*}
  \int_{C_i} (\varphi^{-1})^* \omega =& \int_{A_i} (\varphi\circ F_i)^* (\varphi^{-1})^* \\
  =& \int_{A_i} F_i^* \omega = \int_{D_i} F_i^* \omega
\end{align*}
$$
</details>
</MathBox>

### Integration on Lie groups

<MathBox title='Haar volume form on groups' boxType='proposition'>
Let $G$ be a compact Lie group endowed with a left-invariant orientation. Then $G$ has a unique positively orientated left-invariant $n$-form $\omega_G$ with the property that $\int_G \omega_G = 1$. The orientation form $\omega_G$ is called the *Haar volume form* on $G$. Similarly, the map $f \mapsto \int_G f \omega_G$ is called the *Haar integral*.

<details>
<summary>Proof</summary>

If $\dim(G) = 0$, we just let $\omega_G$ be the constant function $\frac{1}{k}$, where $k$ is the cardinality of $G$. Otherwise, let $(\mathbf{e}_i)_{i=1}^n$ be a left-invariant global frame on $G$, i.e. a basis for the Lie algebra of $G$. By replacing $\mathbf{e}_1$ with $-\mathbf{e}_1$ if necessary, we may assume this frame is positively oriented. Let $(\varepsilon^i)$ be the dual coframe. Left-invariance of $\mathbf{e}_i$ implies that

$$
  (L_g^* \varepsilon^i)(\mathbf{e}_j) = \varepsilon^i (L_{g*} \mathbf{e}_j) = \varepsilon^i (\mathbf{e}_j) = \delta_j^i
$$

which shows that $L_g^* \varepsilon^i = \varepsilon^i$, so $\varepsilon^i$, so $\varepsilon^i$ is left-invariant.

Let $\omega_G = \bigwedge_{i=1}^n \varepsilon^i$, then

$$
  L_g^* (\omega_G) = \bigwedge_{i=1}^n L_g^* \varepsilon^i = \bigwedge_{i=1}^n \varepsilon^i = \omega_G
$$

so $\omega_G$ is left-invariant as well. Because $\omega_G (\mathbf{e}_1,\dots,\mathbf{e}_n) = 1 > 0$, then $\omega_G$ is an orientation form for the given orientation. Clearly, any positive constant multiple of $\omega_G$ is also a left-invariant orientation form. Conversely, if $\tilde{\omega}_G$ is any other left-invariant orientation form, we can write $\tilde{\omega}_G |_e = c\omega_G |_e$ for some positive number $c$. Using left-invariance, we find That

$$
  \tilde{\omega}_G|_g = L_{g^{-1}}^* \tilde{\omega}_G |_e cL_{g^{-1}}^* \omega_G |_e = c\omega_G |_g 
$$

which proves that $\tilde{\omega}_G$ is a positive constant multiple of $\omega_G$.

Since $G$ is compact and oriented, $\int_G \omega_G$ is a positive real number, so we can define $\tilde{\omega}_G = (\int_G \omega_G)^{-1} \omega_G$. Clearly, $\tilde{\omega}_G$ is the unique positively oriented left-invariant orientation form with integral $1$.
</details>
</MathBox>

## Stoke's theorem

<MathBox title="Stoke's theorem" boxType='theorem' tag='theorem-74'>
Let $M$ be an oriented smooth $n$-manifold with boundary, and let $\omega$ be a compactly supported smooth $(n-1)$-form on $M$. Then

$$
  \int_M \d\omega = \int_{\partial M} \omega
$$

where $\partial M$ has the induced orientation such that $\iota_{\partial M}^* \omega$. If $\partial M = \emptyset$, then $\int_M \d\omega = 0$.

<details>
<summary>Proof</summary>

**Case 1:** $M = \mathbb{H}^n$<br/> 
Because $\omega$ has compact support, there is a number $r > 0$ such that $\operatorname{supp}(\omega)$ is contained in the rectangle $A = [-r,r]^{n-1} \times [0,r]$. We can write $\omega$ in standard coordinates As

$$
  \omega = \sum_{i=1}^n \omega_i \;\d x^1 \wedge\cdots\wedge \hat{\d x}^i \wedge\cdots\wedge\d x^n
$$

where the hat means that $\d x^i$ is omitted. Thus,

$$
\begin{align*}
  \d\omega =& \sum_{i=1}^n \d\omega_i \;\d x^1 \wedge\cdots\wedge \hat{\d x}^i \wedge\cdots\wedge\d x^n \\
  =& \sum_{i,j=1}^n \frac{\partial\omega_i}{\partial x^j} \d x^j \;\d x^1 \wedge\cdots\wedge \hat{\d x}^i \wedge\cdots\wedge\d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \frac{\partial\omega_i}{\partial x^i} \;\d x^1 \wedge\cdots\wedge\d x^n
\end{align*}
$$

Thus we compute

$$
\begin{align*}
  \int_{\mathbb{H}^n} \d\omega =& \sum_{i=1}^n (-1)^{i-1} \int_A \frac{\partial\omega_i}{\partial x^i} \;\d x^1 \wedge\cdots\wedge\d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \int_{-r}^r \cdots \int_{-r}^r \frac{\partial\omega_i}{\partial x^i}(\mathbf{x}) \;\d x^1\cdots\d x^n
\end{align*}
$$

We can change the orider of integration in each term so as to do the $x^i$ integration first. By the fundamental theorem of calculus, the terms for which $i\neq n$ reduce to

$$
\begin{align*}
  &\sum_{i=1}^n (-1)^{i-1} \int_0^r \int_{-r}^r \cdots \int_{-r}^r \frac{\partial\omega_i}{\partial x^i}(\mathbf{x}) \;\d x^1\cdots\d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \int_{-r}^r \cdots \int_{-r}^r \frac{\partial\omega_i}{\partial x^i}(\mathbf{x}) \;\d x^i \d x^1\cdots \hat{\d x}^i \cdots \d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \int_{-r}^r \cdots \int_{-r}^r \left[\omega_i (\mathbf{x}) \right]_{x^i = -r}^{x^i = r} \; \d x^1\cdots \hat{\d x}^i \cdots \d x^n \\
  =& 0
\end{align*}
$$

because we have chosen $r$ large enough that $\omega = 0$ when $x^i = \pm r$. The only term that might not be zero is the one for which $i = n$, in which case we have

$$
\begin{align*}
  \int_{\mathbb{H}^n} \d\omega =& (-1)^{n-1} \int_{-r}^r \cdots \int_{-r}^r \int_0^r \frac{\partial\omega_n}{\partial x^n}(\mathbf{x})\;\d x^n \d x^1 \cdots\d x^{n-1} \\
  =& (-1)^{n-1} \int_{-r}^r \cdots \int_{-r}^r \left[\omega_n (\mathbf{x})\right]_{x^n = 0}^{x^n = r} \;\d x^1 \cdots\d x^{n-1} \\
  =& (-1)^n \int_{-r}^r \cdots \int_{-r}^r \omega_n (x^1,\dots,x^{n-1}, 0) \;\d x^1 \cdots\d x^{n-1}
\end{align*}
$$

because $\omega_n = 0$ when $x^n = r$.

Computing the right-hand side gives

$$
  \int_{\partial\mathbb{H}^n} \omega = \sum_{i=1}^n \int_{A\cap\partial\mathbb{H}^n} \omega_i (x^1,\dots,x^{n-1},0) \bigwedge_{j=1, j\neq i}^n \d x^j
$$

Since $x^n$ vanishes on $\partial\mathbb{H}^n$, the pullback of $\d x^n$ to the boundary is identically zero. Thus, the only term above that is nonzero is the one for which $i = n$, which becomes

$$
  \int_{\partiall\mathbb{H}^n} \omega = \int_{A\cap\partial\mathbb{H}^n} \omega^n (x^^1,\dots,x^{n-1},0) \bigwedge_{i=1}^n \d x^i
$$

Taking into account the fact that the coordinates $(x^1,\dots,x^{n-1})$ are positively oriented for $\partial\mathbb{H}^n$ when $n$ is even and negatively oriented when $n$ is odd, we find that $\int_{\mathbb{H}^n} \d\omega = \int_{\partial\mathbb{H}^n} \omega$.

**Case 2:** $M = \R^n$<br/> 
In this case, the support of $\omega$ is contained in a cube of the form $A = [-r,r]^n$. The same computations as for **Case 1** goes through, except that in this case the $i = n$ term vanishes like all others, such that $\int_\R \d\omega = 0$. Since $\partial\R = \emptyset$, then $\int_{\partial\R} \omega = 0$.

**Case 3:** $M$ is a smooth $n$-manifold with boundary<br/>
Consider an $(n-1)$-form $\omega$ that is compactly supported in the domain of a single positively or negatively oriented smooth chart $(U,\varphi)$. Assuming that $\varphi$ is a positively oriented boundary chart, the definition yields

$$
  \int_M \d\omega = \int_{\mathbb{H}^n} (\varphi^{-1})^* \;\d\omega = \int_{\mathbb{H}^n} \d\left( (\varphi^{-1})^* \omega\right)
$$

By the computation above, this is equal to $\int_{\partial\mathbb{H}^n} (\varphi^{-1})^* \omega$, where $\partial\mathbb{H}^n$ is given the induced orientation. Since $\d\varphi$ takes outward-pointing vectors on $\partial M$ to outward-pointing vectors on $\mathbb{H}^n$, it follows that $\varphi|_{U\cap\partial M}$ is an orientation-preserving diffeomorphism onto $\varphi(U)\cap\partial\mathbb{H}^n$, and this $\int_{\partial\mathbb{H}^n} (\varphi^{-1})^* \omega = \int_{\partial M} \omega$. For a negatively oriented smooth boundary chart, the same argument applies with an additional negative sign on each side of the equation. For an interior chart, we get the same computations with $\mathbb{H}^n$ replaced by $\R^n$.

Finally, let $\omega$ be an arbitrary compactly supported smooth $(n-1)$-form. Choosing a cover of $\operatorname{supp}(\omega)$ by finitely many domains of positively or negatively oriented smooth charts $\Set{(U_i, \varphi_i)}$, and choosing a subordinate smooth partition of unity $\Set{\psi_i}$, we can apply the preceding argument to $\psi_i \omega$ for each $i$ and obtain

$$
\begin{align*}
  \int_{\partial M} \omega =& \sum_{i=1} \int_{\partial M} \psi_i \omega \\
  =& \sum_{i=1}^n \int_M \d(\psi_i \omega) \\
  =& \sum_{i=1}^n \int_M \d\psi_i \wedge\omega + \psi_i \;\d\omega \\
  =& \int_M \d\left( \sum_{i=1}^n \psi_i \right)\wedge\omega + \int_M \left( \sum_{i=1}^n \psi_i \right)\d\omega \\
  =& 0 + \int_M \d\omega
\end{align*}
$$

because $\sum_{i=1}^n \psi_i \equiv 1$.
</details>
</MathBox>

<MathBox title='Integrals of exact form' boxType='corollary'>
If $M$ is a compact oriented smooth manifold without boundary, then the integral of every exact form over $M$ is zero:

$$
  \partial M = \emptyset \implies \int_M \d\omega = 0
$$
</MathBox>

<MathBox title='Integrals of closed forms over boundaries' boxType='corollary'>
Suppose $M$ is a compact oriented smooth manifold with boundary. If $\omega$ is a closed form on $M$, then the integral of $\omega$ over $\partial M$ is zero:

$$
  \d\omega \equiv 0 \implies \int_{\partial M} \omega = 0
$$
</MathBox>

<MathBox title='' boxType='corollary'>
Suppose $M$ is a smooth manifold with or without boundary, $S\subseteq M$ is an oriented compact smooth $k$-dimensional submanifold (without boundary), and that $\omega$ is a closed $k$-form on $M$. If $\int_S \omega\neq 0$, then both of the following are true:
1. $\omega$ is not exact on $M$
2. $S$ is not the boundary of an oriented compact smooth submanifold with boundary in $M$
</MathBox>

<MathBox title="Green's theorem" boxType='theorem'>
Suppose $D$ is a compact regular domain in $\R^2$, and let $P$ and $Q$ be smooth real-valued functions on $D$. Then

$$
  \int_D \left(\frac{\partial Q}{\partial x} - \frac{\partial P}{\partial y} \right)\d x\;\d y = \int_{\partial D} P\;\d x + Q\;\d y
$$

<details>
<summary>Proof</summary>

This follows from applying Stoke's theorem (theorem $\ref{theorem-74}$) to the $1$-form $P\;\d x + Q\;\d y$.
</details>
</MathBox>

## Manifolds with corner

<MathBox title='Smooth manifold with corners' boxType='definition'>
Let $\overline{\R}_+^n$ denote the subset of $\R^n$ where all of the coordinates are nonnegative:

$$
  \overline{\R}_+^n = \Set{(x^1,\dots,x^n)\in\R^n | x^1 \geq 0,\dots,x^n \geq 0}
$$

Suppose $M$ is a topological $n$-manifold with boundary. A *chart with corners* for $M$ is a pair $(U,\varphi)$, where $U\subseteq M$ is open and $\varphi$ is a homeomorphism from $U$ to a (relatively) open subset $\hat{U}\subseteq\overline{\R}_+^n$. Two charts with corners $(U,\varphi)$ and $(V,\psi)$ are smoothly compatible if the composite map $\varphi\circ\psi^{-1}:\psi(U\cap V) \to\varphi(U\cap V)$ is smooth.

A *smooth structure with corners* on a topological manifold with boundary is a maximal collection of smoothly compatible interior charts and charts with corners whose domains cover $M$. A topological manifold with boundary together with a smooth structure with corners form a *smooth manifold with corners*. Any chart with corners in the given smooth structure with corners is called a *smooth chart with corners* for $M$.
</MathBox>

Charts with corners are topologically indistinguishable from boundary charts. Thus, from the topological point of view there is no difference between smooth manifolds with boundary and manifolds with corners. The difference is in the smooth structure, because in dimensions greater that $1$, the compatibility condition for charts with corners is different from that for boundary charts. Note that in the case $n=1$, then $\overline{\R}_+^1$ is actually equal to $\mathbb{H}^n$, so smooth $1$-manifolds with corners are no different from smooth manifolds with boundary.

<MathBox title='Corner point' boxType='definition'>
The boundary of $\overline{\R}_+^n$ in $\R^n$ is the set of points at which at least one coordinate vanishes. The points in $\overline{\R}_+^n$ at which more than one coordinate vanishes are called its *corner points*.

If $M$ is a smooth manifold with corners, a point $\mathbf{p}\in M$ is called a *corner point* of $\varphi(\mathbf{p})$ is a corner point in $\overline{\R}_+^n$ with respect to some smooth chart with corners $(U,\varphi)$. Similarly, $\mathbf{p}$ is called a *boundary point* if $\varphi(\mathbf{p})\in\partial\overline{\R}_+^n$ with respect to some such chart.
</MathBox>

Every smooth manifold with or without boundary is also a smooth manifold with corners, but with no corner points. Conversely, a smooth manifold with corners is a smooth manifold with boundary if and only if it has no corner points. The boundary of a smooth manifold with corners, however, is in general not a smooth manifold with corners. In fact, even the boundary of $\overline{\R}_+^n$ itself is not a smooth manifold with corners. However, it is a union of finitely many such, i.e. $\partial\overline{\R}_+^n = \bigcup_{i=1}^n H_i$ where

$$
  H_i = \Set{(x^1,\dots,x^n)\in\overline{R}_+^n | x^i = 0}
$$

is an $(n-1)$-dimensional smooth manifold with corners contained in the subspace defined by $x^i = 0$.

<MathBox title='Invariance of corner points' boxType='proposition'>
Let $M$ be a smooth $n$-manifold with corners, $n\geq 2$, and let $\mathbf{p}\in M$. If $\varphi(\mathrm{p})$ is a corner point for some smooth chart with corners $(U,\varphi)$, then the same is true for every such chart whose domain contains $\mathbf{p}$.

<details>
<summary>Proof</summary>

Suppose $(U,\varphi)$ and $(V,\psi)$ are two smooth charts with corners such that $\varphi(\mathbf{p})$ is a corner point $\psi(\mathbf{p})$ is not. To simplify notation, let us assume without loss of generality that $\varphi(\mathbf{p})$ has coordinates $(x^1,\dots,x^k,0,\dots,0)$ with $k\leq n-2$. Then $\psi(V)$ contains an open subset of some $(n-1)$-dimensional linear subspace $S\subseteq\R^n$, with $\psi(\mathbf{p})\in S$. If $\psi(\mathbf{p})\in \partial\overline{\R}_+^n$, take $S$ to be the unique subspace defined by an equation of the form $x^i = 0$ that contains $\psi(\mathbf{p})$. If $\psi(\mathbf{p})$ is an interior point, any $(n-1)$-dimensional subspace containing $\psi(\mathbf{p})$ will do.

Let $S' = S\cap\psi(U\cap V)$, and let $\alpha:S'\to\R^n$ be the restriction of $\varphi\circ\psi^{-1}$ to $S'$. Because $\varphi\circ\psi^{-1}$ is a diffeomorphism from $\psi(U\cap V)$ to $\psi(U\cap V)$, it follows that $\psi\circ\varphi^{-1}\circ\alpha$ is the identity of $S'$, and therefore $\d\alpha_{\psi(\mathbf{p})}$ is an injective linear map. Let $T = \d\alpha_{\psi(\mathbf{p})} (T_{\psi(\mathbf{p})}S) \subseteq\R^n$. Because $T$ is $(n-1)$-dimensional, it must contain a vector $\mathbf{v}$ such that one of the last two components, $v^{n-1}$ or $v^n$, is nonzero (otherwise, $T$ would be contained in a codimension-2 subspace). Renumbering the coordinates and replacing $\mathbf{v}$ by $-\mathbf{v}$ if necessary, we may assume $v^n < 0$.

Let $\gamma:(-\varepsilon,\varepsilon)\to S$ be a smooth curve such that $\gamma(0) = \mathbf{p}$ and $\d\alpha(\gamma'(0)) = \mathbf{v}$. Then $\alpha\circ\gamma(t)$ has negative $x^n$ coordinate for small $t> 0$, which contradicts the fact that $\alpha$ takes it values in $\overline{R}_+^n$.
</details>
</MathBox>

<MathBox title='Integrals of differental forms on manifolds with corners' boxType='definition'>
Let $M$ be an oriented smooth $n$-manifold with corners, and suppose $\omega$ is an $(n-1)$-form on $\partial M$ that is compactly supported in the domain of a single oriented smooth chart with corners $(U,\varphi)$. The integral of $\omega$ over $M$ is defined by

$$
  \int_{\partial M} \omega = \sum_{i=1}^n \int_{H_i} (\varphi^{-1})^* \omega
$$

where $H_i$ as defined above is given the induced orientation as part of the boundary of the set where $x^i \geq 0$. In other words, we simply integrate $\omega$ in coordinates over the codimension-$1$ portion of the boundary. Finally, if $\omega$ is an arbitrarily compactly supported $(n-1)$-form on $M$, we define the integral of $\omega$ over $\partial M$ by piecing together with a partition of unity just as in the case of a manifold with boundary.
</MathBox>

<MathBox title="Stoke's theorem on manifolds with corners" boxType='theorem'>
Let $M$ be an oriented smooth $n$-manifold with corners, and let $\omega$ be a compactly supported smooth $(n-1)$-form on $M$, then

$$
  \int_M \d\omega = \int_{\partial M} \omega
$$

<details>
<summary>Proof</summary>

The proof is nearly identical to the proof of Stoke's theorem proper. By means of smooth charts and a partition of unity, we may reduced the theorem to the case in which either $M = \R^n$ or $M = \overline{R}_+^n$. The $\R^n$ case yields zero on both sides of the equation, just as before. In the case of a chart with corners, $\omega$ is supported in some cube $[0,r]^n$, and we calculate exactly as before

$$
\begin{align*}
  \int_{\overline{\R}_+^n} \d\omega =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \cdots\int_0^r \frac{\partial\omega_i}{\partial x^i}(\mathbf{x})\;\d x^1\cdots\d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \cdots\int_0^r \frac{\partial\omega_i}{\partial x^i}(\mathbf{x})\;\d x^i \d x^1\cdots\hat{\d x}^i \cdots\d x^n \\
  =& \sum_{i=1}^n (-1)^{i-1} \int_0^r \cdots\int_0^r \left[ \omega_i (\mathbf{x}) \right]_{x^i = 0}^{x^i = r} \d x^1\cdots\hat{\d x}^i \cdots\d x^n \\
  =& \sum_{i=1}^n (-1)^i \int_0^r \cdots\int_0^r \omega_i(x^1,\dots,0,\dots,x^n) \d x^1\cdots\hat{\d x}^i \cdots\d x^n \\
  =& \sum_{i=1}^n \int_{H_i} \omega = \int_{\partial\overline{\R}_+^n} \omega
\end{align*}
$$

The factor $(-1)^i$ disappears because the induced orientation on $H_i$ is $(-1)^i$ times that of the standard coordinates $(x^1,\dots,\hat{x}^i,\dots,x^n)$.
</details>
</MathBox>

<MathBox title='' boxType='theorem'>
Suppose $M$ is a smooth manifold and that $\gamma_0, \gamma_1:[a,b]\to M$ are path-homotopic piecewise smooth curve segments. For every closed $1$-form $\omega$ on $M$

$$
  \int_{\gamma_0} \omega = \int_{\gamma_1} \omega
$$

<details>
<summary>Proof</summary>

By means of an affine reparametrization, we may assume without loss of generality that $[a,b] = [0,1]$. Assume first that $\gamma_0$ and $\gamma_1$ are smooth, such that they are smoothly homotopic relative to $\Set{0,1}$. Let $H: I\times I \to M$ be such a smooth homotopy. Since $\omega$ is closed, we have

$$
  \int_{I\times I} \d(H^* \omega) = \int_{I\times I} H^* \;\d\omega = 0
$$

On the other hand, $I\times I$ is a smooth manifold with corners, so Stoke's theorem implies That

$$
  0 = \int_{I\times I} \d(H^* \omega) = \int_{\partial(I\times I)} H^* \omega
$$

Parametrizing $\partial(I\times I)$ in terms of maps $F_i : I\to I\times I$

$$
\begin{align*}
  F_1 (t) =& (t,0) \\
  F_2 (t) =& (1, t) \\
  F_3 (t) =& (1-t, 1) \\
  F_4 (t) =& (0, 1-t)
\end{align*}
$$

we get that

$$
  \int_{\partial(I\times I)} \omega = \sum_{i=1}^4 \int_{F_i} \omega
$$

Applying the segment property of the line integral, we obtain

$$
\begin{align*}
  0 =& \int_{\partial(I\times I)} H^* \omega \\
  =& \sum_i \int_{F_i} H^* \omega \\
  =& \sum_i \int_{H\circ F_i} \omega
\end{align*}
$$

The fact that $H$ is a homotopy relative to $\Set{0,1}$ means that $H\circ F_2$ and $H\circ F_4$ are constant maps, and therefore the second fourth terms are zero. The theorem then follows from the facts that $H\circ F_1 = \gamma_0$ and $H\circ F_3$ is a backward reparametrization of $\gamma_1$.

Next we consider the general case of piecewise smooth curves. We cannot simply apply the preceding result on each subinterval where $\gamma_0$ and $\gamma_1$ are smooth, because the restricted curves may not start and end at the same points. Instead, we prove the following more general claim: Let $\gamma_0, \gamma_1: I\to M$ be piecewise smooth curve segments (not necessarily with the same endpoints), and suppose $H: I\times I \to M$ is any homotopy between them. Define curve segments $\sigma_0, \sigma_1 :I\to M$ by

$$
\begin{align*}
  \sigma_0 (t) =& H(0,t) \\
  \sigma_1 (t) =& H(1,t)
\end{align*}
$$

and let $\tilde{\sigma}_0$ and $\tilde{\sigma}_1$ be any smooth curve segments that are path-homotopic to $\sigma_0$ and $\sigma_1$, respectively. Then

$$
  \int_{\gamma_1} \omgea - \int_{\gamma_0} \omega = \int_{\tilde{\sigma}_1} \omega - \int_{\tilde{\sigma}_0} \omega
$$

When specialized to the case in which $\gamma_0$ and $\gamma_1$ are path-homotopic, this implies the theorem, because $\sigma_0$ and $\sigma_1$ are constant maps in that case.

Since $\gamma_0$ and $\gamma_1$ are piecewise smooth, there are only finitely many points $\Set{a_1,\dots,a_m}$ in $(0,1)$ at which either $\gamma_0$ or $\gamma_1$ is not smooth. We prove the claim by induction on the number $m$ of such points. When $m=0$, both curves are smooth, and we may replace the given homotopy $H$ by a smooth homotopy $\tilde{H}$, which can be taken to be homotopic to $H$ relative to $I\times\Set{0} \cup I\times\Set{1}$. Thus, for $i=0,1$, the curve $\tilde{\sigma}_i = \tilde{H}(i, t)$ is a smooth curve segment that is path-homotopic to $\sigma_i$. In this setting $\int_{\gamma_1} \omgea - \int_{\gamma_0} \omega = \int_{\tilde{\sigma}_1} \omega - \int_{\tilde{\sigma}_0} \omega$ reduces to $\int_{\partial(I\times I)} \omega = \sum_{i=1}^4 \int_{F_i} \omega$. Note that the integrals over $\tilde{\sigma}_i$ do not depend on which smooth curves path-homotopic to $\sigma_i$ are chosen, by the smooth case proved above.

Let $\gamma_0$ and $\gamma_1$ be homotopic piecewise smooth curves with $m$ nonsmooth points $\Set{a_1,\dots,a_m}$, and suppose the claim is true for curves with fewer than $m$ such points. For $i=0,1$, let $\gamma'_i$ be the restriction of $\gamma_i$ to $[0,a_m]$, and let $\gamma''_i$ be its restriction to $[a_m, 1]$. Let $\sigma:I\to M$ be the curve segment $\sigma(t) = H(a_m, t)$, and let $\tilde{\sigma}$ be any smooth curve segment that is path-homotopic to $\sigma$. Then, since $\gamma'_i$ and $\gamma''_i$ have fewer than $m$ nonsmooth points, the inductive hypothesis implies

$$
\begin{align*}
  \int_{\gamma_1} \omega - \int_{\gamma_0} =& \left( \int_{\gamma'_1} \omega - \int_{\gamma'_0} \omega \right) - \left( \int_{\gamma''_1} \omega - \int_{\gamma''_0} \omega \right) \\
  =& \left( \int_{\tilde{\sigma}} \omega - \int_{\tilde{\sigma}_0} \omega \right) + \left( \int_{\tilde{\sigma_1}} \omega - \int_{\tilde{\sigma}} \omega \right) \\
  =& \int_{\tilde{\sigma}_1} \omega - \int_{\tilde{\sigma}_0} \omega
\end{align*}
$$
</details>
</MathBox>

<MathBox title='' boxType='corollary'>
On a simply connected smooth manifold, every closed $1$-form is exact.

<details>
<summary>Proof</summary>

Suppose $M$ is simply connected and that $\omega$ is a closed $1$-form on $M$. Since every piecewise smooth closed curve in $M$ is path-homotopic to a constant curve, the preceding theorem shows that the integral of $\omega$ over every such curve is equal to $0$. Thus, $\omega$ is conservative and therefore exact.
</details>
</MathBox>

## Integration on Riemannian manifolds

### Integration of functions

<MathBox title='Integral of real-valued functions on Riemannian manifolds' boxType='definition'>
Suppose $(M, g)$ is an oriented Riemannian manifold with or without boundary, and let $\omega_g$ denote its Riemannian volume form. If $f$ is a compactly supported continuous real-valued function on $M$, then $f\omega_g$ is a compactly supported $n$-form, so we can define the integral of $f$ over $M$ to be

$$
  \int_M f \omega_g
$$

If $M$ itself is compact, we define the volume of $M$ by $\mathrm{vol}(M) = \int_M \omega_g$.
</MathBox>

The Riemannian volume form is often denoted by $\d V_g$, or $\d A_g$ or $\d s_g$ in the 2-dimensional and $1$-dimensional case, respectively. Then the integral of $f$ over $M$ is written $\int_M f\d V_g$, and the volume of $M$ as $\mathrm{vol}(M) = \int_M \d V_g$. Note that this notation is just used for conveniance and does not imply that the volum form is the exterior derivative of an $(n-1)$-form.

<MathBox title='' boxType='proposition'>
Let $(M,g)$ be a nonempty oriented Riemannian $n$-manifold with or without boundary, and suppose $f$ is a compactly supported continuous real-valued function on $M$ satisfying $f \geq 0$. Then $\int_M f \;\d V_g \geq 0$ with equality if and only if $f \equiv 0$.

<details>
<summary>Proof</summary>

If $f$ is supported in the domain of a single oriented smooth chart $(U,\varphi)$, then

$$
  \int_M f\;\d V_g = \int_{\varphi(U)} f(\mathbf{x}) \sqrt{\det(g_{ij})}\;\d x^1\cdots\d x^n \geq 0
$$

The same inequality holds in a negatively oriented chart because the negative sign from the chart cancels the negative sign in the expression for $\d V_g$. The general case follows from this oone, because $\int_M f\;\d V_g$ is equal to a sum of terms like $\int_M \psi_i f\;\d V_g$, where each integrand $\psi_i f$ is nonnegative and supported in a single smooth chart. If in addition $f$ is positive somewhere, then it is positivie on a nonempty open subset by continuity, so at least one of the integrals in this sum is positive. On the other hand, if $f$ is identically zero, then clearly $\int_M f\;\d V_g = 0$.
</details>
</MathBox>

### The divergence theorem

<MathBox title='' boxType='proposition'>
Let $(M,g)$ be an oriented Riemannian manifold with or without boundary. Suppose $S\subseteq M$ is an immersed hypersurface with the orientation determined by a unit normal vector field $\mathbf{N}$, and $\tilde{g}$ is the induced metric on $S$. If $\mathbf{X}$ is any vector field along $S$, then

$$
  \iota_S^* (\beta(\mathbf{X})) = \langle \mathbf{X}, \mathbf{N} \rangle_g \;\d V_{\tilde{g}}
$$

where $\beta: \mathfrak{X}(M) \to\Omega^{n-1} (M)$ is a smooth bundle isomorphism defined by

$$
  \beta(\mathbf{X}) = \mathbf{X} \lrcorner\,\d V_g
$$

<details>
<summary>Proof</summary>

Define two vector fields $X^T$ and $X^\perp$ along $S$ by

$$
\begin{align*}
  X^\perp =& \langle\mathbf{X},\mathbf{N}\rangle_g N \\
  X^T =& X - X^\perp
\end{align*}
$$

Then $X = X^\perp + X^T$, where $X^\perp$ is normal to $S$ and $X^T$ is tangent to it. Using this decomposition

$$
  \beta(X) = X^\perp \lrcorner \d V_g + X^T \lrcorner \d V_g
$$

Pulling back to $S$ we can simplify the first term To

$$
\begin{align*}
  \iota_S^* (X^\perp \lrcorner \d V_g) =& \langle\mathbf{X},\mathbf{N}\rangle_g \iota_S^* (N \lrcorner \d V_g) \\
  =& \langle\mathbf{X},\mathbf{N}\rangle_g \d V_{\tilde{g}}
\end{align*}
$$

The stated equation will be proved if we can show that $\iota_S^* (X^T \lrcorner \d V_g) = 0$. If $X_1,\dots,X_{n-1}$ are any vectors tangent to $S$, then

$$
  (X^T \lrcorner\d V_g)(X_1,\dots,X_{n-1}) = \d V_g (X^T, X_1,\dots,X_{n-1}) = 0
$$

because any $n$-tuple of vectors in an $(n-1)$-dimensional vector space is linearly dependent.
</details>
</MathBox>

<MathBox title='Divergence operator' boxType='definition'>
Let $(M, g)$ be an oriented Riemannian $n$-manifold with or without boundary. Multiplication by the Riemannian volume form defines a smooth bundle isomorphism $*: C^\infty (M) \to\Omega^n (M)$ by $*f = f\;\d V_g$. The *divergence operator* on $\mathfrak{X}(M)$, denoted $\div: \mathfrak{X}(M) \to C^\infty (M)$, by

$$
  \div(\mathbf{X}) = *^{-1} \d(\beta(\mathbf{X}))
$$

or equivalently

$$
  \d(\mathbf{X} \lrcorner\,\d V_g) = (\div(\mathbf{X}))\d V_g
$$
</MathBox>

<MathBox title='The divergence theorem' boxType='theorem'>
Let $(M,g)$ be an oriented Riemannian manifold with boundary. For any compactly supported smooth vector field $\mathbf{X}$ on $M$

$$
  \int_M \div(\mathbf{X}) \d V_g = \int_{\partial M} \langle\mathbf{X},\mathbf{N}\rangle_g \;\d V_{\tilde{g}}
$$

where $\mathbf{N}$ is the outward-pointing unit normal vector field along $\partial M$ and $\tilde{g}$ is the induced Riemannian metric on $\partial M$.

<details>
<summary>Proof</summary>

By Stokes' theorem

$$
  \int_M \div(\mathbf{X})\;\d V_g = \int_M \d(\beta(X)) = \int_{\partial M} \iota_S^* \beta(X)
$$

The divergence theorem then follows from the previous lemma.
</details>
</MathBox>

The term *divergence* is related to the following geometric intepretation of a smooth flow $\theta$. If for every compact regular domain $D$ then $\theta$ is
- *volume-preserving* if $\mathrm{vol}(\theta_t (D)) = \mathrm{vol}(D)$ whenever the domain of $\theta_t$ contains $D$
- *volume-increasing* if $\mathrm{vol}(\theta_t (D))$ is strictly increasing
- *volume-decreasing* if $\mathrm{vol}(\theta_t (D))$ is strictly decreasing
- *volume-nonincreasing* if $\mathrm{vol}(\theta_t (D))$ is nonincreasing
- *volume-nondecreasing* if $\mathrm{vol}(\theta_t (D))$ is nondecreasing

Note that the properties of flow domains ensure that if $D$ is contained in the domain of $\theta_t$ for some $t$, then the same is true for all times between $0$ and $t$.

The following proposition shows that the divergence of a vector field can be intepreted as a measure of the tendency of its flow to diverge.

<MathBox title='Geometric interpretation of the divergence' boxType='proposition'>
Let $M$ be an oriented Riemannian manifold, let $\mathbf{X}\in\mathfrak{X}(M)$, and let $\theta$ be the flow of $\mathbf{X}$. Then $\theta$ is
1. *volume-preserving* if and only if $\div(\mathbf{X}) = 0$ everywhere on $M$
2. *volume-nondecreasing* if and only if $\div(\mathbf{X}) \geq 0$ everywhere on $M$
3. *volume-nonincreasing* if and only if $\div(\mathbf{X}) \leq 0$ everywhere on $M$
4. *volume-increasing* if and only if $\div(\mathbf{X}) > 0$ everywhere on $M$
5. *volume-decreasing* if and only if $\div(\mathbf{X}) < 0$ everywhere on $M$

<details>
<summary>Proof</summary>

First we establish some preliminary results. For each $t\in\R$, let $M_t$ be the domain of $\theta_t$. If $D$ is a compact regular domain contained in $M_t$, then $\theta_t$ is an orientation-preserving diffeomorphism from $D$ to $\theta_t (D)$, giving

$$
  \mathrm{vol}(\theta_t (D)) = \int_{\theta_t (D)} \d V_g = \int_D \theta_t^* \d V_g
$$

Because the integrand on the right depends smoothly on $(t,\mathbf{p})$ in the domain of $\theta$, we can differentiate this expression with respect to $t$ by differentiating under the integral sign.

Under Cartan's magic formula for the Lie derivative of the Riemannian volume form, we obtain

$$
\begin{align*}
  \mathcal{L}_X \d V_g =& X \lrcorner \d(\d V_g) + \d(X \lrcorner \d V_g) \\
  =& \div(\mathbf{X})\;\d V_g
\end{align*}
$$

because $\d(\d V_g)$ is an $(n+1)$-form on an $n$-manifold. Then

$$
\begin{align*}
  \left.\frac{\d}{\d t}\right|_{t=t_0} \mathrm{vol}(\theta_t (D)) =& \int_D \left.\frac{\partial}{\partial t}\right|_{t=t_0} (\theta_t^* \;\d V_g) \\
  =& \int_D \theta_{t_0}^* (\mathcal{L}_X \;\d V_g) \\
  =& \int_D \theta_{t_0}^* (\div(\mathbf{X})\;\d V_g) \\
  =& \int_{\theta_{t_0}(D)} \div(\mathbf{X})\;\d V_g
\end{align*}
$$

Now we can prove the "if" parts of all five equivalences. If $\div(\mathbf{X})\equiv 0$, it follows that $\mathrm{vol}(\theta_t (D))$ is a constant function $t$ for every $D$, and thus $\theta$ is volume-preserving. Similarly, an inequality of the form $\div(\mathbf{X}) \geq 0$ or $\div(\mathbf{X}) \leq 0$ implies that $\mathrm{vol}(\theta_t (D))$ is nondecreasing or nonincreasing, respectively.

For **(4)**, suppose $\div(\mathbf{X}) > 0$ on a dense subset of $M$, and let $D$ be a compact regular domain in $M$. Then $\div(\mathbf{X}) \geq 0$ everywhere by continuity, so $\mathrm{vol}(\theta_t (D))$ is nondecreasing by the argument above. Because $\mathrm{int}(D)$ is an open subset of $M$, it follows that $\mathrm{int}(\theta_t (D))$ is open for each $t$ such that $D\subseteq M_t$, and therefore by density there is a point in $\mathrm{int}(\theta_t (D))$ where $\div(\mathbf{X}) > 0$. It follows that $\int_{\theta_t (D)} \div(\mathbf{X}) \;\d V_g > 0$ and thus $\mathrm{vol}(\theta_t (D))$ is strictly increasing. A similar argument proves **(3)**.

To prove the converses, we prove their contrapositives. For **(2)**, if there is a point where $\div(\mathbf{X}) < 0$, then by continuity there is an open subset $U\subseteq M$ on which $\div(\mathbf{X}) < 0$. The argument in the first part of the proof shows that $\mathbf{X}$ generates a volume-decreasing flow on $U$. In particular, for any regular coordinate ball $B$ such that $\overline{B}\subseteq U$ and any $t > 0$ small enough to ensure that $\theta_t (\overline{B}) \subseteq U$, we have $\mathrm{vol}(\theta_t (\overline{B})) < \mathrm{vol}(\overline{B})$, which implies that $\theta$ is not volume-nondecreasing. The same argument with inequalities reversed proves **(3)**. 

If $\div(\mathbf{X})$ is not identically zero, then there is an open subset on which it is either strictly positive of strictly negative, and then the argument above shows that it is not volume-preserving on that set, thus proving **(1)**.

For **(4)**, if the subset of $M$ where $\div(\mathbf{X}) > 0$ is not dense, there is an open subset $U\subseteq M$ on which $\div(\mathbf{X}) \leq 0$. Then **(3)** shows that $\theta$ is volume-nondecreasing on $U$, so it cannot be volume-increasing on $M$. The argument for **(5)** is similar.
</details>
</MathBox>

### Surface integrals

<MathBox title='Curl operator' boxType='definition'>
If $(M,g)$ is an oriented Riemannian $3$-manifold, the *curl operator*, denoted $\operatorname{\curl}: \mathfrak{X}(M) \to\mathfrak{X}(M)$ by

$$
  \operatorname{\curl}(\mathbf{X}) = \beta^{-1} \;\d(\mathbf{X}^\flat)
$$

where $\beta:\mathfrak{X}(M) \to\Omega^2 (M)$ is defiend by $\beta(X) = X \lrcorner \d A_g$. Unwinding the definitions, this is equivalent to

$$
  \operatorname{\curl}(\mathbf{X}) \lrcorner \d V_g = \d(\mathbf{X}^\flat)
$$
</MathBox>

The operators $\operatorname{\grad}$, $\operatorname{\curl}$ and $\div$ on an oriented Riemannian $3$-manifold $M$ are related by the following commutative diagram.

$$
\begin{CD}
  C^\infty (M) @>{\mathrm{grad}}>> \mathfrak{X}(M) @>{\mathrm{curl}}>> \mathfrak{X}(M) @>{\mathrm{div}}>> C^\infty (M) \\
  @VV{\operatorname{id}}V @VV{\flat}V @VV{\beta}V @VV{*}V \\
  \Omega^0 (M) @>>{\d}> \Omega^1 (M) @>>{\d}> \Omega^2 (M) @>>{\d}> \Omega^3 (M) 
\end{CD}
$$

The indenties $\operatorname{\curl}\circ\operatorname{\grad}\equiv 0$ and $\div\circ\operatorname{\curl}\equiv =$ follow from $\d\circ\d\equiv 0$ just as they do in the Euclidean case. The curl operative is defined only in dimension $3$ because it is only in that case that $\Lambda^2 T^* M$ is isomorphic to $TM$ (via the map $\beta: X\mapsto X\lrcorner \d V_g$).

<MathBox title='Surface integral' boxType='definition'>
Let $(M,g)$ be an oriented Riemannian $3$-manifold. Suppose $S\subseteq M$ is a compact $2$-dimensional submanifold with or without boundary, and $N$ is a smooth unit normal vector field along $S$. Let $\d A$ denote the Riemannian volume form on $S$ with respect to the induced metric $\iota_S^* g$ and the orientation determined by $N$, so that $\d A = \iota_S^* (N \lrcorner \d V_g)$. For any smooth vector field $\mathbf{X}$ on $M$, the *surface integral* of $\mathbf{X}$ over $S$ is defined As

$$
  \int_S \langle\mathbf{X},\mathbf{N}\rangle_g \;\d A
$$
</MathBox>

<MathBox title="Stokes' theorem for surface integrals" boxType='theorem'>
Suppose $M$ is an oriented Riemannian $3$-manifold with or without boundary, and $S$ is a compact oriented $2$-dimensional smooth submanifold with boundary in $M$. For any smooth vector field $\mathbf{X}$ on $M$

$$
  \int_S \langle \operatorname{\curl}(\mathbf{X}),\mathbf{N}\rangle_g \;\d A = \int_{\partial S} \langle\mathbf{X},\mathbf{T}\rangle_g \;\d s
$$

where $\mathbf{N}$ is the smooth unit normal vector field along $S$ that determines its orientation, $\d s$ is the Riemannian volume form for $\partial S$ with respect to the metric and orientation induced from $S$, and $\mathbf{T}$ is the unique positively oriented unit tangent vector field on $\partial S$.

<details>
<summary>Proof</summary>

The general version of Stokes' theorem applied to the $1$-form $\mathbf{X}^\flat$ yields

$$
  \int_S \d(\mathbf{X}^\flat) = \int_{\partial S} \mathbf{X}^\flat
$$

Thus the theorem follows from the following two identities

$$
\begin{align*}
  \iota_S^* \d(\mathbf{X}^\flat) =& \langle\operatorname{\curl}(\mathbf{X}),\mathbf{N}\rangle_g \;\d A \\
  \iota_{\partial S}^* \mathbf{X}^\flat =& \langle\mathbf{X},\mathbf{T}\rangle_g \;\d s
\end{align*}
$$

The first identity is just the defining equation for the curl combined with the previous lemma. To prove the second identity, we note that $\iota_{\partial S}^* \mathbf{X}^\flat$ is a smooth $1$-form on a $1$-manifold, and thus must be equal to $f\;\d s$ for some smooth function $f$ on $\partial S$. To evaluate $f$, we note that $\d s(T) = 1$, and so the definition of $\mathbf{X}^\flat$ yields

$$
  f = f\;\d s(T) = \mathbf{X}^\flat (T) = \langle X, T\rangle_g
$$

This proves the second identity and thus the theorem.
</details>
</MathBox>

## Densitities

<MathBox title='Density on vector spaces' boxType='definition'>
Let $V$ be an $n$-dimensional vector space. A *density* on $V$ is a function $\mu: V^n \to\R$ satisfying the following condition: if $T:V\to V$ is any linear map then

$$
  \mu(T\mathbf{v}_1,\dots, T\mathbf{v}_n) = |\det(T)| \mu(\mathbf{v}_1,\dots,\mathbf{v}_n)
$$

A *positive density* on $V$ is a density $\mu$ satisfying $\mu(\mathbf{v}_1,\dots,\mathbf{v}_n) > 0$ whenever $(\mathbf{v}_i)_{i=1}^n$ is a linearly independent $n$-tuple. A *negative density* is defined similarly. 

The set of all densities on $V$ is denoted $\mathcal{D}(V)$. If $M$ is asmooth manifold with or without boundary, the set

$$
  \mathcal{D}M = \bigsqcup_{\mathbf{p}\in M} \mathcal{D}(T_\mathbf{p} M)
$$

is called the *density bundle* f $M$. Let $\pi:\mathcal{D}M\to M$ be the natural projection map taking each element of $\mathcal{D}(T_\mathbf{p}M)$ to $\mathbf{p}$.
</MathBox>

Observe that a density is not a tensor, because it is not linear over $\R$ in any of its argument.

<MathBox title='Properties of densities' boxType='proposition'>
Let $V$ be a vector space of dimension $n\geq 1$.
1. $\mathcal{D}(V)$ is a vector space under the standard vector operations such that for any $\mu_1,\mu_2\in\mathcal{D}(V)$ and $c_1,c_2\in\R$
$$
\begin{align*}
  (c_1 \mu_1 + c_2 \mu_2)(\mathbf{v}_1,\dots,\mathbf{v}_n) =& c_1 \mu_2 (\mathbf{v}_1,\dots,\mathbf{v}_n) \\
  &+ c_2 \mu_2 (\mathbf{v}_1,\dots,\mathbf{v}_n)
\end{align*}
$$
2. If $\mu_1,\mu_2\in \mathcal{D}(V)$ and $\mu_1 (\mathbf{e}_1,\dots,\mathbf{e}_n) = \mu_2 (\mathbf{e}_1,\dots,\mathbf{e}_n)$ for some basis $(\mathbf{e}_i)$ of $V$, then $\mu_1 = \mu_2$.
3. If $\omega\in\Lambda^n (V^*)$, the map $|\omega|: V^n \to\R$ defined by $|\omega|(\mathbf{v}_1,\dots,\mathbf{v}_n) = |\omega(\mathbf{v}_1,\dots,\mathbf{v}_n)|$ is a density.
4. $\mathcal{D}(V)$ is $1$-dimensional, spanned by $|\omega|$ for any nonzero $\omega\in\Lambda^n (V^*)$.

<details>
<summary>Proof</summary>

**(1)** follows immediately from the definition. For **(2)**, suppose $\mu_1$ and $\mu_2$ give the same value when applied to $(\mathbf{e}_i)_{i=1}^n$. If $(\mathbf{v}_i)_{i=1}^n$ are arbitrary vectors in $V$, let $T:V\to V$ be the unique linear map that takes $\mathbf{e}_i$ to $\mathbf{v}_i$ for $i=1,\dots,n$. It follows that

$$
\begin{align*}
  \mu_1 (\mathbf{v}_1,\dots,\mathbf{v}_n) =& \mu_1 (T\mathbf{e}_1,\dots,T\mathbf{e}_n) \\
  =& |\det(T)| \mu_1 (\mathbf{e}_1,\dots,\mathbf{e}_n) \\
  =& |\det(T)| \mu_2 (\mathbf{e}_1,\dots,\mathbf{e_n}) \\
  =& \mu_2 (T\mathbf{e}_1,\dots,T\mathbf{e}_n) \\
  =& \mu_2 (\mathbf{v}_1,\dots,\mathbf{v}_n)
\end{align*}
$$

Part **(3)** follows from the determinant property of multicovectors.

$$
  |\omega|(T\mathbf{v}_1,\dots,T\mathbf{v}_n) =& |\omega(T\mathbf{v}_1,\dots,T\mathbf{v}_n) \\
  =& |\det(T)\omega(\mathbf{v}_1,\dots,\mathbf{v}_n)| \\
  =& |\det(T)|\cdot|\omega|(\mathbf{v}_1,\dots,\mathbf{v}_n)
$$

To prove **(4)**, suppose $\omega$ is any nonzero element of $\Lambda^N (V^*)$. If $\mu$ is an arbitrary element of $\mathcal{D}(V)$, it suffices to show that $\mu = c|\omega|$ for some $c\in\R$. Let $(\mathbf{e}_i)$ be a basis for $V$, and define $a,b\inR$ by

$$
\begin{align*}
  a =& |\omega|(\mathbf{e}_1,\dots,\mathbf{e}_n) = |\omega(\mathbf{e}_1,\dots,\mathbf{e}_n) \\
  b =& \mu(\mathbf{e}_1,\dots,\mathbf{e}_n)
\end{align*}
$$

Because $\omega\neq 0$, it follows that $a\neq 0$. Thus, $\mu$ and $\frac{b}{a}|\omega|$ give the same result when applied to $(\mathbf{e}_i)$, to they are equal by **(2)**.
</details>
</MathBox>

<MathBox title='' boxType='proposition'>
If $M$ is a smooth manifold with or without boundary, its density bundle is a smooth line bundle over $M$.

<details>
<summary>Proof</summary>

We will construct local trivializations and use the vector bundle chart lemma. Let $(U, (x^i))$ be any smooth coordinate chart on $M$, and let $\omega = \bigwedge_{i=1}^n \d_x^i$. By density properties, $|\omega_\mathbf{p}|$ is a basis for $\mathcal{D}(T_\mathbf{p}M)$ at each point $\mathbf{p}\in U$. Thus, the map $\Phi: \pi^{-1} (U)\to U\times\R$ given by

$$
  \Phi(c|\omega_\mathbf{p}|) = (\mathbf{p},c)
$$

is a bijection.

Suppose $(\tilde{U}, (\tilde{x}^j))$ is another smooth chart with $U \cap \tilde{U} \neq\emptyset$. Let $\tilde{\omega} = \bigwedge_{j=1}^n \d\tilde{x}^j$, and define $\tilde{\Phi}:\pi^{-1} (\tilde{U}\to\tilde{U}\times\R$ correspondingly

$$
  \tilde{\Phi}(c|\\tilde{omega}_\mathbf{p}|) = (\mathbf{p},c)
$$

It follows from the transformation law for $n$-forms under changes of coordinates that

$$
\begin{align*}
  \Phi\circ\tilde{\Phi}^{-1} (\mathbf{p}, c) =& \Phi(c|\tilde{\omega}_\mathbf{p}|) \\
  =& \Phi\left(c\left| det\left(\frac{\partial\tilde{x}^j}{\partial x^i}\right) \right| |\omega_\mathbf{p}| \right) \\
  =& \left(\mathbf{p}, c\left| det\left(\frac{\partial\tilde{x}^j}{\partial x^i}\right) \right| \right)
\end{align*}
$$

Thus, the hypotheses of vector bundle chart lemma are satisfied, with the transition functions equal to $\left|det\left(\frac{\partial\tilde{x}^j}{\partial x^i}\right)\right|$.
</details>
</MathBox>

<MathBox title='Density on manifolds' boxType='definition'>
If $M$ is as smooth manifold with or without boundary, a section of $\mathcal{D}M$ is called a *density (field)* on $M$. If $\mu$ is a density and $f$ is a continuous real-valued function, then $f\mu$ is again a density, which is smooth if both $f$ and $\mu$ are. A density on $M$ is *positive* or *negative* if its value at each point has that property. Any nonvanishing $n$-form $\omega$ determines a positive density $|\omega|$, defined by $|\omega|_\mathbf{p} = |\omega_\mathbf{p}|$ for each $\mathbf{p}\in M$. If $\omega$ is a nonvanishing $n$-form on an open subset $U\subseteq M$, then any density $\mu$ on $U$ can be written $\mu = f|\omega|$ for some real valued function $f$. 
</MathBox>

<MathBox title='Existence of a global smooth positive density' boxType='proposition'>
If $M$ is a smooth manifold with or without boundary, there exists a smooth positive density on $M$.

<details>
<summary>Proof</summary>

Because the set of positive elements of $\mathcal{D}M$ is an open subset whose intersection with each fibre is convex, the usual partition of unity argument allows us to piece together local positive densities to obtain a global smooth density.
</details>
</MathBox>

<MathBox title='Density pullback' boxType='definition'>
If $F:M\to N$ is a smooth map between $n$-manifolds with or without boundary and $\mu$ is a density on $N$, we define a denisty $F^* \mu$ on $M$ by

$$
  (F^* \mu)_\mathbf{p} (\mathbf{v}_1,\dots,\mathbf{v}_n) = \mu_{F(\mathbf{p})}(\d F_\mathbf{p}(\mathbf{v}_1),\dots,\d F_\mathbf{p}(\mathbf{v}_n))
$$
</MathBox>

<MathBox title='' boxType='proposition'>
Let $G:P\to M$ and $F:M\to N$ be smooth maps between $n$-manifolds with or without boundary, and let $\mu$ be a density on $N$.
1. $F^* (f\mu) = (f\circ F) F^* \mu$, for any $f\in C^infty (N)$
2. If $\omega$ is an $n$-form on $N$, then $F^*|\omega| = |F^* \omega|$
3. If $\mu$ is smooth, then $F^* \mu$ is a smooth density on $M$
4. $(F\circ G)^* \mu = G^* (F^* \mu)$
</MathBox>

<MathBox title='Density pullback in coordinate form' boxType='proposition'>
Suppose $F:M\to N$ is a smooth map between $n$-manifolds with or without boundary. If $(x^i)$ and $(y^i)$ are smooth coordinates on open subsets $U\subseteq M$ and $V\subseteq N$, respectively, and $u$ is a continuous real-valued function on $V$, then the following holds on $U\cap F^{-1} (V)$

$$
  F^* \left(u\left| \bigwedge_{i=1}^n \d y^i \right|\right) = (u\circ F)|\det(\d F)| \left| \bigwedge_{i=1}^n \d y^i \right|
$$

<details>
<summary>Proof</summary>

By pullback properties we obtain

$$
\begin{align*}
  F^* \left(u\left| \bigwedge_{i=1}^n \d y^i \right|\right) =& (u\circ F)F^* \left| \bigwedge_{i=1}^n \d y^i \right| \\
  =& (u\circ F) \left| F^* \bigwedge_{i=1}^n \d y^i \right| \\
  =& (u\circ F) \left|\det(\D F) \bigwedge_{i=1}^n \d y^i \right| \\
  =& (u\circ F) |\det(\D F)| \left| \bigwedge_{i=1}^n \d y^i \right|
\end{align*}
$$
</details>
</MathBox>

<MathBox title='Integral of densities on Euclidean spaces' boxType='definition'>
If $D\subseteq\R^n$ is a domain of integration and $\mu$ is a density on $\overline{D}$, we can write $\mu = f\left|\bigwedge_{i=1}^n \d x^i \right|$ for some uniquely determined continuous function $f:\overline{D}\to\R$. We define the *integral* of $\mu$ over $D$ by

$$
  \int_D \mu = \int_D f\;\d V
$$

or equivalently

$$
  \int_D f \left|mathrm{d}x^1 \wedge\cdots\wedge \d x^n \right| = \int_D f\;\d x^1\cdots\d x^n
$$

Similarly, if $U$ is an open subset of $\R^n$ or $\mathbb{H}^n$ and $\mu$ is compactly supported in $U$, we define

$$
  \int_U \mu = \int_D \mu
$$

where $D$ is any domain of integration containing the support of $mu$.
</MathBox>

<MathBox title='Diffeomorphism invariance of integrals of densities' boxType='proposition'>
Suppose $U$ and $V$ are open subsets of $\R^n$ or $\mathbb{H}^n$, and that $G:U\to V$ is a diffeomorphism. If $\mu$ is a compactly supported density on $V$, then

$$
  \int_V \mu = \int_U G^* \mu
$$
</MathBox>

<MathBox title='Integral of densities on manifolds' boxType='definition'>
Let $M$ be a smooth $n$-manifold with or without boundary. If $\mu$ is a denisty on $M$ whose support is contained in the domain of a single smooth chart $(U,\varphi)$, the *integral* of $\mu$ over $M$ is defined As

$$
  \int_M \mu = \int_{\varphi(U)} (\varphi^{-1})^* \mu
$$

This is extended to arbitrary densities $\mu$ by setting

$$
  \int_M \mu = \sum_i \int_M \psi_i \mu
$$

where $\Set{\psi_i}$ is a smooth partition of unity subordinate to an open cover of $M$ by smooth charts.
</MathBox>

<MathBox title='Properties of integral of densities' boxType='proposition'>
Suppose $M$ and $N$ are smooth $n$-manifolds with or without boundary, and that $\mu$ and $\eta$ are compactly supported densities on $M$.
1. **(Linearity):** If $a,b\in\R$, Then
$$
  \int_M a\mu + b\eta = a\int_M \mu + b\int_M \eta
$$
2. **(Positivity):** If $\mu$ is a positive density, then $\int_M \mu > 0$
3. **(Diffeomorphism invariance):** If $F:N\to M$ is a diffeomorphism, then
$$
  \int_M \mu = \int_N F^* \mu
$$
</MathBox>

### The Riemannian density

<MathBox title='The Riemannian density' boxType='proposition'>
Let $(M,g)$ be a Riemannian $n$-manifold with or without boundary. There is a unique smooth positive density $\mu_g$ on $M$, called the *Riemannian density*, with the property that

$$
  \mu_g(\mathbf{E}_1,\dots,\mathbf{E}_n) = 1
$$

for any local orthonormal frame $(\mathbf{E}_i)_{i=1}^n$.

<details>
<summary>Proof</summary>

Uniqueness is immediate, because any two densities that agree on a basis must be equal. Given any point $\mathbf{p}\in M$, let $U$ be a connected smooth coordinate neighbourhood of $\mathbf{p}$. Since $U$ is diffeomorphic to an open subset of Euclidean space, it is orientable. Any choice of orientation of $U$ uniquely determines a Riemannian volume form $\omega_g$ on $U$, with the property that $\omega_g (\mathbf{E}_1,\dots,\mathbf{E}_n) = 1$ for any oriented orthonormal frame. If we put $\mu_g = |\omega_g|$, it follows easily that $\mu_g$ is a smooth positive density on $U$ satisfying the stated property. If $U$ and $V$ are two overlapping smooth coordinate neighbourhoods, the two definitions of $\mu_g$ agree where they overlap by uniqueness, so this defines $\mu_g$ globally.
</details>
</MathBox>

<MathBox title='Integral of Riemannian density' boxType='definition'>
Let $(M,g)$ be a Riemannian $n$-manifold with or without boundary, and with Riemannian density $\mu_g = \d V_g$. If $f:M\to\R$ is a compact supported continuous function, the integral of $f$ over $M$ is defined to because

$$
  \int_M f\d V_g
$$
</MathBox>

<MathBox title='The divergence theorem in the nonorientable case' boxType='theorem'>
Let $(M,g)$ be a nonorientable Riemannian $n$-manifold with boundary. For any compactly supported smooth vector field $\mathbf{X}$ on $M$

$$
  \int_M \div(\mathbf{X})\mu_g = \int_{\partial M} \langle\mathbf{X},\mathbf{N}\rangle_g \mu_{\tilde{g}}
$$

where $N$ is the outward-pointing unit normal vector field along $\partial M$, $\tilde{g}$ is the induced Riemannian metric on $\partial M$, and $\mu_g,\mu_{\tilde{g}}$ are the Riemannian densities of $g$ and $\tilde{g}$, respectively.

<details>
<summary>Proof</summary>

Let $\hat{\pi}:\hat{M}\to M$ be the orientation covering of $M$. Note that $\hat{\pi}$ restrict to a smooth covering map from each component of $\partial\hat{M}$ to a component of $\partial M$, so $\hat{\pi}:\partial\hat{M}\to\partial M$ is a generalized covering map.

Define the metrics $\hat{g} = \ha{\pi}^* g$ on $\hat{M}$ and $\overline{g} = \hat{g}^* \tilde{g}$ on $\partial\hat{M}$. Denote the Riemannian volume forms of $\hat{g}$ and $\overline{g}$ by $\omega_\hat{g}$ and $\omega_{\overline{g}}$, respectively, and their Riemannian densities by $\mu_\hat{g}$ and $\mu_{\overline{g}}$. Because $\hat{\pi}$ is a local isometry, it is easy to check that the outward unit normal $\hat{N}$ along $\partial\hat{M}$ is $\hat{\pi}$-related to $N$. Moreover, it follows that there is a unique smooth vector field $\hat{X}$ on $\hat{M}$ that is $\hat{\pi}$-related to $\mathbf{X}$.

Since $\hat{M}$ is an oriented smooth Riemannian manifold with boundary, we can apply the usual divergence theorem to it

$$
\begin{align*}
  2\int_M \div(\mathbf{X})\mu_g =& \int_{\hat{M}} \hat{\pi}^* (\div(\mathbf{X})\mu_g) \\
  =& \int_\hat{M} \div(\hat{X})\mu_\hat{g} \\
  =& \int_\hat{M} \div(\hat{X})\omega_\hat{g} \\
  =& \int_{\partial\hat{M}} \langle \hat{X}, \hat{N} \rangle_g \omega_{\overline{g}} \\
  =& \int_{\partial\hat{M}} \langle \hat{X}, \hat{N} \rangle_g \mu_{\overline{g}} \\
  =& \int_{\partial\hat{M}} (\hat{\pi}|_{\partial\hat{M}})^* (\langle X, n \rangle_g \mu_{\tilde{g}}) \\
  =& 2\int_{\partial\hat{M}} \langle\mathbf{X},\mathbf{N}\rangle_g \mu_{\tilde{g}}
\end{align*}
$$
</details>
</MathBox>
